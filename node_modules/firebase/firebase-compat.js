!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).firebase=t()}(this,function(){"use strict";const t={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},f=function(e,t){if(!e)throw u(t)},u=function(e){return new Error("Firebase Database ("+t.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},n=function(t){const n=[];let r=0;for(let i=0;i<t.length;i++){let e=t.charCodeAt(i);e<128?n[r++]=e:(e<2048?n[r++]=e>>6|192:(55296==(64512&e)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(e=65536+((1023&e)<<10)+(1023&t.charCodeAt(++i)),n[r++]=e>>18|240,n[r++]=e>>12&63|128):n[r++]=e>>12|224,n[r++]=e>>6&63|128),n[r++]=63&e|128)}return n},r={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();var r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_;const i=[];for(let u=0;u<n.length;u+=3){var s=n[u],a=u+1<n.length,o=a?n[u+1]:0,c=u+2<n.length,l=c?n[u+2]:0;let e=(15&o)<<2|l>>6,t=63&l;c||(t=64,a||(e=64)),i.push(r[s>>2],r[(3&s)<<4|o>>4],r[e],r[t])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(n(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){var i,s,a=e[n++];a<128?t[r++]=String.fromCharCode(a):191<a&&a<224?(i=e[n++],t[r++]=String.fromCharCode((31&a)<<6|63&i)):239<a&&a<365?(s=((7&a)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))):(i=e[n++],s=e[n++],t[r++]=String.fromCharCode((15&a)<<12|(63&i)<<6|63&s))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();var n=t?this.charToByteMapWebSafe_:this.charToByteMap_;const r=[];for(let c=0;c<e.length;){var i=n[e.charAt(c++)],s=c<e.length?n[e.charAt(c)]:0;++c;var a=c<e.length?n[e.charAt(c)]:64;++c;var o=c<e.length?n[e.charAt(c)]:64;if(++c,null==i||null==s||null==a||null==o)throw new l;r.push(i<<2|s>>4),64!==a&&(r.push(s<<4&240|a>>2),64!==o&&r.push(a<<6&192|o))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class l extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}function i(e){var t=n(e);return r.encodeByteArray(t,!0)}const s=function(e){return i(e).replace(/\./g,"")},a=function(e){try{return r.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function c(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:const n=t;return new Date(n.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const r in t)t.hasOwnProperty(r)&&"__proto__"!==r&&(e[r]=c(e[r],t[r]));return e}function o(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}const e=()=>o().__FIREBASE_DEFAULTS__,h=()=>{if("undefined"!=typeof process&&void 0!==process.env){var e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0}},d=()=>{if("undefined"!=typeof document){let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}var t=e&&a(e[1]);return t&&JSON.parse(t)}},p=()=>{try{return e()||h()||d()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},g=()=>{var e;return null===(e=p())||void 0===e?void 0:e.config};var m,v;class y{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(n){return(e,t)=>{e?this.reject(e):this.resolve(t),"function"==typeof n&&(this.promise.catch(()=>{}),1===n.length?n(e):n(e,t))}}}function _(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");i=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(i)),""].join(".")}function w(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function b(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(w())}function I(){var e=null===(e=p())||void 0===e?void 0:e.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function T(){var e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function E(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function k(){const e=w();return 0<=e.indexOf("MSIE ")||0<=e.indexOf("Trident/")}function S(){return!0===t.NODE_ADMIN}function C(){try{return"object"==typeof indexedDB}catch(e){return!1}}function N(){return new Promise((t,n)=>{try{let e=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),e||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{e=!1},i.onerror=()=>{var e;n((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){n(e)}})}function A(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class R extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,R.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,D.prototype.create)}}class D{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var r,n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],s=s?(r=n,s.replace(x,(e,t)=>{var n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",s=`${this.serviceName}: ${s} (${i}).`;return new R(i,s,n)}}const x=/\{\$([^}]+)}/g;function P(e){return JSON.parse(e)}function O(e){return JSON.stringify(e)}function M(e){let t={},n={},r={},i="";try{var s=e.split(".");t=P(a(s[0])||""),n=P(a(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}}function L(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function F(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function U(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function q(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function V(e,t){if(e===t)return 1;const n=Object.keys(e),r=Object.keys(t);for(const a of n){if(!r.includes(a))return;var i=e[a],s=t[a];if(B(i)&&B(s)){if(!V(i,s))return}else if(i!==s)return}for(const o of r)if(!n.includes(o))return;return 1}function B(e){return null!==e&&"object"==typeof e}function j(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function z(e){const r={},t=e.replace(/^\?/,"").split("&");return t.forEach(e=>{var t,n;e&&([t,n]=e.split("="),r[decodeURIComponent(t)]=decodeURIComponent(n))}),r}function $(e){var t=e.indexOf("?");if(!t)return"";var n=e.indexOf("#",t);return e.substring(t,0<n?n:void 0)}class K{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(n,r){r=r||0;const i=this.W_;if("string"==typeof n)for(let e=0;e<16;e++)i[e]=n.charCodeAt(r)<<24|n.charCodeAt(r+1)<<16|n.charCodeAt(r+2)<<8|n.charCodeAt(r+3),r+=4;else for(let t=0;t<16;t++)i[t]=n[r]<<24|n[r+1]<<16|n[r+2]<<8|n[r+3],r+=4;for(let d=16;d<80;d++){var e=i[d-3]^i[d-8]^i[d-14]^i[d-16];i[d]=4294967295&(e<<1|e>>>31)}let t=this.chain_[0],s=this.chain_[1],a=this.chain_[2],o=this.chain_[3],c=this.chain_[4],l,u;for(let p=0;p<80;p++){u=p<40?p<20?(l=o^s&(a^o),1518500249):(l=s^a^o,1859775393):p<60?(l=s&a|o&(s|a),2400959708):(l=s^a^o,3395469782);var h=(t<<5|t>>>27)+l+c+u+i[p]&4294967295;c=o,o=a,a=4294967295&(s<<30|s>>>2),s=t,t=h}this.chain_[0]=this.chain_[0]+t&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+o&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(n,r){if(null!=n){var i=(r=void 0===r?n.length:r)-this.blockSize;let e=0;const s=this.buf_;let t=this.inbuf_;for(;e<r;){if(0===t)for(;e<=i;)this.compress_(n,e),e+=this.blockSize;if("string"==typeof n){for(;e<r;)if(s[t]=n.charCodeAt(e),++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}else for(;e<r;)if(s[t]=n[e],++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}this.inbuf_=t,this.total_+=r}}digest(){const t=[];let e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;56<=r;r--)this.buf_[r]=255&e,e/=256;this.compress_(this.buf_);let n=0;for(let i=0;i<5;i++)for(let e=24;0<=e;e-=8)t[n]=this.chain_[i]>>e&255,++n;return t}}function W(e,t){const n=new G(e,t);return n.subscribe.bind(n)}class G{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=H),void 0===r.error&&(r.error=H),void 0===r.complete&&(r.complete=H);var i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],--this.observerCount,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function H(){}function Q(e,t,n,r){let i;if(r<t?i="at least "+t:n<r&&(i=0===n?"none":"no more than "+n),i){var s=e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".";throw new Error(s)}}function Y(e,t){return`${e} failed: ${t} argument `}function J(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(Y(e,t)+"must be a valid function.")}function X(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(Y(e,t)+"must be a valid context object.")}function Z(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})}const ee=function(e){let t=0;for(let r=0;r<e.length;r++){var n=e.charCodeAt(r);n<128?t++:n<2048?t+=2:55296<=n&&n<=56319?(t+=4,r++):t+=3}return t},te=1e3,ne=2,re=144e5,ie=.5;function se(e,t=te,n=ne){var r=t*Math.pow(n,e),i=Math.round(ie*r*(Math.random()-.5)*2);return Math.min(re,r+i)}function ae(e){return e&&e._delegate?e._delegate:e}class oe{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const ce="[DEFAULT]";class le{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new y;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{var n=this.getOrInitializeService({instanceIdentifier:t});n&&r.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!==(n=null==e?void 0:e.optional)&&void 0!==n&&n;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:ce})}catch(e){}for(var[t,n]of this.instancesDeferred.entries()){t=this.normalizeInstanceIdentifier(t);try{var r=this.getOrInitializeService({instanceIdentifier:t});n.resolve(r)}catch(e){}}}}clearInstance(e=ce){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=ce){return this.instances.has(e)}getOptions(e=ce){return this.instancesOptions.get(e)||{}}initialize(e={}){var{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);var r,i,s=this.getOrInitializeService({instanceIdentifier:n,options:t});for([r,i]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(r)&&i.resolve(s);return s}onInit(e,t){var n=this.normalizeInstanceIdentifier(t);const r=null!==(i=this.onInitCallbacks.get(n))&&void 0!==i?i:new Set;r.add(e),this.onInitCallbacks.set(n,r);var i=this.instances.get(n);return i&&e(i,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){var n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===ce?void 0:r,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=ce){return!this.component||this.component.multipleInstances?e:ce}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ue{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){const t=this.getProvider(e.name);t.isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);var t=new le(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const he=[];(Hn=m=m||{})[Hn.DEBUG=0]="DEBUG",Hn[Hn.VERBOSE=1]="VERBOSE",Hn[Hn.INFO=2]="INFO",Hn[Hn.WARN=3]="WARN",Hn[Hn.ERROR=4]="ERROR",Hn[Hn.SILENT=5]="SILENT";const de={debug:m.DEBUG,verbose:m.VERBOSE,info:m.INFO,warn:m.WARN,error:m.ERROR,silent:m.SILENT},pe=m.INFO,fe={[m.DEBUG]:"log",[m.VERBOSE]:"log",[m.INFO]:"info",[m.WARN]:"warn",[m.ERROR]:"error"},ge=(e,t,...n)=>{if(!(t<e.logLevel)){var r=(new Date).toISOString(),i=fe[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)}};class me{constructor(e){this.name=e,this._logLevel=pe,this._logHandler=ge,this._userLogHandler=null,he.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in m))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?de[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,m.DEBUG,...e),this._logHandler(this,m.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,m.VERBOSE,...e),this._logHandler(this,m.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,m.INFO,...e),this._logHandler(this,m.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,m.WARN,...e),this._logHandler(this,m.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,m.ERROR,...e),this._logHandler(this,m.ERROR,...e)}}const ve=(t,e)=>e.some(e=>t instanceof e);let ye,_e;const we=new WeakMap,be=new WeakMap,Ie=new WeakMap,Te=new WeakMap,Ee=new WeakMap;let ke={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return be.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Ie.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ne(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function Se(r){return r!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(_e=_e||[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]).includes(r)?function(...e){return r.apply(Ae(this),e),Ne(we.get(this))}:function(...e){return Ne(r.apply(Ae(this),e))}:function(e,...t){var n=r.call(Ae(this),e,...t);return Ie.set(n,e.sort?e.sort():[e]),Ne(n)}}function Ce(e){return"function"==typeof e?Se(e):(e instanceof IDBTransaction&&(s=e,be.has(s)||(t=new Promise((e,t)=>{const n=()=>{s.removeEventListener("complete",r),s.removeEventListener("error",i),s.removeEventListener("abort",i)},r=()=>{e(),n()},i=()=>{t(s.error||new DOMException("AbortError","AbortError")),n()};s.addEventListener("complete",r),s.addEventListener("error",i),s.addEventListener("abort",i)}),be.set(s,t))),ve(e,ye=ye||[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])?new Proxy(e,ke):e);var s,t}function Ne(e){if(e instanceof IDBRequest)return function(s){const e=new Promise((e,t)=>{const n=()=>{s.removeEventListener("success",r),s.removeEventListener("error",i)},r=()=>{e(Ne(s.result)),n()},i=()=>{t(s.error),n()};s.addEventListener("success",r),s.addEventListener("error",i)});return e.then(e=>{e instanceof IDBCursor&&we.set(e,s)}).catch(()=>{}),Ee.set(e,s),e}(e);if(Te.has(e))return Te.get(e);var t=Ce(e);return t!==e&&(Te.set(e,t),Ee.set(t,e)),t}const Ae=e=>Ee.get(e);function Re(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(e,t),o=Ne(a);return r&&a.addEventListener("upgradeneeded",e=>{r(Ne(a.result),e.oldVersion,e.newVersion,Ne(a.transaction))}),n&&a.addEventListener("blocked",()=>n()),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",()=>i())}).catch(()=>{}),o}function De(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",()=>t()),Ne(n).then(()=>{})}const xe=["get","getKey","getAll","getAllKeys","count"],Pe=["put","add","delete","clear"],Oe=new Map;function Me(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(Oe.get(t))return Oe.get(t);const i=t.replace(/FromIndex$/,""),s=t!==i,a=Pe.includes(i);if(i in(s?IDBIndex:IDBObjectStore).prototype&&(a||xe.includes(i))){var n=async function(e,...t){var n=this.transaction(e,a?"readwrite":"readonly");let r=n.store;return s&&(r=r.index(t.shift())),(await Promise.all([r[i](...t),a&&n.done]))[0]};return Oe.set(t,n),n}}}ke={...v=ke,get:(e,t,n)=>Me(e,t)||v.get(e,t,n),has:(e,t)=>!!Me(e,t)||v.has(e,t)};class Le{constructor(e){this.container=e}getPlatformInfoString(){const e=this.container.getProviders();return e.map(e=>{if("VERSION"!==(null==(t=e.getComponent())?void 0:t.type))return null;var t,t=e.getImmediate();return`${t.library}/${t.version}`}).filter(e=>e).join(" ")}}const Fe="@firebase/app",Ue=new me("@firebase/app");var qe;const Ve="[DEFAULT]",Be={"@firebase/app":"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},je=new Map,ze=new Map;function $e(t,n){try{t.container.addComponent(n)}catch(e){Ue.debug(`Component ${n.name} failed to register with FirebaseApp ${t.name}`,e)}}function Ke(e,t){e.container.addOrOverwriteComponent(t)}function We(e){var t=e.name;if(ze.has(t))return Ue.debug(`There were multiple attempts to register component ${t}.`),!1;ze.set(t,e);for(const n of je.values())$e(n,e);return!0}function Ge(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const He=new D("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Qe{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new oe("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw He.create("app-deleted",{appName:this._name})}}const Ye="9.19.1";function Je(e,t={}){let n=e;if("object"!=typeof t){const i=t;t={name:i}}var r=Object.assign({name:Ve,automaticDataCollectionEnabled:!1},t);const i=r.name;if("string"!=typeof i||!i)throw He.create("bad-app-name",{appName:String(i)});if(n=n||g(),!n)throw He.create("no-options");var s=je.get(i);if(s){if(V(n,s.options)&&V(r,s.config))return s;throw He.create("duplicate-app",{appName:i})}const a=new ue(i);for(const o of ze.values())a.addComponent(o);r=new Qe(n,r,a);return je.set(i,r),r}function Xe(e=Ve){var t=je.get(e);if(!t&&e===Ve)return Je();if(!t)throw He.create("no-app",{appName:e});return t}async function Ze(e){var t=e.name;je.has(t)&&(je.delete(t),await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function et(e,t,n){let r=null!==(s=Be[e])&&void 0!==s?s:e;n&&(r+=`-${n}`);var i=r.match(/\s|\//),s=t.match(/\s|\//);if(i||s){const a=[`Unable to register library "${r}" with version "${t}":`];return i&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&a.push("and"),s&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Ue.warn(a.join(" "))}We(new oe(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}function tt(e,t){if(null!==e&&"function"!=typeof e)throw He.create("invalid-log-argument");!function(s,e){for(const t of he){let i=null;e&&e.level&&(i=de[e.level]),t.userLogHandler=null===s?null:(e,t,...n)=>{var r=n.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");t>=(null!==i&&void 0!==i?i:e.logLevel)&&s({level:m[t].toLowerCase(),message:r,args:n,type:e.name})}}}(e,t)}function nt(e){var t;t=e,he.forEach(e=>{e.setLogLevel(t)})}const rt="firebase-heartbeat-database",it=1,st="firebase-heartbeat-store";let at=null;function ot(){return at=at||Re(rt,it,{upgrade:(e,t)=>{0===t&&e.createObjectStore(st)}}).catch(e=>{throw He.create("idb-open",{originalErrorMessage:e.message})}),at}async function ct(e,t){try{const r=await ot(),i=r.transaction(st,"readwrite"),s=i.objectStore(st);return await s.put(t,lt(e)),i.done}catch(e){var n;e instanceof R?Ue.warn(e.message):(n=He.create("idb-set",{originalErrorMessage:null==e?void 0:e.message}),Ue.warn(n.message))}}function lt(e){return`${e.name}!${e.options.appId}`}class ut{constructor(e){this.container=e,this._heartbeatsCache=null;var t=this.container.getProvider("app").getImmediate();this._storage=new dt(t),this._heartbeatsCachePromise=this._storage.read().then(e=>this._heartbeatsCache=e)}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate();var t=e.getPlatformInfoString();const n=ht();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==n&&!this._heartbeatsCache.heartbeats.some(e=>e.date===n))return this._heartbeatsCache.heartbeats.push({date:n,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{var t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";var e=ht(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const s=n.find(e=>e.agent===i.agent);if(s){if(s.dates.push(i.date),pt(n)>t){s.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),pt(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),t=s(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,0<n.length?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),t}}function ht(){const e=new Date;return e.toISOString().substring(0,10)}class dt{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!C()&&N().then(()=>!0).catch(()=>!1)}async read(){return await this._canUseIndexedDBPromise&&await async function(e){try{const n=await ot();return n.transaction(st).objectStore(st).get(lt(e))}catch(e){var t;e instanceof R?Ue.warn(e.message):(t=He.create("idb-get",{originalErrorMessage:null==e?void 0:e.message}),Ue.warn(t.message))}}(this.app)||{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){var n=await this.read();return ct(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){var n=await this.read();return ct(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function pt(e){return s(JSON.stringify({version:2,heartbeats:e})).length}qe="",We(new oe("platform-logger",e=>new Le(e),"PRIVATE")),We(new oe("heartbeat",e=>new ut(e),"PRIVATE")),et(Fe,"0.9.7",qe),et(Fe,"0.9.7","esm2017"),et("fire-js","");var ft=Object.freeze({__proto__:null,SDK_VERSION:Ye,_DEFAULT_ENTRY_NAME:Ve,_addComponent:$e,_addOrOverwriteComponent:Ke,_apps:je,_clearComponents:function(){ze.clear()},_components:ze,_getProvider:Ge,_registerComponent:We,_removeServiceInstance:function(e,t,n=Ve){Ge(e,t).clearInstance(n)},deleteApp:Ze,getApp:Xe,getApps:function(){return Array.from(je.values())},initializeApp:Je,onLog:tt,registerVersion:et,setLogLevel:nt,FirebaseError:R});class gt{constructor(e,t){this._delegate=e,this.firebase=t,$e(e,new oe("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),Ze(this._delegate)))}_getService(e,t=Ve){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=Ve){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){$e(this._delegate,e)}_addOrOverwriteComponent(e){Ke(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const mt=new D("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."});function vt(i){const s={},a={__esModule:!0,initializeApp:function(e,t={}){var n=Je(e,t);if(L(s,n.name))return s[n.name];var r=new i(n,a);return s[n.name]=r},app:o,registerVersion:et,setLogLevel:nt,onLog:tt,apps:null,SDK_VERSION:Ye,INTERNAL:{registerComponent:function(n){const r=n.name,t=r.replace("-compat","");{var e;We(n)&&"PUBLIC"===n.type&&(e=(e=o())=>{if("function"!=typeof e[t])throw mt.create("invalid-app-argument",{appName:r});return e[t]()},void 0!==n.serviceProps&&c(e,n.serviceProps),a[t]=e,i.prototype[t]=function(...e){const t=this._getService.bind(this,r);return t.apply(this,n.multipleInstances?e:[])})}return"PUBLIC"===n.type?a[t]:null},removeApp:function(e){delete s[e]},useAsService:function(e,t){if("serverAuth"===t)return null;var n=t;return n},modularAPIs:ft}};function o(e){if(e=e||Ve,!L(s,e))throw mt.create("no-app",{appName:e});return s[e]}return a.default=a,Object.defineProperty(a,"apps",{get:function(){return Object.keys(s).map(e=>s[e])}}),o.App=i,a}var yt=function e(){const t=vt(gt);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){c(t,e)},createSubscribe:W,ErrorFactory:D,deepExtend:c}),t}();const _t=new me("@firebase/app-compat");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){_t.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);const fO=self.firebase.SDK_VERSION;fO&&0<=fO.indexOf("LITE")&&_t.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}const wt=yt;et("@firebase/app-compat","0.2.7",void 0);wt.registerVersion("firebase","9.19.1","app-compat");var bt="@firebase/installations",It="0.6.4";const Tt=1e4,Et="w:0.6.4",kt="FIS_v2",St="https://firebaseinstallations.googleapis.com/v1",Ct=36e5;const Nt=new D("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function At(e){return e instanceof R&&e.code.includes("request-failed")}function Rt({projectId:e}){return`${St}/projects/${e}/installations`}function Dt(e){return{token:e.token,requestStatus:2,expiresIn:(e=e.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()}}async function xt(e,t){var n=(await t.json()).error;return Nt.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Pt({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function Ot(e,{refreshToken:t}){const n=Pt(e);return n.append("Authorization",(t=t,`${kt} ${t}`)),n}async function Mt(e){var t=await e();return 500<=t.status&&t.status<600?e():t}function Lt(t){return new Promise(e=>{setTimeout(e,t)})}const Ft=/^[cdef][\w-]{21}$/,Ut="";function qt(){try{const t=new Uint8Array(17),n=self.crypto||self.msCrypto;n.getRandomValues(t),t[0]=112+t[0]%16;var e=function(e){const t=function(e){const t=btoa(String.fromCharCode(...e));return t.replace(/\+/g,"-").replace(/\//g,"_")}(e);return t.substr(0,22)}(t);return Ft.test(e)?e:Ut}catch(e){return Ut}}function Vt(e){return`${e.appName}!${e.appId}`}const Bt=new Map;function jt(e,t){var n=Vt(e);zt(n,t),function(e,t){const n=function(){!$t&&"BroadcastChannel"in self&&($t=new BroadcastChannel("[Firebase] FID Change"),$t.onmessage=e=>{zt(e.data.key,e.data.fid)});return $t}();n&&n.postMessage({key:e,fid:t});0===Bt.size&&$t&&($t.close(),$t=null)}(n,t)}function zt(e,t){var n=Bt.get(e);if(n)for(const r of n)r(t)}let $t=null;const Kt="firebase-installations-store";let Wt=null;function Gt(){return Wt=Wt||Re("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Kt)}}),Wt}async function Ht(e,t){var n=Vt(e);const r=await Gt(),i=r.transaction(Kt,"readwrite"),s=i.objectStore(Kt);var a=await s.get(n);return await s.put(t,n),await i.done,a&&a.fid===t.fid||jt(e,t.fid),t}async function Qt(e){var t=Vt(e);const n=await Gt(),r=n.transaction(Kt,"readwrite");await r.objectStore(Kt).delete(t),await r.done}async function Yt(e,t){var n=Vt(e);const r=await Gt(),i=r.transaction(Kt,"readwrite"),s=i.objectStore(Kt);var a=await s.get(n),o=t(a);return void 0===o?await s.delete(n):await s.put(o,n),await i.done,!o||a&&a.fid===o.fid||jt(e,o.fid),o}async function Jt(n){let r;var e=await Yt(n.appConfig,e=>{var t=Zt(e||{fid:qt(),registrationStatus:0}),t=function(e,t){{if(0!==t.registrationStatus)return 1===t.registrationStatus?{installationEntry:t,registrationPromise:async function(e){let t=await Xt(e.appConfig);for(;1===t.registrationStatus;)await Lt(100),t=await Xt(e.appConfig);if(0!==t.registrationStatus)return t;{var{installationEntry:n,registrationPromise:r}=await Jt(e);return r||n}}(e)}:{installationEntry:t};if(!navigator.onLine){var n=Promise.reject(Nt.create("app-offline"));return{installationEntry:t,registrationPromise:n}}var r={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},n=async function(t,n){try{var e=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=Rt(e),i=Pt(e),s=t.getImmediate({optional:!0});!s||(a=await s.getHeartbeatsHeader())&&i.append("x-firebase-client",a);var a={fid:n,authVersion:kt,appId:e.appId,sdkVersion:Et};const o={method:"POST",headers:i,body:JSON.stringify(a)},c=await Mt(()=>fetch(r,o));if(c.ok){a=await c.json();return{fid:a.fid||n,registrationStatus:2,refreshToken:a.refreshToken,authToken:Dt(a.authToken)}}throw await xt("Create Installation",c)}(t,n);return Ht(t.appConfig,e)}catch(e){throw At(e)&&409===e.customData.serverCode?await Qt(t.appConfig):await Ht(t.appConfig,{fid:n.fid,registrationStatus:0}),e}}(e,r);return{installationEntry:r,registrationPromise:n}}}(n,t);return r=t.registrationPromise,t.installationEntry});return e.fid===Ut?{installationEntry:await r}:{installationEntry:e,registrationPromise:r}}function Xt(e){return Yt(e,e=>{if(!e)throw Nt.create("installation-not-found");return Zt(e)})}function Zt(e){return 1===(t=e).registrationStatus&&t.registrationTime+Tt<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function en({appConfig:e,heartbeatServiceProvider:t},n){const r=([i,s]=[e,n["fid"]],`${Rt(i)}/${s}/authTokens:generate`);var i,s;const a=Ot(e,n),o=t.getImmediate({optional:!0});!o||(c=await o.getHeartbeatsHeader())&&a.append("x-firebase-client",c);var c={installation:{sdkVersion:Et,appId:e.appId}};const l={method:"POST",headers:a,body:JSON.stringify(c)},u=await Mt(()=>fetch(r,l));if(u.ok)return Dt(await u.json());throw await xt("Generate Auth Token",u)}async function tn(r,i=!1){let s;var e=await Yt(r.appConfig,e=>{if(!rn(e))throw Nt.create("not-registered");var t,n=e.authToken;if(i||2!==(t=n).requestStatus||function(e){var t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+Ct}(t)){if(1===n.requestStatus)return s=async function(e,t){let n=await nn(e.appConfig);for(;1===n.authToken.requestStatus;)await Lt(100),n=await nn(e.appConfig);var r=n.authToken;return 0===r.requestStatus?tn(e,t):r}(r,i),e;if(!navigator.onLine)throw Nt.create("app-offline");n=(t=e,n={requestStatus:1,requestTime:Date.now()},Object.assign(Object.assign({},t),{authToken:n}));return s=async function(t,n){try{var r=await en(t,n),e=Object.assign(Object.assign({},n),{authToken:r});return await Ht(t.appConfig,e),r}catch(e){throw!At(e)||401!==e.customData.serverCode&&404!==e.customData.serverCode?(r=Object.assign(Object.assign({},n),{authToken:{requestStatus:0}}),await Ht(t.appConfig,r)):await Qt(t.appConfig),e}}(r,n),n}return e});return s?await s:e.authToken}function nn(e){return Yt(e,e=>{if(!rn(e))throw Nt.create("not-registered");var t,n=e.authToken;return 1===(t=n).requestStatus&&t.requestTime+Tt<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function rn(e){return void 0!==e&&2===e.registrationStatus}async function sn(e,t=!1){var n,r=e;return await((n=(await Jt(r)).registrationPromise)&&await n),(await tn(r,t)).token}function an(e){return Nt.create("missing-app-config-values",{valueName:e})}const on="installations",cn=e=>{var t=e.getProvider("app").getImmediate();return{app:t,appConfig:function(e){if(!e||!e.options)throw an("App Configuration");if(!e.name)throw an("App Name");for(const t of["projectId","apiKey","appId"])if(!e.options[t])throw an(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),heartbeatServiceProvider:Ge(t,"heartbeat"),_delete:()=>Promise.resolve()}},ln=e=>{const t=Ge(e.getProvider("app").getImmediate(),on).getImmediate();return{getId:()=>async function(e){var t=e;const{installationEntry:n,registrationPromise:r}=await Jt(t);return(r||tn(t)).catch(console.error),n.fid}(t),getToken:e=>sn(t,e)}};We(new oe(on,cn,"PUBLIC")),We(new oe("installations-internal",ln,"PRIVATE")),et(bt,It),et(bt,It,"esm2017");const un="analytics",hn="firebase_id",dn="origin",pn="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",fn="https://www.googletagmanager.com/gtag/js",gn=new me("@firebase/analytics"),mn=new D("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function vn(e){if(e.startsWith(fn))return e;var t=mn.create("invalid-gtag-resource",{gtagURL:e});return gn.warn(t.message),""}function yn(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function _n(e,t){const n=function(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(e,t)),n}("firebase-js-sdk-policy",{createScriptURL:vn}),r=document.createElement("script");var i=`${fn}?l=${e}&id=${t}`;r.src=n?null===n||void 0===n?void 0:n.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}function wn(r,i,s,a){return async function(e,t,n){try{"event"===e?await async function(e,n,r,i,s){try{let t=[];if(s&&s.send_to){let e=s.send_to;Array.isArray(e)||(e=[e]);const c=await yn(r);for(const l of e){var a=c.find(e=>e.measurementId===l),o=a&&n[a.appId];if(!o){t=[];break}t.push(o)}}0===t.length&&(t=Object.values(n)),await Promise.all(t),e("event",i,s||{})}catch(e){gn.error(e)}}(r,i,s,t,n):"config"===e?await async function(e,t,n,r,i,s){var a=r[i];try{if(a)await t[a];else{const c=await yn(n);var o=c.find(e=>e.measurementId===i);o&&await t[o.appId]}}catch(e){gn.error(e)}e("config",i,s)}(r,i,s,a,t,n):"consent"===e?r("consent","update",n):r("set",t)}catch(e){gn.error(e)}}}const bn=30;const In=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};async function Tn(e){var t,{appId:n,apiKey:r}=e,r={method:"GET",headers:new Headers({Accept:"application/json","x-goog-api-key":r})},n=pn.replace("{app-id}",n);const i=await fetch(n,r);if(200===i.status||304===i.status)return i.json();{let e="";try{var s=await i.json();null!==(t=s.error)&&void 0!==t&&t.message&&(e=s.error.message)}catch(e){}throw mn.create("config-fetch-failed",{httpStatus:i.status,responseMessage:e})}}async function En(e,t=In,n){var{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw mn.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw mn.create("no-api-key")}var a=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()};const o=new Cn;return setTimeout(async()=>{o.abort()},void 0!==n?n:6e4),async function t(n,{throttleEndTimeMillis:e,backoffCount:r},i,s=In){var a;const{appId:o,measurementId:c}=n;try{await kn(i,e)}catch(e){if(c)return gn.warn("Timed out fetching this Firebase app's measurement ID from the server."+` Falling back to the measurement ID ${c}`+` provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:o,measurementId:c};throw e}try{const l=await Tn(n);return s.deleteThrottleMetadata(o),l}catch(e){const u=e;if(!Sn(u)){if(s.deleteThrottleMetadata(o),c)return gn.warn("Failed to fetch this Firebase app's measurement ID from the server."+` Falling back to the measurement ID ${c}`+` provided in the "measurementId" field in the local Firebase config. [${null===u||void 0===u?void 0:u.message}]`),{appId:o,measurementId:c};throw e}const h=503===Number(null===(a=null===u||void 0===u?void 0:u.customData)||void 0===a?void 0:a.httpStatus)?se(r,s.intervalMillis,bn):se(r,s.intervalMillis),d={throttleEndTimeMillis:Date.now()+h,backoffCount:r+1};return s.setThrottleMetadata(o,d),gn.debug(`Calling attemptFetch again in ${h} millis`),t(n,d,i,s)}}({appId:r,apiKey:i,measurementId:s},a,o,t)}function kn(i,s){return new Promise((e,t)=>{var n=Math.max(s-Date.now(),0);const r=setTimeout(e,n);i.addEventListener(()=>{clearTimeout(r),t(mn.create("fetch-throttle",{throttleEndTimeMillis:s}))})})}function Sn(e){if(!(e instanceof R&&e.customData))return!1;var t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}class Cn{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Nn(t,e,n,r,i,s,a){const o=En(t);o.then(e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&gn.warn(`The measurement ID in the local Firebase config (${t.options.measurementId})`+` does not match the measurement ID fetched from the server (${e.measurementId}).`+" To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")}).catch(e=>gn.error(e)),e.push(o);var c=async function(){if(!C())return gn.warn(mn.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await N()}catch(e){return gn.warn(mn.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then(e=>{if(e)return r.getId()}),[l,u]=await Promise.all([o,c]);!function(e){var t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(fn)&&n.src.includes(e))return n}(s)&&_n(s,l.measurementId),i("js",new Date);const h=null!==(c=null==a?void 0:a.config)&&void 0!==c?c:{};return h[dn]="firebase",h.update=!0,null!=u&&(h[hn]=u),i("config",l.measurementId,h),l.measurementId}class An{constructor(e){this.app=e}_delete(){return delete Rn[this.app.options.appId],Promise.resolve()}}let Rn={},Dn=[];const xn={};let Pn="dataLayer",On="gtag",Mn,Ln,Fn=!1;function Un(e){if(Fn)throw mn.create("already-initialized");e.dataLayerName&&(Pn=e.dataLayerName),e.gtagName&&(On=e.gtagName)}function qn(e,t,n){!function(){const e=[];var t;T()&&e.push("This is a browser extension environment."),A()||e.push("Cookies are not available."),0<e.length&&(t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),t=mn.create("invalid-analytics-context",{errorInfo:t}),gn.warn(t.message))}();var r,i,s=e.options.appId;if(!s)throw mn.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw mn.create("no-api-key");gn.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest'+` measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId}`+' provided in the "measurementId" field in the local Firebase config.')}if(null!=Rn[s])throw mn.create("already-exists",{id:s});return Fn||(function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t,t}(Pn),{wrappedGtag:r,gtagCore:i}=function(e,t,n,r,i){let s=function(){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=wn(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(Rn,Dn,xn,Pn,On),Ln=r,Mn=i,Fn=!0),Rn[s]=Nn(e,Dn,xn,t,Mn,Pn,n),new An(e)}async function Vn(){if(T())return!1;if(!A())return!1;if(!C())return!1;try{return await N()}catch(e){return!1}}function Bn(e,t,n){e=ae(e),async function(e,t,n,r){if(r&&r.global)return e("set",{screen_name:n}),Promise.resolve();e("config",await t,{update:!0,screen_name:n})}(Ln,Rn[e.app.options.appId],t,n).catch(e=>gn.error(e))}function jn(e,t,n){e=ae(e),async function(e,t,n,r){if(r&&r.global)return e("set",{user_id:n}),Promise.resolve();e("config",await t,{update:!0,user_id:n})}(Ln,Rn[e.app.options.appId],t,n).catch(e=>gn.error(e))}function zn(e,t,n){e=ae(e),async function(e,t,n,r){if(r&&r.global){const i={};for(const s of Object.keys(n))i[`user_properties.${s}`]=n[s];return e("set",i),Promise.resolve()}e("config",await t,{update:!0,user_properties:n})}(Ln,Rn[e.app.options.appId],t,n).catch(e=>gn.error(e))}function $n(e,t){e=ae(e),async function(e,t){var n=await e;window[`ga-disable-${n}`]=!t}(Rn[e.app.options.appId],t).catch(e=>gn.error(e))}function Kn(e,t,n,r){e=ae(e),async function(e,t,n,r,i){var s;i&&i.global?e("event",n,r):(s=await t,e("event",n,Object.assign(Object.assign({},r),{send_to:s})))}(Ln,Rn[e.app.options.appId],t,n,r).catch(e=>gn.error(e))}const Wn="@firebase/analytics";We(new oe(un,(e,{options:t})=>{return qn(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)},"PUBLIC")),We(new oe("analytics-internal",function(e){try{const r=e.getProvider(un).getImmediate();return{logEvent:(e,t,n)=>Kn(r,e,t,n)}}catch(e){throw mn.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),et(Wn,"0.9.5"),et(Wn,"0.9.5","esm2017");var Gn,Hn,Qn;class Yn{constructor(e,t){this.app=e,this._delegate=t}logEvent(e,t,n){Kn(this._delegate,e,t,n)}setCurrentScreen(e,t){Bn(this._delegate,e,t)}setUserId(e,t){jn(this._delegate,e,t)}setUserProperties(e,t){zn(this._delegate,e,t)}setAnalyticsCollectionEnabled(e){$n(this._delegate,e)}}(Hn=Gn=Gn||{}).ADD_SHIPPING_INFO="add_shipping_info",Hn.ADD_PAYMENT_INFO="add_payment_info",Hn.ADD_TO_CART="add_to_cart",Hn.ADD_TO_WISHLIST="add_to_wishlist",Hn.BEGIN_CHECKOUT="begin_checkout",Hn.CHECKOUT_PROGRESS="checkout_progress",Hn.EXCEPTION="exception",Hn.GENERATE_LEAD="generate_lead",Hn.LOGIN="login",Hn.PAGE_VIEW="page_view",Hn.PURCHASE="purchase",Hn.REFUND="refund",Hn.REMOVE_FROM_CART="remove_from_cart",Hn.SCREEN_VIEW="screen_view",Hn.SEARCH="search",Hn.SELECT_CONTENT="select_content",Hn.SELECT_ITEM="select_item",Hn.SELECT_PROMOTION="select_promotion",Hn.SET_CHECKOUT_OPTION="set_checkout_option",Hn.SHARE="share",Hn.SIGN_UP="sign_up",Hn.TIMING_COMPLETE="timing_complete",Hn.VIEW_CART="view_cart",Hn.VIEW_ITEM="view_item",Hn.VIEW_ITEM_LIST="view_item_list",Hn.VIEW_PROMOTION="view_promotion",Hn.VIEW_SEARCH_RESULTS="view_search_results";const Jn=e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("analytics").getImmediate();return new Yn(t,n)};Qn={Analytics:Yn,settings:Un,isSupported:Vn,EventName:Gn},wt.INTERNAL.registerComponent(new oe("analytics-compat",Jn,"PUBLIC").setServiceProps(Qn).setMultipleInstances(!0)),wt.registerVersion("@firebase/analytics-compat","0.2.5");const Xn=new Map,Zn={activated:!1,tokenObservers:[]},er={initialized:!1,enabled:!1};function tr(e){return Xn.get(e)||Object.assign({},Zn)}const nr="https://content-firebaseappcheck.googleapis.com/v1",rr="exchangeDebugToken",ir={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4};class sr{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,i<(this.nextErrorWaitInterval=r))throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new y,t=this.getNextRun(e),await new Promise(e=>{setTimeout(e,t)}),this.pending.resolve(),await this.pending.promise,this.pending=new y,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(e){this.retryPolicy(e)?this.process(!1).catch(()=>{}):this.stop()}var t}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();var t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}const ar=new D("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function or(e=!1){var t;return e?null===(t=self.grecaptcha)||void 0===t?void 0:t.enterprise:self.grecaptcha}function cr(e){if(!tr(e).activated)throw ar.create("use-before-activation",{appName:e.name})}function lr(e){var t=Math.round(e/1e3),n=Math.floor(t/86400),r=Math.floor((t-3600*n*24)/3600),i=Math.floor((t-3600*n*24-3600*r)/60),t=t-3600*n*24-3600*r-60*i;let s="";return n&&(s+=ur(n)+"d:"),r&&(s+=ur(r)+"h:"),s+=ur(i)+"m:"+ur(t)+"s",s}function ur(e){return 0===e?"00":10<=e?e.toString():"0"+e}async function hr({url:e,body:t},n){const r={"Content-Type":"application/json"},i=n.getImmediate({optional:!0});!i||(c=await i.getHeartbeatsHeader())&&(r["X-Firebase-Client"]=c);var s={method:"POST",body:JSON.stringify(t),headers:r};let a;try{a=await fetch(e,s)}catch(e){throw ar.create("fetch-network-error",{originalErrorMessage:null==e?void 0:e.message})}if(200!==a.status)throw ar.create("fetch-status-error",{httpStatus:a.status});let o;try{o=await a.json()}catch(e){throw ar.create("fetch-parse-error",{originalErrorMessage:null==e?void 0:e.message})}var c=o.ttl.match(/^([\d.]+)(s)$/);if(!c||!c[2]||isNaN(Number(c[1])))throw ar.create("fetch-parse-error",{originalErrorMessage:"ttl field (timeToLive) is not in standard Protobuf Duration "+`format: ${o.ttl}`});s=1e3*Number(c[1]),c=Date.now();return{token:o.token,expireTimeMillis:c+s,issuedAtTimeMillis:c}}const dr="firebase-app-check-database",pr=1,fr="firebase-app-check-store",gr="debug-token";let mr=null;function vr(){return mr||(mr=new Promise((t,n)=>{try{const e=indexedDB.open(dr,pr);e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{var t;n(ar.create("storage-open",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(fr,{keyPath:"compositeKey"})}}catch(e){n(ar.create("storage-open",{originalErrorMessage:null==e?void 0:e.message}))}}),mr)}async function yr(e,t){const n=await vr(),r=n.transaction(fr,"readwrite"),i=r.objectStore(fr),s=i.put({compositeKey:e,value:t});return new Promise((t,n)=>{s.onsuccess=e=>{t()},r.onerror=e=>{var t;n(ar.create("storage-set",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))}})}async function _r(e){const t=await vr(),i=t.transaction(fr,"readonly"),n=i.objectStore(fr),s=n.get(e);return new Promise((n,r)=>{s.onsuccess=e=>{var t=e.target.result;n(t?t.value:void 0)},i.onerror=e=>{var t;r(ar.create("storage-get",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))}})}function wr(e){return`${e.options.appId}-${e.name}`}const br=new me("@firebase/app-check");async function Ir(t){if(C()){let e=void 0;try{e=await _r(wr(t))}catch(e){br.warn(`Failed to read token from IndexedDB. Error: ${e}`)}return e}}function Tr(e,t){return C()?yr(wr(e),t).catch(e=>{br.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}async function Er(){let e=void 0;try{e=await _r(gr)}catch(e){}if(e)return e;var t,n=Z();return t=n,yr(gr,t).catch(e=>br.warn(`Failed to persist debug token to IndexedDB. Error: ${e}`)),n}function kr(){return er.enabled}async function Sr(){var e=er;if(e.enabled&&e.token)return e.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}const Cr={error:"UNKNOWN_ERROR"};async function Nr(e,t=!1){var n=e.app;cr(n);const r=tr(n);let i=r.token,s=void 0;if(i&&!Pr(i)&&(r.token=void 0,i=void 0),i||(o=await r.cachedTokenPromise)&&(Pr(o)?i=o:await Tr(n,void 0)),!t&&i&&Pr(i))return{token:i.token};let a=!1;if(kr()){r.exchangeTokenPromise||(r.exchangeTokenPromise=hr(function(e,t){var{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${nr}/projects/${n}/apps/${r}:${rr}?key=${i}`,body:{debug_token:t}}}(n,await Sr()),e.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),a=!0);var o=await r.exchangeTokenPromise;return await Tr(n,o),{token:(r.token=o).token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),a=!0),i=await tr(n).exchangeTokenPromise}catch(e){"appCheck/throttled"===e.code?br.warn(e.message):br.error(e),s=e}let c;return i?s?c=Pr(i)?{token:i.token,internalError:s}:Or(s):(c={token:i.token},r.token=i,await Tr(n,i)):c=Or(s),a&&xr(n,c),c}function Ar(e,t,n,r){var i=e["app"];const s=tr(i);i={next:n,error:r,type:t};if(s.tokenObservers=[...s.tokenObservers,i],s.token&&Pr(s.token)){const a=s.token;Promise.resolve().then(()=>{n({token:a.token}),Dr(e)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Dr(e))}function Rr(e,t){const n=tr(e);var r=n.tokenObservers.filter(e=>e.next!==t);0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),n.tokenObservers=r}function Dr(e){var t=e["app"];const n=tr(t);let r=n.tokenRefresher;r||(r=function(n){const r=n["app"];return new sr(async()=>{var e=tr(r);let t;if(t=e.token?await Nr(n,!0):await Nr(n),t.error)throw t.error;if(t.internalError)throw t.internalError},()=>!0,()=>{var e=tr(r);if(e.token){var t=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5,e=e.token.expireTimeMillis-3e5,t=Math.min(t,e);return Math.max(0,t-Date.now())}return 0},ir.RETRIAL_MIN_WAIT,ir.RETRIAL_MAX_WAIT)}(e),n.tokenRefresher=r),!r.isRunning()&&n.isTokenAutoRefreshEnabled&&r.start()}function xr(e,t){for(const n of tr(e).tokenObservers)try{"EXTERNAL"===n.type&&null!=t.error?n.error(t.error):n.next(t)}catch(e){}}function Pr(e){return 0<e.expireTimeMillis-Date.now()}function Or(e){return{token:(t=Cr,r.encodeString(JSON.stringify(t),!1)),error:e};var t}class Mr{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){var e=tr(this.app)["tokenObservers"];for(const t of e)Rr(this.app,t.next);return Promise.resolve()}}const Lr="https://www.google.com/recaptcha/api.js",Fr="https://www.google.com/recaptcha/enterprise.js";function Ur(t,n){const r=new y,e=tr(t);e.reCAPTCHAState={initialized:r};const i=Br(t);var s=or(!1);return s?Vr(t,n,s,i,r):function(e){const t=document.createElement("script");t.src=Lr,t.onload=e,document.head.appendChild(t)}(()=>{var e=or(!1);if(!e)throw new Error("no recaptcha");Vr(t,n,e,i,r)}),r.promise}function qr(t,n){const r=new y,e=tr(t);e.reCAPTCHAState={initialized:r};const i=Br(t);var s=or(!0);return s?Vr(t,n,s,i,r):function(e){const t=document.createElement("script");t.src=Fr,t.onload=e,document.head.appendChild(t)}(()=>{var e=or(!0);if(!e)throw new Error("no recaptcha");Vr(t,n,e,i,r)}),r.promise}function Vr(e,t,n,r,i){n.ready(()=>{!function(e,t,n,r){const i=n.render(r,{sitekey:t,size:"invisible"}),s=tr(e);s.reCAPTCHAState=Object.assign(Object.assign({},s.reCAPTCHAState),{widgetId:i})}(e,t,n,r),i.resolve(n)})}function Br(e){var t=`fire_app_check_${e.name}`;const n=document.createElement("div");return n.id=t,n.style.display="none",document.body.appendChild(n),t}async function jr(r){cr(r);const i=await tr(r).reCAPTCHAState.initialized.promise;return new Promise((e,t)=>{const n=tr(r).reCAPTCHAState;i.ready(()=>{e(i.execute(n.widgetId,{action:"fire_app_check"}))})})}class zr{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){Gr(this._throttleData);var t=await jr(this._app).catch(e=>{throw ar.create("recaptcha-error")});let e;try{e=await hr(function(e,t){var{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${nr}/projects/${n}/apps/${r}:exchangeRecaptchaV3Token?key=${i}`,body:{recaptcha_v3_token:t}}}(this._app,t),this._heartbeatServiceProvider)}catch(e){throw null!==(t=e.code)&&void 0!==t&&t.includes("fetch-status-error")?(this._throttleData=Wr(Number(null===(t=e.customData)||void 0===t?void 0:t.httpStatus),this._throttleData),ar.create("throttled",{time:lr(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):e}return this._throttleData=null,e}initialize(e){this._app=e,this._heartbeatServiceProvider=Ge(e,"heartbeat"),Ur(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof zr&&this._siteKey===e._siteKey}}class $r{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){Gr(this._throttleData);var t=await jr(this._app).catch(e=>{throw ar.create("recaptcha-error")});let e;try{e=await hr(function(e,t){var{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${nr}/projects/${n}/apps/${r}:exchangeRecaptchaEnterpriseToken?key=${i}`,body:{recaptcha_enterprise_token:t}}}(this._app,t),this._heartbeatServiceProvider)}catch(e){throw null!==(t=e.code)&&void 0!==t&&t.includes("fetch-status-error")?(this._throttleData=Wr(Number(null===(t=e.customData)||void 0===t?void 0:t.httpStatus),this._throttleData),ar.create("throttled",{time:lr(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):e}return this._throttleData=null,e}initialize(e){this._app=e,this._heartbeatServiceProvider=Ge(e,"heartbeat"),qr(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof $r&&this._siteKey===e._siteKey}}class Kr{constructor(e){this._customProviderOptions=e}async getToken(){var e=await this._customProviderOptions.getToken(),t=function(e){const t=M(e).claims;return"object"==typeof t&&t.hasOwnProperty("iat")?t.iat:null}(e.token),t=null!==t&&t<Date.now()&&0<t?1e3*t:Date.now();return Object.assign(Object.assign({},e),{issuedAtTimeMillis:t})}initialize(e){this._app=e}isEqual(e){return e instanceof Kr&&this._customProviderOptions.getToken.toString()===e._customProviderOptions.getToken.toString()}}function Wr(e,t){if(404===e||403===e)return{backoffCount:1,allowRequestsAfter:Date.now()+864e5,httpStatus:e};var n=t?t.backoffCount:0,r=se(n,1e3,2);return{backoffCount:n+1,allowRequestsAfter:Date.now()+r,httpStatus:e}}function Gr(e){if(e&&Date.now()-e.allowRequestsAfter<=0)throw ar.create("throttled",{time:lr(e.allowRequestsAfter-Date.now()),httpStatus:e.httpStatus})}function Hr(e=Xe(),t){const n=Ge(e=ae(e),"app-check");if(er.initialized||function(){var e=o();const t=er;if(t.initialized=!0,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN||!0===e.FIREBASE_APPCHECK_DEBUG_TOKEN){t.enabled=!0;const n=new y;t.token=n,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN?n.resolve(e.FIREBASE_APPCHECK_DEBUG_TOKEN):n.resolve(Er())}}(),kr()&&Sr().then(e=>console.log(`App Check debug token: ${e}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),n.isInitialized()){var r=n.getImmediate();const i=n.getOptions();if(i.isTokenAutoRefreshEnabled===t.isTokenAutoRefreshEnabled&&i.provider.isEqual(t.provider))return r;throw ar.create("already-initialized",{appName:e.name})}r=n.initialize({options:t});return function(t,e,n){const r=function(e,t){return Xn.set(e,t),Xn.get(e)}(t,Object.assign({},Zn));r.activated=!0,r.provider=e,r.cachedTokenPromise=Ir(t).then(e=>(e&&Pr(e)&&(r.token=e,xr(t,{token:e.token})),e)),r.isTokenAutoRefreshEnabled=void 0===n?t.automaticDataCollectionEnabled:n,r.provider.initialize(t)}(e,t.provider,t.isTokenAutoRefreshEnabled),tr(e).isTokenAutoRefreshEnabled&&Ar(r,"INTERNAL",()=>{}),r}const Qr="app-check-internal";We(new oe("app-check",e=>{var t,n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat");return t=n,e=r,new Mr(t,e)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(Qr).initialize()})),We(new oe(Qr,e=>{var t,n=e.getProvider("app-check").getImmediate();return t=n,{getToken:e=>Nr(t,e),addTokenListener:e=>Ar(t,"INTERNAL",e),removeTokenListener:e=>Rr(t.app,e)}},"PUBLIC").setInstantiationMode("EXPLICIT")),et("@firebase/app-check","0.6.4");const Yr=new D("appCheck","AppCheck",{"use-before-activation":"App Check is being used before activate() is called for FirebaseApp {$appName}. Call activate() before instantiating other Firebase services."});class Jr{constructor(e){this.app=e}activate(e,t){let n;n="string"==typeof e?new zr(e):e instanceof $r||e instanceof zr||e instanceof Kr?e:new Kr({getToken:e.getToken}),this._delegate=Hr(this.app,{provider:n,isTokenAutoRefreshEnabled:t})}setTokenAutoRefreshEnabled(e){if(!this._delegate)throw Yr.create("use-before-activation",{appName:this.app.name});!function(e,t){const n=tr(e.app);n.tokenRefresher&&(!0===t?n.tokenRefresher.start():n.tokenRefresher.stop()),n.isTokenAutoRefreshEnabled=t}(this._delegate,e)}getToken(e){if(!this._delegate)throw Yr.create("use-before-activation",{appName:this.app.name});return async function(e,t){var n=await Nr(e,t);if(n.error)throw n.error;return{token:n.token}}(this._delegate,e)}onTokenChanged(e,t,n){if(!this._delegate)throw Yr.create("use-before-activation",{appName:this.app.name});return function(e,t,n){let r=()=>{},i=()=>{};return r=null!=t.next?t.next.bind(t):t,null!=t.error?i=t.error.bind(t):n&&(i=n),Ar(e,"EXTERNAL",r,i),()=>Rr(e.app,r)}(this._delegate,e,t)}}const Xr=e=>{var t=e.getProvider("app-compat").getImmediate();return new Jr(t)};function Zr(e,t){var n={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}wt.INTERNAL.registerComponent(new oe("appCheck-compat",Xr,"PUBLIC").setServiceProps({ReCaptchaEnterpriseProvider:$r,ReCaptchaV3Provider:zr,CustomProvider:Kr})),wt.registerVersion("@firebase/app-check-compat","0.3.4");const ei={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},ti={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function ni(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}function ri(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}}const ii=ni,si=new D("auth","Firebase",ni()),ai=new me("@firebase/auth");function oi(e,...t){ai.logLevel<=m.ERROR&&ai.error(`Auth (${Ye}): ${e}`,...t)}function ci(e,...t){throw di(e,...t)}function li(e,...t){return di(e,...t)}function ui(e,t,n){var r=Object.assign(Object.assign({},ii()),{[t]:n});const i=new D("auth","Firebase",r);return i.create(t,{appName:e.name})}function hi(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&ci(e,"argument-error"),ui(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.`+"Did you pass a reference from a different Auth SDK?")}function di(e,...t){if("string"==typeof e)return si.create(e,...t);{var n=t[0];const r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}}function pi(e,t,...n){if(!e)throw di(t,...n)}function fi(e){var t="INTERNAL ASSERTION FAILED: "+e;throw oi(t),new Error(t)}function gi(e,t){e||fi(t)}const mi=new Map;function vi(e){gi(e instanceof Function,"Expected a class definition");let t=mi.get(e);return t?gi(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,mi.set(e,t)),t}function yi(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function _i(){return"http:"===wi()||"https:"===wi()}function wi(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class bi{constructor(e,t){gi((this.shortDelay=e)<(this.longDelay=t),"Short delay should be less than long delay!"),this.isMobile=b()||E()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(_i()||T()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function Ii(e,t){gi(e.emulator,"Emulator should always be set here");var n=e.emulator["url"];return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Ti{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl||("undefined"!=typeof self&&"fetch"in self?self.fetch:void fi("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static headers(){return this.headersImpl||("undefined"!=typeof self&&"Headers"in self?self.Headers:void fi("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static response(){return this.responseImpl||("undefined"!=typeof self&&"Response"in self?self.Response:void fi("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}}const Ei={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},ki=new bi(3e4,6e4);function Si(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Ci(i,s,a,o,e={}){return Ni(i,e,async()=>{let e={},t={};o&&("GET"===s?t=o:e={body:JSON.stringify(o)});var n=j(Object.assign({key:i.config.apiKey},t)).slice(1);const r=await i._getAdditionalHeaders();return r["Content-Type"]="application/json",i.languageCode&&(r["X-Firebase-Locale"]=i.languageCode),Ti.fetch()(Ri(i,i.config.apiHost,a,n),Object.assign({method:s,headers:r,referrerPolicy:"no-referrer"},e))})}async function Ni(t,e,n){t._canInitEmulator=!1;var r=Object.assign(Object.assign({},Ei),e);try{const a=new Di(t),o=await Promise.race([n(),a.promise]);a.clearNetworkTimeout();var i=await o.json();if("needConfirmation"in i)throw xi(t,"account-exists-with-different-credential",i);if(o.ok&&!("errorMessage"in i))return i;{const c=o.ok?i.errorMessage:i.error.message,[l,u]=c.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===l)throw xi(t,"credential-already-in-use",i);if("EMAIL_EXISTS"===l)throw xi(t,"email-already-in-use",i);if("USER_DISABLED"===l)throw xi(t,"user-disabled",i);var s=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw ui(t,s,u);ci(t,s)}}catch(e){if(e instanceof R)throw e;ci(t,"network-request-failed",{message:String(e)})}}async function Ai(e,t,n,r,i={}){var s=await Ci(e,t,n,r,i);return"mfaPendingCredential"in s&&ci(e,"multi-factor-auth-required",{_serverResponse:s}),s}function Ri(e,t,n,r){var i=`${t}${n}?${r}`;return e.config.emulator?Ii(e.config,i):`${e.config.apiScheme}://${i}`}class Di{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(li(this.auth,"network-request-failed")),ki.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function xi(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=li(e,t,r);return i.customData._tokenResponse=n,i}function Pi(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Oi(e){return 1e3*Number(e)}function Mi(e){var[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return oi("JWT malformed, contained fewer than 3 sections"),null;try{var i=a(n);return i?JSON.parse(i):(oi("Failed to decode base64 JWT payload"),null)}catch(e){return oi("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function Li(t,n,e=!1){if(e)return n;try{return n}catch(e){throw e instanceof R&&(n=[e["code"]][0],"auth/user-disabled"===n||"auth/user-token-expired"===n)&&t.auth.currentUser===t&&await t.auth.signOut(),e}}class Fi{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){var t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}this.errorBackoff=3e4;t=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,t)}schedule(e=!1){var t;this.isRunning&&(t=this.getInterval(e),this.timerId=setTimeout(async()=>{await this.iteration()},t))}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Ui{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Pi(this.lastLoginAt),this.creationTime=Pi(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function qi(e){var t=e.auth,n=await e.getIdToken(),r=await Li(e,async function(e,t){return Ci(e,"POST","/v1/accounts:lookup",t)}(t,{idToken:n}));pi(null==r?void 0:r.users.length,t,"internal-error");var i=r.users[0];e._notifyReloadListener(i);var s,a,t=null!==(n=i.providerUserInfo)&&void 0!==n&&n.length?i.providerUserInfo.map(e=>{var t=e["providerId"],n=Zr(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}):[],r=(s=e.providerData,a=t,[...s.filter(t=>!a.some(e=>e.providerId===t.providerId)),...a]),n=e.isAnonymous,t=!(e.email&&i.passwordHash||null!==r&&r.length),t=!!n&&t,t={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new Ui(i.createdAt,i.lastLoginAt),isAnonymous:t};Object.assign(e,t)}class Vi{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){pi(e.idToken,"internal-error"),pi(void 0!==e.idToken,"internal-error"),pi(void 0!==e.refreshToken,"internal-error");var t,n,n="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):(t=e.idToken,pi(n=Mi(t),"internal-error"),pi(void 0!==n.exp,"internal-error"),pi(void 0!==n.iat,"internal-error"),Number(n.exp)-Number(n.iat));this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}async getToken(e,t=!1){return pi(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){var i,s,{accessToken:n,refreshToken:r,expiresIn:a}=(s=t,await{accessToken:(a=await Ni(i=e,{},async()=>{var e=j({grant_type:"refresh_token",refresh_token:s}).slice(1),{tokenApiHost:t,apiKey:n}=i.config,n=Ri(i,t,"/v1/token",`key=${n}`);const r=await i._getAdditionalHeaders();return r["Content-Type"]="application/x-www-form-urlencoded",Ti.fetch()(n,{method:"POST",headers:r,body:e})})).access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token});this.updateTokensAndExpiration(n,r,Number(a))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){var{refreshToken:n,accessToken:r,expirationTime:i}=t;const s=new Vi;return n&&(pi("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(pi("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(pi("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Vi,this.toJSON())}_performRefresh(){return fi("not implemented")}}function Bi(e,t){pi("string"==typeof e||void 0===e,"internal-error",{appName:t})}class ji{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=Zr(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Fi(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Ui(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){var t=await Li(this,this.stsTokenManager.getToken(this.auth,e));return pi(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=ae(e);var r=await n.getIdToken(t),i=Mi(r);pi(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");var s="object"==typeof i.firebase?i.firebase:void 0,a=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:Pi(Oi(i.auth_time)),issuedAtTime:Pi(Oi(i.iat)),expirationTime:Pi(Oi(i.exp)),signInProvider:a||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=ae(e);await qi(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(pi(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ji(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){pi(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await qi(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){var e=await this.getIdToken();return await Li(this,async function(e,t){return Ci(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n=null!==(a=t.displayName)&&void 0!==a?a:void 0,r=null!==(g=t.email)&&void 0!==g?g:void 0,i=null!==(o=t.phoneNumber)&&void 0!==o?o:void 0,s=null!==(l=t.photoURL)&&void 0!==l?l:void 0,a=null!==(c=t.tenantId)&&void 0!==c?c:void 0,o=null!==(g=t._redirectEventId)&&void 0!==g?g:void 0,c=null!==(l=t.createdAt)&&void 0!==l?l:void 0,l=null!==(g=t.lastLoginAt)&&void 0!==g?g:void 0;const{uid:u,emailVerified:h,isAnonymous:d,providerData:p,stsTokenManager:f}=t;pi(u&&f,e,"internal-error");var g=Vi.fromJSON(this.name,f);pi("string"==typeof u,e,"internal-error"),Bi(n,e.name),Bi(r,e.name),pi("boolean"==typeof h,e,"internal-error"),pi("boolean"==typeof d,e,"internal-error"),Bi(i,e.name),Bi(s,e.name),Bi(a,e.name),Bi(o,e.name),Bi(c,e.name),Bi(l,e.name);const m=new ji({uid:u,auth:e,email:r,emailVerified:h,displayName:n,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:a,stsTokenManager:g,createdAt:c,lastLoginAt:l});return p&&Array.isArray(p)&&(m.providerData=p.map(e=>Object.assign({},e))),o&&(m._redirectEventId=o),m}static async _fromIdTokenResponse(e,t,n=!1){const r=new Vi;r.updateFromServerResponse(t);var i=new ji({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await qi(i),i}}class zi{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){var t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}zi.type="NONE";const $i=zi;function Ki(e,t,n){return`firebase:${e}:${t}:${n}`}class Wi{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;var{config:r,name:i}=this.auth;this.fullUserKey=Ki(this.userKey,r.apiKey,i),this.fullPersistenceKey=Ki("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){var e=await this.persistence._get(this.fullUserKey);return e?ji._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence!==e){var t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Wi(vi($i),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||vi($i);const s=Ki(n,e.config.apiKey,e.name);let a=null;for(const u of t)try{var o=await u._get(s);if(o){var c=ji._fromJSON(e,o);u!==i&&(a=c),i=u;break}}catch(e){}var l=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&l.length&&(i=l[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new Wi(i,e,n)}}function Gi(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Ji(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Hi(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Zi(t))return"Blackberry";if(es(t))return"Webos";if(Qi(t))return"Safari";if((t.includes("chrome/")||Yi(t))&&!t.includes("edge/"))return"Chrome";if(Xi(t))return"Android";var n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);return 2===(null==n?void 0:n.length)?n[1]:"Other"}function Hi(e=w()){return/firefox\//i.test(e)}function Qi(e=w()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Yi(e=w()){return/crios\//i.test(e)}function Ji(e=w()){return/iemobile/i.test(e)}function Xi(e=w()){return/android/i.test(e)}function Zi(e=w()){return/blackberry/i.test(e)}function es(e=w()){return/webos/i.test(e)}function ts(e=w()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function ns(e=w()){return ts(e)||Xi(e)||es(e)||Zi(e)||/windows phone/i.test(e)||Ji(e)}function rs(e,t=[]){let n;switch(e){case"Browser":n=Gi(w());break;case"Worker":n=`${Gi(w())}-${e}`;break;default:n=e}var r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Ye}/${r}`}class is{constructor(e){this.auth=e,this.queue=[]}pushCallback(r,e){var t=n=>new Promise((e,t)=>{try{e(r(n))}catch(e){t(e)}});t.onAbort=e,this.queue.push(t);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser!==e){const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const r of t)try{r()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}}class ss{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new os(this),this.idTokenSubscription=new os(this),this.beforeStateQueue=new is(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=si,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(t,n){return n&&(this._popupRedirectResolver=vi(n)),this._initializationPromise=this.queue(async()=>{var e;if(!this._deleted&&(this.persistenceManager=await Wi.create(this,t),!this._deleted)){if(null!==(e=this._popupRedirectResolver)&&void 0!==e&&e._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(n),this.lastNotifiedUid=(null===(e=this.currentUser)||void 0===e?void 0:e.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(!this._deleted){var e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e)return this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var t,n,r,i=await this.assertedPersistence.getCurrentUser();let s=i,a=!1;if(e&&this.config.authDomain&&(await this.getOrInitRedirectPersistenceManager(),t=null===(r=this.redirectUser)||void 0===r?void 0:r._redirectEventId,n=null===s||void 0===s?void 0:s._redirectEventId,r=await this.tryRedirectSignIn(e),t&&t!==n||null==r||!r.user||(s=r.user,a=!0)),!s)return this.directlySetCurrentUser(null);if(s._redirectEventId)return pi(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s);if(a)try{await this.beforeStateQueue.runMiddleware(s)}catch(e){s=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await qi(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;var e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?ae(e):null;return t&&pi(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&pi(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(vi(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new D("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){var t;return this.redirectPersistenceManager||(pi(t=e&&vi(e)||this._popupRedirectResolver,this,"argument-error"),this.redirectPersistenceManager=await Wi.create(this,[vi(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()),this.redirectPersistenceManager}async _redirectUserForId(e){var t;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e;this._isInitialized&&(this.idTokenSubscription.next(this.currentUser),e=null!==(e=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==e?e:null,this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser)))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return pi(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),(this.currentUser=e)?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return pi(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=rs(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);var t=await(null===(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader());return t&&(e["X-Firebase-Client"]=t),e}}function as(e){return ae(e)}class os{constructor(e){this.auth=e,this.observer=null,this.addObserver=W(e=>this.observer=e)}get next(){return pi(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function cs(e,t,n){const r=as(e);pi(r._canInitEmulator,r,"emulator-config-failed"),pi(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");var i=!(null==n||!n.disableWarnings);const s=ls(t);var{host:a,port:o}=function(e){const t=ls(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);{if(i){var s=i[1];return{host:s,port:us(r.substr(s.length+1))}}var[a,s]=r.split(":");return{host:a,port:us(s)}}}(t);r.config.emulator={url:`${s}//${a}${null===o?"":`:${o}`}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function ls(e){var t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function us(e){if(!e)return null;var t=Number(e);return isNaN(t)?null:t}class hs{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return fi("not implemented")}_getIdTokenResponse(e){return fi("not implemented")}_linkToIdToken(e,t){return fi("not implemented")}_getReauthenticationResolver(e){return fi("not implemented")}}async function ds(e,t){return Ci(e,"POST","/v1/accounts:resetPassword",Si(e,t))}async function ps(e,t){return Ci(e,"POST","/v1/accounts:update",t)}async function fs(e,t){return Ci(e,"POST","/v1/accounts:sendOobCode",Si(e,t))}class gs extends hs{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new gs(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new gs(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){var t="string"==typeof e?JSON.parse(e):e;if(null!=t&&t.email&&null!=t&&t.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return Ai(e,"POST","/v1/accounts:signInWithPassword",Si(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Ai(e,"POST","/v1/accounts:signInWithEmailLink",Si(e,t))}(e,{email:this._email,oobCode:this._password});default:ci(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return ps(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Ai(e,"POST","/v1/accounts:signInWithEmailLink",Si(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:ci(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function ms(e,t){return Ai(e,"POST","/v1/accounts:signInWithIdp",Si(e,t))}class vs extends hs{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new vs(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ci("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){var t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,t=Zr(t,["providerId","signInMethod"]);if(!n||!r)return null;const i=new vs(n,r);return i.idToken=t.idToken||void 0,i.accessToken=t.accessToken||void 0,i.secret=t.secret,i.nonce=t.nonce,i.pendingToken=t.pendingToken||null,i}_getIdTokenResponse(e){return ms(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,ms(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ms(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=j(t)}return e}}const ys={USER_NOT_FOUND:"user-not-found"};class _s extends hs{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new _s({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new _s({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Ai(e,"POST","/v1/accounts:signInWithPhoneNumber",Si(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){var n=await Ai(e,"POST","/v1/accounts:signInWithPhoneNumber",Si(e,t));if(n.temporaryProof)throw xi(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Ai(e,"POST","/v1/accounts:signInWithPhoneNumber",Si(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),ys)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){var{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){var{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e="string"==typeof e?JSON.parse(e):e;return n||t||r||i?new _s({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class ws{constructor(e){var t=z($(e)),n=null!==(r=t.apiKey)&&void 0!==r?r:null,r=null!==(i=t.oobCode)&&void 0!==i?i:null,i=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=t.mode)&&void 0!==i?i:null);pi(n&&r&&i,"argument-error"),this.apiKey=n,this.operation=i,this.code=r,this.continueUrl=null!==(r=t.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(r=t.languageCode)&&void 0!==r?r:null,this.tenantId=null!==(t=t.tenantId)&&void 0!==t?t:null}static parseLink(e){var t,n,r,t=(t=z($(e=e)).link,n=t?z($(t)).deep_link_id:null,((r=z($(e)).deep_link_id)?z($(r)).link:null)||r||n||t||e);try{return new ws(t)}catch(e){return null}}}class bs{constructor(){this.providerId=bs.PROVIDER_ID}static credential(e,t){return gs._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){var n=ws.parseLink(t);return pi(n,"argument-error"),gs._fromEmailAndCode(e,n.code,n.tenantId)}}bs.PROVIDER_ID="password",bs.EMAIL_PASSWORD_SIGN_IN_METHOD="password",bs.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Is{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Ts extends Is{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Es extends Ts{static credentialFromJSON(e){var t="string"==typeof e?JSON.parse(e):e;return pi("providerId"in t&&"signInMethod"in t,"argument-error"),vs._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return pi(e.idToken||e.accessToken,"argument-error"),vs._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Es.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Es.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:a}=e;if(!(n||r||t||i))return null;if(!a)return null;try{return new Es(a)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class ks extends Ts{constructor(){super("facebook.com")}static credential(e){return vs._fromParams({providerId:ks.PROVIDER_ID,signInMethod:ks.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ks.credentialFromTaggedObject(e)}static credentialFromError(e){return ks.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return ks.credential(e.oauthAccessToken)}catch(e){return null}}}ks.FACEBOOK_SIGN_IN_METHOD="facebook.com",ks.PROVIDER_ID="facebook.com";class Ss extends Ts{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return vs._fromParams({providerId:Ss.PROVIDER_ID,signInMethod:Ss.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ss.credentialFromTaggedObject(e)}static credentialFromError(e){return Ss.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Ss.credential(t,n)}catch(e){return null}}}Ss.GOOGLE_SIGN_IN_METHOD="google.com",Ss.PROVIDER_ID="google.com";class Cs extends Ts{constructor(){super("github.com")}static credential(e){return vs._fromParams({providerId:Cs.PROVIDER_ID,signInMethod:Cs.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Cs.credentialFromTaggedObject(e)}static credentialFromError(e){return Cs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Cs.credential(e.oauthAccessToken)}catch(e){return null}}}Cs.GITHUB_SIGN_IN_METHOD="github.com",Cs.PROVIDER_ID="github.com";class Ns extends hs{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return ms(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,ms(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ms(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){var{providerId:t,signInMethod:n,pendingToken:r}="string"==typeof e?JSON.parse(e):e;return t&&n&&r&&t===n?new Ns(t,r):null}static _create(e,t){return new Ns(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class As extends Is{constructor(e){pi(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return As.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return As.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){var t=Ns.fromJSON(e);return pi(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return Ns._create(n,t)}catch(e){return null}}}class Rs extends Ts{constructor(){super("twitter.com")}static credential(e,t){return vs._fromParams({providerId:Rs.PROVIDER_ID,signInMethod:Rs.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Rs.credentialFromTaggedObject(e)}static credentialFromError(e){return Rs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Rs.credential(t,n)}catch(e){return null}}}async function Ds(e,t){return Ai(e,"POST","/v1/accounts:signUp",Si(e,t))}Rs.TWITTER_SIGN_IN_METHOD="twitter.com",Rs.PROVIDER_ID="twitter.com";class xs{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){var i=await ji._fromIdTokenResponse(e,n,r),s=Ps(n);return new xs({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);var r=Ps(n);return new xs({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Ps(e){return e.providerId||("phoneNumber"in e?"phone":null)}class Os extends R{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Os.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Os(e,t,n,r)}}function Ms(t,n,e,r){const i="reauthenticate"===n?e._getReauthenticationResolver(t):e._getIdTokenResponse(t);return i.catch(e=>{if("auth/multi-factor-auth-required"===e.code)throw Os._fromErrorAndOperation(t,e,n,r);throw e})}function Ls(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function Fs(e,t){const n=ae(e);await qs(!0,n,t);var r=(e=n.auth,t={idToken:await n.getIdToken(),deleteProvider:[t]},await Ci(e,"POST","/v1/accounts:update",t))["providerUserInfo"];const i=Ls(r||[]);return n.providerData=n.providerData.filter(e=>i.has(e.providerId)),i.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function Us(e,t,n=!1){var r=await Li(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return xs._forOperation(e,"link",r)}async function qs(e,t,n){await qi(t);const r=Ls(t.providerData);var i=!1===e?"provider-already-linked":"no-such-provider";pi(r.has(n)===e,t.auth,i)}async function Vs(e,t,n=!1){var r=e["auth"],i="reauthenticate";try{var s=await Li(e,Ms(r,i,t,e),n);pi(s.idToken,r,"internal-error");var a=Mi(s.idToken);pi(a,r,"internal-error");var o=a["sub"];return pi(e.uid===o,r,"user-mismatch"),xs._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&ci(r,"user-mismatch"),e}}async function Bs(e,t,n=!1){var r=await Ms(e,"signIn",t),r=await xs._fromIdTokenResponse(e,"signIn",r);return n||await e._updateCurrentUser(r.user),r}async function js(e,t){return Bs(as(e),t)}async function zs(e,t){var n=ae(e);return await qs(!1,n,t.providerId),Us(n,t)}async function $s(e,t){return Vs(ae(e),t)}async function Ks(e,t){const n=as(e);var r=await Ai(n,"POST","/v1/accounts:signInWithCustomToken",Si(n,{token:t,returnSecureToken:!0})),r=await xs._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(r.user),r}class Ws{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Gs._fromServerResponse(e,t):"totpInfo"in t?Hs._fromServerResponse(e,t):ci(e,"internal-error")}}class Gs extends Ws{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Gs(t)}}class Hs extends Ws{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Hs(t)}}function Qs(e,t,n){var r;pi(0<(null===(r=n.url)||void 0===r?void 0:r.length),e,"invalid-continue-uri"),pi(void 0===n.dynamicLinkDomain||0<n.dynamicLinkDomain.length,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(pi(0<n.iOS.bundleId.length,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(pi(0<n.android.packageName.length,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function Ys(e,t,n){var r=ae(e),i={requestType:"PASSWORD_RESET",email:t};n&&Qs(r,i,n),await fs(r,i)}async function Js(e,t){await Ci(e=ae(e),"POST","/v1/accounts:update",Si(e,{oobCode:t}))}async function Xs(e,t){var n=ae(e),r=await ds(n,{oobCode:t}),i=r.requestType;switch(pi(i,n,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":pi(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":pi(r.mfaInfo,n,"internal-error");default:pi(r.email,n,"internal-error")}let s=null;return r.mfaInfo&&(s=Ws._fromServerResponse(as(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:s},operation:i}}async function Zs(e,t,n){var r=ae(e),i={requestType:"EMAIL_SIGNIN",email:t};pi(n.handleCodeInApp,r,"argument-error"),n&&Qs(r,i,n),await fs(r,i)}async function ea(e,t){var n=_i()?yi():"http://localhost",n=(await Ci(e=ae(e),"POST","/v1/accounts:createAuthUri",Si(e,{identifier:t,continueUri:n})))["signinMethods"];return n||[]}async function ta(e,t){var n=ae(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&Qs(n.auth,r,t);var r=(await fs(n.auth,r))["email"];r!==e.email&&await e.reload()}async function na(e,t,n){var r=ae(e),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&Qs(r.auth,i,n);var i=(await fs(r.auth,i))["email"];i!==e.email&&await e.reload()}async function ra(e,{displayName:t,photoURL:n}){if(void 0!==t||void 0!==n){const i=ae(e);var r=await i.getIdToken(),r=await Li(i,async function(e,t){return Ci(e,"POST","/v1/accounts:update",t)}(i.auth,{idToken:r,displayName:t,photoUrl:n,returnSecureToken:!0}));i.displayName=r.displayName||null,i.photoURL=r.photoUrl||null;const s=i.providerData.find(({providerId:e})=>"password"===e);s&&(s.displayName=i.displayName,s.photoURL=i.photoURL),await i._updateTokensIfNecessary(r)}}async function ia(e,t,n){var r=e["auth"];const i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);r=await Li(e,ps(r,i));await e._updateTokensIfNecessary(r,!0)}class sa{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class aa extends sa{constructor(e,t,n,r){super(e,t,n),this.username=r}}class oa extends sa{constructor(e,t){super(e,"facebook.com",t)}}class ca extends aa{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class la extends sa{constructor(e,t){super(e,"google.com",t)}}class ua extends aa{constructor(e,t,n){super(e,"twitter.com",t,n)}}function ha(e){var{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){if(!e)return null;var t=e["providerId"],n=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},r=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!t&&null!=e&&e.idToken){var i=null===(i=null===(i=Mi(e.idToken))||void 0===i?void 0:i.firebase)||void 0===i?void 0:i.sign_in_provider;if(i){i="anonymous"!==i&&"custom"!==i?i:null;return new sa(r,i)}}if(!t)return null;switch(t){case"facebook.com":return new oa(r,n);case"github.com":return new ca(r,n);case"google.com":return new la(r,n);case"twitter.com":return new ua(r,n,e.screenName||null);case"custom":case"anonymous":return new sa(r,null);default:return new sa(r,t,n)}}(n)}class da{constructor(e,t,n){this.type=e,this.credential=t,this.auth=n}static _fromIdtoken(e,t){return new da("enroll",e,t)}static _fromMfaPendingCredential(e){return new da("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t;if(null!=e&&e.multiFactorSession){if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.pendingCredential)return da._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.idToken)return da._fromIdtoken(e.multiFactorSession.idToken)}return null}}class pa{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,i){const s=as(e),a=i.customData._serverResponse;var t=(a.mfaInfo||[]).map(e=>Ws._fromServerResponse(s,e));pi(a.mfaPendingCredential,s,"internal-error");const o=da._fromMfaPendingCredential(a.mfaPendingCredential);return new pa(o,t,async e=>{var t=await e._process(s,o);delete a.mfaInfo,delete a.mfaPendingCredential;var n=Object.assign(Object.assign({},a),{idToken:t.idToken,refreshToken:t.refreshToken});switch(i.operationType){case"signIn":var r=await xs._fromIdTokenResponse(s,i.operationType,n);return await s._updateCurrentUser(r.user),r;case"reauthenticate":return pi(i.user,s,"internal-error"),xs._forOperation(i.user,i.operationType,n);default:ci(s,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}class fa{constructor(t){this.user=t,this.enrolledFactors=[],t._onReload(e=>{e.mfaInfo&&(this.enrolledFactors=e.mfaInfo.map(e=>Ws._fromServerResponse(t.auth,e)))})}static _fromUser(e){return new fa(e)}async getSession(){return da._fromIdtoken(await this.user.getIdToken(),this.user.auth)}async enroll(e,t){const n=e;var r=await this.getSession(),r=await Li(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(r),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid;var n,r,i=await this.user.getIdToken();try{var s=await Li(this.user,(n=this.user.auth,r={idToken:i,mfaEnrollmentId:t},Ci(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Si(n,r))));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(e){throw e}}}const ga=new WeakMap;const ma="__sak";class va{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ma,"1"),this.storage.removeItem(ma),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){var t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class ya extends va{constructor(){var e;super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=(Qi(e=w())||ts(e))&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=ns(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){var t=this.storage.getItem(r),n=this.localCache[r];t!==n&&e(r,n,t)}}onStorageEvent(e,t=!1){if(e.key){const r=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(r);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!t)return}var n=()=>{var e=this.storage.getItem(r);!t&&this.localCache[r]===e||this.notifyListeners(r,e)};const i=this.storage.getItem(r);k()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}else this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)})}notifyListeners(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(const r of Array.from(n))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){var t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}ya.type="LOCAL";const _a=ya;class wa extends va{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}wa.type="SESSION";const ba=wa;class Ia{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){var e=this.receivers.find(e=>e.isListeningto(t));if(e)return e;e=new Ia(t);return this.receivers.push(e),e}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data;var s=this.handlersMap[r];null!=s&&s.size&&(t.ports[0].postMessage({status:"ack",eventId:n,eventType:r}),s=Array.from(s).map(async e=>e(t.origin,i)),s=await Promise.all(s.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})),t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:s}))}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Ta(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}Ia.receivers=[];class Ea{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,a=50){const o="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!o)throw new Error("connection_unavailable");let c,l;return new Promise((n,r)=>{const i=Ta("",20);o.port1.start();const s=setTimeout(()=>{r(new Error("unsupported_event"))},a);l={messageChannel:o,onMessage(e){var t=e;if(t.data.eventId===i)switch(t.data.status){case"ack":clearTimeout(s),c=setTimeout(()=>{r(new Error("timeout"))},3e3);break;case"done":clearTimeout(c),n(t.data.response);break;default:clearTimeout(s),clearTimeout(c),r(new Error("invalid_response"))}}},this.handlers.add(l),o.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:i,data:t},[o.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function ka(){return window}function Sa(){return void 0!==ka().WorkerGlobalScope&&"function"==typeof ka().importScripts}const Ca="firebaseLocalStorageDb",Na="firebaseLocalStorage",Aa="fbase_key";class Ra{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Da(e,t){return e.transaction([Na],t?"readwrite":"readonly").objectStore(Na)}function xa(){const r=indexedDB.open(Ca,1);return new Promise((n,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const e=r.result;try{e.createObjectStore(Na,{keyPath:Aa})}catch(e){t(e)}}),r.addEventListener("success",async()=>{const e=r.result;var t;e.objectStoreNames.contains(Na)?n(e):(e.close(),t=indexedDB.deleteDatabase(Ca),await new Ra(t).toPromise(),n(await xa()))})})}async function Pa(e,t,n){var r=Da(e,!0).put({fbase_key:t,value:n});return new Ra(r).toPromise()}function Oa(e,t){var n=Da(e,!0).delete(t);return new Ra(n).toPromise()}class Ma{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await xa(),this.db)}async _withRetries(e){let t=0;for(;;)try{return e(await this._openDb())}catch(e){if(3<t++)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Sa()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ia._getInstance(Sa()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>{const n=await this._poll();return{keyProcessed:n.includes(t.key)}}),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t,n;this.activeServiceWorker=await async function(){if(null===navigator||void 0===navigator||!navigator.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),this.activeServiceWorker&&(this.sender=new Ea(this.activeServiceWorker),(n=await this.sender._send("ping",{},800))&&null!==(e=n[0])&&void 0!==e&&e.fulfilled&&null!==(t=n[0])&&void 0!==t&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0))}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;var e=await xa();return await Pa(e,ma,"1"),await Oa(e,ma),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(t,n){return this._withPendingWrite(async()=>(await this._withRetries(e=>Pa(e,t,n)),this.localCache[t]=n,this.notifyServiceWorker(t)))}async _get(t){var e=await this._withRetries(e=>async function(e,t){var n=Da(e,!1).get(t);return void 0===(n=await new Ra(n).toPromise())?null:n.value}(e,t));return this.localCache[t]=e}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>Oa(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){var e,t,n=await this._withRetries(e=>{var t=Da(e,!1).getAll();return new Ra(t).toPromise()});if(!n)return[];if(0!==this.pendingWrites)return[];const r=[],i=new Set;for({fbase_key:e,value:t}of n)i.add(e),JSON.stringify(this.localCache[e])!==JSON.stringify(t)&&(this.notifyListeners(e,t),r.push(e));for(const s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r}notifyListeners(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Ma.type="LOCAL";const La=Ma;function Fa(i){return new Promise((e,n)=>{const t=document.createElement("script");var r;t.setAttribute("src",i),t.onload=e,t.onerror=e=>{const t=li("internal-error");t.customData=e,n(t)},t.type="text/javascript",t.charset="UTF-8",(null!==(r=null===(r=document.getElementsByTagName("head"))||void 0===r?void 0:r[0])&&void 0!==r?r:document).appendChild(t)})}function Ua(e){return`__${e}${Math.floor(1e6*Math.random())}`}class qa{constructor(e){this.auth=e,this.counter=1e12,this._widgets=new Map}render(e,t){var n=this.counter;return this._widgets.set(n,new Va(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t,n=e||1e12;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;return(null===(t=this._widgets.get(e||1e12))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;return null===(t=this._widgets.get(e||1e12))||void 0===t||t.execute(),""}}class Va{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};var r="string"==typeof e?document.getElementById(e):e;pi(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<e;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Ba=Ua("rcb"),ja=new bi(3e4,6e4);class za{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(e=ka().grecaptcha)||void 0===e||!e.render)}load(s,a=""){var e;return pi((e=a).length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e),s,"argument-error"),this.shouldResolveImmediately(a)?Promise.resolve(ka().grecaptcha):new Promise((t,n)=>{const i=ka().setTimeout(()=>{n(li(s,"network-request-failed"))},ja.get());ka()[Ba]=()=>{ka().clearTimeout(i),delete ka()[Ba];const e=ka().grecaptcha;if(e){const r=e.render;e.render=(e,t)=>{var n=r(e,t);return this.counter++,n},this.hostLanguage=a,t(e)}else n(li(s,"internal-error"))},Fa(`https://www.google.com/recaptcha/api.js??${j({onload:Ba,render:"explicit",hl:a})}`).catch(()=>{clearTimeout(i),n(li(s,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!(null===(t=ka().grecaptcha)||void 0===t||!t.render)&&(e===this.hostLanguage||0<this.counter||this.librarySeparatelyLoaded)}}class $a{async load(e){return new qa(e)}clearedOneInstance(){}}const Ka="recaptcha",Wa={theme:"light",type:"image"};class Ga{constructor(e,t=Object.assign({},Wa),n){this.parameters=t,this.type=Ka,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=as(n),this.isInvisible="invisible"===this.parameters.size,pi("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");var r="string"==typeof e?document.getElementById(e):e;pi(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=new(this.auth.settings.appVerificationDisabledForTesting?$a:za),this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),r=this.getAssertedRecaptcha();var t=r.getResponse(e);return t||new Promise(t=>{const n=e=>{e&&(this.tokenChangeListeners.delete(n),t(e))};this.tokenChangeListeners.add(n),this.isInvisible&&r.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){pi(!this.parameters.sitekey,this.auth,"argument-error"),pi(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),pi("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(n){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof n)n(t);else if("string"==typeof n){const e=ka()[n];"function"==typeof e&&e(t)}}}assertNotDestroyed(){pi(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;var t;this.isInvisible||(t=document.createElement("div"),e.appendChild(t),e=t),this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){pi(_i()&&!Sa(),this.auth,"internal-error"),await function(){let t=null;return new Promise(e=>{"complete"!==document.readyState?(t=()=>e(),window.addEventListener("load",t)):e()}).catch(e=>{throw t&&window.removeEventListener("load",t),e})}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);var e=await((await Ci(this.auth,"GET","/v1/recaptchaParams")).recaptchaSiteKey||"");pi(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return pi(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Ha{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){var t=_s._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function Qa(t,n,r){var i,s,a,o,c,l,u=await r.verify();try{pi("string"==typeof u,t,"argument-error"),pi(r.type===Ka,t,"argument-error");let e;if(e="string"==typeof n?{phoneNumber:n}:n,"session"in e){var h=e.session;if("phoneNumber"in e)return pi("enroll"===h.type,t,"internal-error"),(c=t,l={idToken:h.credential,phoneEnrollmentInfo:{phoneNumber:e.phoneNumber,recaptchaToken:u}},await Ci(c,"POST","/v2/accounts/mfaEnrollment:start",Si(c,l))).phoneSessionInfo.sessionInfo;pi("signin"===h.type,t,"internal-error");var d=(null===(i=e.multiFactorHint)||void 0===i?void 0:i.uid)||e.multiFactorUid;return pi(d,t,"missing-multi-factor-info"),(o={mfaPendingCredential:h.credential,mfaEnrollmentId:d,phoneSignInInfo:{recaptchaToken:u}},await Ci(t,"POST","/v2/accounts/mfaSignIn:start",Si(t,o))).phoneResponseInfo.sessionInfo}var p=(s=t,a={phoneNumber:e.phoneNumber,recaptchaToken:u},await Ci(s,"POST","/v1/accounts:sendVerificationCode",Si(s,a)))["sessionInfo"];return p}finally{r._reset()}}class Ya{constructor(e){this.providerId=Ya.PROVIDER_ID,this.auth=as(e)}verifyPhoneNumber(e,t){return Qa(this.auth,e,ae(t))}static credential(e,t){return _s._fromVerification(e,t)}static credentialFromResult(e){var t=e;return Ya.credentialFromTaggedObject(t)}static credentialFromError(e){return Ya.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{phoneNumber:t,temporaryProof:n}=e;return t&&n?_s._fromTokenResponse(t,n):null}}function Ja(e,t){return t?vi(t):(pi(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Ya.PROVIDER_ID="phone",Ya.PHONE_SIGN_IN_METHOD="phone";class Xa extends hs{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ms(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ms(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ms(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Za(e){return Bs(e.auth,new Xa(e),e.bypassAuthState)}function eo(e){var{auth:t,user:n}=e;return pi(n,t,"internal-error"),Vs(n,new Xa(e),e.bypassAuthState)}async function to(e){var{auth:t,user:n}=e;return pi(n,t,"internal-error"),Us(n,new Xa(e),e.bypassAuthState)}class no{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){var{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:a}=e;if(s)this.reject(s);else{r={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(r))}catch(e){this.reject(e)}}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Za;case"linkViaPopup":case"linkViaRedirect":return to;case"reauthViaPopup":case"reauthViaRedirect":return eo;default:ci(this.auth,"internal-error")}}resolve(e){gi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){gi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const ro=new bi(2e3,1e4);class io extends no{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,io.currentPopupAction&&io.currentPopupAction.cancel(),io.currentPopupAction=this}async executeNotNull(){var e=await this.execute();return pi(e,this.auth,"internal-error"),e}async onExecution(){gi(1===this.filter.length,"Popup operations only handle one event");var e=Ta();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(li(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(li(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,io.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e;null!==(e=null===(e=this.authWindow)||void 0===e?void 0:e.window)&&void 0!==e&&e.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(li(this.auth,"popup-closed-by-user"))},2e3):this.pollId=window.setTimeout(t,ro.get())};t()}}io.currentPopupAction=null;const so="pendingRedirect",ao=new Map;class oo extends no{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let t=ao.get(this.auth._key());if(!t){try{const e=await async function(e,t){const n=ho(t),r=uo(e);if(!await r._isAvailable())return!1;var i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(e)}catch(e){t=()=>Promise.reject(e)}ao.set(this.auth._key(),t)}return this.bypassAuthState||ao.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){var t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function co(e,t){return uo(e)._set(ho(t),"true")}function lo(e,t){ao.set(e._key(),t)}function uo(e){return vi(e._redirectPersistence)}function ho(e){return Ki(so,e.config.apiKey,e.name)}function po(e,t,n){return async function(e,t,n){var r=as(e);hi(e,t,Is),await r._initializationPromise;const i=Ja(r,n);return await co(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}function fo(e,t,n){return async function(e,t,n){var r=ae(e);hi(r.auth,t,Is),await r.auth._initializationPromise;const i=Ja(r.auth,n);await co(i,r.auth);var s=await vo(r);return i._openRedirect(r.auth,t,"reauthViaRedirect",s)}(e,t,n)}function go(e,t,n){return async function(e,t,n){var r=ae(e);hi(r.auth,t,Is),await r.auth._initializationPromise;const i=Ja(r.auth,n);await qs(!1,r,t.providerId),await co(i,r.auth);var s=await vo(r);return i._openRedirect(r.auth,t,"linkViaRedirect",s)}(e,t,n)}async function mo(e,t,n=!1){const r=as(e);var i=Ja(r,t);const s=new oo(r,i,n),a=await s.execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,t)),a}async function vo(e){var t=Ta(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class yo{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let n=!1;return this.consumers.forEach(e=>{this.isEventForConsumer(t,e)&&(n=!0,this.sendToConsumer(t,e),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return wo(e);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=t,n=!0)),n}sendToConsumer(e,t){var n;e.error&&!wo(e)?(n=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error",t.onError(li(this.auth,n))):t.onAuthEvent(e)}isEventForConsumer(e,t){var n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return 6e5<=Date.now()-this.lastProcessedEventTime&&this.cachedEventUids.clear(),this.cachedEventUids.has(_o(e))}saveEventToCache(e){this.cachedEventUids.add(_o(e)),this.lastProcessedEventTime=Date.now()}}function _o(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function wo({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function bo(e,t={}){return Ci(e,"GET","/v1/projects",t)}const Io=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,To=/^https?/;async function Eo(e){if(!e.config.emulator){var t=(await bo(e))["authorizedDomains"];for(const n of t)try{if(function(e){const t=yi(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){var i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!To.test(n))return!1;if(Io.test(e))return r===e;const s=e.replace(/\./g,"\\."),a=new RegExp("^(.+\\."+s+"|"+s+")$","i");return a.test(r)}(n))return}catch(e){}ci(e,"unauthorized-domain")}}const ko=new bi(3e4,6e4);function So(){const t=ka().___jsl;if(null!==t&&void 0!==t&&t.H)for(const n of Object.keys(t.H))if(t.H[n].r=t.H[n].r||[],t.H[n].L=t.H[n].L||[],t.H[n].r=[...t.H[n].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}let Co=null;function No(e){var i;return Co=Co||(i=e,new Promise((e,t)=>{function n(){So(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{So(),t(li(i,"network-request-failed"))},timeout:ko.get()})}if(null!==(r=null===(r=ka().gapi)||void 0===r?void 0:r.iframes)&&void 0!==r&&r.Iframe)e(gapi.iframes.getContext());else{if(null===(r=ka().gapi)||void 0===r||!r.load){var r=Ua("iframefcb");return ka()[r]=()=>{gapi.load?n():t(li(i,"network-request-failed"))},Fa(`https://apis.google.com/js/api.js?onload=${r}`).catch(e=>t(e))}n()}}).catch(e=>{throw Co=null,e})),Co}const Ao=new bi(5e3,15e3),Ro="__/auth/iframe",Do="emulator/auth/iframe",xo={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Po=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function Oo(a){const e=await No(a);var t=ka().gapi;return pi(t,a,"internal-error"),e.open({where:document.body,url:function(e){var t=e.config;pi(t.authDomain,e,"auth-domain-config-required");var n=t.emulator?Ii(t,Do):`https://${e.config.authDomain}/${Ro}`;const r={apiKey:t.apiKey,appName:e.name,v:Ye};(t=Po.get(e.config.apiHost))&&(r.eid=t);const i=e._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${j(r).slice(1)}`}(a),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:xo,dontclear:!0},s=>new Promise(async(e,t)=>{await s.restyle({setHideOnLeave:!1});const n=li(a,"network-request-failed"),r=ka().setTimeout(()=>{t(n)},Ao.get());function i(){ka().clearTimeout(r),e(s)}s.ping(i).then(i,()=>{t(n)})}))}const Mo={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Lo{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Fo(e,t,n,r=500,i=600){var s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const c=Object.assign(Object.assign({},Mo),{width:r.toString(),height:i.toString(),top:s,left:a});s=w().toLowerCase();n&&(o=Yi(s)?"_blank":n),Hi(s)&&(t=t||"http://localhost",c.scrollbars="yes");var l,a=Object.entries(c).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if([n=w()]=[s],ts(n)&&null!==(l=window.navigator)&&void 0!==l&&l.standalone&&"_self"!==o)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",o),new Lo(null);const u=window.open(t||"",o,a);pi(u,e,"popup-blocked");try{u.focus()}catch(e){}return new Lo(u)}const Uo="__/auth/handler",qo="emulator/auth/handler";function Vo(e,t,n,r,i,s){pi(e.config.authDomain,e,"auth-domain-config-required"),pi(e.config.apiKey,e,"invalid-api-key");const a={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:Ye,eventId:i};if(t instanceof Is){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",U(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(var[o,c]of Object.entries(s||{}))a[o]=c}if(t instanceof Ts){const u=t.getScopes().filter(e=>""!==e);0<u.length&&(a.scopes=u.join(","))}e.tenantId&&(a.tid=e.tenantId);const l=a;for(const h of Object.keys(l))void 0===l[h]&&delete l[h];return`${e=[e["config"]][0],e.emulator?Ii(e,qo):`https://${e.authDomain}/${Uo}`}?${j(l).slice(1)}`}const Bo="webStorageSupport";const jo=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ba,this._completeRedirectFn=mo,this._overrideRedirectResult=lo}async _openPopup(e,t,n,r){var i;return gi(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),Fo(e,Vo(e,t,n,yi(),r),Ta())}async _openRedirect(e,t,n,r){return await this._originValidation(e),r=Vo(e,t,n,yi(),r),ka().location.href=r,new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:n}=this.eventManagers[t];return r?Promise.resolve(r):(gi(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(t){const e=await Oo(t),n=new yo(t);return e.register("authEvent",e=>{return pi(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:n.onEvent(e.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(n,r){const e=this.iframes[n._key()];e.send(Bo,{type:Bo},e=>{var t=null===(t=null==e?void 0:e[0])||void 0===t?void 0:t[Bo];void 0!==t&&r(!!t),ci(n,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Eo(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return ns()||Qi()||ts()}};class zo extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return fi("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new zo(e)}_finalizeEnroll(e,t,n){return e=e,n={idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()},Ci(e,"POST","/v2/accounts/mfaEnrollment:finalize",Si(e,n))}_finalizeSignIn(e,t){return e=e,t={mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()},Ci(e,"POST","/v2/accounts/mfaSignIn:finalize",Si(e,t))}}class $o{constructor(){}static assertion(e){return zo._fromCredential(e)}}$o.FACTOR_ID="phone";var Ko="@firebase/auth";class Wo{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(t){var e;this.assertAuthConfigured(),this.internalListeners.has(t)||(e=this.auth.onIdTokenChanged(e=>{t((null==e?void 0:e.stsTokenManager.accessToken)||null)}),this.internalListeners.set(t,e),this.updateProactiveRefresh())}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){pi(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){0<this.internalListeners.size?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}var Go,Ho,Qo;function Yo(){return window}Go="authIdTokenMaxAge",null===(Ho=p())||void 0===Ho||Ho[`_${Go}`],Qo="Browser",We(new oe("auth",(e,{options:r})=>{var t=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat");const{apiKey:i,authDomain:s}=t.options;return((e,t)=>{pi(i&&!i.includes(":"),"invalid-api-key",{appName:e.name}),pi(!(null!==s&&void 0!==s&&s.includes(":")),"argument-error",{appName:e.name});var n={apiKey:i,authDomain:s,clientPlatform:Qo,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:rs(Qo)},n=new ss(e,t,n);return function(e,t){const n=(null==t?void 0:t.persistence)||[];var r=(Array.isArray(n)?n:[n]).map(vi);null!=t&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(n,r),n})(t,n)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{const r=e.getProvider("auth-internal");r.initialize()})),We(new oe("auth-internal",e=>{var t=as(e.getProvider("auth").getImmediate());return e=t,new Wo(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),et(Ko,"0.22.0",function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(Qo)),et(Ko,"0.22.0","esm2017");async function Jo(e,t,n){var r=Yo()["BuildInfo"];gi(t.sessionId,"AuthEvent did not contain a session ID");var i=await async function(e){const t=function(e){if(gi(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}(e),n=await crypto.subtle.digest("SHA-256",t),r=Array.from(new Uint8Array(n));return r.map(e=>e.toString(16).padStart(2,"0")).join("")}(t.sessionId);const s={};return ts()?s.ibi=r.packageName:Xi()?s.apn=r.packageName:ci(e,"operation-not-supported-in-this-environment"),r.displayName&&(s.appDisplayName=r.displayName),s.sessionId=i,Vo(e,n,t.type,void 0,null!==(i=t.eventId)&&void 0!==i?i:void 0,s)}function Xo(r){const i=Yo()["cordova"];return new Promise(n=>{i.plugins.browsertab.isAvailable(e=>{let t=null;e?i.plugins.browsertab.openUrl(r):t=i.InAppBrowser.open(r,(e=w(),/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)?"_blank":"_system"),"location=yes"),n(t)})})}const Zo=20;class ec extends yo{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(t){return this.resolveInialized(),this.passiveListeners.forEach(e=>e(t)),super.onEvent(t)}async initialized(){await this.initPromise}}function tc(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:function(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<Zo;r++){var n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}(),postBody:null,tenantId:e.tenantId,error:li(e,"no-auth-event")}}async function nc(e){var t=await ic()._get(sc(e));return t&&await ic()._remove(sc(e)),t}function rc(e,t){var n,r,i;const s=(n=ac(t=t),a=n.link?decodeURIComponent(n.link):void 0,r=ac(a).link,i=n.deep_link_id?decodeURIComponent(n.deep_link_id):void 0,(n=ac(i).link)||i||r||a||t);if(s.includes("/__/auth/callback")){var a=ac(s),a=a.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(a.firebaseError)):null,a=null===(a=null===(a=null==a?void 0:a.code)||void 0===a?void 0:a.split("auth/"))||void 0===a?void 0:a[1],a=a?li(a):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:s,postBody:null}}return null}function ic(){return vi(_a)}function sc(e){return Ki("authEvent",e.config.apiKey,e.name)}function ac(e){if(null==e||!e.includes("?"))return{};const[,...t]=e.split("?");return z(t.join("?"))}const oc=class{constructor(){this._redirectPersistence=ba,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=mo,this._overrideRedirectResult=lo}async _initialize(e){var t=e._key();let n=this.eventManagers.get(t);return n||(n=new ec(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){ci(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){var i,s;i=e,o=Yo(),pi("function"==typeof(null===(s=null==o?void 0:o.universalLinks)||void 0===s?void 0:s.subscribe),i,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),pi(void 0!==(null===(s=null==o?void 0:o.BuildInfo)||void 0===s?void 0:s.packageName),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),pi("function"==typeof(null===(s=null===(s=null===(s=null==o?void 0:o.cordova)||void 0===s?void 0:s.plugins)||void 0===s?void 0:s.browsertab)||void 0===s?void 0:s.openUrl),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),pi("function"==typeof(null===(s=null===(s=null===(s=null==o?void 0:o.cordova)||void 0===s?void 0:s.plugins)||void 0===s?void 0:s.browsertab)||void 0===s?void 0:s.isAvailable),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),pi("function"==typeof(null===(o=null===(o=null==o?void 0:o.cordova)||void 0===o?void 0:o.InAppBrowser)||void 0===o?void 0:o.open),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"});const a=await this._initialize(e);await a.initialized(),a.resetRedirect(),ao.clear(),await this._originValidation(e);var o=tc(e,n,r);n=e,r=o,await ic()._set(sc(n),r);o=await Xo(await Jo(e,o,t));return async function(a,o,c){const l=Yo()["cordova"];let u=()=>{};try{await new Promise((n,e)=>{let t=null;function r(){var e;n();const t=null===(e=l.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==c?void 0:c.close)&&c.close()}function i(){t=t||window.setTimeout(()=>{e(li(a,"redirect-cancelled-by-user"))},2e3)}function s(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&i()}o.addPassiveListener(r),document.addEventListener("resume",i,!1),Xi()&&document.addEventListener("visibilitychange",s,!1),u=()=>{o.removePassiveListener(r),document.removeEventListener("resume",i,!1),document.removeEventListener("visibilitychange",s,!1),t&&window.clearTimeout(t)}})}finally{u()}}(e,a,o)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){var t=Yo()["BuildInfo"];const n={};ts()?n.iosBundleId=t.packageName:Xi()?n.androidPackageName=t.packageName:ci(e,"operation-not-supported-in-this-environment"),await bo(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(r,i){const{universalLinks:e,handleOpenURL:t,BuildInfo:n}=Yo(),s=setTimeout(async()=>{await nc(r),i.onEvent(cc())},500),a=async e=>{clearTimeout(s);var t=await nc(r);let n=null;t&&null!=e&&e.url&&(n=rc(t,e.url)),i.onEvent(n||cc())};void 0!==e&&"function"==typeof e.subscribe&&e.subscribe(null,a);const o=t,c=`${n.packageName.toLowerCase()}://`;Yo().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&a({url:e}),"function"==typeof o)try{o(e)}catch(e){console.error(e)}}}};function cc(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:li("no-auth-event")}}var lc;function uc(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function hc(e=w()){return!("file:"!==uc()&&"ionic:"!==uc()&&"capacitor:"!==uc()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function dc(e=w()){return k()&&11===(null===document||void 0===document?void 0:document.documentMode)||([e=w()]=[e],/Edge\/\d+/.test(e))}function pc(){try{const t=self.localStorage;var e=Ta();if(t)return t.setItem(e,"1"),t.removeItem(e),!dc()||C()}catch(e){return fc()&&C()}return!1}function fc(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function gc(){return("http:"===uc()||"https:"===uc()||T()||hc())&&!(E()||I())&&pc()&&!fc()}function mc(){return hc()&&"undefined"!=typeof document}const vc={LOCAL:"local",NONE:"none",SESSION:"session"},yc=pi,_c="persistence";async function wc(e){await e._initializationPromise;const t=bc();var n=Ki(_c,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function bc(){var e;try{return(null===(e="undefined"!=typeof window?window:null)?void 0:e.sessionStorage)||null}catch(e){return null}}const Ic=pi;class Tc{constructor(){this.browserResolver=vi(jo),this.cordovaResolver=vi(oc),this.underlyingResolver=null,this._redirectPersistence=ba,this._completeRedirectFn=mo,this._overrideRedirectResult=lo}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return mc()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Ic(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){var e;this.underlyingResolver||(e=await(!!mc()&&new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})),this.underlyingResolver=e?this.cordovaResolver:this.browserResolver)}}function Ec(e){return e.unwrap()}function kc(e,t){var n,r,i,s=null===(r=t.customData)||void 0===r?void 0:r._tokenResponse;if("auth/multi-factor-auth-required"===(null==t?void 0:t.code)){const o=t;o.resolver=new Ac(e,(n=t,i=ae(e),pi((a=n).customData.operationType,i,"argument-error"),pi(null===(r=a.customData._serverResponse)||void 0===r?void 0:r.mfaPendingCredential,i,"argument-error"),pa._fromError(i,a)))}else if(s){var a=Sc(t);const c=t;a&&(c.credential=a,c.tenantId=s.tenantId||void 0,c.email=s.email||void 0,c.phoneNumber=s.phoneNumber||void 0)}}function Sc(e){var t=(e instanceof R?e.customData:e)["_tokenResponse"];if(!t)return null;if(!(e instanceof R)&&"temporaryProof"in t&&"phoneNumber"in t)return Ya.credentialFromResult(e);const n=t.providerId;if(!n||n===ei.PASSWORD)return null;let r;switch(n){case ei.GOOGLE:r=Ss;break;case ei.FACEBOOK:r=ks;break;case ei.GITHUB:r=Cs;break;case ei.TWITTER:r=Rs;break;default:var{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:a,pendingToken:o,nonce:c}=t;return s||a||i||o?o?n.startsWith("saml.")?Ns._create(n,o):vs._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:i,accessToken:s}):new Es(n).credential({idToken:i,accessToken:s,rawNonce:c}):null}return e instanceof R?r.credentialFromError(e):r.credentialFromResult(e)}function Cc(t,e){return e.catch(e=>{throw e instanceof R&&kc(t,e),e}).then(e=>{var t=e.operationType,n=e.user;return{operationType:t,credential:Sc(e),additionalUserInfo:ha(e),user:Rc.getOrCreate(n)}})}async function Nc(t,e){const n=await e;return{verificationId:n.verificationId,confirm:e=>Cc(t,n.confirm(e))}}class Ac{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Cc(Ec(this.auth),this.resolver.resolveSignIn(e))}}class Rc{constructor(e){var t;this._delegate=e,this.multiFactor=(t=ae(e),ga.has(t)||ga.set(t,fa._fromUser(t)),ga.get(t))}static getOrCreate(e){return Rc.USER_MAP.has(e)||Rc.USER_MAP.set(e,new Rc(e)),Rc.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return Cc(this.auth,zs(this._delegate,e))}async linkWithPhoneNumber(e,t){return Nc(this.auth,async function(e,t,n){const r=ae(e);await qs(!1,r,"phone");var i=await Qa(r.auth,t,ae(n));return new Ha(i,e=>zs(r,e))}(this._delegate,e,t))}async linkWithPopup(e){return Cc(this.auth,async function(e,t,n){var r=ae(e);hi(r.auth,t,Is);var i=Ja(r.auth,n);const s=new io(r.auth,"linkViaPopup",t,i,r);return s.executeNotNull()}(this._delegate,e,Tc))}async linkWithRedirect(e){return await wc(as(this.auth)),go(this._delegate,e,Tc)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return Cc(this.auth,$s(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return Nc(this.auth,async function(e,t,n){const r=ae(e);var i=await Qa(r.auth,t,ae(n));return new Ha(i,e=>$s(r,e))}(this._delegate,e,t))}reauthenticateWithPopup(e){return Cc(this.auth,async function(e,t,n){var r=ae(e);hi(r.auth,t,Is);var i=Ja(r.auth,n);const s=new io(r.auth,"reauthViaPopup",t,i,r);return s.executeNotNull()}(this._delegate,e,Tc))}async reauthenticateWithRedirect(e){return await wc(as(this.auth)),fo(this._delegate,e,Tc)}sendEmailVerification(e){return ta(this._delegate,e)}async unlink(e){return await Fs(this._delegate,e),this}updateEmail(e){return ia(ae(this._delegate),e,null)}updatePassword(e){return ia(ae(this._delegate),null,e)}updatePhoneNumber(e){return async function(e,t){await Us(ae(e),t)}(this._delegate,e)}updateProfile(e){return ra(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return na(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Rc.USER_MAP=new WeakMap;const Dc=pi;class xc{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();var n=e.options["apiKey"];Dc(n,"invalid-api-key",{appName:e.name}),Dc(n,"invalid-api-key",{appName:e.name});var r="undefined"!=typeof window?Tc:void 0;this._delegate=t.initialize({options:{persistence:function(e,t){const n=function(e,t){const n=bc();if(!n)return[];var r=Ki(_c,e,t);switch(n.getItem(r)){case vc.NONE:return[$i];case vc.LOCAL:return[La,ba];case vc.SESSION:return[ba];default:return[]}}(e,t);"undefined"==typeof self||n.includes(La)||n.push(La);if("undefined"!=typeof window)for(const r of[_a,ba])n.includes(r)||n.push(r);n.includes($i)||n.push($i);return n}(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(ri),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Rc.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){cs(this._delegate,e,t)}applyActionCode(e){return Js(this._delegate,e)}checkActionCode(e){return Xs(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await ds(ae(e),{oobCode:t,newPassword:n})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return Cc(this._delegate,async function(e,t,n){const r=as(e);var i=await Ds(r,{returnSecureToken:!0,email:t,password:n}),i=await xs._fromIdTokenResponse(r,"signIn",i);return await r._updateCurrentUser(i.user),i}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return ea(this._delegate,e)}isSignInWithEmailLink(e){return this._delegate,e=e,"EMAIL_SIGNIN"===(null==(t=ws.parseLink(e))?void 0:t.operation);var t}async getRedirectResult(){Dc(gc(),this._delegate,"operation-not-supported-in-this-environment");var e,t,n=(e=this._delegate,t=Tc,await as(e)._initializationPromise,await mo(e,t,!1));return n?Cc(this._delegate,Promise.resolve(n)):{credential:null,user:null}}addFrameworkForLogging(e){as(this._delegate)._logFramework(e)}onAuthStateChanged(e,t,n){var{next:r,error:i,complete:s}=Pc(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){var{next:r,error:i,complete:s}=Pc(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return Zs(this._delegate,e,t)}sendPasswordResetEmail(e,t){return Ys(this._delegate,e,t||void 0)}async setPersistence(e){var t,n;t=this._delegate,n=e,yc(Object.values(vc).includes(n),t,"invalid-persistence-type"),E()?yc(n!==vc.SESSION,t,"unsupported-persistence-type"):I()?yc(n===vc.NONE,t,"unsupported-persistence-type"):fc()?yc(n===vc.NONE||n===vc.LOCAL&&C(),t,"unsupported-persistence-type"):yc(n===vc.NONE||pc(),t,"unsupported-persistence-type");let r;switch(e){case vc.SESSION:r=ba;break;case vc.LOCAL:var i=await vi(La)._isAvailable();r=i?La:_a;break;case vc.NONE:r=$i;break;default:return ci("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(r)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Cc(this._delegate,async function(e){const t=as(e);if(await t._initializationPromise,null!==(n=t.currentUser)&&void 0!==n&&n.isAnonymous)return new xs({user:t.currentUser,providerId:null,operationType:"signIn"});var n=await Ds(t,{returnSecureToken:!0}),n=await xs._fromIdTokenResponse(t,"signIn",n,!0);return await t._updateCurrentUser(n.user),n}(this._delegate))}signInWithCredential(e){return Cc(this._delegate,js(this._delegate,e))}signInWithCustomToken(e){return Cc(this._delegate,Ks(this._delegate,e))}signInWithEmailAndPassword(e,t){return Cc(this._delegate,(n=this._delegate,e=e,t=t,js(ae(n),bs.credential(e,t))));var n}signInWithEmailLink(e,t){return Cc(this._delegate,async function(e,t,n){var r=ae(e),i=bs.credentialWithLink(t,n||yi());return pi(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),js(r,i)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return Nc(this._delegate,async function(e,t,n){const r=as(e);var i=await Qa(r,t,ae(n));return new Ha(i,e=>js(r,e))}(this._delegate,e,t))}async signInWithPopup(e){return Dc(gc(),this._delegate,"operation-not-supported-in-this-environment"),Cc(this._delegate,async function(e,t,n){var r=as(e);hi(e,t,Is);var i=Ja(r,n);const s=new io(r,"signInViaPopup",t,i);return s.executeNotNull()}(this._delegate,e,Tc))}async signInWithRedirect(e){return Dc(gc(),this._delegate,"operation-not-supported-in-this-environment"),await wc(this._delegate),po(this._delegate,e,Tc)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){var n=(await Xs(ae(e),t))["data"];return n.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function Pc(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&Rc.getOrCreate(e)),error:t,complete:n}}xc.Persistence=vc;class Oc{constructor(){this.providerId="phone",this._delegate=new Ya(Ec(wt.auth()))}static credential(e,t){return Ya.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}Oc.PHONE_SIGN_IN_METHOD=Ya.PHONE_SIGN_IN_METHOD,Oc.PROVIDER_ID=Ya.PROVIDER_ID;const Mc=pi;class Lc{constructor(e,t,n=wt.app()){var r;Mc(null===(r=n.options)||void 0===r?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new Ga(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}(lc=wt).INTERNAL.registerComponent(new oe("auth-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new xc(t,n)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:ti.EMAIL_SIGNIN,PASSWORD_RESET:ti.PASSWORD_RESET,RECOVER_EMAIL:ti.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:ti.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:ti.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:ti.VERIFY_EMAIL}},EmailAuthProvider:bs,FacebookAuthProvider:ks,GithubAuthProvider:Cs,GoogleAuthProvider:Ss,OAuthProvider:Es,SAMLAuthProvider:As,PhoneAuthProvider:Oc,PhoneMultiFactorGenerator:$o,RecaptchaVerifier:Lc,TwitterAuthProvider:Rs,Auth:xc,AuthCredential:hs,Error:R}).setInstantiationMode("LAZY").setMultipleInstances(!1)),lc.registerVersion("@firebase/auth-compat","0.3.7");const Fc="@firebase/database";let Uc="";function qc(e){Uc=e}class Vc{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),O(t))}get(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:P(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Bc{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return L(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}var jc,zc,$c,Kc,Wc,Gc,Hc=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Vc(t)}}catch(e){}return new Bc};function Qc(e){var t=function(t){const n=[];let r=0;for(let a=0;a<t.length;a++){let e=t.charCodeAt(a);var i,s;55296<=e&&e<=56319&&(i=e-55296,a++,f(a<t.length,"Surrogate pair missing trail surrogate."),s=t.charCodeAt(a)-56320,e=65536+(i<<10)+s),e<128?n[r++]=e:(e<2048?n[r++]=e>>6|192:(e<65536?n[r++]=e>>12|224:(n[r++]=e>>18|240,n[r++]=e>>12&63|128),n[r++]=e>>6&63|128),n[r++]=63&e|128)}return n}(e);const n=new K;return n.update(t),t=n.digest(),r.encodeByteArray(t)}const Yc=Hc("localStorage"),Jc=Hc("sessionStorage"),Xc=new me("@firebase/database"),Zc=function(){let e=1;return function(){return e++}}(),el=function(...e){let t="";for(let r=0;r<e.length;r++){var n=e[r];Array.isArray(n)||n&&"object"==typeof n&&"number"==typeof n.length?t+=el.apply(null,n):t+="object"==typeof n?O(n):n,t+=" "}return t};let tl=null,nl=!0;function rl(t){return function(...e){ul(t,...e)}}function il(...e){var t="FIREBASE INTERNAL ERROR: "+el(...e);Xc.error(t)}function sl(e,t){return e===t?0:e<t?-1:1}function al(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+O(t))}function ol(e){if("object"!=typeof e||null===e)return O(e);const t=[];for(const r in e)t.push(r);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=O(t[i]),n+=":",n+=ol(e[t[i]]);return n+="}",n}function cl(e,t){var n=e.length;if(n<=t)return[e];const r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r}const ll=function(e,t){f(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(Xc.logLevel=m.VERBOSE,tl=Xc.log.bind(Xc),t&&Jc.set("logging_enabled",!0)):"function"==typeof e?tl=e:(tl=null,Jc.remove("logging_enabled"))},ul=function(...e){var t;!0===nl&&(nl=!1,null===tl&&!0===Jc.get("logging_enabled")&&ll(!0)),tl&&(t=el.apply(null,e),tl(t))},hl=function(...e){var t=`FIREBASE FATAL ERROR: ${el(...e)}`;throw Xc.error(t),new Error(t)},dl=function(...e){var t="FIREBASE WARNING: "+el(...e);Xc.warn(t)},pl=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&dl("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},fl=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},gl="[MIN_NAME]",ml="[MAX_NAME]",vl=function(e,t){if(e===t)return 0;if(e===gl||t===ml)return-1;if(t===gl||e===ml)return 1;var n=wl(e),r=wl(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null===r&&e<t?-1:1};function yl(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}function _l(e){f(!fl(e),"Invalid JSON number");let t,n,r,i,s;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,e=Math.abs(e),r=e>=Math.pow(2,-1022)?(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),n=i+1023,Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(e/Math.pow(2,-1074))));const a=[];for(s=52;s;--s)a.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;--s)a.push(n%2?1:0),n=Math.floor(n/2);a.push(t?1:0),a.reverse();const o=a.join("");let c="";for(s=0;s<64;s+=8){let e=parseInt(o.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()}function wl(e){if(Il.test(e)){var t=Number(e);if(t>=Tl&&t<=El)return t}return null}function bl(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n}const Il=new RegExp("^-?(0*)\\d{1,10}$"),Tl=-2147483648,El=2147483647,kl=function(e){try{e()}catch(t){setTimeout(()=>{var e=t.stack||"";throw dl("Exception was thrown by user callback.",e),t},Math.floor(0))}};class Sl{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null!=t&&t.get().then(e=>this.appCheck=e)}getToken(n){return this.appCheck?this.appCheck.getToken(n):new Promise((e,t)=>{setTimeout(()=>{this.appCheck?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){var e;null!==(e=this.appCheckProvider)&&void 0!==e&&e.get().then(e=>e.addTokenListener(t))}notifyForInvalidToken(){dl(`Provided AppCheck credentials for the app named "${this.appName_}" `+"are invalid. This usually indicates your app was not initialized correctly.")}}class Cl{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(n){return this.auth_?this.auth_.getToken(n).catch(e=>e&&"auth/token-not-initialized"===e.code?(ul("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,t)=>{setTimeout(()=>{this.auth_?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',dl(e)}}class Nl{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Nl.OWNER="owner";const Al=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Rl="websocket",Dl="long_polling";class xl{constructor(e,t,n,r,i=!1,s="",a=!1,o=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=o,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Yc.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Yc.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Pl(e,t,n){f("string"==typeof t,"typeof type must == string"),f("object"==typeof n,"typeof params must == object");let r;if(t===Rl)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Dl)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}((t=e).host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams)&&(n.ns=e.namespace);const i=[];return yl(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class Ol{constructor(){this.counters_={}}incrementCounter(e,t=1){L(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return c(void 0,this.counters_)}}const Ml={},Ll={};function Fl(e){var t=e.toString();return Ml[t]||(Ml[t]=new Ol),Ml[t]}class Ul{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<n.length;++e)n[e]&&kl(()=>{this.onMessage_(n[e])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class ql{constructor(e,t,n,r,i,s,a){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=rl(e),this.stats_=Fl(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),Pl(t,Dl,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Ul(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{let e=!1;const n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(!this.isClosed_){this.scriptTagHolder=new Vl((...e)=>{var[t,n,r]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===t)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{var[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const t={start:"t"};t.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=this.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",this.transportSessionId&&(t.s=this.transportSessionId),this.lastSessionId&&(t.ls=this.lastSessionId),this.applicationId&&(t.p=this.applicationId),this.appCheckToken&&(t.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Al.test(location.hostname)&&(t.r="f");var e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,()=>{})}})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){ql.forceAllow_=!0}static forceDisallow(){ql.forceDisallow_=!0}static isAvailable(){return!!ql.forceAllow_||!(ql.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){var t=O(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var t=i(t),n=cl(t,1840);for(let r=0;r<n.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){var t=O(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Vl{constructor(t,n,e,r){this.onDisconnect=e,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Zc(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=Vl.createIFrame_();let e="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i=document.domain,e='<script>document.domain="'+i+'";<\/script>');var i="<html><body>"+e+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){ul("frame writing exception"),e.stack&&ul(e.stack),ul(e)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||ul("No IE domain setting required")}catch(e){var n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;const i={};i.id=this.myID,i.pw=this.myPW,i.ser=this.currentSerial;var n=this.urlFn(i);let e="",t=0;for(;0<this.pendingSegs.length;){if(!(this.pendingSegs[0].d.length+30+e.length<=1870))break;var r=this.pendingSegs.shift();e=e+"&seg"+t+"="+r.seg+"&ts"+t+"="+r.ts+"&d"+t+"="+r.d,t++}return n+=e,this.addLongPollTag_(n,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const t=this.myIFrame.doc.createElement("script");t.type="text/javascript",t.async=!0,t.src=e,t.onload=t.onreadystatechange=function(){var e=t.readyState;e&&"loaded"!==e&&"complete"!==e||(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),n())},t.onerror=()=>{ul("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(t)}catch(e){}},Math.floor(1))}}let Bl=null;"undefined"!=typeof MozWebSocket?Bl=MozWebSocket:"undefined"!=typeof WebSocket&&(Bl=WebSocket);class jl{constructor(e,t,n,r,i,s,a){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=rl(this.connId),this.stats_=Fl(t),this.connURL=jl.connectionURL_(t,s,a,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){const s={v:"5"};return"undefined"!=typeof location&&location.hostname&&Al.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),r&&(s.ac=r),i&&(s.p=i),Pl(e,Rl,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Yc.set("previous_websocket_failure",!0);try{S(),this.mySock=new Bl(this.connURL,[],void 0)}catch(e){this.log_("Error instantiating WebSocket.");var n=e.message||e.data;return n&&this.log_(n),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){jl.forceDisallow_=!0}static isAvailable(){let e=!1;var t;return"undefined"==typeof navigator||!navigator.userAgent||(t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/))&&1<t.length&&parseFloat(t[1])<4.4&&(e=!0),!e&&null!==Bl&&!jl.forceDisallow_}static previouslyFailed(){return Yc.isInMemoryStorage||!0===Yc.get("previous_websocket_failure")}markConnectionHealthy(){Yc.remove("previous_websocket_failure")}appendFrame_(e){var t;this.frames.push(e),this.frames.length===this.totalFrames&&(t=this.frames.join(""),this.frames=null,t=P(t),this.onMessage(t))}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(f(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){var t;null!==this.mySock&&(t=e.data,this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames?this.appendFrame_(t):null!==(t=this.extractFrameCount_(t))&&this.appendFrame_(t))}send(e){this.resetKeepAlive();var t=O(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=cl(t,16384);1<n.length&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}jl.responsesRequiredToBeHealthy=2,jl.healthyTimeout=3e4;class zl{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[ql,jl]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){var t=jl&&jl.isAvailable();let n=t&&!jl.previouslyFailed();if(e.webSocketOnly&&(t||dl("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[jl];else{const r=this.transports_=[];for(const i of zl.ALL_TRANSPORTS)i&&i.isAvailable()&&r.push(i);zl.globalTransportInitialized_=!0}}initialTransport(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return 1<this.transports_.length?this.transports_[1]:null}}zl.globalTransportInitialized_=!1;class $l{constructor(e,t,n,r,i,s,a,o,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=a,this.onDisconnect_=o,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=rl("c:"+this.id+":"),this.transportManager_=new zl(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));var r=e.healthyTimeout||0;0<r&&(this.healthyTimeout_=bl(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&102400<this.conn_.bytesReceived?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&10240<this.conn_.bytesSent?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){var t;"t"in e&&("a"===(t=e.t)?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_()))}onSecondaryMessageReceived_(e){var t=al("t",e),n=al("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){var t=al("t",e),n=al("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){var t=al("t",e);if("d"in e){var n=e.d;if("h"===t){const r=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?il("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):il("Unknown control packet command: "+t)}}onHandshake_(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&dl("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),bl(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):bl(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Yc.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Kl{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class Wl{constructor(e){this.allowedEvents_=e,this.listeners_={},f(Array.isArray(e)&&0<e.length,"Requires a non-empty array")}trigger(t,...n){if(Array.isArray(this.listeners_[t])){const r=[...this.listeners_[t]];for(let e=0;e<r.length;e++)r[e].callback.apply(r[e].context,n)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(t){f(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}class Gl extends Wl{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||b()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new Gl}getInitialEvent(e){return f("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class Hl{constructor(n,e){if(void 0===e){this.pieces_=n.split("/");let e=0;for(let t=0;t<this.pieces_.length;t++)0<this.pieces_[t].length&&(this.pieces_[e]=this.pieces_[t],e++);this.pieces_.length=e,this.pieceNum_=0}else this.pieces_=n,this.pieceNum_=e}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function Ql(){return new Hl("")}function Yl(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function Jl(e){return e.pieces_.length-e.pieceNum_}function Xl(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new Hl(e.pieces_,t)}function Zl(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function eu(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function tu(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new Hl(t,0)}function nu(e,t){const n=[];for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);if(t instanceof Hl)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{var r=t.split("/");for(let e=0;e<r.length;e++)0<r[e].length&&n.push(r[e])}return new Hl(n,0)}function ru(e){return e.pieceNum_>=e.pieces_.length}function iu(e,t){var n=Yl(e),r=Yl(t);if(null===n)return t;if(n===r)return iu(Xl(e),Xl(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function su(e,t){var n=eu(e,0),r=eu(t,0);for(let s=0;s<n.length&&s<r.length;s++){var i=vl(n[s],r[s]);if(0!==i)return i}return n.length===r.length?0:n.length<r.length?-1:1}function au(e,t){if(Jl(e)!==Jl(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function ou(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(Jl(e)>Jl(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class cu{constructor(e,t){this.errorPrefix_=t,this.parts_=eu(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=ee(this.parts_[n]);lu(this)}}function lu(e){if(768<e.byteLength_)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(32<e.parts_.length)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+uu(e))}function uu(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class hu extends Wl{constructor(){super(["visible"]);let t,e;"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{var e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))},!1)}static getInstance(){return new hu}getInitialEvent(e){return f("visible"===e,"Unknown event type: "+e),[this.visible_]}}class du extends Kl{constructor(e,t,n,r,i,s,a,o){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=a,this.authOverride_=o,this.id=du.nextPersistentConnectionId_++,this.log_=rl("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,o&&!S())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");hu.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&Gl.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(O(i)),f(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const n=new y;var t={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:t,onComplete:e=>{var t=e.d;"ok"===e.s?n.resolve(t):n.reject(t)}}),this.outstandingGetCount_++;t=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(t),n.promise}listen(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),f(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),f(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(t){const n=this.outstandingGets_[t];this.sendRequest("g",n.request,e=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(e)})}sendListen_(r){const i=r.query,s=i._path.toString(),a=i._queryIdentifier;this.log_("Listen on "+s+" for "+a);const e={p:s};r.tag&&(e.q=i._queryObject,e.t=r.tag),e.h=r.hashFn(),this.sendRequest("q",e,e=>{var t=e.d,n=e.s;du.warnOnListenWarnings_(t,i),(this.listens.get(s)&&this.listens.get(s).get(a))===r&&(this.log_("listen response",e),"ok"!==n&&this.removeListen_(s,a),r.onComplete&&r.onComplete(n,t))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&L(e,"w")){const i=F(e,"w");var n,r;Array.isArray(i)&&~i.indexOf("no_index")&&(n='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString(),dl("Using an unspecified index. Your data will be downloaded and "+`filtered on the client. Consider adding ${n} at `+`${r} to your security rules for better performance.`))}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){var t;(e&&40===e.length||(e=e,"object"==typeof(t=M(e).claims)&&!0===t.admin))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const r=this.authToken_;var e=function(e){const t=M(e),n=t.claims;return!!n&&"object"==typeof n&&n.hasOwnProperty("iat")}(r)?"auth":"gauth";const t={cred:r};null===this.authOverride_?t.noauth=!0:"object"==typeof this.authOverride_&&(t.authvar=this.authOverride_),this.sendRequest(e,t,e=>{var t=e.s,n=e.d||"error";this.authToken_===r&&("ok"===t?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(t,n))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{var t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),f(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(t){const n=this.outstandingPuts_[t].action;var e=this.outstandingPuts_[t].request;const r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,e,e=>{this.log_(n+" response",e),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(e.s,e.d)})}reportStats(e){var t;this.connected_&&(this.log_("reportStats",t={c:e}),this.sendRequest("s",t,e=>{var t;"ok"!==e.s&&(t=e.d,this.log_("reportStats","Error sending stats: "+t))}))}onDataMessage_(e){if("r"in e){this.log_("from server: "+O(e));var t=e.r;const n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):il("Unrecognized action received from server: "+O(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){f(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){var e;this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()&&(this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime()),e=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-e),e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)),this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),r=this.onReady_.bind(this);const u=this.onRealtimeDisconnect_.bind(this);var i=this.id+":"+du.nextConnectionId_++,s=this.lastSessionId;let t=!1,n=null;var a=function(){n?n.close():(t=!0,u())};this.realtime_={close:a,sendRequest:function(e){f(n,"sendRequest call when we're not connected not allowed."),n.sendRequest(e)}};var o=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{var[c,l]=await Promise.all([this.authTokenProvider_.getToken(o),this.appCheckTokenProvider_.getToken(o)]);t?ul("getToken() completed but was canceled"):(ul("getToken() completed. Creating connection."),this.authToken_=c&&c.accessToken,this.appCheckToken_=l&&l.token,n=new $l(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,r,u,e=>{dl(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(e){this.log_("Failed to get token: "+e),t||(this.repoInfo_.nodeAdmin&&dl(e),a())}}}interrupt(e){ul("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){ul("Resuming connection for reason: "+e),delete this.interruptReasons_[e],U(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>ol(e)).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){var n=new Hl(e).toString();let r;if(this.listens.has(n)){const i=this.listens.get(n);r=i.get(t),i.delete(t),0===i.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){ul("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){ul("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,3<=this.invalidAppCheckTokenCount_&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const n of t.values())this.sendListen_(n);for(let r=0;r<this.outstandingPuts_.length;r++)this.outstandingPuts_[r]&&this.sendPut_(r);for(;this.onDisconnectRequestQueue_.length;){var e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let i=0;i<this.outstandingGets_.length;i++)this.outstandingGets_[i]&&this.sendGet_(i)}sendConnectStats_(){const e={};e["sdk.js."+Uc.replace(/\./g,"-")]=1,b()?e["framework.cordova"]=1:E()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){var e=Gl.getInstance().currentlyOnline();return U(this.interruptReasons_)&&e}}du.nextPersistentConnectionId_=0,du.nextConnectionId_=0;class pu{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new pu(e,t)}}class fu{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){var n=new pu(gl,e),r=new pu(gl,t);return 0!==this.compare(n,r)}minPost(){return pu.MIN}}let gu;class mu extends fu{static get __EMPTY_NODE(){return gu}static set __EMPTY_NODE(e){gu=e}compare(e,t){return vl(e.name,t.name)}isDefinedOn(e){throw u("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return pu.MIN}maxPost(){return new pu(ml,gu)}makePost(e,t){return f("string"==typeof e,"KeyIndex indexValue must always be a string."),new pu(e,gu)}toString(){return".key"}}const vu=new mu;class yu{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_.pop(),t;if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack_.length}peek(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class _u{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:_u.RED,this.left=null!=r?r:wu.EMPTY_NODE,this.right=null!=i?i:wu.EMPTY_NODE}copy(e,t,n,r,i){return new _u(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return wu.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return wu.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){var e=this.copy(null,null,_u.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){var e=this.copy(null,null,_u.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){var e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}_u.RED=!0,_u.BLACK=!1;class wu{constructor(e,t=wu.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new wu(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,_u.BLACK,null,null))}remove(e){return new wu(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,_u.BLACK,null,null))}get(e){var t;let n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:0<t&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:0<t&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new yu(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new yu(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new yu(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new yu(this.root_,null,this.comparator_,!0,e)}}function bu(e,t){return vl(e.name,t.name)}function Iu(e,t){return vl(e,t)}wu.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new _u(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let Tu;function Eu(e){return"number"==typeof e?"number:"+_l(e):"string:"+e}function ku(e){var t;e.isLeafNode()?(t=e.val(),f("string"==typeof t||"number"==typeof t||"object"==typeof t&&L(t,".sv"),"Priority must be a string or number.")):f(e===Tu||e.isEmpty(),"priority of unexpected type."),f(e===Tu||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}let Su;class Cu{constructor(e,t=Cu.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,f(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),ku(this.priorityNode_)}static set __childrenNodeConstructor(e){Su=e}static get __childrenNodeConstructor(){return Su}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Cu(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Cu.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return ru(e)?this:".priority"===Yl(e)?this.priorityNode_:Cu.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Cu.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){var n=Yl(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(f(".priority"!==n||1===Jl(e),".priority must be the last token in a path"),this.updateImmediateChild(n,Cu.__childrenNodeConstructor.EMPTY_NODE.updateChild(Xl(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Eu(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"==t?_l(this.value_):this.value_,this.lazyHash_=Qc(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Cu.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Cu.__childrenNodeConstructor?-1:(f(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){var t=typeof e.value_,n=typeof this.value_,r=Cu.VALUE_TYPE_ORDER.indexOf(t),i=Cu.VALUE_TYPE_ORDER.indexOf(n);return f(0<=r,"Unknown leaf type: "+t),f(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&(this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_))}}Cu.VALUE_TYPE_ORDER=["object","boolean","number","string"];let Nu,Au;const Ru=new class extends fu{compare(e,t){const n=e.node.getPriority();var r=t.node.getPriority(),r=n.compareTo(r);return 0===r?vl(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return pu.MIN}maxPost(){return new pu(ml,new Cu("[PRIORITY-POST]",Au))}makePost(e,t){var n=Nu(e);return new pu(t,new Cu("[PRIORITY-POST]",n))}toString(){return".priority"}},Du=Math.log(2);class xu{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Du,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}nextBitIsOne(){var e=!(this.bits_&1<<this.current_);return this.current_--,e}}function Pu(c,e,l,t){c.sort(e);const u=function(e,t){var n=t-e;let r,i;if(0==n)return null;if(1==n)return r=c[e],i=l?l(r):r,new _u(i,r.node,_u.BLACK,null,null);var s=parseInt(n/2,10)+e,a=u(e,s),n=u(s+1,t);return r=c[s],i=l?l(r):r,new _u(i,r.node,_u.BLACK,a,n)};var n=function(e){let s=null,a=null,o=c.length;function t(e,t){var n=o-e,r=o;o-=e;var i=u(1+n,r),r=c[n],n=l?l(r):r;!function(e){if(s){s.left=e;s=e}else{a=e;s=e}}(new _u(n,r.node,t,null,i))}for(let i=0;i<e.count;++i){var n=e.nextBitIsOne(),r=Math.pow(2,e.count-(i+1));n?t(r,_u.BLACK):(t(r,_u.BLACK),t(r,_u.RED))}return a}(new xu(c.length));return new wu(t||e,n)}let Ou;const Mu={};class Lu{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return f((Mu,Ru),"ChildrenNode.ts has not been loaded"),Ou=Ou||new Lu({".priority":Mu},{".priority":Ru}),Ou}get(e){var t=F(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof wu?t:null}hasIndex(e){return L(this.indexSet_,e.toString())}addIndex(e,t){f(e!==vu,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(pu.Wrap);let s=i.getNext();for(;s;)r=r||e.isDefinedOn(s.node),n.push(s),s=i.getNext();let a;a=r?Pu(n,e.getCompare()):Mu;var o=e.toString();const c=Object.assign({},this.indexSet_);c[o]=e;const l=Object.assign({},this.indexes_);return l[o]=a,new Lu(l,c)}addToIndexes(a,o){var e=q(this.indexes_,(t,e)=>{const n=F(this.indexSet_,e);if(f(n,"Missing index implementation for "+e),t===Mu){if(n.isDefinedOn(a.node)){const i=[],s=o.getIterator(pu.Wrap);let e=s.getNext();for(;e;)e.name!==a.name&&i.push(e),e=s.getNext();return i.push(a),Pu(i,n.getCompare())}return Mu}{var r=o.get(a.name);let e=t;return r&&(e=e.remove(new pu(a.name,r))),e.insert(a,a.node)}});return new Lu(e,this.indexSet_)}removeFromIndexes(n,r){var e=q(this.indexes_,e=>{if(e===Mu)return e;var t=r.get(n.name);return t?e.remove(new pu(n.name,t)):e});return new Lu(e,this.indexSet_)}}let Fu;class Uu{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&ku(this.priorityNode_),this.children_.isEmpty()&&f(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Fu=Fu||new Uu(new wu(Iu),null,Lu.Default)}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Fu}updatePriority(e){return this.children_.isEmpty()?this:new Uu(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?Fu:t}getChild(e){var t=Yl(e);return null===t?this:this.getImmediateChild(t).getChild(Xl(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(n,r){if(f(r,"We should always be passing snapshot nodes"),".priority"===n)return this.updatePriority(r);{var i=new pu(n,r);let e,t;t=r.isEmpty()?(e=this.children_.remove(n),this.indexMap_.removeFromIndexes(i,this.children_)):(e=this.children_.insert(n,r),this.indexMap_.addToIndexes(i,this.children_));i=e.isEmpty()?Fu:this.priorityNode_;return new Uu(e,i,t)}}updateChild(e,t){var n=Yl(e);if(null===n)return t;f(".priority"!==Yl(e)||1===Jl(e),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(Xl(e),t);return this.updateImmediateChild(n,r)}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(n){if(this.isEmpty())return null;const r={};let i=0,s=0,a=!0;if(this.forEachChild(Ru,(e,t)=>{r[e]=t.val(n),i++,a&&Uu.INTEGER_REGEXP_.test(e)?s=Math.max(s,Number(e)):a=!1}),!n&&a&&s<2*i){const e=[];for(const t in r)e[t]=r[t];return e}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(null===this.lazyHash_){let r="";this.getPriority().isEmpty()||(r+="priority:"+Eu(this.getPriority().val())+":"),this.forEachChild(Ru,(e,t)=>{var n=t.hash();""!==n&&(r+=":"+e+":"+n)}),this.lazyHash_=""===r?"":Qc(r)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new pu(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()}getFirstChild(e){var t=this.getFirstChildName(e);return t?new pu(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()}getLastChild(e){var t=this.getLastChildName(e);return t?new pu(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getIteratorFrom(t,e=>e);{const r=this.children_.getIteratorFrom(t.name,pu.Wrap);let e=r.peek();for(;null!=e&&n.compare(e,t)<0;)r.getNext(),e=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getReverseIteratorFrom(t,e=>e);{const r=this.children_.getReverseIteratorFrom(t.name,pu.Wrap);let e=r.peek();for(;null!=e&&0<n.compare(e,t);)r.getNext(),e=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Vu?-1:0}withIndex(e){if(e===vu||this.indexMap_.hasIndex(e))return this;var t=this.indexMap_.addIndex(e,this.children_);return new Uu(this.children_,this.priorityNode_,t)}isIndexed(e){return e===vu||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority())){if(this.children_.count()!==n.children_.count())return!1;{const r=this.getIterator(Ru),i=n.getIterator(Ru);let e=r.getNext(),t=i.getNext();for(;e&&t;){if(e.name!==t.name||!e.node.equals(t.node))return!1;e=r.getNext(),t=i.getNext()}return null===e&&null===t}}return!1}}resolveIndex_(e){return e===vu?null:this.indexMap_.get(e.toString())}}Uu.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class qu extends Uu{constructor(){super(new wu(Iu),Uu.EMPTY_NODE,Lu.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Uu.EMPTY_NODE}isEmpty(){return!1}}const Vu=new qu;Object.defineProperties(pu,{MIN:{value:new pu(gl,Uu.EMPTY_NODE)},MAX:{value:new pu(ml,Vu)}}),mu.__EMPTY_NODE=Uu.EMPTY_NODE,Cu.__childrenNodeConstructor=Uu,jc=Vu,Tu=jc,zc=Vu,Au=zc;const Bu=!0;function ju(i,e=null){if(null===i)return Uu.EMPTY_NODE;if("object"==typeof i&&".priority"in i&&(e=i[".priority"]),f(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"!=typeof(i="object"==typeof i&&".value"in i&&null!==i[".value"]?i[".value"]:i)||".sv"in i){var t=i;return new Cu(t,ju(e))}if(i instanceof Array||!Bu){let r=Uu.EMPTY_NODE;return yl(i,(e,t)=>{if(L(i,e)&&"."!==e.substring(0,1)){const n=ju(t);!n.isLeafNode()&&n.isEmpty()||(r=r.updateImmediateChild(e,n))}}),r.updatePriority(ju(e))}{const s=[];let r=!1;if(yl(i,(e,t)=>{if("."!==e.substring(0,1)){const n=ju(t);n.isEmpty()||(r=r||!n.getPriority().isEmpty(),s.push(new pu(e,n)))}}),0===s.length)return Uu.EMPTY_NODE;var n=Pu(s,bu,e=>e.name,Iu);if(r){t=Pu(s,Ru.getCompare());return new Uu(n,ju(e),new Lu({".priority":t},{".priority":Ru}))}return new Uu(n,ju(e),Lu.Default)}}Nu=ju;class zu extends fu{constructor(e){super(),this.indexPath_=e,f(!ru(e)&&".priority"!==Yl(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node);var r=this.extractChild(t.node),r=n.compareTo(r);return 0===r?vl(e.name,t.name):r}makePost(e,t){var n=ju(e),n=Uu.EMPTY_NODE.updateChild(this.indexPath_,n);return new pu(t,n)}maxPost(){var e=Uu.EMPTY_NODE.updateChild(this.indexPath_,Vu);return new pu(ml,e)}toString(){return eu(this.indexPath_,0).join("/")}}const $u=new class extends fu{compare(e,t){var n=e.node.compareTo(t.node);return 0===n?vl(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return pu.MIN}maxPost(){return pu.MAX}makePost(e,t){var n=ju(e);return new pu(t,n)}toString(){return".value"}};function Ku(e){return{type:"value",snapshotNode:e}}function Wu(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Gu(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Hu(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class Qu{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){f(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(Gu(t,a)):f(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?s.trackChildChange(Wu(t,n)):s.trackChildChange(Hu(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild(Ru,(e,t)=>{n.hasChild(e)||i.trackChildChange(Gu(e,t))}),n.isLeafNode()||n.forEachChild(Ru,(e,t)=>{if(r.hasChild(e)){const n=r.getImmediateChild(e);n.equals(t)||i.trackChildChange(Hu(e,t,n))}else i.trackChildChange(Wu(e,t))})),n.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Uu.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Yu{constructor(e){this.indexedFilter_=new Qu(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Yu.getStartPost_(e),this.endPost_=Yu.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){var t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,r,i,s){return this.matches(new pu(t,n))||(n=Uu.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){let r=(t=t.isLeafNode()?Uu.EMPTY_NODE:t).withIndex(this.index_);r=r.updatePriority(Uu.EMPTY_NODE);const i=this;return t.forEachChild(Ru,(e,t)=>{i.matches(new pu(e,t))||(r=r.updateImmediateChild(e,Uu.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class Ju{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{var t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{var t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new Yu(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,i,s){return this.rangedFilter_.matches(new pu(t,n))||(n=Uu.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,n,t){let r;if(n.isLeafNode()||n.isEmpty())r=Uu.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<n.numChildren()&&n.isIndexed(this.index_)){r=Uu.EMPTY_NODE.withIndex(this.index_);let e;e=this.reverse_?n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let t=0;for(;e.hasNext()&&t<this.limit_;){var i=e.getNext();if(this.withinDirectionalStart(i)){if(!this.withinDirectionalEnd(i))break;r=r.updateImmediateChild(i.name,i.node),t++}}}else{r=n.withIndex(this.index_),r=r.updatePriority(Uu.EMPTY_NODE);let e;e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);let t=0;for(;e.hasNext();){var s=e.getNext();t<this.limit_&&this.withinDirectionalStart(s)&&this.withinDirectionalEnd(s)?t++:r=r.updateImmediateChild(s.name,Uu.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,t)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){const d=this.index_.getCompare();s=(e,t)=>d(t,e)}else s=this.index_.getCompare();const a=e;f(a.numChildren()===this.limit_,"");var o=new pu(t,n),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),l=this.rangedFilter_.matches(o);if(a.hasChild(t)){var u=a.getImmediateChild(t);let e=r.getChildAfterChild(this.index_,c,this.reverse_);for(;null!=e&&(e.name===t||a.hasChild(e.name));)e=r.getChildAfterChild(this.index_,e,this.reverse_);var h=null==e?1:s(e,o);if(l&&!n.isEmpty()&&0<=h)return null!=i&&i.trackChildChange(Hu(t,n,u)),a.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(Gu(t,u));const p=a.updateImmediateChild(t,Uu.EMPTY_NODE);return null!=e&&this.rangedFilter_.matches(e)?(null!=i&&i.trackChildChange(Wu(e.name,e.node)),p.updateImmediateChild(e.name,e.node)):p}}return!n.isEmpty()&&l&&0<=s(c,o)?(null!=i&&(i.trackChildChange(Gu(c.name,c.node)),i.trackChildChange(Wu(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(c.name,Uu.EMPTY_NODE)):e}}class Xu{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ru}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return f(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return f(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:gl}hasEnd(){return this.endSet_}getIndexEndValue(){return f(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return f(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ml}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return f(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Ru}copy(){const e=new Xu;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Zu(e,t,n){const r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function eh(e,t,n){const r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function th(e,t){const n=e.copy();return n.index_=t,n}function nh(e){const t={};if(e.isDefault())return t;let n;var r;return n=e.index_===Ru?"$priority":e.index_===$u?"$value":e.index_===vu?"$key":(f(e.index_ instanceof zu,"Unrecognized index type!"),e.index_.toString()),t.orderBy=O(n),e.startSet_&&(r=e.startAfterSet_?"startAfter":"startAt",t[r]=O(e.indexStartValue_),e.startNameSet_&&(t[r]+=","+O(e.indexStartName_))),e.endSet_&&(r=e.endBeforeSet_?"endBefore":"endAt",t[r]=O(e.indexEndValue_),e.endNameSet_&&(t[r]+=","+O(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function rh(t){const n={};if(t.startSet_&&(n.sp=t.indexStartValue_,t.startNameSet_&&(n.sn=t.indexStartName_),n.sin=!t.startAfterSet_),t.endSet_&&(n.ep=t.indexEndValue_,t.endNameSet_&&(n.en=t.indexEndName_),n.ein=!t.endBeforeSet_),t.limitSet_){n.l=t.limit_;let e=t.viewFrom_;""===e&&(e=t.isViewFromLeft()?"l":"r"),n.vf=e}return t.index_!==Ru&&(n.i=t.index_.toString()),n}class ih extends Kl{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=rl("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(f(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const a=ih.getListenId_(e,r),o={};this.listens_[a]=o;var n=nh(e._queryParams);this.restRequest_(s+".json",n,(t,e)=>{let n=e;if(null===(t=404===t?n=null:t)&&this.onDataUpdate_(s,n,!1,r),F(this.listens_,a)===o){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",i(e,null)}})}unlisten(e,t){var n=ih.getListenId_(e,t);delete this.listens_[n]}get(e){var t=nh(e._queryParams);const r=e._path.toString(),i=new y;return this.restRequest_(r+".json",t,(e,t)=>{let n=t;null===(e=404===e?n=null:e)?(this.onDataUpdate_(r,n,!1,null),i.resolve(n)):i.reject(new Error(n))}),i.promise}refreshAuthToken(e){}restRequest_(i,s={},a){return s.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([e,t])=>{e&&e.accessToken&&(s.auth=e.accessToken),t&&t.token&&(s.ac=t.token);const n=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+i+"?ns="+this.repoInfo_.namespace+j(s);this.log_("Sending REST request for "+n);const r=new XMLHttpRequest;r.onreadystatechange=()=>{if(a&&4===r.readyState){this.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);let e=null;if(200<=r.status&&r.status<300){try{e=P(r.responseText)}catch(e){dl("Failed to parse JSON response for "+n+": "+r.responseText)}a(null,e)}else 401!==r.status&&404!==r.status&&dl("Got unsuccessful REST response for "+n+" Status: "+r.status),a(r.status);a=null}},r.open("GET",n,!0),r.send()})}}class sh{constructor(){this.rootNode_=Uu.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function ah(){return{value:null,children:new Map}}function oh(e,t,n){var r;ru(t)?(e.value=n,e.children.clear()):null!==e.value?e.value=e.value.updateChild(t,n):(r=Yl(t),e.children.has(r)||e.children.set(r,ah()),oh(e.children.get(r),t=Xl(t),n))}function ch(e,n,r){var i;null!==e.value?r(n,e.value):(i=(e,t)=>{ch(t,new Hl(n.toString()+"/"+e),r)},e.children.forEach((e,t)=>{i(t,e)}))}class lh{constructor(e){this.collection_=e,this.last_=null}get(){var e=this.collection_.get();const n=Object.assign({},e);return this.last_&&yl(this.last_,(e,t)=>{n[e]=n[e]-t}),this.last_=e,n}}class uh{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new lh(e);var n=1e4+2e4*Math.random();bl(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){var e=this.statsListener_.get();const n={};let r=!1;yl(e,(e,t)=>{0<t&&L(this.statsToReport_,e)&&(n[e]=t,r=!0)}),r&&this.server_.reportStats(n),bl(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function hh(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function dh(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function ph(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(EA=$c=$c||{})[EA.OVERWRITE=0]="OVERWRITE",EA[EA.MERGE=1]="MERGE",EA[EA.ACK_USER_WRITE=2]="ACK_USER_WRITE",EA[EA.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class fh{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=$c.ACK_USER_WRITE,this.source=hh()}operationForChild(e){if(ru(this.path)){if(null!=this.affectedTree.value)return f(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var t=this.affectedTree.subtree(new Hl(e));return new fh(Ql(),t,this.revert)}return f(Yl(this.path)===e,"operationForChild called for unrelated child."),new fh(Xl(this.path),this.affectedTree,this.revert)}}class gh{constructor(e,t){this.source=e,this.path=t,this.type=$c.LISTEN_COMPLETE}operationForChild(e){return ru(this.path)?new gh(this.source,Ql()):new gh(this.source,Xl(this.path))}}class mh{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=$c.OVERWRITE}operationForChild(e){return ru(this.path)?new mh(this.source,Ql(),this.snap.getImmediateChild(e)):new mh(this.source,Xl(this.path),this.snap)}}class vh{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=$c.MERGE}operationForChild(e){if(ru(this.path)){const t=this.children.subtree(new Hl(e));return t.isEmpty()?null:t.value?new mh(this.source,Ql(),t.value):new vh(this.source,Ql(),t)}return f(Yl(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new vh(this.source,Xl(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class yh{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ru(e))return this.isFullyInitialized()&&!this.filtered_;var t=Yl(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class _h{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function wh(n,e,t,r){var i=[];const s=[];return e.forEach(e=>{var t;"child_changed"===e.type&&n.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&s.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),bh(n,i,"child_removed",e,r,t),bh(n,i,"child_added",e,r,t),bh(n,i,"child_moved",s,r,t),bh(n,i,"child_changed",e,r,t),bh(n,i,"value",e,r,t),i}function bh(s,a,t,e,o,c){const n=e.filter(e=>e.type===t);n.sort((e,t)=>function(e,t,n){if(null==t.childName||null==n.childName)throw u("Should only compare child_ events.");var r=new pu(t.childName,t.snapshotNode),i=new pu(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(s,e,t)),n.forEach(t=>{const n=(e=s,i=c,"value"===(r=t).type||"child_removed"===r.type||(r.prevName=i.getPredecessorChildName(r.childName,r.snapshotNode,e.index_)),r);var e,r,i;o.forEach(e=>{e.respondsTo(t.type)&&a.push(e.createEvent(n,s.query_))})})}function Ih(e,t){return{eventCache:e,serverCache:t}}function Th(e,t,n,r){return Ih(new yh(t,n,r),e.serverCache)}function Eh(e,t,n,r){return Ih(e.eventCache,new yh(t,n,r))}function kh(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Sh(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Ch;class Nh{constructor(e,t=(Ch=Ch||new wu(sl),Ch)){this.value=e,this.children=t}static fromObject(e){let n=new Nh(null);return yl(e,(e,t)=>{n=n.set(new Hl(e),t)}),n}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Ql(),value:this.value};if(ru(e))return null;{var n=Yl(e);const i=this.children.get(n);if(null===i)return null;var r=i.findRootMostMatchingPathAndValue(Xl(e),t);return null==r?null:{path:nu(new Hl(n),r.path),value:r.value}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ru(e))return this;{var t=Yl(e);const n=this.children.get(t);return null!==n?n.subtree(Xl(e)):new Nh(null)}}set(e,t){if(ru(e))return new Nh(t,this.children);{var n=Yl(e);const i=this.children.get(n)||new Nh(null);var r=i.set(Xl(e),t),r=this.children.insert(n,r);return new Nh(this.value,r)}}remove(t){if(ru(t))return this.children.isEmpty()?new Nh(null):new Nh(null,this.children);{var n=Yl(t);const r=this.children.get(n);if(r){const i=r.remove(Xl(t));let e;return e=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&e.isEmpty()?new Nh(null):new Nh(this.value,e)}return this}}get(e){if(ru(e))return this.value;{var t=Yl(e);const n=this.children.get(t);return n?n.get(Xl(e)):null}}setTree(t,n){if(ru(t))return n;{var r=Yl(t);const i=this.children.get(r)||new Nh(null),s=i.setTree(Xl(t),n);let e;return e=s.isEmpty()?this.children.remove(r):this.children.insert(r,s),new Nh(this.value,e)}}fold(e){return this.fold_(Ql(),e)}fold_(n,r){const i={};return this.children.inorderTraversal((e,t)=>{i[e]=t.fold_(nu(n,e),r)}),r(n,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,Ql(),t)}findOnPath_(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(ru(e))return null;{r=Yl(e);const i=this.children.get(r);return i?i.findOnPath_(Xl(e),nu(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Ql(),t)}foreachOnPath_(e,t,n){if(ru(e))return this;{this.value&&n(t,this.value);var r=Yl(e);const i=this.children.get(r);return i?i.foreachOnPath_(Xl(e),nu(t,r),n):new Nh(null)}}foreach(e){this.foreach_(Ql(),e)}foreach_(n,r){this.children.inorderTraversal((e,t)=>{t.foreach_(nu(n,e),r)}),this.value&&r(n,this.value)}foreachChild(n){this.children.inorderTraversal((e,t)=>{t.value&&n(e,t.value)})}}class Ah{constructor(e){this.writeTree_=e}static empty(){return new Ah(new Nh(null))}}function Rh(t,n,r){if(ru(n))return new Ah(new Nh(r));var i=t.writeTree_.findRootMostValueAndPath(n);if(null!=i){var s=i.path;let e=i.value;i=iu(s,n);return e=e.updateChild(i,r),new Ah(t.writeTree_.set(s,e))}s=new Nh(r),s=t.writeTree_.setTree(n,s);return new Ah(s)}function Dh(e,n,t){let r=e;return yl(t,(e,t)=>{r=Rh(r,nu(n,e),t)}),r}function xh(e,t){if(ru(t))return Ah.empty();var n=e.writeTree_.setTree(t,new Nh(null));return new Ah(n)}function Ph(e,t){return null!=Oh(e,t)}function Oh(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(iu(n.path,t)):null}function Mh(e){const n=[],t=e.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(Ru,(e,t)=>{n.push(new pu(e,t))}):e.writeTree_.children.inorderTraversal((e,t)=>{null!=t.value&&n.push(new pu(e,t.value))}),n}function Lh(e,t){if(ru(t))return e;var n=Oh(e,t);return null!=n?new Ah(new Nh(n)):new Ah(e.writeTree_.subtree(t))}function Fh(e){return e.writeTree_.isEmpty()}function Uh(e,t){return function r(i,e,s){{if(null!=e.value)return s.updateChild(i,e.value);{let n=null;return e.children.inorderTraversal((e,t)=>{".priority"===e?(f(null!==t.value,"Priority writes must always be leaf nodes"),n=t.value):s=r(nu(i,e),t,s)}),s=!s.getChild(i).isEmpty()&&null!==n?s.updateChild(nu(i,".priority"),n):s}}}(Ql(),e.writeTree_,t)}function qh(e,t){return Jh(t,e)}function Vh(t,n){var e,r=t.allWrites.findIndex(e=>e.writeId===n);f(0<=r,"removeWrite called with nonexistent writeId.");const i=t.allWrites[r];t.allWrites.splice(r,1);let s=i.visible,a=!1,o=t.allWrites.length-1;for(;s&&0<=o;){var c=t.allWrites[o];c.visible&&(o>=r&&function(e,t){{if(e.snap)return ou(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&ou(nu(e.path,n),t))return!0;return!1}}(c,i.path)?s=!1:ou(i.path,c.path)&&(a=!0)),o--}return!!s&&(a?((e=t).visibleWrites=jh(e.allWrites,Bh,Ql()),0<e.allWrites.length?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1):i.snap?t.visibleWrites=xh(t.visibleWrites,i.path):yl(i.children,e=>{t.visibleWrites=xh(t.visibleWrites,nu(i.path,e))}),!0)}function Bh(e){return e.visible}function jh(e,t,n){let r=Ah.empty();for(let s=0;s<e.length;++s){const a=e[s];if(t(a)){var i=a.path;let e;if(a.snap)ou(n,i)?(e=iu(n,i),r=Rh(r,e,a.snap)):ou(i,n)&&(e=iu(i,n),r=Rh(r,Ql(),a.snap.getChild(e)));else{if(!a.children)throw u("WriteRecord should have .snap or .children");if(ou(n,i))e=iu(n,i),r=Dh(r,e,a.children);else if(ou(i,n))if(e=iu(i,n),ru(e))r=Dh(r,Ql(),a.children);else{const o=F(a.children,Yl(e));o&&(i=o.getChild(Xl(e)),r=Rh(r,Ql(),i))}}}}return r}function zh(e,t,n,r,i){if(r||i){var s=Lh(e.visibleWrites,t);if(!i&&Fh(s))return n;if(i||null!=n||Ph(s,Ql()))return Uh(jh(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(ou(e.path,t)||ou(t,e.path))},t),n||Uu.EMPTY_NODE);return null}s=Oh(e.visibleWrites,t);if(null!=s)return s;s=Lh(e.visibleWrites,t);return Fh(s)?n:null!=n||Ph(s,Ql())?Uh(s,n||Uu.EMPTY_NODE):null}function $h(e,t,n,r){return zh(e.writeTree,e.treePath,t,n,r)}function Kh(e,t){return function(e,t,n){let r=Uu.EMPTY_NODE;const i=Oh(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(Ru,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(n){const s=Lh(e.visibleWrites,t);return n.forEachChild(Ru,(e,t)=>{var n=Uh(Lh(s,new Hl(e)),t);r=r.updateImmediateChild(e,n)}),Mh(s).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}return Mh(Lh(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function Wh(e,t,n,r){return function(e,t,n,r,i){f(r||i,"Either existingEventSnap or existingServerSnap must exist");var s=nu(t,n);return Ph(e.visibleWrites,s)?null:Fh(s=Lh(e.visibleWrites,s))?i.getChild(n):Uh(s,i.getChild(n))}(e.writeTree,e.treePath,t,n,r)}function Gh(e,t){return n=e.writeTree,t=nu(e.treePath,t),Oh(n.visibleWrites,t);var n}function Hh(e,t,n,r,i,s){return function(e,t,n,r,i,s,a){let o;var c=Lh(e.visibleWrites,t),l=Oh(c,Ql());if(null!=l)o=l;else{if(null==n)return[];o=Uh(c,n)}if(o=o.withIndex(a),o.isEmpty()||o.isLeafNode())return[];{const u=[],h=a.getCompare(),d=s?o.getReverseIteratorFrom(r,a):o.getIteratorFrom(r,a);let e=d.getNext();for(;e&&u.length<i;)0!==h(e,r)&&u.push(e),e=d.getNext();return u}}(e.writeTree,e.treePath,t,n,r,i,s)}function Qh(e,t,n){return r=e.writeTree,e=e.treePath,n=n,i=nu(e,t=t),null!=(s=Oh(r.visibleWrites,i))?s:n.isCompleteForChild(t)?Uh(Lh(r.visibleWrites,i),n.getNode().getImmediateChild(t)):null;var r,i,s}function Yh(e,t){return Jh(nu(e.treePath,t),e.writeTree)}function Jh(e,t){return{treePath:e,writeTree:t}}class Xh{constructor(){this.changeMap=new Map}trackChildChange(e){var t=e.type,n=e.childName;f("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),f(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,Hu(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,Gu(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,Wu(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw u("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,Hu(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const Zh=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class ed{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new yh(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Qh(this.writes_,e,n)}getChildAfterChild(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Sh(this.viewCache_),r=Hh(this.writes_,r,t,1,n,e);return 0===r.length?null:r[0]}}function td(e,t,n,r,i){const s=new Xh;let a,o;if(n.type===$c.OVERWRITE){var c=n;a=c.source.fromUser?id(e,t,c.path,c.snap,r,i,s):(f(c.source.fromServer,"Unknown source."),o=c.source.tagged||t.serverCache.isFiltered()&&!ru(c.path),rd(e,t,c.path,c.snap,r,i,o,s))}else if(n.type===$c.MERGE){c=n;a=c.source.fromUser?function(r,i,s,e,a,o,c){let l=i;return e.foreach((e,t)=>{var n=nu(s,e);sd(i,Yl(n))&&(l=id(r,l,n,t,a,o,c))}),e.foreach((e,t)=>{var n=nu(s,e);sd(i,Yl(n))||(l=id(r,l,n,t,a,o,c))}),l}(e,t,c.path,c.children,r,i,s):(f(c.source.fromServer,"Unknown source."),o=c.source.tagged||t.serverCache.isFiltered(),od(e,t,c.path,c.children,r,i,o,s))}else if(n.type===$c.ACK_USER_WRITE){var l=n;a=l.revert?function(n,r,i,s,e,a){let o;{if(null!=Gh(s,i))return r;{var c=new ed(s,r,e);const u=r.eventCache.getNode();let t;if(ru(i)||".priority"===Yl(i)){let e;e=r.serverCache.isFullyInitialized()?$h(s,Sh(r)):(l=r.serverCache.getNode(),f(l instanceof Uu,"serverChildren would be complete if leaf node"),Kh(s,l)),e=e,t=n.filter.updateFullNode(u,e,a)}else{var l=Yl(i);let e=Qh(s,l,r.serverCache);null==e&&r.serverCache.isCompleteForChild(l)&&(e=u.getImmediateChild(l)),t=null!=e?n.filter.updateChild(u,l,e,Xl(i),c,a):r.eventCache.getNode().hasChild(l)?n.filter.updateChild(u,l,Uu.EMPTY_NODE,Xl(i),c,a):u,t.isEmpty()&&r.serverCache.isFullyInitialized()&&(o=$h(s,Sh(r)),o.isLeafNode()&&(t=n.filter.updateFullNode(t,o,a)))}return o=r.serverCache.isFullyInitialized()||null!=Gh(s,Ql()),Th(r,t,o,n.filter.filtersNodes())}}}(e,t,l.path,r,i,s):function(e,t,i,n,s,a,o){if(null!=Gh(s,i))return t;const c=t.serverCache.isFiltered(),l=t.serverCache;{if(null!=n.value){if(ru(i)&&l.isFullyInitialized()||l.isCompleteForPath(i))return rd(e,t,i,l.getNode().getChild(i),s,a,c,o);if(ru(i)){let n=new Nh(null);return l.getNode().forEachChild(vu,(e,t)=>{n=n.set(new Hl(e),t)}),od(e,t,i,n,s,a,c,o)}return t}{let r=new Nh(null);return n.foreach((e,t)=>{var n=nu(i,e);l.isCompleteForPath(n)&&(r=r.set(e,l.getNode().getChild(n)))}),od(e,t,i,r,s,a,c,o)}}}(e,t,l.path,l.affectedTree,r,i,s)}else{if(n.type!==$c.LISTEN_COMPLETE)throw u("Unknown operation type: "+n.type);a=function(e,t,n,r,i){const s=t.serverCache,a=Eh(t,s.getNode(),s.isFullyInitialized()||ru(n),s.isFiltered());return nd(e,a,n,r,Zh,i)}(e,t,n.path,r,s)}l=s.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty();const s=kh(e);(0<n.length||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(Ku(kh(t)))}}(t,a,l),{viewCache:a,changes:l}}function nd(r,i,s,a,o,c){const l=i.eventCache;if(null!=Gh(a,s))return i;{let t,n;if(ru(s)){var e;f(i.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t=i.serverCache.isFiltered()?(e=Kh(a,(e=Sh(i))instanceof Uu?e:Uu.EMPTY_NODE),r.filter.updateFullNode(i.eventCache.getNode(),e,c)):(u=$h(a,Sh(i)),r.filter.updateFullNode(i.eventCache.getNode(),u,c))}else{var u=Yl(s);if(".priority"===u){f(1===Jl(s),"Can't have a priority with additional path components");var h=l.getNode();n=i.serverCache.getNode();var d=Wh(a,s,h,n);t=null!=d?r.filter.updatePriority(h,d):l.getNode()}else{h=Xl(s);let e;e=l.isCompleteForChild(u)?(n=i.serverCache.getNode(),null!=(d=Wh(a,s,l.getNode(),n))?l.getNode().getImmediateChild(u).updateChild(h,d):l.getNode().getImmediateChild(u)):Qh(a,u,i.serverCache),t=null!=e?r.filter.updateChild(l.getNode(),u,e,h,o,c):l.getNode()}}return Th(i,t,l.isFullyInitialized()||ru(s),r.filter.filtersNodes())}}function rd(e,t,n,r,i,s,a,o){const c=t.serverCache;let l;const u=a?e.filter:e.filter.getIndexedFilter();if(ru(n))l=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){var h=c.getNode().updateChild(n,r);l=u.updateFullNode(c.getNode(),h,null)}else{var d=Yl(n);if(!c.isCompleteForPath(n)&&1<Jl(n))return t;var p=Xl(n);const f=c.getNode().getImmediateChild(d);h=f.updateChild(p,r);l=".priority"===d?u.updatePriority(c.getNode(),h):u.updateChild(c.getNode(),d,h,p,Zh,null)}p=Eh(t,l,c.isFullyInitialized()||ru(n),u.filtersNodes());return nd(e,p,n,i,new ed(i,p,s),o)}function id(t,n,r,i,e,s,a){const o=n.eventCache;let c,l;const u=new ed(e,n,s);if(ru(r))l=t.filter.updateFullNode(n.eventCache.getNode(),i,a),c=Th(n,l,!0,t.filter.filtersNodes());else{var h=Yl(r);if(".priority"===h)l=t.filter.updatePriority(n.eventCache.getNode(),i),c=Th(n,l,o.isFullyInitialized(),o.isFiltered());else{var d=Xl(r);const p=o.getNode().getImmediateChild(h);let e;if(ru(d))e=i;else{const f=u.getCompleteChild(h);e=null!=f?".priority"===Zl(d)&&f.getChild(tu(d)).isEmpty()?f:f.updateChild(d,i):Uu.EMPTY_NODE}c=p.equals(e)?n:Th(n,t.filter.updateChild(o.getNode(),h,e,d,u,a),o.isFullyInitialized(),t.filter.filtersNodes())}}return c}function sd(e,t){return e.eventCache.isCompleteForChild(t)}function ad(e,n,t){return t.foreach((e,t)=>{n=n.updateChild(e,t)}),n}function od(r,i,e,t,s,a,o,c){if(i.serverCache.getNode().isEmpty()&&!i.serverCache.isFullyInitialized())return i;let l=i,n;n=ru(e)?t:new Nh(null).setTree(e,t);const u=i.serverCache.getNode();return n.children.inorderTraversal((e,t)=>{var n;u.hasChild(e)&&(n=ad(0,i.serverCache.getNode().getImmediateChild(e),t),l=rd(r,l,new Hl(e),n,s,a,o,c))}),n.children.inorderTraversal((e,t)=>{var n=!i.serverCache.isCompleteForChild(e)&&null===t.value;u.hasChild(e)||n||(n=ad(0,i.serverCache.getNode().getImmediateChild(e),t),l=rd(r,l,new Hl(e),n,s,a,o,c))}),l}class cd{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new Qu(n.getIndex()),i=(e=n).loadsAllData()?new Qu(e.getIndex()):new(e.hasLimit()?Ju:Yu)(e);this.processor_={filter:i};const s=t.serverCache,a=t.eventCache;var o=r.updateFullNode(Uu.EMPTY_NODE,s.getNode(),null),c=i.updateFullNode(Uu.EMPTY_NODE,a.getNode(),null),o=new yh(o,s.isFullyInitialized(),r.filtersNodes()),c=new yh(c,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=Ih(c,o),this.eventGenerator_=new _h(this.query_)}get query(){return this.query_}}function ld(e){return 0===e.eventRegistrations_.length}function ud(n,r,i){const s=[];if(i){f(null==r,"A cancel should cancel all event registrations.");const a=n.query._path;n.eventRegistrations_.forEach(e=>{var t=e.createCancelEvent(i,a);t&&s.push(t)})}if(r){let e=[];for(let t=0;t<n.eventRegistrations_.length;++t){const o=n.eventRegistrations_[t];if(o.matches(r)){if(r.hasAnyCallback()){e=e.concat(n.eventRegistrations_.slice(t+1));break}}else e.push(o)}n.eventRegistrations_=e}else n.eventRegistrations_=[];return s}function hd(e,t,n,r){t.type===$c.MERGE&&null!==t.source.queryId&&(f(Sh(e.viewCache_),"We should always have a full cache before handling merges"),f(kh(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=td(e.processor_,i,t,n,r);return n=e.processor_,r=s.viewCache,f(r.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),f(r.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed"),f(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,dd(e,s.changes,s.viewCache.eventCache.getNode(),null)}function dd(e,t,n,r){var i=r?[r]:e.eventRegistrations_;return wh(e.eventGenerator_,t,n,i)}let pd;class fd{constructor(){this.views=new Map}}function gd(t,n,r,i){var e=n.source.queryId;if(null!==e){e=t.views.get(e);return f(null!=e,"SyncTree gave us an op for an invalid query."),hd(e,n,r,i)}{let e=[];for(const s of t.views.values())e=e.concat(hd(s,n,r,i));return e}}function md(e,n,r,i,s){var a=n._queryIdentifier,a=e.views.get(a);if(a)return a;{let e=$h(r,s?i:null),t=!1;t=!!e||(e=i instanceof Uu?Kh(r,i):Uu.EMPTY_NODE,!1);a=Ih(new yh(e,t,!1),new yh(i,s,!1));return new cd(n,a)}}function vd(e,t,n,r,i,s){var a=md(e,t,r,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,a),a.eventRegistrations_.push(n),function(e,t){const n=e.viewCache_.eventCache,r=[];if(!n.getNode().isLeafNode()){const i=n.getNode();i.forEachChild(Ru,(e,t)=>{r.push(Wu(e,t))})}return n.isFullyInitialized()&&r.push(Ku(n.getNode())),dd(e,r,n.getNode(),t)}(a,n)}function yd(e,t,n,r){var i=t._queryIdentifier;const s=[];let a=[];var o=Td(e);if("default"===i)for(var[c,l]of e.views.entries())a=a.concat(ud(l,n,r)),ld(l)&&(e.views.delete(c),l.query._queryParams.loadsAllData()||s.push(l.query));else{const u=e.views.get(i);u&&(a=a.concat(ud(u,n,r)),ld(u)&&(e.views.delete(i),u.query._queryParams.loadsAllData()||s.push(u.query)))}return o&&!Td(e)&&s.push((f(pd,"Reference.ts has not been loaded"),new pd(t._repo,t._path))),{removed:s,events:a}}function _d(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function wd(e,t){let n=null;for(const r of e.views.values())n=n||function(e,t){const n=Sh(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!ru(t)&&!n.getImmediateChild(Yl(t)).isEmpty())?n.getChild(t):null}(r,t);return n}function bd(e,t){const n=t._queryParams;if(n.loadsAllData())return Ed(e);var r=t._queryIdentifier;return e.views.get(r)}function Id(e,t){return null!=bd(e,t)}function Td(e){return null!=Ed(e)}function Ed(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let kd;let Sd=1;class Cd{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Nh(null),this.pendingWriteTree_={visibleWrites:Ah.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Nd(e,t,n,r,i){var s,a,o,c;return s=e.pendingWriteTree_,a=t,o=n,c=r,r=i,f(c>s.lastWriteId,"Stacking an older write on top of newer ones"),s.allWrites.push({path:a,snap:o,writeId:c,visible:r=void 0===r?!0:r}),r&&(s.visibleWrites=Rh(s.visibleWrites,a,o)),s.lastWriteId=c,i?Fd(e,new mh(hh(),t,n)):[]}function Ad(e,t,n,r){var i,s,a;i=e.pendingWriteTree_,s=t,a=n,r=r,f(r>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:s,children:a,writeId:r,visible:!0}),i.visibleWrites=Dh(i.visibleWrites,s,a),i.lastWriteId=r;var o=Nh.fromObject(n);return Fd(e,new vh(hh(),t,o))}function Rd(e,t,n=!1){var r=function(e,t){for(let r=0;r<e.allWrites.length;r++){var n=e.allWrites[r];if(n.writeId===t)return n}return null}(e.pendingWriteTree_,t);if(Vh(e.pendingWriteTree_,t)){let t=new Nh(null);return null!=r.snap?t=t.set(Ql(),!0):yl(r.children,e=>{t=t.set(new Hl(e),!0)}),Fd(e,new fh(r.path,t,n))}return[]}function Dd(e,t,n){return Fd(e,new mh(dh(),t,n))}function xd(n,e,t,r,i=!1){var s=e._path,a=n.syncPointTree_.get(s);let o=[];if(a&&("default"===e._queryIdentifier||Id(a,e))){var c=yd(a,e,t,r);0===a.views.size&&(n.syncPointTree_=n.syncPointTree_.remove(s));const d=c.removed;if(o=c.events,!i){a=-1!==d.findIndex(e=>e._queryParams.loadsAllData()),c=n.syncPointTree_.findOnPath(s,(e,t)=>Td(t));if(a&&!c){const p=n.syncPointTree_.subtree(s);if(!p.isEmpty()){var l=p.fold((e,t,r)=>{if(t&&Td(t))return[Ed(t)];{let n=[];return t&&(n=_d(t)),yl(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<l.length;++e){var u=l[e],h=u.query,u=qd(n,u);n.listenProvider_.startListening(Kd(h),Vd(n,h),u.hashFn,u.onComplete)}}}!c&&0<d.length&&!r&&(a?n.listenProvider_.stopListening(Kd(e),null):d.forEach(e=>{var t=n.queryToTagMap.get(Bd(e));n.listenProvider_.stopListening(Kd(e),t)}))}!function(e,t){for(let i=0;i<t.length;++i){const s=t[i];var n,r;s._queryParams.loadsAllData()||(n=Bd(s),r=e.queryToTagMap.get(n),e.queryToTagMap.delete(n),e.tagToQueryMap.delete(r))}}(n,d)}return o}function Pd(e,t,n,r){var i=jd(e,r);if(null==i)return[];var s=zd(i),a=s.path,i=s.queryId,s=iu(a,t);return $d(e,a,new mh(ph(i),s,n))}function Od(e,t,n,r=!1){const i=t._path;let s=null,a=!1;e.syncPointTree_.foreachOnPath(i,(e,t)=>{var n=iu(e,i);s=s||wd(t,n),a=a||Td(t)});let o=e.syncPointTree_.get(i);o?(a=a||Td(o),s=s||wd(o,Ql())):(o=new fd,e.syncPointTree_=e.syncPointTree_.set(i,o));let c;if(null!=s)c=!0;else{c=!1,s=Uu.EMPTY_NODE;const p=e.syncPointTree_.subtree(i);p.foreachChild((e,t)=>{var n=wd(t,Ql());n&&(s=s.updateImmediateChild(e,n))})}var l,u=Id(o,t);u||t._queryParams.loadsAllData()||(h=Bd(t),f(!e.queryToTagMap.has(h),"View does not exist, but we have a tag"),l=Sd++,e.queryToTagMap.set(h,l),e.tagToQueryMap.set(l,h));var h=qh(e.pendingWriteTree_,i);let d=vd(o,t,n,h,s,c);return u||a||r||(u=bd(o,t),d=d.concat(function(t,e,n){const r=e._path,i=Vd(t,e),s=qd(t,n),a=t.listenProvider_.startListening(Kd(e),i,s.hashFn,s.onComplete),o=t.syncPointTree_.subtree(r);if(i)f(!Td(o.value),"If we're adding a query, it shouldn't be shadowed");else{var c=o.fold((e,t,r)=>{if(!ru(e)&&t&&Td(t))return[Ed(t).query];{let n=[];return t&&(n=n.concat(_d(t).map(e=>e.query))),yl(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<c.length;++e){var l=c[e];t.listenProvider_.stopListening(Kd(l),Vd(t,l))}}return a}(e,t,u))),d}function Md(e,r,t){var n=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(r,(e,t)=>{var n=wd(t,iu(e,r));if(n)return n});return zh(n,r,i,t,!0)}function Ld(e,t){const r=t._path;let i=null;e.syncPointTree_.foreachOnPath(r,(e,t)=>{var n=iu(e,r);i=i||wd(t,n)});let n=e.syncPointTree_.get(r);n?i=i||wd(n,Ql()):(n=new fd,e.syncPointTree_=e.syncPointTree_.set(r,n));var s=null!=i;const a=s?new yh(i,!0,!1):null;var o=qh(e.pendingWriteTree_,t._path);return kh(md(n,t,o,s?a.getNode():Uu.EMPTY_NODE,s).viewCache_)}function Fd(e,t){return function t(n,r,i,s){{if(ru(n.path))return Ud(n,r,i,s);{const a=r.get(Ql());null==i&&null!=a&&(i=wd(a,Ql()));let e=[];const o=Yl(n.path),c=n.operationForChild(o),l=r.children.get(o);if(l&&c){const u=i?i.getImmediateChild(o):null,h=Yh(s,o);e=e.concat(t(c,l,u,h))}return a&&(e=e.concat(gd(a,n,s,i))),e}}}(t,e.syncPointTree_,null,qh(e.pendingWriteTree_,Ql()))}function Ud(s,e,a,o){var t=e.get(Ql());null==a&&null!=t&&(a=wd(t,Ql()));let c=[];return e.children.inorderTraversal((e,t)=>{var n=a?a.getImmediateChild(e):null,r=Yh(o,e),i=s.operationForChild(e);i&&(c=c.concat(Ud(i,t,n,r)))}),t&&(c=c.concat(gd(t,s,o,a))),c}function qd(i,t){const s=t.query,a=Vd(i,s);return{hashFn:()=>{const e=t.viewCache_.serverCache.getNode()||Uu.EMPTY_NODE;return e.hash()},onComplete:e=>{if("ok"===e)return a?function(e,t,n){if(s=jd(e,n)){var r=zd(s),i=r.path,s=r.queryId,r=iu(i,t);return $d(e,i,new gh(ph(s),r))}return[]}(i,s._path,a):(t=i,n=s._path,Fd(t,new gh(dh(),n)));var t,n,r=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(e,s);return xd(i,s,null,r)}}}function Vd(e,t){var n=Bd(t);return e.queryToTagMap.get(n)}function Bd(e){return e._path.toString()+"$"+e._queryIdentifier}function jd(e,t){return e.tagToQueryMap.get(t)}function zd(e){var t=e.indexOf("$");return f(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Hl(e.substr(0,t))}}function $d(e,t,n){var r=e.syncPointTree_.get(t);return f(r,"Missing sync point for query tag that we're tracking"),gd(r,n,qh(e.pendingWriteTree_,t),null)}function Kd(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?(f(kd,"Reference.ts has not been loaded"),new kd(e._repo,e._path)):e}class Wd{constructor(e){this.node_=e}getImmediateChild(e){var t=this.node_.getImmediateChild(e);return new Wd(t)}node(){return this.node_}}class Gd{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){var t=nu(this.path_,e);return new Gd(this.syncTree_,t)}node(){return Md(this.syncTree_,this.path_)}}function Hd(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e}function Qd(e,t,n){return e&&"object"==typeof e?(f(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?Yd(e[".sv"],t,n):"object"==typeof e[".sv"]?Jd(e[".sv"],t):void f(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e}const Yd=function(e,t,n){if("timestamp"===e)return n.timestamp;f(!1,"Unexpected server value: "+e)},Jd=function(e,t,n){e.hasOwnProperty("increment")||f(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!=typeof r&&f(!1,"Unexpected increment value: "+r);const i=t.node();if(f(null!==i&&void 0!==i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const s=i;var a=s.getValue();return"number"!=typeof a?r:a+r},Xd=function(e,t,n,r){return ep(t,new Gd(n,e),r)},Zd=function(e,t,n){return ep(e,new Wd(t),n)};function ep(e,r,i){var t=e.getPriority().val(),n=Qd(t,r.getImmediateChild(".priority"),i);let s;if(e.isLeafNode()){const a=e;t=Qd(a.getValue(),r,i);return t!==a.getValue()||n!==a.getPriority().val()?new Cu(t,ju(n)):e}{const o=e;return s=o,n!==o.getPriority().val()&&(s=s.updatePriority(new Cu(n))),o.forEachChild(Ru,(e,t)=>{var n=ep(t,r.getImmediateChild(e),i);n!==t&&(s=s.updateImmediateChild(e,n))}),s}}class tp{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function np(e,t){let n=t instanceof Hl?t:new Hl(t),r=e,i=Yl(n);for(;null!==i;){var s=F(r.node.children,i)||{children:{},childCount:0};r=new tp(i,r,s),n=Xl(n),i=Yl(n)}return r}function rp(e){return e.node.value}function ip(e,t){e.node.value=t,cp(e)}function sp(e){return 0<e.node.childCount}function ap(n,r){yl(n.node.children,(e,t)=>{r(new tp(e,n,t))})}function op(e){return new Hl(null===e.parent?e.name:op(e.parent)+"/"+e.name)}function cp(e){var t,n,r,i;null!==e.parent&&(t=e.parent,n=e.name,r=function(e){return void 0===rp(e)&&!sp(e)}(e=e),i=L(t.node.children,n),r&&i?(delete t.node.children[n],t.node.childCount--,cp(t)):r||i||(t.node.children[n]=e.node,t.node.childCount++,cp(t)))}function lp(e,t,n,r){r&&void 0===t||Ip(Y(e,"value"),t,n)}function up(e,t,r,n){if(!n||void 0!==t){const i=Y(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const s=[];yl(t,(e,t)=>{const n=new Hl(e);if(Ip(i,t,nu(r,n)),".priority"===Zl(n)&&!bp(t))throw new Error(i+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(n)}),function(t,n){let r,i;for(r=0;r<n.length;r++){i=n[r];var s=eu(i);for(let e=0;e<s.length;e++)if((".priority"!==s[e]||e!==s.length-1)&&!yp(s[e]))throw new Error(t+"contains an invalid key ("+s[e]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}n.sort(su);let e=null;for(r=0;r<n.length;r++){if(i=n[r],null!==e&&ou(e,i))throw new Error(t+"contains a path "+e.toString()+" that is ancestor of another path "+i.toString());e=i}}(i,s)}}function hp(e,t,n){if(!n||void 0!==t){if(fl(t))throw new Error(Y(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!bp(t))throw new Error(Y(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function dp(e,t,n,r){if(!(r&&void 0===n||yp(n)))throw new Error(Y(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function pp(e,t,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),Tp(e,t,n,r)}function fp(e,t){if(".info"===Yl(t))throw new Error(e+" failed = Can't modify data under /.info/")}const gp=/[\[\].#$\/\u0000-\u001F\u007F]/,mp=/[\[\].#$\u0000-\u001F\u007F]/,vp=10485760,yp=function(e){return"string"==typeof e&&0!==e.length&&!gp.test(e)},_p=function(e){return"string"==typeof e&&0!==e.length&&!mp.test(e)},wp=function(e){return e=e&&e.replace(/^\/*\.info(\/|$)/,"/"),_p(e)},bp=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!fl(e)||e&&"object"==typeof e&&L(e,".sv")},Ip=function(a,e,t){const o=t instanceof Hl?new cu(t,a):t;if(void 0===e)throw new Error(a+"contains undefined "+uu(o));if("function"==typeof e)throw new Error(a+"contains a function "+uu(o)+" with contents = "+e.toString());if(fl(e))throw new Error(a+"contains "+e.toString()+" "+uu(o));if("string"==typeof e&&e.length>vp/3&&ee(e)>vp)throw new Error(a+"contains a string greater than "+vp+" utf8 bytes "+uu(o)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let i=!1,s=!1;if(yl(e,(e,t)=>{if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(s=!0,!yp(e)))throw new Error(a+" contains an invalid key ("+e+") "+uu(o)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var n,r;n=o,e=e,0<n.parts_.length&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=ee(e),lu(n),Ip(a,t,o),t=o,r=t.parts_.pop(),t.byteLength_-=ee(r),0<t.parts_.length&&--t.byteLength_}),i&&s)throw new Error(a+' contains ".value" child '+uu(o)+" in addition to actual children.")}},Tp=function(e,t,n,r){if(!(r&&void 0===n||_p(n)))throw new Error(Y(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Ep=function(e,t){var n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!yp(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!wp(n))throw new Error(Y(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class kp{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Sp(e,t){let n=null;for(let i=0;i<t.length;i++){const s=t[i];var r=s.getPath();null===n||au(r,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:r}),n.events.push(s)}n&&e.eventLists_.push(n)}function Cp(e,t,n){Sp(e,n),Ap(e,e=>au(e,t))}function Np(e,t,n){Sp(e,n),Ap(e,e=>ou(e,t)||ou(t,e))}function Ap(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){var r=e.eventLists_[i];r&&(t(r.path)?(function(e){for(let n=0;n<e.events.length;n++){const r=e.events[n];var t;null!==r&&(e.events[n]=null,t=r.getEventRunner(),tl&&ul("event: "+r.toString()),kl(t))}}(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}const Rp="repo_interrupt",Dp=25;class xp{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new kp,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=ah(),this.transactionQueueTree_=new tp,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Pp(a,e,t){if(a.stats_=Fl(a.repoInfo_),a.forceRestClient_||function(){const e="object"==typeof window&&window.navigator&&window.navigator.userAgent||"";return 0<=e.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)}())a.server_=new ih(a.repoInfo_,(e,t,n,r)=>{Lp(a,e,t,n,r)},a.authTokenProvider_,a.appCheckProvider_),setTimeout(()=>Fp(a,!0),0);else{if(null!=t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{O(t)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}a.persistentConnection_=new du(a.repoInfo_,e,(e,t,n,r)=>{Lp(a,e,t,n,r)},e=>{Fp(a,e)},e=>{var n;n=a,yl(e,(e,t)=>{Up(n,e,t)})},a.authTokenProvider_,a.appCheckProvider_,t),a.server_=a.persistentConnection_}var n;a.authTokenProvider_.addTokenChangeListener(e=>{a.server_.refreshAuthToken(e)}),a.appCheckProvider_.addTokenChangeListener(e=>{a.server_.refreshAppCheckToken(e.token)}),a.statsReporter_=(e=a.repoInfo_,t=()=>new uh(a.stats_,a.server_),n=e.toString(),Ll[n]||(Ll[n]=t()),Ll[n]),a.infoData_=new sh,a.infoSyncTree_=new Cd({startListening:(e,t,n,r)=>{let i=[];const s=a.infoData_.getNode(e._path);return s.isEmpty()||(i=Dd(a.infoSyncTree_,e._path,s),setTimeout(()=>{r("ok")},0)),i},stopListening:()=>{}}),Up(a,"connected",!1),a.serverSyncTree_=new Cd({startListening:(r,e,t,i)=>(a.server_.listen(r,t,e,(e,t)=>{var n=i(e,t);Np(a.eventQueue_,r._path,n)}),[]),stopListening:(e,t)=>{a.server_.unlisten(e,t)}})}function Op(e){const t=e.infoData_.getNode(new Hl(".info/serverTimeOffset"));var n=t.val()||0;return(new Date).getTime()+n}function Mp(e){return Hd({timestamp:Op(e)})}function Lp(e,t,n,r,i){e.dataUpdateCount++;var s,a,o=new Hl(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let c=[];c=i?r?(s=q(n,e=>ju(e)),function(e,t,n,r){if(o=jd(e,r)){var i=zd(o),s=i.path,a=i.queryId,o=iu(s,t),i=Nh.fromObject(n);return $d(e,s,new vh(ph(a),o,i))}return[]}(e.serverSyncTree_,o,s,i)):(s=ju(n),Pd(e.serverSyncTree_,o,s,i)):r?(a=q(n,e=>ju(e)),t=e.serverSyncTree_,i=o,r=a,a=Nh.fromObject(r),Fd(t,new vh(dh(),i,a))):(a=ju(n),Dd(e.serverSyncTree_,o,a));let l=o;0<c.length&&(l=Qp(e,o)),Np(e.eventQueue_,l,c)}function Fp(e,t){Up(e,"connected",t),!1===t&&function(r){Kp(r,"onDisconnectEvents");const i=Mp(r),s=ah();ch(r.onDisconnect_,Ql(),(e,t)=>{var n=Xd(e,t,r.serverSyncTree_,i);oh(s,e,n)});let a=[];ch(s,Ql(),(e,t)=>{a=a.concat(Dd(r.serverSyncTree_,e,t));var n=Zp(r,e);Qp(r,n)}),r.onDisconnect_=ah(),Np(r.eventQueue_,Ql(),a)}(e)}function Up(e,t,n){var r=new Hl("/.info/"+t),i=ju(n);e.infoData_.updateSnapshot(r,i);i=Dd(e.infoSyncTree_,r,i);Np(e.eventQueue_,r,i)}function qp(e){return e.nextWriteId_++}function Vp(r,i,e,t,s){Kp(r,"set",{path:i.toString(),value:e,priority:t});var n=Mp(r);const a=ju(e,t);var o=Md(r.serverSyncTree_,i),n=Zd(a,o,n);const c=qp(r);n=Nd(r.serverSyncTree_,i,n,c,!0);Sp(r.eventQueue_,n),r.server_.put(i.toString(),a.val(!0),(e,t)=>{var n="ok"===e;n||dl("set at "+i+" failed: "+e);n=Rd(r.serverSyncTree_,c,!n);Np(r.eventQueue_,i,n),Wp(0,s,e,t)});n=Zp(r,i);Qp(r,n),Np(r.eventQueue_,n,[])}function Bp(n,r,i){n.server_.onDisconnectCancel(r.toString(),(e,t)=>{"ok"===e&&!function e(n,t){if(ru(t))return n.value=null,n.children.clear(),!0;if(null!==n.value){if(n.value.isLeafNode())return!1;{const i=n.value;return n.value=null,i.forEachChild(Ru,(e,t)=>{oh(n,new Hl(e),t)}),e(n,t)}}if(0<n.children.size){var r=Yl(t);return t=Xl(t),n.children.has(r)&&e(n.children.get(r),t)&&n.children.delete(r),0===n.children.size}return!0}(n.onDisconnect_,r),Wp(0,i,e,t)})}function jp(n,r,e,i){const s=ju(e);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&oh(n.onDisconnect_,r,s),Wp(0,i,e,t)})}function zp(e,t,n){let r;r=".info"===Yl(t._path)?xd(e.infoSyncTree_,t,n):xd(e.serverSyncTree_,t,n),Cp(e.eventQueue_,t._path,r)}function $p(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Rp)}function Kp(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),ul(n,...t)}function Wp(e,r,i,s){r&&kl(()=>{if("ok"===i)r(null);else{var t=(i||"error").toUpperCase();let e=t;s&&(e+=": "+s);const n=new Error(e);n.code=t,r(n)}})}function Gp(e,t,n){return Md(e.serverSyncTree_,t,n)||Uu.EMPTY_NODE}function Hp(t,e=t.transactionQueueTree_){if(e||Xp(t,e),rp(e)){const n=Jp(t,e);f(0<n.length,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&function(i,s,a){const e=a.map(e=>e.currentWriteId),t=Gp(i,s,e);let n=t;var r=t.hash();for(let u=0;u<a.length;u++){const h=a[u];f(0===h.status,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;var o=iu(s,h.path);n=n.updateChild(o,h.currentOutputSnapshotRaw)}const c=n.val(!0),l=s;i.server_.put(l.toString(),c,t=>{Kp(i,"transaction put response",{path:l.toString(),status:t});let n=[];if("ok"===t){const r=[];for(let e=0;e<a.length;e++)a[e].status=2,n=n.concat(Rd(i.serverSyncTree_,a[e].currentWriteId)),a[e].onComplete&&r.push(()=>a[e].onComplete(null,!0,a[e].currentOutputSnapshotResolved)),a[e].unwatcher();Xp(i,np(i.transactionQueueTree_,s)),Hp(i,i.transactionQueueTree_),Np(i.eventQueue_,s,n);for(let t=0;t<r.length;t++)kl(r[t])}else{if("datastale"===t)for(let e=0;e<a.length;e++)3===a[e].status?a[e].status=4:a[e].status=0;else{dl("transaction at "+l.toString()+" failed: "+t);for(let e=0;e<a.length;e++)a[e].status=4,a[e].abortReason=t}Qp(i,s)}},r)}(t,op(e),n)}else sp(e)&&ap(e,e=>{Hp(t,e)})}function Qp(e,t){var n=Yp(e,t),r=op(n);return function(i,s,a){if(0!==s.length){const l=[];let n=[];const t=s.filter(e=>0===e.status),u=t.map(e=>e.currentWriteId);for(let r=0;r<s.length;r++){const h=s[r];var o=iu(a,h.path);let e=!1,t;if(f(null!==o,"rerunTransactionsUnderNode_: relativePath should not be null."),4===h.status)e=!0,t=h.abortReason,n=n.concat(Rd(i.serverSyncTree_,h.currentWriteId,!0));else if(0===h.status)if(h.retryCount>=Dp)e=!0,t="maxretry",n=n.concat(Rd(i.serverSyncTree_,h.currentWriteId,!0));else{const d=Gp(i,h.path,u);h.currentInputSnapshot=d;var c=s[r].update(d.val());if(void 0!==c){Ip("transaction failed: Data returned ",c,h.path);let e=ju(c);"object"==typeof c&&null!=c&&L(c,".priority")||(e=e.updatePriority(d.getPriority()));o=h.currentWriteId,c=Mp(i),c=Zd(e,d,c);h.currentOutputSnapshotRaw=e,h.currentOutputSnapshotResolved=c,h.currentWriteId=qp(i),u.splice(u.indexOf(o),1),n=n.concat(Nd(i.serverSyncTree_,h.path,c,h.currentWriteId,h.applyLocally)),n=n.concat(Rd(i.serverSyncTree_,o,!0))}else e=!0,t="nodata",n=n.concat(Rd(i.serverSyncTree_,h.currentWriteId,!0))}Np(i.eventQueue_,a,n),n=[],e&&(s[r].status=2,function(e){setTimeout(e,Math.floor(0))}(s[r].unwatcher),s[r].onComplete&&("nodata"===t?l.push(()=>s[r].onComplete(null,!1,s[r].currentInputSnapshot)):l.push(()=>s[r].onComplete(new Error(t),!1,null))))}Xp(i,i.transactionQueueTree_);for(let e=0;e<l.length;e++)kl(l[e]);Hp(i,i.transactionQueueTree_)}}(e,Jp(e,n),r),r}function Yp(e,t){let n,r=e.transactionQueueTree_;for(n=Yl(t);null!==n&&void 0===rp(r);)r=np(r,n),t=Xl(t),n=Yl(t);return r}function Jp(e,t){const n=[];return function t(n,e,r){const i=rp(e);if(i)for(let e=0;e<i.length;e++)r.push(i[e]);ap(e,e=>{t(n,e,r)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function Xp(t,n){const r=rp(n);if(r){let e=0;for(let t=0;t<r.length;t++)2!==r[t].status&&(r[e]=r[t],e++);r.length=e,ip(n,0<r.length?r:void 0)}ap(n,e=>{Xp(t,e)})}function Zp(t,e){var n=op(Yp(t,e)),r=np(t.transactionQueueTree_,e);return function(e,t,n){let r=n?e:e.parent;for(;null!==r;){if(t(r))return;r=r.parent}}(r,e=>{ef(t,e)}),ef(t,r),function t(e,n,r,i){r&&!i&&n(e),ap(e,e=>{t(e,n,!0,i)}),r&&i&&n(e)}(r,e=>{ef(t,e)}),n}function ef(i,s){const a=rp(s);if(a){const o=[];let e=[],t=-1;for(let n=0;n<a.length;n++)3===a[n].status||(1===a[n].status?(f(t===n-1,"All SENT items should be at beginning of queue."),t=n,a[n].status=3,a[n].abortReason="set"):(f(0===a[n].status,"Unexpected transaction status in abort"),a[n].unwatcher(),e=e.concat(Rd(i.serverSyncTree_,a[n].currentWriteId,!0)),a[n].onComplete&&o.push(a[n].onComplete.bind(null,new Error("set"),!1,null))));-1===t?ip(s,void 0):a.length=t+1,Np(i.eventQueue_,op(s),e);for(let r=0;r<o.length;r++)kl(o[r])}}const tf=function(e,t){var n=nf(e),r=n.namespace;"firebase.com"===n.domain&&hl(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||hl("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||pl();var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new xl(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new Hl(n.pathString)}},nf=function(r){let i="",s="",a="",o="",c="",l=!0,u="https",h=443;if("string"==typeof r){let e=r.indexOf("//");0<=e&&(u=r.substring(0,e-1),r=r.substring(e+2));let t=r.indexOf("/");-1===t&&(t=r.length);let n=r.indexOf("?");-1===n&&(n=r.length),i=r.substring(0,Math.min(t,n)),t<n&&(o=function(e){let t="";var n=e.split("/");for(let r=0;r<n.length;r++)if(0<n[r].length){let e=n[r];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(e){}t+="/"+e}return t}(r.substring(t,n)));var d,p=function(e){const t={};for(const r of(e="?"===e.charAt(0)?e.substring(1):e).split("&")){var n;0!==r.length&&(2===(n=r.split("=")).length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):dl(`Invalid query segment '${r}' in query '${e}'`))}return t}(r.substring(Math.min(r.length,n)));e=i.indexOf(":"),0<=e?(l="https"===u||"wss"===u,h=parseInt(i.substring(e+1),10)):e=i.length;const f=i.slice(0,e);"localhost"===f.toLowerCase()?s="localhost":f.split(".").length<=2?s=f:(d=i.indexOf("."),a=i.substring(0,d).toLowerCase(),s=i.substring(d+1),c=a),"ns"in p&&(c=p.ns)}return{host:i,port:h,domain:s,subdomain:a,secure:l,scheme:u,pathString:o,namespace:c}},rf="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",sf=function(){let s=0;const a=[];return function(e){var t=e===s;s=e;let n;const r=new Array(8);for(n=7;0<=n;n--)r[n]=rf.charAt(e%64),e=Math.floor(e/64);f(0===e,"Cannot push at time == 0");let i=r.join("");if(t){for(n=11;0<=n&&63===a[n];n--)a[n]=0;a[n]++}else for(n=0;n<12;n++)a[n]=Math.floor(64*Math.random());for(n=0;n<12;n++)i+=rf.charAt(a[n]);return f(20===i.length,"nextPushId: Length should be 20."),i}}();class af{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){var e=this.snapshot.ref;return("value"===this.eventType?e:e.parent)._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+O(this.snapshot.exportVal())}}class of{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class cf{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return f(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class lf{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new y;return Bp(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){fp("OnDisconnect.remove",this._path);const e=new y;return jp(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){fp("OnDisconnect.set",this._path),lp("OnDisconnect.set",e,this._path,!1);const t=new y;return jp(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){fp("OnDisconnect.setWithPriority",this._path),lp("OnDisconnect.setWithPriority",e,this._path,!1),hp("OnDisconnect.setWithPriority",t,!1);const n=new y;return function(n,r,e,t,i){const s=ju(e,t);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&oh(n.onDisconnect_,r,s),Wp(0,i,e,t)})}(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){fp("OnDisconnect.update",this._path),up("OnDisconnect.update",e,this._path,!1);const t=new y;return function(r,i,n,s){if(U(n))return ul("onDisconnect().update() called with empty data.  Don't do anything."),Wp(0,s,"ok",void 0);r.server_.onDisconnectMerge(i.toString(),n,(e,t)=>{"ok"===e&&yl(n,(e,t)=>{var n=ju(t);oh(r.onDisconnect_,nu(i,e),n)}),Wp(0,s,e,t)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class uf{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return ru(this._path)?null:Zl(this._path)}get ref(){return new ff(this._repo,this._path)}get _queryIdentifier(){var e=rh(this._queryParams),e=ol(e);return"{}"===e?"default":e}get _queryObject(){return rh(this._queryParams)}isEqual(e){if(!((e=ae(e))instanceof uf))return!1;var t=this._repo===e._repo,n=au(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}function hf(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function df(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===vu){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==gl)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==ml)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===Ru){if(null!=t&&!bp(t)||null!=n&&!bp(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(f(e.getIndex()instanceof zu||e.getIndex()===$u,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function pf(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class ff extends uf{constructor(e,t){super(e,t,new Xu,!1)}get parent(){var e=tu(this._path);return null===e?null:new ff(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class gf{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){var t=new Hl(e),n=yf(this.ref,e);return new gf(this._node.getChild(t),n,Ru)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(n){if(this._node.isLeafNode())return!1;const e=this._node;return!!e.forEachChild(this._index,(e,t)=>n(new gf(t,yf(this.ref,e),Ru)))}hasChild(e){var t=new Hl(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function mf(e,t){return(e=ae(e))._checkNotDeleted("ref"),void 0!==t?yf(e._root,t):e._root}function vf(e,t){(e=ae(e))._checkNotDeleted("refFromURL");const n=tf(t,e._repo.repoInfo_.nodeAdmin);Ep("refFromURL",n);var r=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||r.host===e._repo.repoInfo_.host||hl("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+e._repo.repoInfo_.host+")"),mf(e,n.path.toString())}function yf(e,t){return(null===Yl((e=ae(e))._path)?pp:Tp)("child","path",t,!1),new ff(e._repo,nu(e._path,t))}function _f(e,t){e=ae(e),fp("set",e._path),lp("set",t,e._path,!1);const n=new y;return Vp(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}function wf(e,t){up("update",t,e._path,!1);const n=new y;return function(i,s,e,a){Kp(i,"update",{path:s.toString(),value:e});let n=!0;const r=Mp(i),o={};if(yl(e,(e,t)=>{n=!1,o[e]=Xd(nu(s,e),ju(t),i.serverSyncTree_,r)}),n)ul("update() called with empty data.  Don't do anything."),Wp(0,a,"ok",void 0);else{const c=qp(i);var t=Ad(i.serverSyncTree_,s,o,c);Sp(i.eventQueue_,t),i.server_.merge(s.toString(),e,(e,t)=>{var n="ok"===e;n||dl("update at "+s+" failed: "+e);var r=Rd(i.serverSyncTree_,c,!n),n=0<r.length?Qp(i,s):s;Np(i.eventQueue_,n,r),Wp(0,a,e,t)}),yl(e,e=>{var t=Zp(i,nu(s,e));Qp(i,t)}),Np(i.eventQueue_,s,[])}}(e._repo,e._path,t,n.wrapCallback(()=>{})),n.promise}function bf(t){t=ae(t);var i,s,a,e=new cf(()=>{}),e=new If(e);return i=t._repo,s=t,a=e,(null!=(e=Ld(i.serverSyncTree_,s))?Promise.resolve(e):i.server_.get(s).then(e=>{var t,n=ju(e).withIndex(s._queryParams.getIndex());Od(i.serverSyncTree_,s,a,!0);let r;return r=s._queryParams.loadsAllData()?Dd(i.serverSyncTree_,s._path,n):(t=Vd(i.serverSyncTree_,s),Pd(i.serverSyncTree_,s._path,n,t)),Np(i.eventQueue_,s._path,r),xd(i.serverSyncTree_,s,a,null,!0),n},e=>(Kp(i,"get for query "+O(s)+" failed: "+e),Promise.reject(new Error(e))))).then(e=>new gf(e,new ff(t._repo,t._path),t._queryParams.getIndex()))}class If{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){var n=t._queryParams.getIndex();return new af("value",this,new gf(e.snapshotNode,new ff(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new of(this,e,t):null}matches(e){return e instanceof If&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class Tf{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new of(this,e,t):null}createEvent(e,t){f(null!=e.childName,"Child events should have a childName.");var n=yf(new ff(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new af(e.type,this,new gf(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Tf&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function Ef(n,e,t,r,i){let s;if("object"==typeof r&&(s=void 0,i=r),"function"==typeof r&&(s=r),i&&i.onlyOnce){const c=t;var a=(e,t)=>{zp(n._repo,n,o),c(e,t)};a.userCallback=t.userCallback,a.context=t.context,t=a}a=new cf(t,s||void 0);const o="value"===e?new If(a):new Tf(e,a);return function(e,t,n){let r;r=".info"===Yl(t._path)?Od(e.infoSyncTree_,t,n):Od(e.serverSyncTree_,t,n),Cp(e.eventQueue_,t._path,r)}(n._repo,n,o),()=>zp(n._repo,n,o)}function kf(e,t,n,r){return Ef(e,"value",t,n,r)}function Sf(e,t,n,r){return Ef(e,"child_added",t,n,r)}function Cf(e,t,n,r){return Ef(e,"child_changed",t,n,r)}function Nf(e,t,n,r){return Ef(e,"child_moved",t,n,r)}function Af(e,t,n,r){return Ef(e,"child_removed",t,n,r)}function Rf(e,t,n){let r=null;var i=n?new cf(n):null;"value"===t?r=new If(i):t&&(r=new Tf(t,i)),zp(e._repo,e,r)}class Df{}class xf extends Df{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){lp("endAt",this._value,e._path,!0);var t=eh(e._queryParams,this._value,this._key);if(pf(t),df(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new uf(e._repo,e._path,t,e._orderByCalled)}}class Pf extends Df{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){lp("endBefore",this._value,e._path,!1);var t=function(e,t,n){let r;return r=e.index_===vu||n?eh(e,t,n):eh(e,t,gl),r.endBeforeSet_=!0,r}(e._queryParams,this._value,this._key);if(pf(t),df(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new uf(e._repo,e._path,t,e._orderByCalled)}}class Of extends Df{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){lp("startAt",this._value,e._path,!0);var t=Zu(e._queryParams,this._value,this._key);if(pf(t),df(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new uf(e._repo,e._path,t,e._orderByCalled)}}class Mf extends Df{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){lp("startAfter",this._value,e._path,!1);var t=function(e,t,n){let r;return r=e.index_===vu||n?Zu(e,t,n):Zu(e,t,ml),r.startAfterSet_=!0,r}(e._queryParams,this._value,this._key);if(pf(t),df(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new uf(e._repo,e._path,t,e._orderByCalled)}}class Lf extends Df{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new uf(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}(e._queryParams,this._limit),e._orderByCalled)}}class Ff extends Df{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new uf(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}(e._queryParams,this._limit),e._orderByCalled)}}class Uf extends Df{constructor(e){super(),this._path=e}_apply(e){hf(e,"orderByChild");var t=new Hl(this._path);if(ru(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");t=new zu(t),t=th(e._queryParams,t);return df(t),new uf(e._repo,e._path,t,!0)}}class qf extends Df{_apply(e){hf(e,"orderByKey");var t=th(e._queryParams,vu);return df(t),new uf(e._repo,e._path,t,!0)}}class Vf extends Df{_apply(e){hf(e,"orderByPriority");var t=th(e._queryParams,Ru);return df(t),new uf(e._repo,e._path,t,!0)}}class Bf extends Df{_apply(e){hf(e,"orderByValue");var t=th(e._queryParams,$u);return df(t),new uf(e._repo,e._path,t,!0)}}class jf extends Df{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(lp("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new xf(this._value,this._key)._apply(new Of(this._value,this._key)._apply(e))}}function zf(e,...t){let n=ae(e);for(const r of t)n=r._apply(n);return n}Kc=ff,f(!pd,"__referenceConstructor has already been defined"),pd=Kc,Wc=ff,f(!kd,"__referenceConstructor has already been defined"),kd=Wc;const $f="FIREBASE_DATABASE_EMULATOR_HOST",Kf={};let Wf=!1;function Gf(e,t,n,r,i){let s=r||e.options.databaseURL;void 0===s&&(e.options.projectId||hl("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),ul("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let a=tf(s,i),o=a.repoInfo,c,l=void 0;"undefined"!=typeof process&&process.env&&(l=process.env[$f]),l?(c=!0,s=`http://${l}?ns=${o.namespace}`,a=tf(s,i),o=a.repoInfo):c=!a.repoInfo.secure;var u=i&&c?new Nl(Nl.OWNER):new Cl(e.name,e.options,t);Ep("Invalid Firebase Database URL",a),ru(a.path)||hl("Database URL must point to the root of a Firebase Database (not including a child path).");u=function(e,t,n,r){let i=Kf[t.name];i||(i={},Kf[t.name]=i);var s=i[e.toURLString()];s&&hl("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return s=new xp(e,Wf,n,r),i[e.toURLString()]=s}(o,e,u,new Sl(e.name,n));return new Hf(u,e)}class Hf{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Pp(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ff(this._repo,Ql())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=Kf[t];n&&n[e.key]===e||hl(`Database ${t}(${e.repoInfo_}) has already been deleted.`),$p(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&hl("Cannot call "+e+" on a deleted database.")}}function Qf(){zl.IS_TRANSPORT_INITIALIZED&&dl("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Yf(){Qf(),ql.forceDisallow()}function Jf(){Qf(),jl.forceDisallow(),ql.forceAllow()}function Xf(e,t,n,r={}){(e=ae(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&hl("Cannot call useEmulator() after instance has already been initialized.");var i,s=e._repoInternal;let a=void 0;s.repoInfo_.nodeAdmin?(r.mockUserToken&&hl('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),a=new Nl(Nl.OWNER)):r.mockUserToken&&(i="string"==typeof r.mockUserToken?r.mockUserToken:_(r.mockUserToken,e.app.options.projectId),a=new Nl(i)),r=s,e=t,t=n,n=a,r.repoInfo_=new xl(`${e}:${t}`,!1,r.repoInfo_.namespace,r.repoInfo_.webSocketOnly,r.repoInfo_.nodeAdmin,r.repoInfo_.persistenceKey,r.repoInfo_.includeNamespaceInQueryParams,!0),n&&(r.authTokenProvider_=n)}function Zf(e){(e=ae(e))._checkNotDeleted("goOnline"),(e=e._repo).persistentConnection_&&e.persistentConnection_.resume(Rp)}function eg(e,t){ll(e,t)}const tg={".sv":"timestamp"};class ng{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function rg(i,e,t){if(i=ae(i),fp("Reference.transaction",i._path),".length"===i.key||".keys"===i.key)throw"Reference.transaction failed: "+i.key+" is a read-only object.";var n=null===(r=null==t?void 0:t.applyLocally)||void 0===r||r;const s=new y;var r=kf(i,()=>{});return function(t,n,e,r,i,s){Kp(t,"transaction on "+n);const a={path:n,update:e,onComplete:r,status:null,order:Zc(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},o=Gp(t,n,void 0);a.currentInputSnapshot=o;var c=a.update(o.val());if(void 0===c)a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete&&a.onComplete(null,!1,a.currentInputSnapshot);else{Ip("transaction failed: Data returned ",c,a.path),a.status=0;var l=np(t.transactionQueueTree_,n);const u=rp(l)||[];u.push(a),ip(l,u);let e;if("object"==typeof c&&null!==c&&L(c,".priority"))e=F(c,".priority"),f(bp(e),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else{const h=Md(t.serverSyncTree_,n)||Uu.EMPTY_NODE;e=h.getPriority().val()}l=Mp(t),c=ju(c,e),l=Zd(c,o,l);a.currentOutputSnapshotRaw=c,a.currentOutputSnapshotResolved=l,a.currentWriteId=qp(t);l=Nd(t.serverSyncTree_,n,l,a.currentWriteId,a.applyLocally);Np(t.eventQueue_,n,l),Hp(t,t.transactionQueueTree_)}}(i._repo,i._path,e,(e,t,n)=>{var r;e?s.reject(e):(r=new gf(n,new ff(i._repo,i._path),Ru),s.resolve(new ng(t,r)))},r,n),s.promise}du.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},du.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},qc(Ye),We(new oe("database",(e,{instanceIdentifier:t})=>{return Gf(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)},"PUBLIC").setMultipleInstances(!0)),et(Fc,"0.14.4",Gc),et(Fc,"0.14.4","esm2017");function ig(e){var t="FIREBASE WARNING: "+e;sg.warn(t)}const sg=new me("@firebase/database-compat");class ag{constructor(e){this._delegate=e}cancel(t){Q("OnDisconnect.cancel",0,1,arguments.length),J("OnDisconnect.cancel","onComplete",t,!0);const e=this._delegate.cancel();return t&&e.then(()=>t(null),e=>t(e)),e}remove(t){Q("OnDisconnect.remove",0,1,arguments.length),J("OnDisconnect.remove","onComplete",t,!0);const e=this._delegate.remove();return t&&e.then(()=>t(null),e=>t(e)),e}set(e,t){Q("OnDisconnect.set",1,2,arguments.length),J("OnDisconnect.set","onComplete",t,!0);const n=this._delegate.set(e);return t&&n.then(()=>t(null),e=>t(e)),n}setWithPriority(e,t,n){Q("OnDisconnect.setWithPriority",2,3,arguments.length),J("OnDisconnect.setWithPriority","onComplete",n,!0);const r=this._delegate.setWithPriority(e,t);return n&&r.then(()=>n(null),e=>n(e)),r}update(t,n){if(Q("OnDisconnect.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,ig("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}J("OnDisconnect.update","onComplete",n,!0);const e=this._delegate.update(t);return n&&e.then(()=>n(null),e=>n(e)),e}}class og{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return Q("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class cg{constructor(e,t){this._database=e,this._delegate=t}val(){return Q("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return Q("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return Q("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return Q("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return Q("DataSnapshot.child",0,1,arguments.length),e=String(e),Tp("DataSnapshot.child","path",e,!1),new cg(this._database,this._delegate.child(e))}hasChild(e){return Q("DataSnapshot.hasChild",1,1,arguments.length),Tp("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return Q("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(t){return Q("DataSnapshot.forEach",1,1,arguments.length),J("DataSnapshot.forEach","action",t,!1),this._delegate.forEach(e=>t(new cg(this._database,e)))}hasChildren(){return Q("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return Q("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return Q("DataSnapshot.ref",0,0,arguments.length),new ug(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class lg{constructor(e,t){this.database=e,this._delegate=t}on(e,n,t,r){var i;Q("Query.on",2,4,arguments.length),J("Query.on","callback",n,!1);const s=lg.getCancelAndContextArgs_("Query.on",t,r);var a=(e,t)=>{n.call(s.context,new cg(this.database,e),t)};a.userCallback=n,a.context=s.context;var o=null===(i=s.cancel)||void 0===i?void 0:i.bind(s.context);switch(e){case"value":return kf(this._delegate,a,o),n;case"child_added":return Sf(this._delegate,a,o),n;case"child_removed":return Af(this._delegate,a,o),n;case"child_changed":return Cf(this._delegate,a,o),n;case"child_moved":return Nf(this._delegate,a,o),n;default:throw new Error(Y("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){var r;Q("Query.off",0,3,arguments.length),function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Y(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}("Query.off",e,!0),J("Query.off","callback",t,!0),X("Query.off","context",n,!0),t?((r=()=>{}).userCallback=t,r.context=n,Rf(this._delegate,e,r)):Rf(this._delegate,e)}get(){return bf(this._delegate).then(e=>new cg(this.database,e))}once(e,r,t,n){Q("Query.once",1,4,arguments.length),J("Query.once","callback",r,!0);const i=lg.getCancelAndContextArgs_("Query.once",t,n),s=new y;var a=(e,t)=>{var n=new cg(this.database,e);r&&r.call(i.context,n,t),s.resolve(n)};a.userCallback=r,a.context=i.context;var o=e=>{i.cancel&&i.cancel.call(i.context,e),s.reject(e)};switch(e){case"value":kf(this._delegate,a,o,{onlyOnce:!0});break;case"child_added":Sf(this._delegate,a,o,{onlyOnce:!0});break;case"child_removed":Af(this._delegate,a,o,{onlyOnce:!0});break;case"child_changed":Cf(this._delegate,a,o,{onlyOnce:!0});break;case"child_moved":Nf(this._delegate,a,o,{onlyOnce:!0});break;default:throw new Error(Y("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return s.promise}limitToFirst(e){return Q("Query.limitToFirst",1,1,arguments.length),new lg(this.database,zf(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Lf(e)}(e)))}limitToLast(e){return Q("Query.limitToLast",1,1,arguments.length),new lg(this.database,zf(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Ff(e)}(e)))}orderByChild(e){return Q("Query.orderByChild",1,1,arguments.length),new lg(this.database,zf(this._delegate,function(e){if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Tp("orderByChild","path",e,!1),new Uf(e)}(e)))}orderByKey(){return Q("Query.orderByKey",0,0,arguments.length),new lg(this.database,zf(this._delegate,new qf))}orderByPriority(){return Q("Query.orderByPriority",0,0,arguments.length),new lg(this.database,zf(this._delegate,new Vf))}orderByValue(){return Q("Query.orderByValue",0,0,arguments.length),new lg(this.database,zf(this._delegate,new Bf))}startAt(e=null,t){return Q("Query.startAt",0,2,arguments.length),new lg(this.database,zf(this._delegate,([e=null,t]=[e,t],dp("startAt","key",t,!0),new Of(e,t))))}startAfter(e=null,t){return Q("Query.startAfter",0,2,arguments.length),new lg(this.database,zf(this._delegate,(e=e,t=t,dp("startAfter","key",t,!0),new Mf(e,t))))}endAt(e=null,t){return Q("Query.endAt",0,2,arguments.length),new lg(this.database,zf(this._delegate,(e=e,t=t,dp("endAt","key",t,!0),new xf(e,t))))}endBefore(e=null,t){return Q("Query.endBefore",0,2,arguments.length),new lg(this.database,zf(this._delegate,(e=e,t=t,dp("endBefore","key",t,!0),new Pf(e,t))))}equalTo(e,t){return Q("Query.equalTo",1,2,arguments.length),new lg(this.database,zf(this._delegate,(e=e,t=t,dp("equalTo","key",t,!0),new jf(e,t))))}toString(){return Q("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return Q("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(Q("Query.isEqual",1,1,arguments.length),e instanceof lg)return this._delegate.isEqual(e._delegate);throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}static getCancelAndContextArgs_(e,t,n){const r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,J(e,"cancel",r.cancel,!0),r.context=n,X(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(Y(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r}get ref(){return new ug(this.database,new ff(this._delegate._repo,this._delegate._path))}}class ug extends lg{constructor(e,t){super(e,new uf(t._repo,t._path,new Xu,!1)),this.database=e,this._delegate=t}getKey(){return Q("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return Q("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new ug(this.database,yf(this._delegate,e))}getParent(){Q("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new ug(this.database,e):null}getRoot(){return Q("Reference.root",0,0,arguments.length),new ug(this.database,this._delegate.root)}set(e,t){Q("Reference.set",1,2,arguments.length),J("Reference.set","onComplete",t,!0);const n=_f(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}update(t,n){if(Q("Reference.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,ig("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}fp("Reference.update",this._delegate._path),J("Reference.update","onComplete",n,!0);const e=wf(this._delegate,t);return n&&e.then(()=>n(null),e=>n(e)),e}setWithPriority(e,t,n){Q("Reference.setWithPriority",2,3,arguments.length),J("Reference.setWithPriority","onComplete",n,!0);const r=function(e,t,n){if(fp("setWithPriority",e._path),lp("setWithPriority",t,e._path,!1),hp("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";const r=new y;return Vp(e._repo,e._path,t,n,r.wrapCallback(()=>{})),r.promise}(this._delegate,e,t);return n&&r.then(()=>n(null),e=>n(e)),r}remove(t){Q("Reference.remove",0,1,arguments.length),J("Reference.remove","onComplete",t,!0);const e=(n=this._delegate,fp("remove",n._path),_f(n,null));var n;return t&&e.then(()=>t(null),e=>t(e)),e}transaction(e,t,n){Q("Reference.transaction",1,3,arguments.length),J("Reference.transaction","transactionUpdate",e,!1),J("Reference.transaction","onComplete",t,!0),function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Y(e,t)+"must be a boolean.")}("Reference.transaction","applyLocally",n,!0);const r=rg(this._delegate,e,{applyLocally:n}).then(e=>new og(e.committed,new cg(this.database,e.snapshot)));return t&&r.then(e=>t(null,e.committed,e.snapshot),e=>t(e,!1,null)),r}setPriority(e,t){Q("Reference.setPriority",1,2,arguments.length),J("Reference.setPriority","onComplete",t,!0);const n=function(e,t){e=ae(e),fp("setPriority",e._path),hp("setPriority",t,!1);const n=new y;return Vp(e._repo,nu(e._path,".priority"),t,null,n.wrapCallback(()=>{})),n.promise}(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}push(e,t){Q("Reference.push",0,2,arguments.length),J("Reference.push","onComplete",t,!0);const n=function(e,t){e=ae(e),fp("push",e._path),lp("push",t,e._path,!0);var n=Op(e._repo),n=sf(n);const r=yf(e,n),i=yf(e,n);let s;return s=null!=t?_f(i,t).then(()=>i):Promise.resolve(i),r.then=s.then.bind(s),r.catch=s.then.bind(s,void 0),r}(this._delegate,e),r=n.then(e=>new ug(this.database,e));t&&r.then(()=>t(null),e=>t(e));const i=new ug(this.database,n);return i.then=r.then.bind(r),i.catch=r.catch.bind(r,void 0),i}onDisconnect(){return fp("Reference.onDisconnect",this._delegate._path),new ag(new lf(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class hg{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:Yf,forceLongPolling:Jf}}useEmulator(e,t,n={}){Xf(this._delegate,e,t,n)}ref(e){if(Q("database.ref",0,1,arguments.length),e instanceof ug){var t=vf(this._delegate,e.toString());return new ug(this,t)}t=mf(this._delegate,e);return new ug(this,t)}refFromURL(e){Q("database.refFromURL",1,1,arguments.length);var t=vf(this._delegate,e);return new ug(this,t)}goOffline(){var e;Q("database.goOffline",0,0,arguments.length),(e=ae(e=this._delegate))._checkNotDeleted("goOffline"),$p(e._repo)}goOnline(){return Q("database.goOnline",0,0,arguments.length),Zf(this._delegate)}}hg.ServerValue={TIMESTAMP:tg,increment:e=>({".sv":{increment:e}})};var dg,pg=Object.freeze({__proto__:null,initStandalone:function({app:e,url:t,version:n,customAuthImpl:r,namespace:i,nodeAdmin:s=!1}){qc(n);const a=new le("auth-internal",new ue("database-standalone"));return a.setComponent(new oe("auth-internal",()=>r,"PRIVATE")),{instance:new hg(Gf(e,a,void 0,t,s),e),namespace:i}}});const fg=hg.ServerValue;(dg=wt).INTERNAL.registerComponent(new oe("database-compat",(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("database").getImmediate({identifier:t});return new hg(r,n)},"PUBLIC").setServiceProps({Reference:ug,Query:lg,Database:hg,DataSnapshot:cg,enableLogging:eg,INTERNAL:pg,ServerValue:fg}).setMultipleInstances(!0)),dg.registerVersion("@firebase/database-compat","0.3.4");var yt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},gg={},mg=yt||self;function vg(){}function yg(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function _g(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var wg="closure_uid_"+(1e9*Math.random()>>>0),bg=0;function Ig(e,t,n){return e.call.apply(e.bind,arguments)}function Tg(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}}function Eg(e,t,n){return(Eg=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ig:Tg).apply(null,arguments)}function kg(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Sg(e,s){function t(){}t.prototype=s.prototype,e.X=s.prototype,e.prototype=new t,(e.prototype.constructor=e).Wb=function(e,t,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return s.prototype[t].apply(e,r)}}function Cg(){this.s=this.s,this.o=this.o}Cg.prototype.s=!1,Cg.prototype.na=function(){var e;!this.s&&(this.s=!0,this.M(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,wg)&&e[wg]||(e[wg]=++bg))},Cg.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Ng=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function Ag(t){var n=t.length;if(0<n){const r=Array(n);for(let e=0;e<n;e++)r[e]=t[e];return r}return[]}function Rg(t){for(let e=1;e<arguments.length;e++){var n=arguments[e];if(yg(n)){var r=t.length||0,i=n.length||0;t.length=r+i;for(let e=0;e<i;e++)t[r+e]=n[e]}else t.push(n)}}function Dg(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}Dg.prototype.h=function(){this.defaultPrevented=!0};var xg=function(){if(!mg.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{mg.addEventListener("test",vg,t),mg.removeEventListener("test",vg,t)}catch(e){}return e}();function Pg(e){return/^[\s\xa0]*$/.test(e)}var Og=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function Mg(e,t){return e<t?-1:t<e?1:0}function Lg(){var e=mg.navigator;return(e=e&&e.userAgent)?e:""}function Fg(e){return-1!=Lg().indexOf(e)}function Ug(e){return Ug[" "](e),e}Ug[" "]=vg;var qg,Vg=Fg("Opera"),Bg=Fg("Trident")||Fg("MSIE"),jg=Fg("Edge"),zg=jg||Bg,$g=Fg("Gecko")&&!(-1!=Lg().toLowerCase().indexOf("webkit")&&!Fg("Edge"))&&!(Fg("Trident")||Fg("MSIE"))&&!Fg("Edge"),Kg=-1!=Lg().toLowerCase().indexOf("webkit")&&!Fg("Edge");function Wg(){var e=mg.document;return e?e.documentMode:void 0}e:{var Gg="",Hg=(Hg=Lg(),$g?/rv:([^\);]+)(\)|;)/.exec(Hg):jg?/Edge\/([\d\.]+)/.exec(Hg):Bg?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Hg):Kg?/WebKit\/(\S+)/.exec(Hg):Vg?/(?:Version)[ \/]?(\S+)/.exec(Hg):void 0);if(Hg&&(Gg=Hg?Hg[1]:""),Bg){Hg=Wg();if(null!=Hg&&Hg>parseFloat(Gg)){qg=String(Hg);break e}}qg=Gg}var Qg={};function Yg(){return e=function(){let e=0;var t=Og(String(qg)).split("."),n=Og("9").split("."),r=Math.max(t.length,n.length);for(let a=0;0==e&&a<r;a++)for(var i=t[a]||"",s=n[a]||"";i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],(0!=i[0].length||0!=s[0].length)&&(e=Mg(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||Mg(0==i[2].length,0==s[2].length)||Mg(i[2],s[2]),i=i[3],s=s[3],0==e););return 0<=e},t=Qg,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9);var e,t}var Jg=mg.document&&Bg&&(Wg()||parseInt(qg,10))||void 0;function Xg(e,t){if(Dg.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if($g){e:{try{Ug(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:Zg[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&Xg.X.h.call(this)}}Sg(Xg,Dg);var Zg={2:"touch",3:"pen",4:"mouse"};Xg.prototype.h=function(){Xg.X.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var em="closure_listenable_"+(1e6*Math.random()|0),tm=0;function nm(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++tm,this.ba=this.ea=!1}function rm(e){e.ba=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function im(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function sm(e){const t={};for(const n in e)t[n]=e[n];return t}const am="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function om(t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(let e=0;e<am.length;e++)n=am[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function cm(e){this.src=e,this.g={},this.h=0}function lm(e,t){var n,r,i,s=t.type;s in e.g&&(n=e.g[s],(i=0<=(r=Ng(n,t)))&&Array.prototype.splice.call(n,r,1),i&&(rm(t),0==e.g[s].length&&(delete e.g[s],e.h--)))}function um(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ba&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}cm.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=um(e,t,r,i);return-1<a?(t=e[a],n||(t.ea=!1)):((t=new nm(t,this.src,s,!!r,i)).ea=n,e.push(t)),t};var hm="closure_lm_"+(1e6*Math.random()|0),dm={};function pm(e,t,n,r,i){if(r&&r.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}r=wm(r);return t&&t[em]?t.O(n,r,_g(i)?!!i.capture:!!i,s):fm(t,n,r,!0,i,s)}(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)pm(e,t[s],n,r,i);return null}return n=wm(n),e&&e[em]?e.N(t,n,_g(r)?!!r.capture:!!r,i):fm(e,t,n,!1,r,i)}function fm(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=_g(i)?!!i.capture:!!i,o=ym(e);if(o||(e[hm]=o=new cm(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function(){const n=vm;return function e(t){return n.call(e.src,e.listener,t)}}(),(n.proxy=r).src=e,r.listener=n,e.addEventListener)void 0===(i=!xg?a:i)&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(mm(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function gm(e){var t,n,r;"number"!=typeof e&&e&&!e.ba&&((t=e.src)&&t[em]?lm(t.i,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(mm(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=ym(t))?(lm(n,e),0==n.h&&(n.src=null,t[hm]=null)):rm(e)))}function mm(e){return e in dm?dm[e]:dm[e]="on"+e}function vm(e,t){var n,r;return e=!!e.ba||(t=new Xg(t,this),n=e.listener,r=e.ha||e.src,e.ea&&gm(e),n.call(r,t))}function ym(e){return(e=e[hm])instanceof cm?e:null}var _m="__closure_events_fn_"+(1e9*Math.random()>>>0);function wm(t){return"function"==typeof t?t:(t[_m]||(t[_m]=function(e){return t.handleEvent(e)}),t[_m])}function bm(){Cg.call(this),this.i=new cm(this),(this.P=this).I=null}function Im(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t?t=new Dg(t,e):t instanceof Dg?t.target=t.target||e:(a=t,om(t=new Dg(r,e),a)),a=!0,n)for(var i=n.length-1;0<=i;i--)var s=t.g=n[i],a=Tm(s,r,!0,t)&&a;if(a=Tm(s=t.g=e,r,!0,t)&&a,a=Tm(s,r,!1,t)&&a,n)for(i=0;i<n.length;i++)a=Tm(s=t.g=n[i],r,!1,t)&&a}function Tm(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a,o,c=t[s];c&&!c.ba&&c.capture==n&&(a=c.listener,o=c.ha||c.src,c.ea&&lm(e.i,c),i=!1!==a.call(o,r)&&i)}return i&&!r.defaultPrevented}Sg(bm,Cg),bm.prototype[em]=!0,bm.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else i=_g(i)?!!i.capture:!!i,r=wm(r),t&&t[em]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=um(a=t.g[n],r,i,s))&&(rm(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):(t=t&&ym(t))&&(n=t.g[n.toString()],(r=(t=-1)<(t=n?um(n,r,i,s):t)?n[t]:null)&&gm(r))}(this,e,t,n,r)},bm.prototype.M=function(){if(bm.X.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)rm(n[r]);delete t.g[e],t.h--}}this.I=null},bm.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},bm.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Em=mg.JSON.stringify;var km,Sm=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Cm,e=>e.reset());class Cm{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Nm(e,t){var n;km||(n=mg.Promise.resolve(void 0),km=function(){n.then(Dm)}),Am||(km(),Am=!0),Rm.add(e,t)}var Am=!1,Rm=new class{constructor(){this.h=this.g=null}add(e,t){const n=Sm.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function Dm(){for(var e;e=function(){var e=Rm;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}();){try{e.h.call(e.g)}catch(e){!function(e){mg.setTimeout(()=>{throw e},0)}(e)}var t=Sm;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}Am=!1}function xm(e,t){bm.call(this),this.h=e||1,this.g=t||mg,this.j=Eg(this.lb,this),this.l=Date.now()}function Pm(e){e.ca=!1,e.R&&(e.g.clearTimeout(e.R),e.R=null)}function Om(e,t,n){if("function"==typeof e)n&&(e=Eg(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Eg(e.handleEvent,e)}return 2147483647<Number(t)?-1:mg.setTimeout(e,t||0)}Sg(xm,bm),(bt=xm.prototype).ca=!1,bt.R=null,bt.lb=function(){var e;this.ca&&(0<(e=Date.now()-this.l)&&e<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-e):(this.R&&(this.g.clearTimeout(this.R),this.R=null),Im(this,"tick"),this.ca&&(Pm(this),this.start())))},bt.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},bt.M=function(){xm.X.M.call(this),Pm(this),delete this.g};class Mm extends Cg{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=Om(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);var n=t.h;t.h=null,t.m.apply(null,n)}(this)}M(){super.M(),this.g&&(mg.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Lm(e){Cg.call(this),this.h=e,this.g={}}Sg(Lm,Cg);var Fm=[];function Um(e,t,n,r){Array.isArray(n)||(n&&(Fm[0]=n.toString()),n=Fm);for(var i=0;i<n.length;i++){var s=pm(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function qm(e){im(e.g,function(e,t){this.g.hasOwnProperty(t)&&gm(e)},e),e.g={}}function Vm(){this.g=!0}function Bm(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}return Em(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}Lm.prototype.M=function(){Lm.X.M.call(this),qm(this)},Lm.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Vm.prototype.Aa=function(){this.g=!1},Vm.prototype.info=function(){};var jm={},zm=null;function $m(){return zm=zm||new bm}function Km(e){Dg.call(this,jm.Pa,e)}function Wm(){var e=$m();Im(e,new Km(e))}function Gm(e,t){Dg.call(this,jm.STAT_EVENT,e),this.stat=t}function Hm(e){var t=$m();Im(t,new Gm(t,e))}function Qm(e,t){Dg.call(this,jm.Qa,e),this.size=t}function Ym(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return mg.setTimeout(function(){e()},t)}jm.Pa="serverreachability",Sg(Km,Dg),jm.STAT_EVENT="statevent",Sg(Gm,Dg),jm.Qa="timingevent",Sg(Qm,Dg);It={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},Hc={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function Jm(){}function Xm(e){return e.h||(e.h=e.i())}function Zm(){}Jm.prototype.h=null;yt={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function ev(){Dg.call(this,"d")}function tv(){Dg.call(this,"c")}function nv(){}function rv(e,t,n,r){this.l=e,this.j=t,this.m=n,this.U=r||1,this.S=new Lm(this),this.O=av,this.T=new xm(e=zg?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new iv}function iv(){this.i=null,this.g="",this.h=!1}Sg(ev,Dg),Sg(tv,Dg),Sg(nv,Jm),nv.prototype.g=function(){return new XMLHttpRequest},nv.prototype.i=function(){return{}};var sv=new nv,av=45e3,ov={},cv={};function lv(e,t,n){e.K=1,e.v=Cv(Iv(t)),e.s=n,e.P=!0,uv(e,null)}function uv(e,t){e.F=Date.now(),pv(e),e.A=Iv(e.v);var a,o,c,l,u,h,n=e.A,r=e.U;Array.isArray(r)||(r=[String(r)]),Vv(n.i,"t",r),e.C=0,n=e.l.H,e.h=new iv,e.g=qy(e.l,n?t:null,!e.s),0<e.N&&(e.L=new Mm(Eg(e.La,e,e.g),e.N)),Um(e.S,e.g,"readystatechange",e.ib),t=e.H?sm(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.da(e.A,e.u,e.s,t)):(e.u="GET",e.g.da(e.A,e.u,null,t)),Wm(),a=e.j,o=e.u,c=e.A,l=e.m,u=e.U,h=e.s,a.info(function(){if(a.g)if(h)for(var e="",t=h.split("&"),n=0;n<t.length;n++){var r,i,s=t[n].split("=");1<s.length&&(r=s[0],s=s[1],e=2<=(i=r.split("_")).length&&"type"==i[1]?e+(r+"=")+s+"&":e+(r+"=redacted&"))}else e=null;else e=h;return"XMLHTTP REQ ("+l+") [attempt "+u+"]: "+o+"\n"+c+"\n"+e})}function hv(e){return e.g&&("GET"==e.u&&2!=e.K&&e.l.Da)}function dv(e,t,n){let r=!0,i;for(;!e.I&&e.C<n.length;){if(i=(a=n,c=o=void 0,o=(s=e).C,-1==(c=a.indexOf("\n",o))?cv:(o=Number(a.substring(o,c)),isNaN(o)?ov:(c+=1)+o>a.length?cv:(a=a.substr(c,o),s.C=c+o,a))),i==cv){4==t&&(e.o=4,Hm(14),r=!1),Bm(e.j,e.m,null,"[Incomplete Response]");break}if(i==ov){e.o=4,Hm(15),Bm(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}Bm(e.j,e.m,i,null),yv(e,i)}var s,a,o,c;hv(e)&&i!=cv&&i!=ov&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,Hm(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.$&&(e.$=!0,(t=e.l).g==e&&t.$&&!t.K&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Dy(t),t.K=!0,Hm(11))):(Bm(e.j,e.m,n,"[Invalid Chunked Response]"),vv(e),mv(e))}function pv(e){e.V=Date.now()+e.O,fv(e,e.O)}function fv(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Ym(Eg(e.gb,e),t)}function gv(e){e.B&&(mg.clearTimeout(e.B),e.B=null)}function mv(e){0==e.l.G||e.I||Oy(e.l,e)}function vv(e){gv(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Pm(e.T),qm(e.S),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function yv(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||Gv(n.h,e)))if(!e.J&&Gv(n.h,e)&&3==n.G){try{var r=n.Fa.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;Py(n),Ty(n)}Ry(n),Hm(18)}}else n.Ba=i[1],0<n.Ba-n.T&&i[2]<37500&&n.L&&0==n.A&&!n.v&&(n.v=Ym(Eg(n.cb,n),6e3));if(Wv(n.h)<=1&&n.ja){try{n.ja()}catch(e){}n.ja=void 0}}else Ly(n,11)}else if(!e.J&&n.g!=e||Py(n),!Pg(t))for(i=n.Fa.g.parse(t),t=0;t<i.length;t++){var s=i[t];if(n.T=s[0],s=s[1],2==n.G)if("c"==s[0]){n.I=s[1],n.ka=s[2];var a=s[3];null!=a&&(n.ma=a,n.j.info("VER="+n.ma));var o=s[4];null!=o&&(n.Ca=o,n.j.info("SVER="+n.Ca));var c,l,u=s[5];null!=u&&"number"==typeof u&&0<u&&(r=1.5*u,n.J=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const f=e.g;if(f){const g=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;g&&((c=r.h).g||-1==g.indexOf("spdy")&&-1==g.indexOf("quic")&&-1==g.indexOf("h2")||(c.j=c.l,c.g=new Set,c.h&&(Hv(c,c.h),c.h=null))),!r.D||(l=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.za=l,Sv(r.F,r.D,l))}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-e.F,n.j.info("Handshake RTT: "+n.P+"ms"));var h,d,p=e;(r=n).sa=Uy(r,r.H?r.ka:null,r.V),p.J?(Qv(r.h,p),h=p,(d=r.J)&&h.setTimeout(d),h.B&&(gv(h),pv(h)),r.g=p):Ay(r),0<n.i.length&&ky(n)}else"stop"!=s[0]&&"close"!=s[0]||Ly(n,7);else 3==n.G&&("stop"==s[0]||"close"==s[0]?"stop"==s[0]?Ly(n,7):Iy(n):"noop"!=s[0]&&n.l&&n.l.wa(s),n.A=0)}Wm()}catch(e){}}function _v(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(yg(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.oa&&"function"==typeof e.oa)return e.oa();if(!e.W||"function"!=typeof e.W){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(yg(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.W&&"function"==typeof e.W)return e.W();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(yg(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(bt=rv.prototype).setTimeout=function(e){this.O=e},bt.ib=function(e){e=e.target;const t=this.L;t&&3==my(e)?t.l():this.La(e)},bt.La=function(e){try{if(e==this.g)e:{var t=my(this.g),n=this.g.Ea();this.g.aa();if(!(t<3)&&(3!=t||zg||this.g&&(this.h.h||this.g.fa()||vy(this.g)))){this.I||4!=t||7==n||Wm(),gv(this);var r=this.g.aa();this.Y=r;t:if(hv(this)){var i=vy(this.g);e="";var s=i.length,a=4==my(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){vv(this),mv(this);var o="";break t}this.h.i=new mg.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,e+=this.h.i.decode(i[n],{stream:a&&n==s-1});i.splice(0,s),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==r,h=this.j,d=this.u,p=this.A,f=this.m,g=this.U,m=t,v=r,h.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+g+"]: "+d+"\n"+p+"\n"+m+" "+v}),this.i){if(this.Z&&!this.J){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Pg(c)){var u=c;break t}}u=null}if(!(r=u)){this.i=!1,this.o=3,Hm(12),vv(this),mv(this);break e}Bm(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,yv(this,r)}this.P?(dv(this,t,o),zg&&this.i&&3==t&&(Um(this.S,this.T,"tick",this.hb),this.T.start())):(Bm(this.j,this.m,o,null),yv(this,o)),4==t&&vv(this),this.i&&!this.I&&(4==t?Oy(this.l,this):(this.i=!1,pv(this)))}else 400==r&&0<o.indexOf("Unknown SID")?(this.o=3,Hm(12)):(this.o=0,Hm(13)),vv(this),mv(this)}}}catch(e){}var h,d,p,f,g,m,v},bt.hb=function(){var e,t;this.g&&(e=my(this.g),t=this.g.fa(),this.C<t.length&&(gv(this),dv(this,e,t),this.i&&4!=e&&pv(this)))},bt.cancel=function(){this.I=!0,vv(this)},bt.gb=function(){this.B=null;var e,t,n=Date.now();0<=n-this.V?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.K&&(Wm(),Hm(17)),vv(this),this.o=2,mv(this)):fv(this,this.V-n)};var wv=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function bv(e,t){var n;this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof bv?(this.h=void 0!==t?t:e.h,Tv(this,e.j),this.s=e.s,this.g=e.g,Ev(this,e.m),this.l=e.l,t=e.i,(n=new Lv).i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),kv(this,n),this.o=e.o):e&&(n=String(e).match(wv))?(this.h=!!t,Tv(this,n[1]||"",!0),this.s=Nv(n[2]||""),this.g=Nv(n[3]||"",!0),Ev(this,n[4]),this.l=Nv(n[5]||"",!0),kv(this,n[6]||"",!0),this.o=Nv(n[7]||"")):(this.h=!!t,this.i=new Lv(null,this.h))}function Iv(e){return new bv(e)}function Tv(e,t,n){e.j=n?Nv(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Ev(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.m=t}else e.m=null}function kv(e,t,n){var r,i;t instanceof Lv?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(Fv(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(Uv(this,t),Vv(this,n,e))},r)),r.j=i):(n||(t=Av(t,Ov)),e.i=new Lv(t,e.h))}function Sv(e,t,n){e.i.set(t,n)}function Cv(e){return Sv(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Nv(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Av(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Rv),e=n?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function Rv(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}bv.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Av(t,Dv,!0),":");var n=this.g;return!n&&"file"!=t||(e.push("//"),(t=this.s)&&e.push(Av(t,Dv,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Av(n,"/"==n.charAt(0)?Pv:xv,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Av(n,Mv)),e.join("")};var Dv=/[#\/\?@]/g,xv=/[#\?:]/g,Pv=/[#\?]/g,Ov=/[#\?@]/g,Mv=/#/g;function Lv(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Fv(n){n.g||(n.g=new Map,n.h=0,n.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r,i=e[n].indexOf("="),s=null;0<=i?(r=e[n].substring(0,i),s=e[n].substring(i+1)):r=e[n],t(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Uv(e,t){Fv(e),t=Bv(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function qv(e,t){return Fv(e),t=Bv(e,t),e.g.has(t)}function Vv(e,t,n){Uv(e,t),0<n.length&&(e.i=null,e.g.set(Bv(e,t),Ag(n)),e.h+=n.length)}function Bv(e,t){return t=String(t),t=e.j?t.toLowerCase():t}(bt=Lv.prototype).add=function(e,t){Fv(this),this.i=null,e=Bv(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},bt.forEach=function(n,r){Fv(this),this.g.forEach(function(e,t){e.forEach(function(e){n.call(r,e,t,this)},this)},this)},bt.oa=function(){Fv(this);const t=Array.from(this.g.values()),n=Array.from(this.g.keys()),r=[];for(let s=0;s<n.length;s++){var i=t[s];for(let e=0;e<i.length;e++)r.push(n[s])}return r},bt.W=function(t){Fv(this);let n=[];if("string"==typeof t)qv(this,t)&&(n=n.concat(this.g.get(Bv(this,t))));else{t=Array.from(this.g.values());for(let e=0;e<t.length;e++)n=n.concat(t[e])}return n},bt.set=function(e,t){return Fv(this),this.i=null,qv(this,e=Bv(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},bt.get=function(e,t){return e&&0<(e=this.W(e)).length?String(e[0]):t},bt.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++)for(var r=t[n],i=encodeURIComponent(String(r)),s=this.W(r),r=0;r<s.length;r++){var a=i;""!==s[r]&&(a+="="+encodeURIComponent(String(s[r]))),e.push(a)}return this.i=e.join("&")};var jv=class{constructor(e,t){this.h=e,this.g=t}};function zv(e){this.l=e||10,e=mg.PerformanceNavigationTiming?0<(e=mg.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(mg.g&&mg.g.Ga&&mg.g.Ga()&&mg.g.Ga().$b),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var $v;function Kv(e){return e.h||e.g&&e.g.size>=e.j}function Wv(e){return e.h?1:e.g?e.g.size:0}function Gv(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function Hv(e,t){e.g?e.g.add(t):e.h=t}function Qv(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Yv(t){if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return Ag(t.i);{let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}}function Jv(){}function Xv(){this.g=new Jv}function Zv(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function ey(e){this.l=e.ac||null,this.j=e.jb||!1}function ty(e,t){bm.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=ny,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}zv.prototype.cancel=function(){if(this.i=Yv(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},Jv.prototype.stringify=function(e){return mg.JSON.stringify(e,void 0)},Jv.prototype.parse=function(e){return mg.JSON.parse(e,void 0)},Sg(ey,Jm),ey.prototype.g=function(){return new ty(this.l,this.j)},ey.prototype.i=($v={},function(){return $v}),Sg(ty,bm);var ny=0;function ry(e){e.j.read().then(e.Ta.bind(e)).catch(e.ga.bind(e))}function iy(e){e.readyState=4,e.l=null,e.j=null,e.A=null,sy(e)}function sy(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(bt=ty.prototype).open=function(e,t){if(this.readyState!=ny)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,sy(this)},bt.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||mg).fetch(new Request(this.B,t)).then(this.Wa.bind(this),this.ga.bind(this))},bt.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,iy(this)),this.readyState=ny},bt.Wa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,sy(this)),this.g&&(this.readyState=3,sy(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==mg.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ry(this)}else e.text().then(this.Va.bind(this),this.ga.bind(this))},bt.Ta=function(e){var t;this.g&&(this.u&&e.value?this.response.push(e.value):this.u||(t=e.value||new Uint8Array(0),(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)),(e.done?iy:sy)(this),3==this.readyState&&ry(this))},bt.Va=function(e){this.g&&(this.response=this.responseText=e,iy(this))},bt.Ua=function(e){this.g&&(this.response=e,iy(this))},bt.ga=function(){this.g&&iy(this)},bt.setRequestHeader=function(e,t){this.v.append(e,t)},bt.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},bt.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(ty.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var ay=mg.JSON.parse;function oy(e){bm.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=cy,this.K=this.L=!1}Sg(oy,bm);var cy="",ly=/^https?$/i,uy=["POST","PUT"];function hy(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,dy(e),fy(e)}function dy(e){e.D||(e.D=!0,Im(e,"complete"),Im(e,"error"))}function py(e){if(e.h&&void 0!==gg&&(!e.C[1]||4!=my(e)||2!=e.aa()))if(e.v&&4==my(e))Om(e.Ha,0,e);else if(Im(e,"readystatechange"),4==my(e)){e.h=!1;try{var t,n,r,i,s=e.aa();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break e;default:a=!1}if((t=a)||((n=0===s)&&(!(i=String(e.H).match(wv)[1]||null)&&mg.self&&mg.self.location&&(i=(r=mg.self.location.protocol).substr(0,r.length-1)),n=!ly.test(i?i.toLowerCase():"")),t=n),t)Im(e,"complete"),Im(e,"success");else{e.m=6;try{var o=2<my(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.aa()+"]",dy(e)}}finally{fy(e)}}}function fy(e,t){if(e.g){gy(e);const n=e.g,r=e.C[0]?vg:null;e.g=null,e.C=null,t||Im(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function gy(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(mg.clearTimeout(e.A),e.A=null)}function my(e){return e.g?e.g.readyState:0}function vy(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case cy:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function yy(e){let n="";return im(e,function(e,t){n+=t,n+=":",n+=e,n+="\r\n"}),n}function _y(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=yy(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Sv(e,t,n))}function wy(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function by(e){this.Ca=0,this.i=[],this.j=new Vm,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=wy("failFast",!1,e),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=wy("baseRetryDelayMs",5e3,e),this.bb=wy("retryDelaySeedMs",1e4,e),this.$a=wy("forwardChannelMaxRetries",2,e),this.ta=wy("forwardChannelRequestTimeoutMs",2e4,e),this.ra=e&&e.xmlHttpFactory||void 0,this.Da=e&&e.Zb||!1,this.J=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.I="",this.h=new zv(e&&e.concurrentRequestLimit),this.Fa=new Xv,this.O=e&&e.fastHandshake||!1,this.N=e&&e.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=e&&e.Xb||!1,e&&e.Aa&&this.j.Aa(),e&&e.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&e&&e.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Iy(e){var t,n;Ey(e),3==e.G&&(t=e.U++,Sv(n=Iv(e.F),"SID",e.I),Sv(n,"RID",t),Sv(n,"TYPE","terminate"),Cy(e,n),(t=new rv(e,e.j,t,void 0)).K=2,t.v=Cv(Iv(n)),n=!1,!(n=mg.navigator&&mg.navigator.sendBeacon?mg.navigator.sendBeacon(t.v.toString(),""):n)&&mg.Image&&((new Image).src=t.v,n=!0),n||(t.g=qy(t.l,null),t.g.da(t.v)),t.F=Date.now(),pv(t)),Fy(e)}function Ty(e){e.g&&(Dy(e),e.g.cancel(),e.g=null)}function Ey(e){Ty(e),e.u&&(mg.clearTimeout(e.u),e.u=null),Py(e),e.h.cancel(),e.m&&("number"==typeof e.m&&mg.clearTimeout(e.m),e.m=null)}function ky(e){Kv(e.h)||e.m||(e.m=!0,Nm(e.Ja,e),e.C=0)}function Sy(e,t){var n=t?t.m:e.U++,r=Iv(e.F);Sv(r,"SID",e.I),Sv(r,"RID",n),Sv(r,"AID",e.T),Cy(e,r),e.o&&e.s&&_y(r,e.o,e.s),n=new rv(e,e.j,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.i=t.D.concat(e.i)),t=Ny(e,n,1e3),n.setTimeout(Math.round(.5*e.ta)+Math.round(.5*e.ta*Math.random())),Hv(e.h,n),lv(n,r,t)}function Cy(e,n){e.ia&&im(e.ia,function(e,t){Sv(n,t,e)}),e.l&&_v({},function(e,t){Sv(n,t,e)})}function Ny(e,t,r){r=Math.min(e.i.length,r);var i=e.l?Eg(e.l.Ra,e.l,e):null;e:{var s=e.i;let n=-1;for(;;){const c=["count="+r];-1==n?0<r?(n=s[0].h,c.push("ofs="+n)):n=0:c.push("ofs="+n);let e=!0;for(let t=0;t<r;t++){var a=s[t].h,o=s[t].g;if((a-=n)<0)n=Math.max(0,s[t].h-100),e=!1;else try{!function(e,r,t){const i=t||"";try{_v(e,function(e,t){let n=e;_g(e)&&(n=Em(e)),r.push(i+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(i+"type="+encodeURIComponent("_badmap")),e}}(o,c,"req"+a+"_")}catch(e){i&&i(o)}}if(e){i=c.join("&");break e}}}return e=e.i.splice(0,r),t.D=e,i}function Ay(e){e.g||e.u||(e.Z=1,Nm(e.Ia,e),e.A=0)}function Ry(e){return!(e.g||e.u||3<=e.A)&&(e.Z++,e.u=Ym(Eg(e.Ia,e),My(e,e.A)),e.A++,1)}function Dy(e){null!=e.B&&(mg.clearTimeout(e.B),e.B=null)}function xy(e){e.g=new rv(e,e.j,"rpc",e.Z),null===e.o&&(e.g.H=e.s),e.g.N=0;var t=Iv(e.sa);Sv(t,"RID","rpc"),Sv(t,"SID",e.I),Sv(t,"CI",e.L?"0":"1"),Sv(t,"AID",e.T),Sv(t,"TYPE","xmlhttp"),Cy(e,t),e.o&&e.s&&_y(t,e.o,e.s),e.J&&e.g.setTimeout(e.J);var n=e.g;e=e.ka,n.K=1,n.v=Cv(Iv(t)),n.s=null,n.P=!0,uv(n,e)}function Py(e){null!=e.v&&(mg.clearTimeout(e.v),e.v=null)}function Oy(e,t){var n,r,i,s=null;if(e.g==t){Py(e),Dy(e),e.g=null;var a=2}else{if(!Gv(e.h,t))return;s=t.D,Qv(e.h,t),a=1}if(0!=e.G)if(e.pa=t.Y,t.i)1==a?(s=t.s?t.s.length:0,t=Date.now()-t.F,n=e.C,Im(a=$m(),new Qm(a,s)),ky(e)):Ay(e);else if(3==(n=t.o)||0==n&&0<e.pa||(1!=a||(i=t,Wv((r=e).h)>=r.h.j-(r.m?1:0)||(r.m?(r.i=i.D.concat(r.i),0):1==r.G||2==r.G||r.C>=(r.Za?0:r.$a)||(r.m=Ym(Eg(r.Ja,r,i),My(r,r.C)),r.C++,0))))&&(2!=a||!Ry(e)))switch(s&&0<s.length&&(t=e.h,t.i=t.i.concat(s)),n){case 1:Ly(e,5);break;case 4:Ly(e,10);break;case 3:Ly(e,6);break;default:Ly(e,2)}}function My(e,t){let n=e.Xa+Math.floor(Math.random()*e.bb);return e.l||(n*=2),n*t}function Ly(e,t){var n,r;e.j.info("Error code "+t),2==t?(n=null,e.l&&(n=null),r=Eg(e.kb,e),n||(n=new bv("//www.google.com/images/cleardot.gif"),mg.location&&"http"==mg.location.protocol||Tv(n,"https"),Cv(n)),function(e,t){var n=new Vm;if(mg.Image){const r=new Image;r.onload=kg(Zv,n,r,"TestLoadImage: loaded",!0,t),r.onerror=kg(Zv,n,r,"TestLoadImage: error",!1,t),r.onabort=kg(Zv,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=kg(Zv,n,r,"TestLoadImage: timeout",!1,t),mg.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)):Hm(2),e.G=0,e.l&&e.l.va(t),Fy(e),Ey(e)}function Fy(e){var t;e.G=0,e.la=[],e.l&&(0==(t=Yv(e.h)).length&&0==e.i.length||(Rg(e.la,t),Rg(e.la,e.i),e.h.i.length=0,Ag(e.i),e.i.length=0),e.l.ua())}function Uy(e,t,n){var r,i,s=n instanceof bv?Iv(n):new bv(n,void 0);return""!=s.g?(t&&(s.g=t+"."+s.g),Ev(s,s.m)):(s=(r=mg.location).protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port,i=new bv(null,void 0),s&&Tv(i,s),t&&(i.g=t),r&&Ev(i,r),n&&(i.l=n),s=i),n=e.D,t=e.za,n&&t&&Sv(s,n,t),Sv(s,"VER",e.ma),Cy(e,s),s}function qy(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Da&&!e.ra?new oy(new ey({jb:!0})):new oy(e.ra)).Ka(e.H),t}function Vy(){}function By(){if(Bg&&!(10<=Number(Jg)))throw Error("Environmental error: no available transport.")}function jy(e,t){bm.call(this),this.g=new by(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.S=e,(e=t&&t.Yb)&&!Pg(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Pg(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new Ky(this)}function zy(e){ev.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function $y(){tv.call(this),this.status=1}function Ky(e){this.g=e}(bt=oy.prototype).Ka=function(e){this.L=e},bt.da=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||sv).g(),this.C=this.u?Xm(this.u):Xm(sv),this.g.onreadystatechange=Eg(this.Ha,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void hy(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const c of r.keys())n.set(c,r.get(c))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=mg.FormData&&e instanceof mg.FormData,0<=Ng(uy,t)&&!r&&!i&&n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(var[s,a]of n)this.g.setRequestHeader(s,a);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{gy(this),0<this.B&&((this.K=(o=this.g,Bg&&Yg()&&"number"==typeof o.timeout&&void 0!==o.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=Eg(this.qa,this)):this.A=Om(this.qa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){hy(this,e)}var o},bt.qa=function(){void 0!==gg&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Im(this,"timeout"),this.abort(8))},bt.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Im(this,"complete"),Im(this,"abort"),fy(this))},bt.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),fy(this,!0)),oy.X.M.call(this)},bt.Ha=function(){this.s||(this.F||this.v||this.l?py(this):this.fb())},bt.fb=function(){py(this)},bt.aa=function(){try{return 2<my(this)?this.g.status:-1}catch(e){return-1}},bt.fa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},bt.Sa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ay(t)}},bt.Ea=function(){return this.m},bt.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(bt=by.prototype).ma=8,bt.G=1,bt.Ja=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const s=new rv(this,this.j,t,void 0);let e=this.s;if(this.S&&(e?(e=sm(e),om(e,this.S)):e=this.S),null!==this.o||this.N||(s.H=e,e=null),this.O)e:{for(var n=0,r=0;r<this.i.length;r++){var i=this.i[r];if("__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i=i.length:i=void 0,void 0===i)break;if(4096<(n+=i)){n=r;break e}if(4096===n||r===this.i.length-1){n=r+1;break e}}n=1e3}else n=1e3;n=Ny(this,s,n),Sv(r=Iv(this.F),"RID",t),Sv(r,"CVER",22),this.D&&Sv(r,"X-HTTP-Session-Id",this.D),Cy(this,r),e&&(this.N?n="headers="+encodeURIComponent(String(yy(e)))+"&"+n:this.o&&_y(r,this.o,e)),Hv(this.h,s),this.Ya&&Sv(r,"TYPE","init"),this.O?(Sv(r,"$req",n),Sv(r,"SID","null"),s.Z=!0,lv(s,r,null)):lv(s,r,n),this.G=2}}else 3==this.G&&(t?Sy(this,t):0==this.i.length||Kv(this.h)||Sy(this))},bt.Ia=function(){var e;this.u=null,xy(this),this.$&&!(this.K||null==this.g||this.P<=0)&&(e=2*this.P,this.j.info("BP detection timer enabled: "+e),this.B=Ym(Eg(this.eb,this),e))},bt.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,Hm(10),Ty(this),xy(this))},bt.cb=function(){null!=this.v&&(this.v=null,Ty(this),Ry(this),Hm(19))},bt.kb=function(e){e?(this.j.info("Successfully pinged google.com"),Hm(2)):(this.j.info("Failed to ping google.com"),Hm(1))},(bt=Vy.prototype).xa=function(){},bt.wa=function(){},bt.va=function(){},bt.ua=function(){},bt.Ra=function(){},By.prototype.g=function(e,t){return new jy(e,t)},Sg(jy,bm),jy.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;Hm(0),e.V=t,e.ia=n||{},e.L=e.Y,e.F=Uy(e,null,e.V),ky(e)},jy.prototype.close=function(){Iy(this.g)},jy.prototype.u=function(e){var t,n=this.g;"string"==typeof e?((t={}).__data__=e,e=t):this.v&&((t={}).__data__=Em(e),e=t),n.i.push(new jv(n.ab++,e)),3==n.G&&ky(n)},jy.prototype.M=function(){this.g.l=null,delete this.j,Iy(this.g),delete this.g,jy.X.M.call(this)},Sg(zy,ev),Sg($y,tv),Sg(Ky,Vy),Ky.prototype.xa=function(){Im(this.g,"a")},Ky.prototype.wa=function(e){Im(this.g,new zy(e))},Ky.prototype.va=function(e){Im(this.g,new $y)},Ky.prototype.ua=function(){Im(this.g,"b")},By.prototype.createWebChannel=By.prototype.g,jy.prototype.send=jy.prototype.u,jy.prototype.open=jy.prototype.m,It.NO_ERROR=0,It.TIMEOUT=8,It.HTTP_ERROR=6,Hc.COMPLETE="complete",(Zm.EventType=yt).OPEN="a",yt.CLOSE="b",yt.ERROR="c",yt.MESSAGE="d",bm.prototype.listen=bm.prototype.N,oy.prototype.listenOnce=oy.prototype.O,oy.prototype.getLastError=oy.prototype.Oa,oy.prototype.getLastErrorCode=oy.prototype.Ea,oy.prototype.getStatus=oy.prototype.aa,oy.prototype.getResponseJson=oy.prototype.Sa,oy.prototype.getResponseText=oy.prototype.fa,oy.prototype.send=oy.prototype.da,oy.prototype.setWithCredentials=oy.prototype.Ka;var Wy,Gy=$m,Hy=It,Qy=Hc,Yy=jm,Jy=10,Xy=11,Zy=ey,e_=Zm,t_=oy;const n_="@firebase/firestore";class r_{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}r_.UNAUTHENTICATED=new r_(null),r_.GOOGLE_CREDENTIALS=new r_("google-credentials-uid"),r_.FIRST_PARTY=new r_("first-party-uid"),r_.MOCK_USER=new r_("mock-user");let i_="9.19.1";const s_=new me("@firebase/firestore");function a_(){return s_.logLevel}function o_(e,...t){var n;s_.logLevel<=m.DEBUG&&(n=t.map(u_),s_.debug(`Firestore (${i_}): ${e}`,...n))}function c_(e,...t){var n;s_.logLevel<=m.ERROR&&(n=t.map(u_),s_.error(`Firestore (${i_}): ${e}`,...n))}function l_(e,...t){var n;s_.logLevel<=m.WARN&&(n=t.map(u_),s_.warn(`Firestore (${i_}): ${e}`,...n))}function u_(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function h_(e="Unexpected state"){var t=`FIRESTORE (${i_}) INTERNAL ASSERTION FAILED: `+e;throw c_(t),new Error(t)}function d_(e){e||h_()}const p_={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class f_ extends R{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class g_{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class m_{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class v_{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(r_.UNAUTHENTICATED))}shutdown(){}}class y_{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class __{constructor(e){this.t=e,this.currentUser=r_.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i;const i=e=>this.i!==r?(r=this.i,n(e)):Promise.resolve();let s=new g_;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new g_,t.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const e=s;t.enqueueRetryable(async()=>{await e.promise,await i(this.currentUser)})},o=e=>{o_("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(e=>o(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?o(e):(o_("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new g_))},0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(o_("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(d_("string"==typeof e.accessToken),new m_(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){var e=this.auth&&this.auth.getUid();return d_(null===e||"string"==typeof e),new r_(e)}}class w_{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=r_.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);var e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class b_{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new w_(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(r_.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class I_{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&0<e.length&&this.headers.set("x-firebase-appcheck",this.value)}}class T_{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(t,n){const r=e=>{null!=e.error&&o_("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);var t=e.token!==this.T;return this.T=e.token,o_("FirebaseAppCheckTokenProvider",`Received ${t?"new":"existing"} token.`),t?n(e.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable(()=>r(e))};const i=e=>{o_("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.I.onInit(e=>i(e)),setTimeout(()=>{var e;this.appCheck||((e=this.I.getImmediate({optional:!0}))?i(e):o_("FirebaseAppCheckTokenProvider","AppCheck not yet detected"))},0)}getToken(){var e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(d_("string"==typeof e.token),this.T=e.token,new I_(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class E_{static A(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length;let r="";for(;r.length<20;){var i=function(t){const n="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(n&&"function"==typeof n.getRandomValues)n.getRandomValues(r);else for(let e=0;e<t;e++)r[e]=Math.floor(256*Math.random());return r}(40);for(let e=0;e<i.length;++e)r.length<20&&i[e]<n&&(r+=t.charAt(i[e]%t.length))}return r}}function k_(e,t){return e<t?-1:t<e?1:0}function S_(e,n,r){return e.length===n.length&&e.every((e,t)=>r(e,n[t]))}function C_(e){return e+"\0"}class N_{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new f_(p_.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new f_(p_.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new f_(p_.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new f_(p_.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return N_.fromMillis(Date.now())}static fromDate(e){return N_.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new N_(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?k_(this.nanoseconds,e.nanoseconds):k_(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class A_{constructor(e){this.timestamp=e}static fromTimestamp(e){return new A_(e)}static min(){return new A_(new N_(0,0))}static max(){return new A_(new N_(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class R_{constructor(e,t,n){void 0===t?t=0:t>e.length&&h_(),void 0===n?n=e.length-t:n>e.length-t&&h_(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===R_.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof R_?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class D_ extends R_{construct(e,t,n){return new D_(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(0<=n.indexOf("//"))throw new f_(p_.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>0<e.length))}return new D_(t)}static emptyPath(){return new D_([])}}const x_=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class P_ extends R_{construct(e,t,n){return new P_(e,t,n)}static isValidIdentifier(e){return x_.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=!P_.isValidIdentifier(e)?"`"+e+"`":e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new P_(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;var i=()=>{if(0===n.length)throw new f_(p_.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new f_(p_.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new f_(p_.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new f_(p_.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new P_(t)}static emptyPath(){return new P_([])}}class O_{constructor(e){this.path=e}static fromPath(e){return new O_(D_.fromString(e))}static fromName(e){return new O_(D_.fromString(e).popFirst(5))}static empty(){return new O_(D_.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===D_.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return D_.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new O_(new D_(e.slice()))}}class M_{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function L_(e){return e.fields.find(e=>2===e.kind)}function F_(e){return e.fields.filter(e=>2!==e.kind)}M_.UNKNOWN_ID=-1;class U_{constructor(e,t){this.fieldPath=e,this.kind=t}}class q_{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new q_(0,j_.min())}}function V_(e,t){var n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,r=A_.fromTimestamp(1e9===r?new N_(n+1,0):new N_(n,r));return new j_(r,O_.empty(),t)}function B_(e){return new j_(e.readTime,e.key,-1)}class j_{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new j_(A_.min(),O_.empty(),-1)}static max(){return new j_(A_.max(),O_.empty(),-1)}}function z_(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=O_.comparator(e.documentKey,t.documentKey),0!==n?n:k_(e.largestBatchId,t.largestBatchId))}const $_="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class K_{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function W_(e){if(e.code!==p_.FAILED_PRECONDITION||e.message!==$_)throw e;o_("LocalStore","Unexpectedly lost primary lease")}class G_{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(r,i){return this.callbackAttached&&h_(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new G_((t,n)=>{this.nextCallback=e=>{this.wrapSuccess(r,e).next(t,n)},this.catchCallback=e=>{this.wrapFailure(i,e).next(t,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof G_?t:G_.resolve(t)}catch(e){return G_.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):G_.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):G_.reject(t)}static resolve(n){return new G_((e,t)=>{e(n)})}static reject(n){return new G_((e,t)=>{t(n)})}static waitFor(e){return new G_((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=G_.resolve(!1);for(const n of e)t=t.next(e=>e?G_.resolve(e):n());return t}static forEach(e,n){const r=[];return e.forEach((e,t)=>{r.push(n.call(this,e,t))}),this.waitFor(r)}static mapArray(o,c){return new G_((t,n)=>{const r=o.length,i=new Array(r);let s=0;for(let e=0;e<r;e++){const a=e;c(o[a]).next(e=>{i[a]=e,++s,s===r&&t(i)},e=>n(e))}})}static doWhile(r,i){return new G_((e,t)=>{const n=()=>{!0===r()?i().next(()=>{n()},t):e()};n()})}}class H_{constructor(n,e){this.action=n,this.transaction=e,this.aborted=!1,this.R=new g_,this.transaction.oncomplete=()=>{this.R.resolve()},this.transaction.onabort=()=>{e.error?this.R.reject(new J_(n,e.error)):this.R.resolve()},this.transaction.onerror=e=>{var t=nw(e.target.error);this.R.reject(new J_(n,t))}}static open(e,t,n,r){try{return new H_(t,e.transaction(r,n))}catch(e){throw new J_(t,e)}}get v(){return this.R.promise}abort(e){e&&this.R.reject(e),this.aborted||(o_("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}P(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){var t=this.transaction.objectStore(e);return new Z_(t)}}class Q_{constructor(e,t,n){this.name=e,this.version=t,this.V=n,12.2===Q_.S(w())&&c_("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return o_("SimpleDb","Removing database:",e),ew(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!C())return!1;if(Q_.C())return!0;const e=w(),t=Q_.S(e),n=0<t&&t<10,r=Q_.N(e),i=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||i)}static C(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.k)}static O(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static N(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async $(s){return this.db||(o_("SimpleDb","Opening database:",this.name),this.db=await new Promise((n,r)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=e=>{var t=e.target.result;n(t)},i.onblocked=()=>{r(new J_(s,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=e=>{var t=e.target.error;"VersionError"===t.name?r(new f_(p_.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===t.name?r(new f_(p_.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+t)):r(new J_(s,t))},i.onupgradeneeded=e=>{o_("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.V.M(t,i.transaction,e.oldVersion,this.version).next(()=>{o_("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.F&&(this.db.onversionchange=e=>this.F(e)),this.db}B(t){this.F=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(e,t,n,r){var i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.$(e);const t=H_.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.P(),e)).catch(e=>(t.abort(e),G_.reject(e))).toPromise();return s.catch(()=>{}),await t.v,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(o_("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Y_{constructor(e){this.L=e,this.q=!1,this.U=null}get isDone(){return this.q}get K(){return this.U}set cursor(e){this.L=e}done(){this.q=!0}G(e){this.U=e}delete(){return ew(this.L.delete())}}class J_ extends f_{constructor(e,t){super(p_.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function X_(e){return"IndexedDbTransactionError"===e.name}class Z_{constructor(e){this.store=e}put(e,t){let n;return n=void 0!==t?(o_("SimpleDb","PUT",this.store.name,e,t),this.store.put(t,e)):(o_("SimpleDb","PUT",this.store.name,"<auto-key>",e),this.store.put(e)),ew(n)}add(e){return o_("SimpleDb","ADD",this.store.name,e,e),ew(this.store.add(e))}get(t){return ew(this.store.get(t)).next(e=>(o_("SimpleDb","GET",this.store.name,t,e=void 0===e?null:e),e))}delete(e){return o_("SimpleDb","DELETE",this.store.name,e),ew(this.store.delete(e))}count(){return o_("SimpleDb","COUNT",this.store.name),ew(this.store.count())}j(e,n){var t=this.options(e,n);if(t.index||"function"!=typeof this.store.getAll){const e=this.cursor(t),n=[];return this.W(e,(e,t)=>{n.push(t)}).next(()=>n)}{const e=this.store.getAll(t.range);return new G_((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}}H(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new G_((t,n)=>{r.onerror=e=>{n(e.target.error)},r.onsuccess=e=>{t(e.target.result)}})}J(e,t){o_("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.Y=!1;var r=this.cursor(n);return this.W(r,(e,t,n)=>n.delete())}Z(e,t){let n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.W(r,t)}X(i){const e=this.cursor({});return new G_((n,r)=>{e.onerror=e=>{var t=nw(e.target.error);r(t)},e.onsuccess=e=>{const t=e.target.result;t?i(t.primaryKey,t.value).next(e=>{e?t.continue():n()}):n()}})}W(e,s){const a=[];return new G_((i,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{const t=e.target.result;if(t){const n=new Y_(t),r=s(t.primaryKey,t.value,n);if(r instanceof G_){const e=r.catch(e=>(n.done(),G_.reject(e)));a.push(e)}n.isDone?i():null===n.K?t.continue():t.continue(n.K)}else i()}}).next(()=>G_.waitFor(a))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Y?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ew(e){return new G_((n,r)=>{e.onsuccess=e=>{var t=e.target.result;n(t)},e.onerror=e=>{var t=nw(e.target.error);r(t)}})}let tw=!1;function nw(e){const t=Q_.S(w());if(12.2<=t&&t<13){const t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){const e=new f_("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return tw||(tw=!0,setTimeout(()=>{throw e},0)),e}}return e}class rw{constructor(e,t){this.asyncQueue=e,this.tt=t,this.task=null}start(){this.et(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}et(e){o_("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{o_("IndexBackiller",`Documents written: ${await this.tt.nt()}`)}catch(e){X_(e)?o_("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await W_(e)}await this.et(6e4)})}}class iw{constructor(e,t){this.localStore=e,this.persistence=t}async nt(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.st(e,t))}st(e,t){const n=new Set;let r=t,i=!0;return G_.doWhile(()=>!0===i&&0<r,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>null===t||n.has(t)?void(i=!1):(o_("IndexBackiller",`Processing collection: ${t}`),this.it(e,t,r).next(e=>{r-=e,n.add(t)})))).next(()=>t-r)}it(r,i,e){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(r,i).next(n=>this.localStore.localDocuments.getNextDocuments(r,i,n,e).next(e=>{const t=e.changes;return this.localStore.indexManager.updateIndexEntries(r,t).next(()=>this.rt(n,e)).next(e=>(o_("IndexBackiller",`Updating offset: ${e}`),this.localStore.indexManager.updateCollectionGroup(r,i,e))).next(()=>t.size)}))}rt(e,t){let r=e;return t.changes.forEach((e,t)=>{var n=B_(t);0<z_(n,r)&&(r=n)}),new j_(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class sw{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ot(e),this.ut=e=>t.writeSequenceNumber(e))}ot(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.ut&&this.ut(e),e}}function aw(e){return null==e}function ow(e){return 0===e&&1/e==-1/0}function cw(e){return"number"==typeof e&&Number.isInteger(e)&&!ow(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function lw(e){let t="";for(let n=0;n<e.length;n++)0<t.length&&(t=uw(t)),t=function(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const r=e.charAt(i);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(e.get(n),t);return uw(t)}function uw(e){return e+""}function hw(t){const n=t.length;if(d_(2<=n),2===n)return d_(""===t.charAt(0)&&""===t.charAt(1)),D_.emptyPath();const __PRIVATE_lastReasonableEscapeIndex=n-2,r=[];let i="";for(let a=0;a<n;){const n=t.indexOf("",a);switch((n<0||n>__PRIVATE_lastReasonableEscapeIndex)&&h_(),t.charAt(n+1)){case"":var s=t.substring(a,n);let e;0===i.length?e=s:(i+=s,e=i,i=""),r.push(e);break;case"":i+=t.substring(a,n),i+="\0";break;case"":i+=t.substring(a,n+1);break;default:h_()}a=n+2}return new D_(r)}sw.ct=-1;const dw=["userId","batchId"];function pw(e,t){return[e,lw(t)]}function fw(e,t,n){return[e,lw(t),n]}const gw={},mw=["prefixPath","collectionGroup","readTime","documentId"],vw=["prefixPath","collectionGroup","documentId"],yw=["collectionGroup","readTime","prefixPath","documentId"],_w=["canonicalId","targetId"],ww=["targetId","path"],bw=["path","targetId"],Iw=["collectionId","parent"],Tw=["indexId","uid"],Ew=["uid","sequenceNumber"],kw=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Sw=["indexId","uid","orderedDocumentKey"],Cw=["userId","collectionPath","documentId"],Nw=["userId","collectionPath","largestBatchId"],Aw=["userId","collectionGroup","largestBatchId"],Rw=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Dw=[...Rw,"documentOverlays"],xw=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Pw=xw,Ow=[...Pw,"indexConfiguration","indexState","indexEntries"];class Mw extends K_{constructor(e,t){super(),this.at=e,this.currentSequenceNumber=t}}function Lw(e,t){var n=e;return Q_.O(n.at,t)}function Fw(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Uw(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function qw(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Vw{constructor(e,t){this.comparator=e,this.root=t||jw.EMPTY}insert(e,t){return new Vw(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,jw.BLACK,null,null))}remove(e){return new Vw(this.comparator,this.root.remove(e,this.comparator).copy(null,null,jw.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(n){this.inorderTraversal((e,t)=>(n(e,t),!1))}toString(){const n=[];return this.inorderTraversal((e,t)=>(n.push(`${e}:${t}`),!1)),`{${n.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Bw(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Bw(this.root,e,this.comparator,!1)}getReverseIterator(){return new Bw(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Bw(this.root,e,this.comparator,!0)}}class Bw{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class jw{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:jw.RED,this.left=null!=r?r:jw.EMPTY,this.right=null!=i?i:jw.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new jw(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return jw.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return jw.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){var e=this.copy(null,null,jw.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,jw.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw h_();if(this.right.isRed())throw h_();var e=this.left.check();if(e!==this.right.check())throw h_();return e+(this.isRed()?0:1)}}jw.EMPTY=null,jw.RED=!0,jw.BLACK=!1,jw.EMPTY=new class{constructor(){this.size=0}get key(){throw h_()}get value(){throw h_()}get color(){throw h_()}get left(){throw h_()}get right(){throw h_()}copy(e,t,n,r,i){return this}insert(e,t,n){return new jw(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class zw{constructor(e){this.comparator=e,this.data=new Vw(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(n){this.data.inorderTraversal((e,t)=>(n(e),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new $w(this.data.getIterator())}getIteratorFrom(e){return new $w(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof zw))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){const t=new zw(this.comparator);return t.data=e,t}}class $w{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Kw(e){return e.hasNext()?e.getNext():void 0}class Ww{constructor(e){(this.fields=e).sort(P_.comparator)}static empty(){return new Ww([])}unionWith(e){let t=new zw(P_.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new Ww(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return S_(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Gw extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Hw{constructor(e){this.binaryString=e}static fromBase64String(e){var t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Gw("Invalid base64 string: "+e):e}}(e);return new Hw(t)}static fromUint8Array(e){var t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Hw(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return k_(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Hw.EMPTY_BYTE_STRING=new Hw("");const Qw=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Yw(t){if(d_(!!t),"string"!=typeof t)return{seconds:Jw(t.seconds),nanos:Jw(t.nanos)};{let e=0;var n=Qw.exec(t);d_(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function Jw(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Xw(e){return"string"==typeof e?Hw.fromBase64String(e):Hw.fromUint8Array(e)}function Zw(e){var t;return"server_timestamp"===(null===(t=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function eb(e){var t=Yw(e.mapValue.fields.__local_write_time__.timestampValue);return new N_(t.seconds,t.nanos)}class tb{constructor(e,t,n,r,i,s,a,o){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.useFetchStreams=o}}class nb{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new nb("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof nb&&e.projectId===this.projectId&&e.database===this.database}}const rb={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},ib={nullValue:"NULL_VALUE"};function sb(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Zw(e)?4:yb(e)?9007199254740991:10:h_()}function ab(r,i){if(r===i)return!0;var e,t,n=sb(r);if(n!==sb(i))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return eb(r).isEqual(eb(i));case 3:return function(e){if("string"==typeof r.timestampValue&&"string"==typeof e.timestampValue&&r.timestampValue.length===e.timestampValue.length)return r.timestampValue===e.timestampValue;var t=Yw(r.timestampValue),n=Yw(e.timestampValue);return t.seconds===n.seconds&&t.nanos===n.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return t=i,Xw(r.bytesValue).isEqual(Xw(t.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,Jw((t=r).geoPointValue.latitude)===Jw(e.geoPointValue.latitude)&&Jw(t.geoPointValue.longitude)===Jw(e.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Jw(e.integerValue)===Jw(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=Jw(e.doubleValue),r=Jw(t.doubleValue);return n===r?ow(n)===ow(r):isNaN(n)&&isNaN(r)}return!1}(r,i);case 9:return S_(r.arrayValue.values||[],i.arrayValue.values||[],ab);case 10:return function(e){const t=e.mapValue.fields||{},n=i.mapValue.fields||{};if(Fw(t)!==Fw(n))return!1;for(const e in t)if(t.hasOwnProperty(e)&&(void 0===n[e]||!ab(t[e],n[e])))return!1;return!0}(r);default:return h_()}}function ob(e,t){return void 0!==(e.values||[]).find(e=>ab(e,t))}function cb(e,t){if(e===t)return 0;var n,r,i,s,a=sb(e),o=sb(t);if(a!==o)return k_(a,o);switch(a){case 0:case 9007199254740991:return 0;case 1:return k_(e.booleanValue,t.booleanValue);case 2:return r=t,i=Jw(e.integerValue||e.doubleValue),s=Jw(r.integerValue||r.doubleValue),i<s?-1:s<i?1:i===s?0:isNaN(i)?isNaN(s)?0:-1:1;case 3:return lb(e.timestampValue,t.timestampValue);case 4:return lb(eb(e),eb(t));case 5:return k_(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Xw(e),r=Xw(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){var n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const t=k_(n[i],r[i]);if(0!==t)return t}return k_(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return n=e.geoPointValue,r=t.geoPointValue,0!==(s=k_(Jw(n.latitude),Jw(r.latitude)))?s:k_(Jw(n.longitude),Jw(r.longitude));case 9:return function(e,t){var n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const t=cb(n[i],r[i]);if(t)return t}return k_(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===rb.mapValue&&t===rb.mapValue)return 0;if(e===rb.mapValue)return 1;if(t===rb.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const t=k_(r[o],s[o]);if(0!==t)return t;var a=cb(n[r[o]],i[s[o]]);if(0!==a)return a}return k_(r.length,s.length)}(e.mapValue,t.mapValue);default:throw h_()}}function lb(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return k_(e,t);var n=Yw(e),r=Yw(t),i=k_(n.seconds,r.seconds);return 0!==i?i:k_(n.nanos,r.nanos)}function ub(e){return function s(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Yw(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Xw(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,O_.fromName(t).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=s(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${s(e.fields[i])}`;return n+"}"}(e.mapValue):h_();var t}(e)}function hb(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function db(e){return e&&"integerValue"in e}function pb(e){return!!e&&"arrayValue"in e}function fb(e){return e&&"nullValue"in e}function gb(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function mb(e){return e&&"mapValue"in e}function vb(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const n={mapValue:{fields:{}}};return Uw(t.mapValue.fields,(e,t)=>n.mapValue.fields[e]=vb(t)),n}if(t.arrayValue){const r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=vb(t.arrayValue.values[e]);return r}return Object.assign({},t)}function yb(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function _b(e,t){var n=cb(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function wb(e,t){var n=cb(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class bb{constructor(e){this.value=e}static empty(){return new bb({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let e=this.value;for(let t=0;t<n.length-1;++t)if(e=(e.mapValue.fields||{})[n.get(t)],!mb(e))return null;return e=(e.mapValue.fields||{})[n.lastSegment()],e||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=vb(t)}setAll(e){let n=P_.emptyPath(),r={},i=[];e.forEach((e,t)=>{if(!n.isImmediateParentOf(t)){const e=this.getFieldsMap(n);this.applyChanges(e,r,i),r={},i=[],n=t.popLast()}e?r[t.lastSegment()]=vb(e):i.push(t.lastSegment())});var t=this.getFieldsMap(n);this.applyChanges(t,r,i)}delete(e){const t=this.field(e.popLast());mb(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ab(this.value,e.value)}getFieldsMap(t){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<t.length;++r){let e=n.mapValue.fields[t.get(r)];mb(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},n.mapValue.fields[t.get(r)]=e),n=e}return n.mapValue.fields}applyChanges(n,e,t){Uw(e,(e,t)=>n[e]=t);for(const e of t)delete n[e]}clone(){return new bb(vb(this.value))}}class Ib{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new Ib(e,0,A_.min(),A_.min(),A_.min(),bb.empty(),0)}static newFoundDocument(e,t,n,r){return new Ib(e,1,t,A_.min(),n,r,0)}static newNoDocument(e,t){return new Ib(e,2,t,A_.min(),A_.min(),bb.empty(),0)}static newUnknownDocument(e,t){return new Ib(e,3,t,A_.min(),A_.min(),bb.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(A_.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=bb.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=bb.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=A_.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Ib&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ib(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Tb{constructor(e,t){this.position=e,this.inclusive=t}}function Eb(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],a=e.position[i];if(r=s.field.isKeyField()?O_.comparator(O_.fromName(a.referenceValue),n.key):cb(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function kb(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!ab(e.position[n],t.position[n]))return!1;return!0}class Sb{constructor(e,t="asc"){this.field=e,this.dir=t}}class Cb{}class Nb extends Cb{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Lb(e,t,n):"array-contains"===t?new Vb(e,n):"in"===t?new Bb(e,n):"not-in"===t?new jb(e,n):"array-contains-any"===t?new zb(e,n):new Nb(e,t,n)}static createKeyFieldInFilter(e,t,n){return new("in"===t?Fb:Ub)(e,n)}matches(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(cb(t,this.value)):null!==t&&sb(this.value)===sb(t)&&this.matchesComparison(cb(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return h_()}}isInequality(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class Ab extends Cb{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new Ab(e,t)}matches(t){return Rb(this)?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null!==this.ht||(this.ht=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){var e=this.lt(e=>e.isInequality());return null!==e?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function Rb(e){return"and"===e.op}function Db(e){return"or"===e.op}function xb(e){return Pb(e)&&Rb(e)}function Pb(e){for(const t of e.filters)if(t instanceof Ab)return!1;return!0}function Ob(e,t){var n=e.filters.concat(t);return Ab.create(n,e.op)}function Mb(e){return e instanceof Nb?`${(t=e).field.canonicalString()} ${t.op} ${ub(t.value)}`:e instanceof Ab?(e=e).op.toString()+" {"+e.getFilters().map(Mb).join(" ,")+"}":"Filter";var t}class Lb extends Nb{constructor(e,t,n){super(e,t,n),this.key=O_.fromName(n.referenceValue)}matches(e){var t=O_.comparator(e.key,this.key);return this.matchesComparison(t)}}class Fb extends Nb{constructor(e,t){super(e,"in",t),this.keys=qb(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Ub extends Nb{constructor(e,t){super(e,"not-in",t),this.keys=qb(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function qb(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>O_.fromName(e.referenceValue))}class Vb extends Nb{constructor(e,t){super(e,"array-contains",t)}matches(e){var t=e.data.field(this.field);return pb(t)&&ob(t.arrayValue,this.value)}}class Bb extends Nb{constructor(e,t){super(e,"in",t)}matches(e){var t=e.data.field(this.field);return null!==t&&ob(this.value.arrayValue,t)}}class jb extends Nb{constructor(e,t){super(e,"not-in",t)}matches(e){if(ob(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!ob(this.value.arrayValue,t)}}class zb extends Nb{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!pb(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>ob(this.value.arrayValue,e))}}class $b{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.ft=null}}function Kb(e,t=null,n=[],r=[],i=null,s=null,a=null){return new $b(e,t,n,r,i,s,a)}function Wb(e){const t=e;if(null===t.ft){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>function t(e){if(e instanceof Nb)return e.field.canonicalString()+e.op.toString()+ub(e.value);if(xb(e))return e.filters.map(e=>t(e)).join(",");var n=e.filters.map(e=>t(e)).join(",");return`${e.op}(${n})`}(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),aw(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>ub(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>ub(e)).join(",")),t.ft=e}return t.ft}function Gb(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++)if(n=e.orderBy[i],r=t.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;var n,r;if(e.filters.length!==t.filters.length)return!1;for(let s=0;s<e.filters.length;s++)if(!function r(e,t){return e instanceof Nb?(n=e,(s=t)instanceof Nb&&n.op===s.op&&n.field.isEqual(s.field)&&ab(n.value,s.value)):e instanceof Ab?(i=t)instanceof Ab&&e.op===i.op&&e.filters.length===i.filters.length&&e.filters.reduce((e,t,n)=>e&&r(t,i.filters[n]),!0):void h_();var i,n,s}(e.filters[s],t.filters[s]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!kb(e.startAt,t.startAt)&&kb(e.endAt,t.endAt)}function Hb(e){return O_.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Qb(e,t){return e.filters.filter(e=>e instanceof Nb&&e.field.isEqual(t))}function Yb(t,n,r){let i=ib,s=!0;for(const r of Qb(t,n)){let e=ib,t=!0;switch(r.op){case"<":case"<=":e="nullValue"in(a=r.value)?ib:"booleanValue"in a?{booleanValue:!1}:"integerValue"in a||"doubleValue"in a?{doubleValue:NaN}:"timestampValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in a?{stringValue:""}:"bytesValue"in a?{bytesValue:""}:"referenceValue"in a?hb(nb.empty(),O_.empty()):"geoPointValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in a?{arrayValue:{}}:"mapValue"in a?{mapValue:{}}:h_();break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=ib}_b({value:i,inclusive:s},{value:e,inclusive:t})<0&&(i=e,s=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];_b({value:i,inclusive:s},{value:t,inclusive:r.inclusive})<0&&(i=t,s=r.inclusive);break}return{value:i,inclusive:s}}function Jb(t,n,r){let i=rb,s=!0;for(const r of Qb(t,n)){let e=rb,t=!0;switch(r.op){case">=":case">":e="nullValue"in(a=r.value)?{booleanValue:!1}:"booleanValue"in a?{doubleValue:NaN}:"integerValue"in a||"doubleValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in a?{stringValue:""}:"stringValue"in a?{bytesValue:""}:"bytesValue"in a?hb(nb.empty(),O_.empty()):"referenceValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in a?{arrayValue:{}}:"arrayValue"in a?{mapValue:{}}:"mapValue"in a?rb:h_(),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=rb}0<wb({value:i,inclusive:s},{value:e,inclusive:t})&&(i=e,s=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];0<wb({value:i,inclusive:s},{value:t,inclusive:r.inclusive})&&(i=t,s=r.inclusive);break}return{value:i,inclusive:s}}class Xb{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.dt=null,this.wt=null,this.startAt,this.endAt}}function Zb(e,t,n,r,i,s,a,o){return new Xb(e,t,n,r,i,s,a,o)}function eI(e){return new Xb(e)}function tI(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function nI(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function rI(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function iI(e){return null!==e.collectionGroup}function sI(t){const n=t;if(null===n.dt){n.dt=[];const t=rI(n),e=nI(n);if(null!==t&&null===e)t.isKeyField()||n.dt.push(new Sb(t)),n.dt.push(new Sb(P_.keyField(),"asc"));else{let e=!1;for(const r of n.explicitOrderBy)n.dt.push(r),r.field.isKeyField()&&(e=!0);if(!e){const t=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n.dt.push(new Sb(P_.keyField(),t))}}}return n.dt}function aI(e){const t=e;if(!t.wt)if("F"===t.limitType)t.wt=Kb(t.path,t.collectionGroup,sI(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const i of sI(t)){const t="desc"===i.dir?"asc":"desc";e.push(new Sb(i.field,t))}var n=t.endAt?new Tb(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Tb(t.startAt.position,t.startAt.inclusive):null;t.wt=Kb(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.wt}function oI(e,t){t.getFirstInequalityField(),rI(e);var n=e.filters.concat([t]);return new Xb(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function cI(e,t,n){return new Xb(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function lI(e,t){return Gb(aI(e),aI(t))&&e.limitType===t.limitType}function uI(e){return`${Wb(aI(e))}|lt:${e.limitType}`}function hI(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>Mb(e)).join(", ")}]`),aw(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>ub(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>ub(e)).join(",")),`Target(${t})`}(aI(e))}; limitType=${e.limitType})`}function dI(n,e){return e.isFoundDocument()&&(i=n,a=(s=e).key.path,null!==i.collectionGroup?s.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(a):O_.isDocumentKey(i.path)?i.path.isEqual(a):i.path.isImmediateParentOf(a))&&function(e){for(const t of sI(n))if(!t.field.isKeyField()&&null===e.data.field(t.field))return;return 1}(e)&&function(e){for(const t of n.filters)if(!t.matches(e))return;return 1}(e)&&(i=e,(!(e=n).startAt||(t=e.startAt,r=Eb(t,sI(e),i),t.inclusive?r<=0:r<0))&&(!e.endAt||(t=e.endAt,r=Eb(t,sI(e),i),t.inclusive?0<=r:0<r)));var t,r,i,s,a}function pI(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function fI(i){return(e,t)=>{let n=!1;for(const r of sI(i)){const i=function(e,i,t){var n=e.field.isKeyField()?O_.comparator(i.key,t.key):function(e,t){var n=i.data.field(e),r=t.data.field(e);return null!==n&&null!==r?cb(n,r):h_()}(e.field,t);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return h_()}}(r,e,t);if(0!==i)return i;n=n||r.field.isKeyField()}return 0}}class gI{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(r){Uw(this.inner,(e,t)=>{for(const[e,n]of t)r(e,n)})}isEmpty(){return qw(this.inner)}size(){return this.innerSize}}const mI=new Vw(O_.comparator);const vI=new Vw(O_.comparator);function yI(...e){let t=vI;for(const n of e)t=t.insert(n.key,n);return t}function _I(e){let n=vI;return e.forEach((e,t)=>n=n.insert(e,t.overlayedDocument)),n}function wI(){return new gI(e=>e.toString(),(e,t)=>e.isEqual(t))}const bI=new Vw(O_.comparator),II=new zw(O_.comparator);function TI(...e){let t=II;for(const n of e)t=t.add(n);return t}const EI=new zw(k_);function kI(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ow(t)?"-0":t}}function SI(e){return{integerValue:""+e}}function CI(e,t){return cw(t)?SI(t):kI(e,t)}class NI{constructor(){this._=void 0}}function AI(e,t){return e instanceof MI?db(n=t)||n&&"doubleValue"in n?t:{integerValue:0}:null;var n}class RI extends NI{}class DI extends NI{constructor(e){super(),this.elements=e}}function xI(e,t){const n=FI(t);for(const t of e.elements)n.some(e=>ab(e,t))||n.push(t);return{arrayValue:{values:n}}}class PI extends NI{constructor(e){super(),this.elements=e}}function OI(e,t){let n=FI(t);for(const t of e.elements)n=n.filter(e=>!ab(e,t));return{arrayValue:{values:n}}}class MI extends NI{constructor(e,t){super(),this.serializer=e,this._t=t}}function LI(e){return Jw(e.integerValue||e.doubleValue)}function FI(e){return pb(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class UI{constructor(e,t){this.field=e,this.transform=t}}class qI{constructor(e,t){this.version=e,this.transformResults=t}}class VI{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new VI}static exists(e){return new VI(void 0,e)}static updateTime(e){return new VI(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function BI(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class jI{}function zI(e,n){if(!e.hasLocalMutations||n&&0===n.fields.length)return null;if(null===n)return e.isNoDocument()?new XI(e.key,VI.none()):new GI(e.key,e.data,VI.none());{const i=e.data,s=bb.empty();let t=new zw(P_.comparator);for(var r of n.fields)if(!t.has(r)){let e=i.field(r);null===e&&1<r.length&&(r=r.popLast(),e=i.field(r)),null===e?s.delete(r):s.set(r,e),t=t.add(r)}return new HI(e.key,s,new Ww(t.toArray()),VI.none())}}function $I(e,t,n){e instanceof GI?function(e,t,n){const r=e.value.clone(),i=YI(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof HI?function(e,t,n){if(!BI(e.precondition,t))return t.convertToUnknownDocument(n.version);const r=YI(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(QI(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function KI(e,t,n,r){return e instanceof GI?function(e,t,n,r){if(!BI(e.precondition,t))return n;const i=e.value.clone(),s=JI(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof HI?function(e,t,n,r){if(!BI(e.precondition,t))return n;const i=JI(e.fieldTransforms,r,t),s=t.data;return s.setAll(QI(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):(t=t,n=n,BI(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n)}function WI(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&S_(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof DI&&t instanceof DI||e instanceof PI&&t instanceof PI?S_(e.elements,t.elements,ab):e instanceof MI&&t instanceof MI?ab(e._t,t._t):e instanceof RI&&t instanceof RI)}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}class GI extends jI{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class HI extends jI{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function QI(n){const r=new Map;return n.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=n.data.field(e),r.set(e,t))}),r}function YI(e,t,n){const r=new Map;d_(e.length===n.length);for(let u=0;u<n.length;u++){var i=e[u],s=i.transform,a=t.data.field(i.field);r.set(i.field,(o=s,c=a,l=n[u],o instanceof DI?xI(o,c):o instanceof PI?OI(o,c):l))}var o,c,l;return r}function JI(e,t,n){const r=new Map;for(const l of e){const e=l.transform,u=n.data.field(l.field);r.set(l.field,(i=e,s=u,a=t,c=o=void 0,i instanceof RI?function(){const e={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return s&&(e.fields.__previous_value__=s),{mapValue:e}}():i instanceof DI?xI(i,s):i instanceof PI?OI(i,s):(o=AI(i=i,s),c=LI(o)+LI(i._t),db(o)&&db(i._t)?SI(c):kI(i.serializer,c))))}var i,s,a,o,c;return r}class XI extends jI{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ZI extends jI{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class eT{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){var n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&$I(i,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=KI(n,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=KI(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(s,a){const o=wI();return this.mutations.forEach(e=>{const t=s.get(e.key),n=t.overlayedDocument;let r=this.applyToLocalView(n,t.mutatedFields);r=a.has(e.key)?null:r;var i=zI(n,r);null!==i&&o.set(e.key,i),n.isValidDocument()||n.convertToNoDocument(A_.min())}),o}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),TI())}isEqual(e){return this.batchId===e.batchId&&S_(this.mutations,e.mutations,(e,t)=>WI(e,t))&&S_(this.baseMutations,e.baseMutations,(e,t)=>WI(e,t))}}class tT{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){d_(e.mutations.length===n.length);let r=bI;var i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new tT(e,t,n,r)}}class nT{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class rT{constructor(e){this.count=e}}function iT(e){switch(e){default:return h_(),0;case p_.CANCELLED:case p_.UNKNOWN:case p_.DEADLINE_EXCEEDED:case p_.RESOURCE_EXHAUSTED:case p_.INTERNAL:case p_.UNAVAILABLE:case p_.UNAUTHENTICATED:return;case p_.INVALID_ARGUMENT:case p_.NOT_FOUND:case p_.ALREADY_EXISTS:case p_.PERMISSION_DENIED:case p_.FAILED_PRECONDITION:case p_.ABORTED:case p_.OUT_OF_RANGE:case p_.UNIMPLEMENTED:case p_.DATA_LOSS:return 1}}function sT(e){if(void 0===e)return c_("GRPC error has no .code"),p_.UNKNOWN;switch(e){case Wy.OK:return p_.OK;case Wy.CANCELLED:return p_.CANCELLED;case Wy.UNKNOWN:return p_.UNKNOWN;case Wy.DEADLINE_EXCEEDED:return p_.DEADLINE_EXCEEDED;case Wy.RESOURCE_EXHAUSTED:return p_.RESOURCE_EXHAUSTED;case Wy.INTERNAL:return p_.INTERNAL;case Wy.UNAVAILABLE:return p_.UNAVAILABLE;case Wy.UNAUTHENTICATED:return p_.UNAUTHENTICATED;case Wy.INVALID_ARGUMENT:return p_.INVALID_ARGUMENT;case Wy.NOT_FOUND:return p_.NOT_FOUND;case Wy.ALREADY_EXISTS:return p_.ALREADY_EXISTS;case Wy.PERMISSION_DENIED:return p_.PERMISSION_DENIED;case Wy.FAILED_PRECONDITION:return p_.FAILED_PRECONDITION;case Wy.ABORTED:return p_.ABORTED;case Wy.OUT_OF_RANGE:return p_.OUT_OF_RANGE;case Wy.UNIMPLEMENTED:return p_.UNIMPLEMENTED;case Wy.DATA_LOSS:return p_.DATA_LOSS;default:return h_()}}(It=Wy=Wy||{})[It.OK=0]="OK",It[It.CANCELLED=1]="CANCELLED",It[It.UNKNOWN=2]="UNKNOWN",It[It.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",It[It.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",It[It.NOT_FOUND=5]="NOT_FOUND",It[It.ALREADY_EXISTS=6]="ALREADY_EXISTS",It[It.PERMISSION_DENIED=7]="PERMISSION_DENIED",It[It.UNAUTHENTICATED=16]="UNAUTHENTICATED",It[It.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",It[It.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",It[It.ABORTED=10]="ABORTED",It[It.OUT_OF_RANGE=11]="OUT_OF_RANGE",It[It.UNIMPLEMENTED=12]="UNIMPLEMENTED",It[It.INTERNAL=13]="INTERNAL",It[It.UNAVAILABLE=14]="UNAVAILABLE",It[It.DATA_LOSS=15]="DATA_LOSS";class aT{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return oT}static getOrCreateInstance(){return null===oT&&(oT=new aT),oT}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(t){this.onExistenceFilterMismatchCallbacks.forEach(e=>e(t))}}let oT=null;class cT{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,lT.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new cT(A_.min(),r,EI,mI,TI())}}class lT{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new lT(n,t,TI(),TI(),TI())}}class uT{constructor(e,t,n,r){this.It=e,this.removedTargetIds=t,this.key=n,this.Tt=r}}class hT{constructor(e,t){this.targetId=e,this.Et=t}}class dT{constructor(e,t,n=Hw.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class pT{constructor(){this.At=0,this.Rt=mT(),this.vt=Hw.EMPTY_BYTE_STRING,this.bt=!1,this.Pt=!0}get current(){return this.bt}get resumeToken(){return this.vt}get Vt(){return 0!==this.At}get St(){return this.Pt}Dt(e){0<e.approximateByteSize()&&(this.Pt=!0,this.vt=e)}Ct(){let n=TI(),r=TI(),i=TI();return this.Rt.forEach((e,t)=>{switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:i=i.add(e);break;default:h_()}}),new lT(this.vt,this.bt,n,r,i)}xt(){this.Pt=!1,this.Rt=mT()}Nt(e,t){this.Pt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.Pt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}$t(){--this.At}Mt(){this.Pt=!0,this.bt=!0}}class fT{constructor(e){this.Ft=e,this.Bt=new Map,this.Lt=mI,this.qt=gT(),this.Ut=new zw(k_)}Kt(e){for(const t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(const n of e.removedTargetIds)this.Qt(n,e.key,e.Tt)}zt(n){this.forEachTarget(n,e=>{const t=this.jt(e);switch(n.state){case 0:this.Wt(e)&&t.Dt(n.resumeToken);break;case 1:t.$t(),t.Vt||t.xt(),t.Dt(n.resumeToken);break;case 2:t.$t(),t.Vt||this.removeTarget(e);break;case 3:this.Wt(e)&&(t.Mt(),t.Dt(n.resumeToken));break;case 4:this.Wt(e)&&(this.Ht(e),t.Dt(n.resumeToken));break;default:h_()}})}forEachTarget(e,n){0<e.targetIds.length?e.targetIds.forEach(n):this.Bt.forEach((e,t)=>{this.Wt(t)&&n(t)})}Jt(e){const t=e.targetId,n=e.Et.count,r=this.Yt(t);if(r){var i=r.target;if(Hb(i))if(0===n){const e=new O_(i.path);this.Qt(t,e,Ib.newNoDocument(e,A_.min()))}else d_(1===n);else{const r=this.Zt(t);r!==n&&(this.Ht(t),this.Ut=this.Ut.add(t),null===(i=aT.instance)||void 0===i||i.notifyOnExistenceFilterMismatch({localCacheCount:r,existenceFilterCount:e.Et.count}))}}}Xt(r){const i=new Map;this.Bt.forEach((e,t)=>{var n=this.Yt(t);if(n){if(e.current&&Hb(n.target)){const i=new O_(n.target.path);null!==this.Lt.get(i)||this.te(t,i)||this.Qt(t,i,Ib.newNoDocument(i,r))}e.St&&(i.set(t,e.Ct()),e.xt())}});let s=TI();this.qt.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{var t=this.Yt(e);return!t||2===t.purpose||(n=!1)}),n&&(s=s.add(e))}),this.Lt.forEach((e,t)=>t.setReadTime(r));var e=new cT(r,i,this.Ut,this.Lt,s);return this.Lt=mI,this.qt=gT(),this.Ut=new zw(k_),e}Gt(e,t){var n;this.Wt(e)&&(n=this.te(e,t.key)?2:0,this.jt(e).Nt(t.key,n),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e)))}Qt(e,t,n){if(this.Wt(e)){const r=this.jt(e);this.te(e,t)?r.Nt(t,1):r.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),n&&(this.Lt=this.Lt.insert(t,n))}}removeTarget(e){this.Bt.delete(e)}Zt(e){var t=this.jt(e).Ct();return this.Ft.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.jt(e).Ot()}jt(e){let t=this.Bt.get(e);return t||(t=new pT,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new zw(k_),this.qt=this.qt.insert(e,t)),t}Wt(e){var t=null!==this.Yt(e);return t||o_("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){var t=this.Bt.get(e);return t&&t.Vt?null:this.Ft.ne(e)}Ht(t){this.Bt.set(t,new pT),this.Ft.getRemoteKeysForTarget(t).forEach(e=>{this.Qt(t,e,null)})}te(e,t){return this.Ft.getRemoteKeysForTarget(e).has(t)}}function gT(){return new Vw(O_.comparator)}function mT(){return new Vw(O_.comparator)}const vT={asc:"ASCENDING",desc:"DESCENDING"},yT={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},_T={and:"AND",or:"OR"};class wT{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function bT(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function IT(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function TT(e){return d_(!!e),A_.fromTimestamp((t=Yw(e),new N_(t.seconds,t.nanos)));var t}function ET(e,t){return e=e,new D_(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function kT(e){var t=D_.fromString(e);return d_(zT(t)),t}function ST(e,t){return ET(e.databaseId,t.path)}function CT(e,t){const n=kT(t);if(n.get(1)!==e.databaseId.projectId)throw new f_(p_.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new f_(p_.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new O_(DT(n))}function NT(e,t){return ET(e.databaseId,t)}function AT(e){var t=kT(e);return 4===t.length?D_.emptyPath():DT(t)}function RT(e){return new D_(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function DT(e){return d_(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function xT(e,t,n){return{name:ST(e,t),fields:n.value.mapValue.fields}}function PT(e,t,n){const r=CT(e,t.name),i=TT(t.updateTime),s=t.createTime?TT(t.createTime):A_.min(),a=new bb({mapValue:{fields:t.fields}}),o=Ib.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function OT(e,t){let n;if(t instanceof GI)n={update:xT(e,t.key,t.value)};else if(t instanceof XI)n={delete:ST(e,t.key)};else if(t instanceof HI)n={update:xT(e,t.key,t.data),updateMask:function(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof ZI))return h_();n={verify:ST(e,t.key)}}return 0<t.fieldTransforms.length&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e){var t=e.transform;if(t instanceof RI)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof DI)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof PI)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof MI)return{fieldPath:e.field.canonicalString(),increment:t._t};throw h_()}(e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:(t=r.updateTime,bT(e,t.toTimestamp()))}:void 0!==r.exists?{exists:r.exists}:h_()),n;var r}function MT(t,n){const e=n.currentDocument?void 0!==(i=n.currentDocument).updateTime?VI.updateTime(TT(i.updateTime)):void 0!==i.exists?VI.exists(i.exists):VI.none():VI.none(),r=n.updateTransforms?n.updateTransforms.map(e=>function(e,t){let n=null;if("setToServerValue"in t)d_("REQUEST_TIME"===t.setToServerValue),n=new RI;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new DI(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new PI(e)}else"increment"in t?n=new MI(e,t.increment):h_();var r=P_.fromServerFormat(t.fieldPath);return new UI(r,n)}(t,e)):[];var i;if(n.update){n.update.name;var s=CT(t,n.update.name),a=new bb({mapValue:{fields:n.update.fields}});if(n.updateMask){const t=function(){const e=n.updateMask.fieldPaths||[];return new Ww(e.map(e=>P_.fromServerFormat(e)))}();return new HI(s,a,t,e,r)}return new GI(s,a,e,r)}if(n.delete){const r=CT(t,n.delete);return new XI(r,e)}if(n.verify){const r=CT(t,n.verify);return new ZI(r,e)}return h_()}function LT(e,t){return{documents:[NT(e,t.path)]}}function FT(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=NT(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=NT(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length)return function n(e){return e instanceof Nb?function(e){if("=="===e.op){if(gb(e.value))return{unaryFilter:{field:BT(e.field),op:"IS_NAN"}};if(fb(e.value))return{unaryFilter:{field:BT(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(gb(e.value))return{unaryFilter:{field:BT(e.field),op:"IS_NOT_NAN"}};if(fb(e.value))return{unaryFilter:{field:BT(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:BT(e.field),op:qT(e.op),value:e.value}}}(e):e instanceof Ab?function(e){const t=e.getFilters().map(e=>n(e));return 1===t.length?t[0]:{compositeFilter:{op:VT(e.op),filters:t}}}(e):h_()}(Ab.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);i=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:BT(e.field),direction:(e=e.dir,vT[e])}}(e))}(t.orderBy);i&&(n.structuredQuery.orderBy=i);var s,i=(s=t.limit,e.useProto3Json||aw(s)?s:{value:s});return null!==i&&(n.structuredQuery.limit=i),t.startAt&&(n.structuredQuery.startAt={before:(i=t.startAt).inclusive,values:i.position}),t.endAt&&(n.structuredQuery.endAt={before:!(t=t.endAt).inclusive,values:t.position}),n}function UT(e){let t=AT(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(0<r){d_(1===r);const f=n.from[0];f.allDescendants?i=f.collectionId:t=t.child(f.collectionId)}let s=[];n.where&&(s=function(){const e=function t(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=jT(e.unaryFilter.field);return Nb.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=jT(e.unaryFilter.field);return Nb.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=jT(e.unaryFilter.field);return Nb.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=jT(e.unaryFilter.field);return Nb.create(i,"!=",{nullValue:"NULL_VALUE"});default:return h_()}}(e):void 0!==e.fieldFilter?function(e){return Nb.create(jT(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return h_()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Ab.create(e.compositeFilter.filters.map(e=>t(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return h_()}}(e.compositeFilter.op))}(e):h_()}(n.where);return e instanceof Ab&&xb(e)?e.getFilters():[e]}());let a=[];n.orderBy&&(a=n.orderBy.map(e=>function(e){return new Sb(jT(e.field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())}(e)));let o=null;var c,l,u,h;n.limit&&(o=(e=n.limit,aw(c="object"==typeof e?e.value:e)?null:c));let d=null;n.startAt&&(d=(l=n.startAt,h=!!l.before,u=l.values||[],new Tb(u,h)));let p=null;return n.endAt&&(p=(l=n.endAt,u=!l.before,h=l.values||[],new Tb(h,u))),Zb(t,i,a,s,o,"F",d,p)}function qT(e){return yT[e]}function VT(e){return _T[e]}function BT(e){return{fieldPath:e.canonicalString()}}function jT(e){return P_.fromServerFormat(e.fieldPath)}function zT(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}class $T{constructor(e,t,n,r,i=A_.min(),s=A_.min(),a=Hw.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a}withSequenceNumber(e){return new $T(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new $T(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new $T(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class KT{constructor(e){this.se=e}}function WT(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:GT(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document={name:ST(i=e.se,(e=t).key),fields:e.data.value.mapValue.fields,updateTime:bT(i,e.version.toTimestamp()),createTime:bT(i,e.createTime.toTimestamp())};else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:HT(t.version)};else{if(!t.isUnknownDocument())return h_();r.unknownDocument={path:n.path.toArray(),version:HT(t.version)}}var i;return r}function GT(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function HT(e){var t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function QT(e){var t=new N_(e.seconds,e.nanoseconds);return A_.fromTimestamp(t)}function YT(t,e){const n=(e.baseMutations||[]).map(e=>MT(t.se,e));for(let s=0;s<e.mutations.length-1;++s){const n=e.mutations[s];if(s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform){const r=e.mutations[s+1];n.updateTransforms=r.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}const r=e.mutations.map(e=>MT(t.se,e)),i=N_.fromMillis(e.localWriteTimeMs);return new eT(e.batchId,i,n,r)}function JT(e){var t,n=QT(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?QT(e.lastLimboFreeSnapshotVersion):A_.min();let i;return i=void 0!==e.query.documents?(d_(1===(t=e.query).documents.length),aI(eI(AT(t.documents[0])))):aI(UT(e.query)),new $T(i,e.targetId,0,e.lastListenSequenceNumber,n,r,Hw.fromBase64String(e.resumeToken))}function XT(e,t){var n=HT(t.snapshotVersion),r=HT(t.lastLimboFreeSnapshotVersion),i=(Hb(t.target)?LT:FT)(e.se,t.target),s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Wb(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function ZT(e){var t=UT({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?cI(t,t.limit,"L"):t}function eE(e,t){return new nT(t.largestBatchId,MT(e.se,t.overlayMutation))}function tE(e,t){var n=t.path.lastSegment();return[e,lw(t.path.popLast()),n]}function nE(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:HT(r.readTime),documentKey:lw(r.documentKey.path),largestBatchId:r.largestBatchId}}class rE{getBundleMetadata(e,t){return iE(e).get(t).next(e=>{if(e)return{id:(t=e).bundleId,createTime:QT(t.createTime),version:t.version};var t})}saveBundleMetadata(e,t){return iE(e).put({bundleId:(n=t).id,createTime:HT(TT(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return sE(e).get(t).next(e=>{if(e)return{name:(t=e).name,query:ZT(t.bundledQuery),readTime:QT(t.readTime)};var t})}saveNamedQuery(e,t){return sE(e).put({name:(t=t).name,readTime:HT(TT(t.readTime)),bundledQuery:t.bundledQuery})}}function iE(e){return Lw(e,"bundles")}function sE(e){return Lw(e,"namedQueries")}class aE{constructor(e,t){this.serializer=e,this.userId=t}static ie(e,t){var n=t.uid||"";return new aE(e,n)}getOverlay(e,t){return oE(e).get(tE(this.userId,t)).next(e=>e?eE(this.serializer,e):null)}getOverlays(e,t){const n=wI();return G_.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(r,i,e){const s=[];return e.forEach((e,t)=>{var n=new nT(i,t);s.push(this.re(r,n))}),G_.waitFor(s)}removeOverlaysForBatchId(n,e,r){const t=new Set;e.forEach(e=>t.add(lw(e.getCollectionPath())));const i=[];return t.forEach(e=>{var t=IDBKeyRange.bound([this.userId,e,r],[this.userId,e,r+1],!1,!0);i.push(oE(n).J("collectionPathOverlayIndex",t))}),G_.waitFor(i)}getOverlaysForCollection(e,t,n){const r=wI(),i=lw(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return oE(e).j("collectionPathOverlayIndex",s).next(e=>{for(const t of e){const e=eE(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,i){const s=wI();let a;var r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return oE(e).Z({index:"collectionGroupOverlayIndex",range:r},(e,t,n)=>{const r=eE(this.serializer,t);s.size()<i||r.largestBatchId===a?(s.set(r.getKey(),r),a=r.largestBatchId):n.done()}).next(()=>s)}re(e,t){return oE(e).put(function(e,t,n){var[,r,i]=tE(t,n.mutation.key);return{userId:t,collectionPath:r,documentId:i,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:OT(e.se,n.mutation)}}(this.serializer,this.userId,t))}}function oE(e){return Lw(e,"documentOverlays")}class cE{constructor(){}oe(e,t){this.ue(e,t),t.ce()}ue(e,t){var n,r;"nullValue"in e?this.ae(t,5):"booleanValue"in e?(this.ae(t,10),t.he(e.booleanValue?1:0)):"integerValue"in e?(this.ae(t,15),t.he(Jw(e.integerValue))):"doubleValue"in e?(n=Jw(e.doubleValue),isNaN(n)?this.ae(t,13):(this.ae(t,15),ow(n)?t.he(0):t.he(n))):"timestampValue"in e?(r=e.timestampValue,this.ae(t,20),"string"==typeof r?t.le(r):(t.le(`${r.seconds||""}`),t.he(r.nanos||0))):"stringValue"in e?(this.fe(e.stringValue,t),this.de(t)):"bytesValue"in e?(this.ae(t,30),t.we(Xw(e.bytesValue)),this.de(t)):"referenceValue"in e?this._e(e.referenceValue,t):"geoPointValue"in e?(r=e.geoPointValue,this.ae(t,45),t.he(r.latitude||0),t.he(r.longitude||0)):"mapValue"in e?yb(e)?this.ae(t,Number.MAX_SAFE_INTEGER):(this.me(e.mapValue,t),this.de(t)):"arrayValue"in e?(this.ge(e.arrayValue,t),this.de(t)):h_()}fe(e,t){this.ae(t,25),this.ye(e,t)}ye(e,t){t.le(e)}me(e,t){var n=e.fields||{};this.ae(t,55);for(const e of Object.keys(n))this.fe(e,t),this.ue(n[e],t)}ge(e,t){var n=e.values||[];this.ae(t,50);for(const e of n)this.ue(e,t)}_e(e,t){this.ae(t,37),O_.fromName(e).path.forEach(e=>{this.ae(t,60),this.ye(e,t)})}ae(e,t){e.he(t)}de(e){e.he(2)}}function lE(e){var t=64-function(e){let t=0;for(let r=0;r<8;++r){var n=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e);return Math.ceil(t/8)}cE.pe=new cE;class uE{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ie(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Te(n.value),n=t.next();this.Ee()}Ae(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Re(n.value),n=t.next();this.ve()}be(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Te(e);else if(e<2048)this.Te(960|e>>>6),this.Te(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Te(480|e>>>12),this.Te(128|63&e>>>6),this.Te(128|63&e);else{const e=t.codePointAt(0);this.Te(240|e>>>18),this.Te(128|63&e>>>12),this.Te(128|63&e>>>6),this.Te(128|63&e)}}this.Ee()}Pe(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Re(e);else if(e<2048)this.Re(960|e>>>6),this.Re(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Re(480|e>>>12),this.Re(128|63&e>>>6),this.Re(128|63&e);else{const e=t.codePointAt(0);this.Re(240|e>>>18),this.Re(128|63&e>>>12),this.Re(128|63&e>>>6),this.Re(128|63&e)}}this.ve()}Ve(e){var t=this.Se(e),n=lE(t);this.De(1+n),this.buffer[this.position++]=255&n;for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}Ce(e){var t=this.Se(e),n=lE(t);this.De(1+n),this.buffer[this.position++]=~(255&n);for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}xe(){this.Ne(255),this.Ne(255)}ke(){this.Oe(255),this.Oe(255)}reset(){this.position=0}seed(e){this.De(e.length),this.buffer.set(e,this.position),this.position+=e.length}$e(){return this.buffer.slice(0,this.position)}Se(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let r=1;r<t.length;++r)t[r]^=n?255:0;return t}Te(e){var t=255&e;0==t?(this.Ne(0),this.Ne(255)):255==t?(this.Ne(255),this.Ne(0)):this.Ne(t)}Re(e){var t=255&e;0==t?(this.Oe(0),this.Oe(255)):255==t?(this.Oe(255),this.Oe(0)):this.Oe(e)}Ee(){this.Ne(0),this.Ne(1)}ve(){this.Oe(0),this.Oe(1)}Ne(e){this.De(1),this.buffer[this.position++]=e}Oe(e){this.De(1),this.buffer[this.position++]=~e}De(e){var t=e+this.position;if(!(t<=this.buffer.length)){let e=2*this.buffer.length;e<t&&(e=t);const n=new Uint8Array(e);n.set(this.buffer),this.buffer=n}}}class hE{constructor(e){this.Me=e}we(e){this.Me.Ie(e)}le(e){this.Me.be(e)}he(e){this.Me.Ve(e)}ce(){this.Me.xe()}}class dE{constructor(e){this.Me=e}we(e){this.Me.Ae(e)}le(e){this.Me.Pe(e)}he(e){this.Me.Ce(e)}ce(){this.Me.ke()}}class pE{constructor(){this.Me=new uE,this.Fe=new hE(this.Me),this.Be=new dE(this.Me)}seed(e){this.Me.seed(e)}Le(e){return 0===e?this.Fe:this.Be}$e(){return this.Me.$e()}reset(){this.Me.reset()}}class fE{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}qe(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new fE(this.indexId,this.documentKey,this.arrayValue,n)}}function gE(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=mE(e.arrayValue,t.arrayValue),0!==n?n:(n=mE(e.directionalValue,t.directionalValue),0!==n?n:O_.comparator(e.documentKey,t.documentKey)))}function mE(e,t){for(let r=0;r<e.length&&r<t.length;++r){var n=e[r]-t[r];if(0!=n)return n}return e.length-t.length}class vE{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ue=e.orderBy,this.Ke=[];for(const t of e.filters){const e=t;e.isInequality()?this.Ge=e:this.Ke.push(e)}}Qe(e){d_(e.collectionGroup===this.collectionId);var t=L_(e);if(void 0!==t&&!this.ze(t))return!1;var n=F_(e);let r=0,i=0;for(;r<n.length&&this.ze(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.Ge){const e=n[r];if(!this.je(this.Ge,e)||!this.We(this.Ue[i++],e))return!1;++r}for(;r<n.length;++r){const e=n[r];if(i>=this.Ue.length||!this.We(this.Ue[i++],e))return!1}return!0}ze(e){for(const t of this.Ke)if(this.je(t,e))return!0;return!1}je(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;var n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind==n}We(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function yE(e){if(0===e.getFilters().length)return[];const t=function t(e){if(d_(e instanceof Nb||e instanceof Ab),e instanceof Nb)return e;if(1===e.filters.length)return t(e.filters[0]);const n=e.filters.map(e=>t(e));let r=Ab.create(n,e.op);return r=EE(r),bE(r)?r:(d_(r instanceof Ab),d_(Rb(r)),d_(1<r.filters.length),r.filters.reduce((e,t)=>IE(e,t)))}(function t(n){var e;if(d_(n instanceof Nb||n instanceof Ab),n instanceof Nb){if(n instanceof Bb){const r=(null===(e=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===e?void 0:e.map(e=>Nb.create(n.field,"==",e)))||[];return Ab.create(r,"or")}return n}const r=n.filters.map(e=>t(e));return Ab.create(r,n.op)}(e));return d_(bE(t)),_E(t)||wE(t)?[t]:t.getFilters()}function _E(e){return e instanceof Nb}function wE(e){return e instanceof Ab&&xb(e)}function bE(e){return _E(e)||wE(e)||function(e){if(e instanceof Ab&&Db(e)){for(const t of e.getFilters())if(!_E(t)&&!wE(t))return!1;return!0}return!1}(e)}function IE(e,t){var n,r;return d_(e instanceof Nb||e instanceof Ab),d_(t instanceof Nb||t instanceof Ab),EE(e instanceof Nb?t instanceof Nb?(n=e,r=t,Ab.create([n,r],"and")):TE(e,t):t instanceof Nb?TE(t,e):function(e,t){if(d_(0<e.filters.length&&0<t.filters.length),Rb(e)&&Rb(t))return Ob(e,t.getFilters());const n=Db(e)?e:t,r=Db(e)?t:e,i=n.filters.map(e=>IE(e,r));return Ab.create(i,"or")}(e,t))}function TE(t,e){if(Rb(e))return Ob(e,t.getFilters());var n=e.filters.map(e=>IE(t,e));return Ab.create(n,"or")}function EE(t){if(d_(t instanceof Nb||t instanceof Ab),t instanceof Nb)return t;const e=t.getFilters();if(1===e.length)return EE(e[0]);if(Pb(t))return t;const n=e.map(e=>EE(e)),r=[];return n.forEach(e=>{e instanceof Nb?r.push(e):e instanceof Ab&&(e.op===t.op?r.push(...e.filters):r.push(e))}),1===r.length?r[0]:Ab.create(r,t.op)}class kE{constructor(){this.He=new SE}addToCollectionParentIndex(e,t){return this.He.add(t),G_.resolve()}getCollectionParents(e,t){return G_.resolve(this.He.getEntries(t))}addFieldIndex(e,t){return G_.resolve()}deleteFieldIndex(e,t){return G_.resolve()}getDocumentsMatchingTarget(e,t){return G_.resolve(null)}getIndexType(e,t){return G_.resolve(0)}getFieldIndexes(e,t){return G_.resolve([])}getNextCollectionGroupToUpdate(e){return G_.resolve(null)}getMinOffset(e,t){return G_.resolve(j_.min())}getMinOffsetFromCollectionGroup(e,t){return G_.resolve(j_.min())}updateCollectionGroup(e,t,n){return G_.resolve()}updateIndexEntries(e,t){return G_.resolve()}}class SE{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new zw(D_.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new zw(D_.comparator)).toArray()}}const CE=new Uint8Array(0);class NE{constructor(e,t){this.user=e,this.databaseId=t,this.Je=new SE,this.Ye=new gI(e=>Wb(e),(e,t)=>Gb(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(this.Je.has(t))return G_.resolve();var n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Je.add(t)});r={collectionId:n,parent:lw(r)};return AE(e).put(r)}getCollectionParents(e,n){const r=[],t=IDBKeyRange.bound([n,""],[C_(n),""],!1,!0);return AE(e).j(t).next(e=>{for(const t of e){if(t.collectionId!==n)break;r.push(hw(t.parent))}return r})}addFieldIndex(e,t){const n=DE(e),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;const i=n.add(r);if(t.indexState){const n=xE(e);return i.next(e=>{n.put(nE(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const n=DE(e),r=xE(e),i=RE(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,l){const u=RE(e);let h=!0;const n=new Map;return G_.forEach(this.Ze(l),t=>this.Xe(e,t).next(e=>{h=h&&!!e,n.set(t,e)})).next(()=>{if(h){let c=TI();const h=[];return G_.forEach(n,(e,t)=>{o_("IndexedDbIndexManager",`Using index ${o=e,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`} to execute ${Wb(l)}`);var n=function(e,t){var n=L_(t);if(void 0===n)return null;for(const t of Qb(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(t,e),r=function(e,t){const n=new Map;for(const r of F_(t))for(const t of Qb(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(t,e),i=function(e,t){const n=[];let r=!0;for(const i of F_(t)){const t=(0===i.kind?Yb:Jb)(e,i.fieldPath,e.startAt);n.push(t.value),r=r&&t.inclusive}return new Tb(n,r)}(t,e),s=function(e,t){const n=[];let r=!0;for(const i of F_(t)){const t=(0===i.kind?Jb:Yb)(e,i.fieldPath,e.endAt);n.push(t.value),r=r&&t.inclusive}return new Tb(n,r)}(t,e),a=this.tn(e,t,i),o=this.tn(e,t,s),r=this.en(e,t,r),r=this.nn(e.indexId,n,a,i.inclusive,o,s.inclusive,r);return G_.forEach(r,e=>u.H(e,l.limit).next(e=>{e.forEach(e=>{var t=O_.fromSegments(e.documentKey);c.has(t)||(c=c.add(t),h.push(t))})}))}).next(()=>h)}return G_.resolve(null)})}Ze(t){let e=this.Ye.get(t);return e||(e=0===t.filters.length?[t]:yE(Ab.create(t.filters,"and")).map(e=>Kb(t.path,t.collectionGroup,t.orderBy,e.getFilters(),t.limit,t.startAt,t.endAt)),this.Ye.set(t,e),e)}nn(t,e,n,r,i,s,a){const o=(null!=e?e.length:1)*Math.max(n.length,i.length),c=o/(null!=e?e.length:1),l=[];for(let u=0;u<o;++u){const o=e?this.sn(e[u/c]):CE,h=this.rn(t,o,n[u%c],r),d=this.on(t,o,i[u%c],s),p=a.map(e=>this.rn(t,o,e,!0));l.push(...this.createRange(h,d,p))}return l}rn(e,t,n,r){const i=new fE(e,O_.empty(),t,n);return r?i:i.qe()}on(e,t,n,r){const i=new fE(e,O_.empty(),t,n);return r?i.qe():i}Xe(e,t){const r=new vE(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(const n of e)r.Qe(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let n=2;const r=this.Ze(t);return G_.forEach(r,t=>this.Xe(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new zw(P_.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&1<r.length&&2===n?1:n)}un(e,t){const n=new pE;for(const i of F_(e)){const e=t.data.field(i.fieldPath);if(null==e)return null;var r=n.Le(i.kind);cE.pe.oe(e,r)}return n.$e()}sn(e){const t=new pE;return cE.pe.oe(e,t.Le(0)),t.$e()}cn(e,t){const n=new pE;return cE.pe.oe(hb(this.databaseId,t),n.Le(0===(r=F_(e)).length?0:r[r.length-1].kind)),n.$e();var r}en(e,t,n){if(null===n)return[];let r=[];r.push(new pE);let i=0;for(const s of F_(e)){const e=n[i++];for(const n of r)if(this.an(t,s.fieldPath)&&pb(e))r=this.hn(r,s,e);else{const t=n.Le(s.kind);cE.pe.oe(e,t)}}return this.ln(r)}tn(e,t,n){return this.en(e,t,n.position)}ln(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].$e();return t}hn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new pE;r.seed(n.$e()),cE.pe.oe(e,r.Le(t.kind)),i.push(r)}return i}an(e,t){return!!e.filters.find(e=>e instanceof Nb&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){const n=DE(e),r=xE(e);return(t?n.j("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.j()).next(e=>{const s=[];return G_.forEach(e,i=>r.get([i.indexId,this.uid]).next(e=>{var t,n,r;s.push((t=i,n=(e=e)?new q_(e.sequenceNumber,new j_(QT(e.readTime),new O_(hw(e.documentKey)),e.largestBatchId)):q_.empty(),r=t.fields.map(([e,t])=>new U_(P_.fromServerFormat(e),t)),new M_(t.indexId,t.collectionGroup,r,n)))})).next(()=>s)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{var n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!=n?n:k_(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,n,r){const i=DE(e),s=xE(e);return this.fn(e).next(t=>i.j("collectionGroupIndex",IDBKeyRange.bound(n,n)).next(e=>G_.forEach(e,e=>s.put(nE(e.indexId,this.user,t,r)))))}updateIndexEntries(i,e){const n=new Map;return G_.forEach(e,(t,r)=>{var e=n.get(t.collectionGroup);return(e?G_.resolve(e):this.getFieldIndexes(i,t.collectionGroup)).next(e=>(n.set(t.collectionGroup,e),G_.forEach(e,n=>this.dn(i,t,n).next(e=>{var t=this.wn(r,n);return e.isEqual(t)?G_.resolve():this._n(i,r,n,e,t)}))))})}mn(e,t,n,r){return RE(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.cn(n,t.key),documentKey:t.key.path.toArray()})}gn(e,t,n,r){return RE(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.cn(n,t.key),t.key.path.toArray()])}dn(e,n,r){const t=RE(e);let i=new zw(gE);return t.Z({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.cn(r,n)])},(e,t)=>{i=i.add(new fE(r.indexId,n,t.arrayValue,t.directionalValue))}).next(()=>i)}wn(e,t){let n=new zw(gE);var r=this.un(t,e);if(null==r)return n;const i=L_(t);if(null!=i){var s=e.data.field(i.fieldPath);if(pb(s))for(const i of s.arrayValue.values||[])n=n.add(new fE(t.indexId,e.key,this.sn(i),r))}else n=n.add(new fE(t.indexId,e.key,CE,r));return n}_n(t,n,r,l,e){o_("IndexedDbIndexManager","Updating index entries for document '%s'",n.key);const i=[];return function(e,n,r,i){var s=l.getIterator(),a=e.getIterator();let o=Kw(s),c=Kw(a);for(;o||c;){let e=!1,t=!1;if(o&&c){const r=n(o,c);r<0?t=!0:0<r&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(c),c=Kw(a)):t?(i(o),o=Kw(s)):(o=Kw(s),c=Kw(a))}}(e,gE,e=>{i.push(this.mn(t,n,r,e))},e=>{i.push(this.gn(t,n,r,e))}),G_.waitFor(i)}fn(e){let r=1;return xE(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,t,n)=>{n.done(),r=t.sequenceNumber+1}).next(()=>r)}createRange(e,t,n){n=n.sort((e,t)=>gE(e,t)).filter((e,t,n)=>!t||0!==gE(e,n[t-1]));const r=[];r.push(e);for(const i of n){const n=gE(i,e),s=gE(i,t);if(0===n)r[0]=e.qe();else if(0<n&&s<0)r.push(i),r.push(i.qe());else if(0<s)break}r.push(t);const i=[];for(let a=0;a<r.length;a+=2){if(this.yn(r[a],r[a+1]))return[];const t=[r[a].indexId,this.uid,r[a].arrayValue,r[a].directionalValue,CE,[]],n=[r[a+1].indexId,this.uid,r[a+1].arrayValue,r[a+1].directionalValue,CE,[]];i.push(IDBKeyRange.bound(t,n))}return i}yn(e,t){return 0<gE(e,t)}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(PE)}getMinOffset(t,e){return G_.mapArray(this.Ze(e),e=>this.Xe(t,e).next(e=>e||h_())).next(PE)}}function AE(e){return Lw(e,"collectionParents")}function RE(e){return Lw(e,"indexEntries")}function DE(e){return Lw(e,"indexConfiguration")}function xE(e){return Lw(e,"indexState")}function PE(e){d_(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let i=1;i<e.length;i++){var r=e[i].indexState.offset;z_(r,t)<0&&(t=r),n<r.largestBatchId&&(n=r.largestBatchId)}return new j_(t.readTime,t.documentKey,n)}const OE={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class ME{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new ME(e,ME.DEFAULT_COLLECTION_PERCENTILE,ME.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function LE(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],a=IDBKeyRange.only(n.batchId);let o=0;const c=r.Z({range:a},(e,t,n)=>(o++,n.delete()));s.push(c.next(()=>{d_(1===o)}));const l=[];for(const e of n.mutations){const r=fw(t,e.key.path,n.batchId);s.push(i.delete(r)),l.push(e.key)}return G_.waitFor(s).next(()=>l)}function FE(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw h_();t=e.noDocument}return JSON.stringify(t).length}ME.DEFAULT_COLLECTION_PERCENTILE=10,ME.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ME.DEFAULT=new ME(41943040,ME.DEFAULT_COLLECTION_PERCENTILE,ME.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ME.DISABLED=new ME(-1,0,0);class UE{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.pn={}}static ie(e,t,n,r){d_(""!==e.uid);var i=e.isAuthenticated()?e.uid:"";return new UE(i,t,n,r)}checkEmpty(e){let r=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return VE(e).Z({index:"userMutationsIndex",range:t},(e,t,n)=>{r=!1,n.done()}).next(()=>r)}addMutationBatch(u,h,d,p){const f=BE(u),g=VE(u);return g.add({}).next(e=>{d_("number"==typeof e);const t=new eT(e,h,d,p),n=(i=this.serializer,s=this.userId,a=t,o=a.baseMutations.map(e=>OT(i.se,e)),c=a.mutations.map(e=>OT(i.se,e)),{userId:s,batchId:a.batchId,localWriteTimeMs:a.localWriteTime.toMillis(),baseMutations:o,mutations:c}),r=[];var i,s,a,o,c;let l=new zw((e,t)=>k_(e.canonicalString(),t.canonicalString()));for(const u of p){const h=fw(this.userId,u.key.path,e);l=l.add(u.key.path.popLast()),r.push(g.put(n)),r.push(f.put(h,gw))}return l.forEach(e=>{r.push(this.indexManager.addToCollectionParentIndex(u,e))}),u.addOnCommittedListener(()=>{this.pn[e]=t.keys()}),G_.waitFor(r).next(()=>t)})}lookupMutationBatch(e,t){return VE(e).get(t).next(e=>e?(d_(e.userId===this.userId),YT(this.serializer,e)):null)}In(e,n){return this.pn[n]?G_.resolve(this.pn[n]):this.lookupMutationBatch(e,n).next(e=>{if(e){var t=e.keys();return this.pn[n]=t}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return VE(e).Z({index:"userMutationsIndex",range:n},(e,t,n)=>{t.userId===this.userId&&(d_(t.batchId>=r),i=YT(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return VE(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return VE(e).j("userMutationsIndex",t).next(e=>e.map(e=>YT(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(a,o){const e=pw(this.userId,o.path),t=IDBKeyRange.lowerBound(e),c=[];return BE(a).Z({range:t},(e,t,n)=>{var[r,i,s]=e,i=hw(i);if(r===this.userId&&o.path.isEqual(i))return VE(a).get(s).next(e=>{if(!e)throw h_();d_(e.userId===this.userId),c.push(YT(this.serializer,e))});n.done()}).next(()=>c)}getAllMutationBatchesAffectingDocumentKeys(t,e){let o=new zw(k_);const n=[];return e.forEach(a=>{var e=pw(this.userId,a.path),e=IDBKeyRange.lowerBound(e),e=BE(t).Z({range:e},(e,t,n)=>{var[r,i,s]=e,i=hw(i);r===this.userId&&a.path.isEqual(i)?o=o.add(s):n.done()});n.push(e)}),G_.waitFor(n).next(()=>this.Tn(t,o))}getAllMutationBatchesAffectingQuery(e,t){const a=t.path,o=a.length+1,n=pw(this.userId,a),r=IDBKeyRange.lowerBound(n);let c=new zw(k_);return BE(e).Z({range:r},(e,t,n)=>{var[r,i,s]=e,i=hw(i);r===this.userId&&a.isPrefixOf(i)?i.length===o&&(c=c.add(s)):n.done()}).next(()=>this.Tn(e,c))}Tn(t,e){const n=[],r=[];return e.forEach(e=>{r.push(VE(t).get(e).next(e=>{if(null===e)throw h_();d_(e.userId===this.userId),n.push(YT(this.serializer,e))}))}),G_.waitFor(r).next(()=>n)}removeMutationBatch(t,n){return LE(t.at,this.userId,n).next(e=>(t.addOnCommittedListener(()=>{this.En(n.batchId)}),G_.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}En(e){delete this.pn[e]}performConsistencyCheck(n){return this.checkEmpty(n).next(e=>{if(!e)return G_.resolve();var t=IDBKeyRange.lowerBound([this.userId]);const r=[];return BE(n).Z({range:t},(e,t,n)=>{if(e[0]===this.userId){const t=hw(e[1]);r.push(t)}else n.done()}).next(()=>{d_(0===r.length)})})}containsKey(e,t){return qE(e,this.userId,t)}An(e){return jE(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function qE(e,s,t){const n=pw(s,t.path),a=n[1],r=IDBKeyRange.lowerBound(n);let o=!1;return BE(e).Z({range:r,Y:!0},(e,t,n)=>{var[r,i]=e;r===s&&i===a&&(o=!0),n.done()}).next(()=>o)}function VE(e){return Lw(e,"mutations")}function BE(e){return Lw(e,"documentMutations")}function jE(e){return Lw(e,"mutationQueues")}class zE{constructor(e){this.Rn=e}next(){return this.Rn+=2,this.Rn}static vn(){return new zE(0)}static bn(){return new zE(-1)}}class $E{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(n){return this.Pn(n).next(e=>{const t=new zE(e.highestTargetId);return e.highestTargetId=t.next(),this.Vn(n,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Pn(e).next(e=>A_.fromTimestamp(new N_(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Pn(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,n,r){return this.Pn(t).next(e=>(e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),this.Vn(t,e)))}addTargetData(t,n){return this.Sn(t,n).next(()=>this.Pn(t).next(e=>(e.targetCount+=1,this.Dn(n,e),this.Vn(t,e))))}updateTargetData(e,t){return this.Sn(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>KE(t).delete(e.targetId)).next(()=>this.Pn(t)).next(e=>(d_(0<e.targetCount),--e.targetCount,this.Vn(t,e)))}removeTargets(r,i,s){let a=0;const o=[];return KE(r).Z((e,t)=>{var n=JT(t);n.sequenceNumber<=i&&null===s.get(n.targetId)&&(a++,o.push(this.removeTargetData(r,n)))}).next(()=>G_.waitFor(o)).next(()=>a)}forEachTarget(e,r){return KE(e).Z((e,t)=>{var n=JT(t);r(n)})}Pn(e){return WE(e).get("targetGlobalKey").next(e=>(d_(null!==e),e))}Vn(e,t){return WE(e).put("targetGlobalKey",t)}Sn(e,t){return KE(e).put(XT(this.serializer,t))}Dn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Pn(e).next(e=>e.targetCount)}getTargetData(e,i){var t=Wb(i),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let s=null;return KE(e).Z({range:t,index:"queryTargetsIndex"},(e,t,n)=>{var r=JT(t);Gb(i,r.target)&&(s=r,n.done())}).next(()=>s)}addMatchingKeys(n,e,r){const i=[],s=GE(n);return e.forEach(e=>{var t=lw(e.path);i.push(s.put({targetId:r,path:t})),i.push(this.referenceDelegate.addReference(n,r,e))}),G_.waitFor(i)}removeMatchingKeys(n,e,r){const i=GE(n);return G_.forEach(e,e=>{var t=lw(e.path);return G_.waitFor([i.delete([r,t]),this.referenceDelegate.removeReference(n,r,e)])})}removeMatchingKeysForTargetId(e,t){const n=GE(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=GE(e);let i=TI();return r.Z({range:n,Y:!0},(e,t,n)=>{var r=hw(e[1]),r=new O_(r);i=i.add(r)}).next(()=>i)}containsKey(e,t){var n=lw(t.path),n=IDBKeyRange.bound([n],[C_(n)],!1,!0);let r=0;return GE(e).Z({index:"documentTargetsIndex",Y:!0,range:n},([e],t,n)=>{0!==e&&(r++,n.done())}).next(()=>0<r)}ne(e,t){return KE(e).get(t).next(e=>e?JT(e):null)}}function KE(e){return Lw(e,"targets")}function WE(e){return Lw(e,"targetGlobal")}function GE(e){return Lw(e,"targetDocuments")}function HE([e,t],[n,r]){var i=k_(e,n);return 0===i?k_(t,r):i}class QE{constructor(e){this.Cn=e,this.buffer=new zw(HE),this.xn=0}Nn(){return++this.xn}kn(e){var t=[e,this.Nn()];if(this.buffer.size<this.Cn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();HE(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class YE{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.On=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.$n(6e4)}stop(){this.On&&(this.On.cancel(),this.On=null)}get started(){return null!==this.On}$n(e){o_("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.On=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.On=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){X_(e)?o_("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await W_(e)}await this.$n(3e5)})}}class JE{constructor(e,t){this.Mn=e,this.params=t}calculateTargetCount(e,t){return this.Mn.Fn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return G_.resolve(sw.ct);const n=new QE(t);return this.Mn.forEachTarget(e,e=>n.kn(e.sequenceNumber)).next(()=>this.Mn.Bn(e,e=>n.kn(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Mn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Mn.removeOrphanedDocuments(e,t)}collect(t,n){return-1===this.params.cacheSizeCollectionThreshold?(o_("LruGarbageCollector","Garbage collection skipped; disabled"),G_.resolve(OE)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(o_("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),OE):this.Ln(t,n))}getCacheSize(e){return this.Mn.getCacheSize(e)}Ln(t,n){let r,i,s,a,o,c,l;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(i=e>this.params.maximumSequenceNumbersToCollect?(o_("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),this.params.maximumSequenceNumbersToCollect):e,a=Date.now(),this.nthSequenceNumber(t,i))).next(e=>(r=e,o=Date.now(),this.removeTargets(t,r,n))).next(e=>(s=e,c=Date.now(),this.removeOrphanedDocuments(t,r))).next(e=>(l=Date.now(),a_()<=m.DEBUG&&o_("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-u}ms\n\tDetermined least recently used ${i} in `+(o-a)+"ms\n"+`\tRemoved ${s} targets in `+(c-o)+"ms\n"+`\tRemoved ${e} documents in `+(l-c)+"ms\n"+`Total Duration: ${l-u}ms`),G_.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e})))}}class XE{constructor(e,t){this.db=e,this.garbageCollector=(e=this,t=t,new JE(e,t))}Fn(e){const n=this.qn(e);return this.db.getTargetCache().getTargetCount(e).next(t=>n.next(e=>t+e))}qn(e){let t=0;return this.Bn(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Bn(e,n){return this.Un(e,(e,t)=>n(t))}addReference(e,t,n){return ZE(e,n)}removeReference(e,t,n){return ZE(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return ZE(e,t)}Kn(t,n){let r=!1;return jE(t).X(e=>qE(t,e,n).next(e=>(e&&(r=!0),G_.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(n,r){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let a=0;return this.Un(n,(t,e)=>{if(e<=r){const r=this.Kn(n,t).next(e=>{if(!e)return a++,i.getEntry(n,t).next(()=>(i.removeEntry(t,A_.min()),GE(n).delete([0,lw(t.path)])))});s.push(r)}}).next(()=>G_.waitFor(s)).next(()=>i.apply(n)).next(()=>a)}removeTarget(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return ZE(e,t)}Un(e,r){const t=GE(e);let i,s=sw.ct;return t.Z({index:"documentTargetsIndex"},([e],{path:t,sequenceNumber:n})=>{0===e?(s!==sw.ct&&r(new O_(hw(i)),s),s=n,i=t):s=sw.ct}).next(()=>{s!==sw.ct&&r(new O_(hw(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ZE(e,t){return GE(e).put((e=e.currentSequenceNumber,{targetId:0,path:lw(t.path),sequenceNumber:e}))}class e0{constructor(){this.changes=new gI(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ib.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?G_.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class t0{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return s0(e).put(n)}removeEntry(e,n,t){return s0(e).delete(function(e){const t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],GT(e),t[t.length-1]]}(t))}updateMetadata(t,n){return this.getMetadata(t).next(e=>(e.byteSize+=n,this.Gn(t,e)))}getEntry(e,n){let r=Ib.newInvalidDocument(n);return s0(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(a0(n))},(e,t)=>{r=this.Qn(n,t)}).next(()=>r)}zn(e,n){let r={size:0,document:Ib.newInvalidDocument(n)};return s0(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(a0(n))},(e,t)=>{r={document:this.Qn(n,t),size:FE(t)}}).next(()=>r)}getEntries(e,t){let r=mI;return this.jn(e,t,(e,t)=>{var n=this.Qn(e,t);r=r.insert(e,n)}).next(()=>r)}Wn(e,t){let r=mI,i=new Vw(O_.comparator);return this.jn(e,t,(e,t)=>{var n=this.Qn(e,t);r=r.insert(e,n),i=i.insert(e,FE(t))}).next(()=>({documents:r,Hn:i}))}jn(e,t,i){if(t.isEmpty())return G_.resolve();let n=new zw(c0);t.forEach(e=>n=n.add(e));const r=IDBKeyRange.bound(a0(n.first()),a0(n.last())),s=n.getIterator();let a=s.getNext();return s0(e).Z({index:"documentKeyIndex",range:r},(e,t,n)=>{for(var r=O_.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);a&&c0(a,r)<0;)i(a,null),a=s.getNext();a&&a.isEqual(r)&&(i(a,t),a=s.hasNext()?s.getNext():null),a?n.G(a0(a)):n.done()}).next(()=>{for(;a;)i(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,r,t,i){const n=r.path,s=[n.popLast().toArray(),n.lastSegment(),GT(t.readTime),t.documentKey.path.isEmpty()?"":t.documentKey.path.lastSegment()],a=[n.popLast().toArray(),n.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return s0(e).j(IDBKeyRange.bound(s,a,!0)).next(e=>{let t=mI;for(const n of e){const e=this.Qn(O_.fromSegments(n.prefixPath.concat(n.collectionGroup,n.documentId)),n);e.isFoundDocument()&&(dI(r,e)||i.has(e.key))&&(t=t.insert(e.key,e))}return t})}getAllFromCollectionGroup(e,t,n,i){let s=mI;var r=o0(t,n),a=o0(t,j_.max());return s0(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(r,a,!0)},(e,t,n)=>{var r=this.Qn(O_.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);s=s.insert(r.key,r),s.size===i&&n.done()}).next(()=>s)}newChangeBuffer(e){return new r0(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return i0(e).get("remoteDocumentGlobalKey").next(e=>(d_(!!e),e))}Gn(e,t){return i0(e).put("remoteDocumentGlobalKey",t)}Qn(e,t){if(t){const e=function(e,t){let n;if(t.document)n=PT(e.se,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=O_.fromSegments(t.noDocument.path),i=QT(t.noDocument.readTime);n=Ib.newNoDocument(e,i),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return h_();{const e=O_.fromSegments(t.unknownDocument.path),s=QT(t.unknownDocument.version);n=Ib.newUnknownDocument(e,s)}}return t.readTime&&n.setReadTime((t=t.readTime,r=new N_(t[0],t[1]),A_.fromTimestamp(r))),n;var r}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(A_.min()))return e}return Ib.newInvalidDocument(e)}}function n0(e){return new t0(e)}class r0 extends e0{constructor(e,t){super(),this.Jn=e,this.trackRemovals=t,this.Yn=new gI(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(s){const a=[];let o=0,c=new zw((e,t)=>k_(e.canonicalString(),t.canonicalString()));return this.changes.forEach((e,t)=>{var n=this.Yn.get(e);if(a.push(this.Jn.removeEntry(s,e,n.readTime)),t.isValidDocument()){var r=WT(this.Jn.serializer,t);c=c.add(e.path.popLast());var i=FE(r);o+=i-n.size,a.push(this.Jn.addEntry(s,e,r))}else if(o-=n.size,this.trackRemovals){const o=WT(this.Jn.serializer,t.convertToNoDocument(A_.min()));a.push(this.Jn.addEntry(s,e,o))}}),c.forEach(e=>{a.push(this.Jn.indexManager.addToCollectionParentIndex(s,e))}),a.push(this.Jn.updateMetadata(s,o)),G_.waitFor(a)}getFromCache(e,t){return this.Jn.zn(e,t).next(e=>(this.Yn.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Jn.Wn(e,t).next(({documents:n,Hn:e})=>(e.forEach((e,t)=>{this.Yn.set(e,{size:t,readTime:n.get(e).readTime})}),n))}}function i0(e){return Lw(e,"remoteDocumentGlobal")}function s0(e){return Lw(e,"remoteDocumentsV14")}function a0(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function o0(e,t){const n=t.documentKey.path.toArray();return[e,GT(t.readTime),n.slice(0,n.length-2),0<n.length?n[n.length-1]:""]}function c0(e,t){var n=e.path.toArray(),r=t.path.toArray();let i=0;for(let s=0;s<n.length-2&&s<r.length-2;++s)if(i=k_(n[s],r[s]),i)return i;return i=k_(n.length,r.length),i||(i=k_(n[n.length-2],r[r.length-2]),i||k_(n[n.length-1],r[r.length-1]))}class l0{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class u0{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,n){let r=null;return this.documentOverlayCache.getOverlay(t,n).next(e=>(r=e,this.remoteDocumentCache.getEntry(t,n))).next(e=>(null!==r&&KI(r.mutation,e,Ww.empty(),N_.now()),e))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,TI()).next(()=>e))}getLocalViewOfDocuments(e,t,n=TI()){const r=wI();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let n=yI();return e.forEach((e,t)=>{n=n.insert(e,t.overlayedDocument)}),n}))}getOverlayedDocuments(e,t){const n=wI();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,TI()))}populateOverlays(e,n,t){const r=[];return t.forEach(e=>{n.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,t)=>{n.set(e,t)})})}computeViews(e,t,r,i){let s=mI;const a=wI(),o=wI();return t.forEach((e,t)=>{const n=r.get(t.key);i.has(t.key)&&(void 0===n||n.mutation instanceof HI)?s=s.insert(t.key,t):void 0!==n?(a.set(t.key,n.mutation.getFieldMask()),KI(n.mutation,t,n.mutation.getFieldMask(),N_.now())):a.set(t.key,Ww.empty())}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>a.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new l0(t,null!==(n=a.get(e))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(s,a){const o=wI();let c=new Vw((e,t)=>e-t),l=TI();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(s,a).next(e=>{for(const r of e)r.keys().forEach(e=>{var t,n=a.get(e);null!==n&&(t=o.get(e)||Ww.empty(),t=r.applyToLocalView(n,t),o.set(e,t),t=(c.get(r.batchId)||TI()).add(e),c=c.insert(r.batchId,t))})}).next(()=>{const e=[],t=c.getReverseIterator();for(;t.hasNext();){const c=t.getNext(),n=c.key,r=c.value,i=wI();r.forEach(e=>{var t;l.has(e)||(null!==(t=zI(a.get(e),o.get(e)))&&i.set(e,t),l=l.add(e))}),e.push(this.documentOverlayCache.saveOverlays(s,n,i))}return G_.waitFor(e)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(e,t,n){return r=t,O_.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):iI(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n);var r}getNextDocuments(s,t,a,o){return this.remoteDocumentCache.getAllFromCollectionGroup(s,t,a,o).next(n=>{const e=0<o-n.size?this.documentOverlayCache.getOverlaysForCollectionGroup(s,t,a.largestBatchId,o-n.size):G_.resolve(wI());let r=-1,i=n;return e.next(e=>G_.forEach(e,(t,e)=>(r<e.largestBatchId&&(r=e.largestBatchId),n.get(t)?G_.resolve():this.remoteDocumentCache.getEntry(s,t).next(e=>{i=i.insert(t,e)}))).next(()=>this.populateOverlays(s,e,n)).next(()=>this.computeViews(s,i,e,TI())).next(e=>({batchId:r,changes:_I(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new O_(t)).next(e=>{let t=yI();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(r,i,s){const a=i.collectionGroup;let o=yI();return this.indexManager.getCollectionParents(r,a).next(e=>G_.forEach(e,e=>{var t,n=(t=i,e=e.child(a),new Xb(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return this.getDocumentsMatchingCollectionQuery(r,n,s).next(e=>{e.forEach((e,t)=>{o=o.insert(e,t)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,s,n){let a;return this.documentOverlayCache.getOverlaysForCollection(t,s.path,n.largestBatchId).next(e=>(a=e,this.remoteDocumentCache.getDocumentsMatchingQuery(t,s,n,a))).next(r=>{a.forEach((e,t)=>{var n=t.getKey();null===r.get(n)&&(r=r.insert(n,Ib.newInvalidDocument(n)))});let i=yI();return r.forEach((e,t)=>{var n=a.get(e);void 0!==n&&KI(n.mutation,t,Ww.empty(),N_.now()),dI(s,t)&&(i=i.insert(e,t))}),i})}}class h0{constructor(e){this.serializer=e,this.Zn=new Map,this.Xn=new Map}getBundleMetadata(e,t){return G_.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){return this.Zn.set(t.id,{id:t.id,version:t.version,createTime:TT(t.createTime)}),G_.resolve()}getNamedQuery(e,t){return G_.resolve(this.Xn.get(t))}saveNamedQuery(e,t){return this.Xn.set(t.name,{name:(t=t).name,query:ZT(t.bundledQuery),readTime:TT(t.readTime)}),G_.resolve()}}class d0{constructor(){this.overlays=new Vw(O_.comparator),this.ts=new Map}getOverlay(e,t){return G_.resolve(this.overlays.get(t))}getOverlays(e,t){const n=wI();return G_.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(n,r,e){return e.forEach((e,t)=>{this.re(n,r,t)}),G_.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.ts.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.ts.delete(n)),G_.resolve()}getOverlaysForCollection(e,t,n){const r=wI(),i=t.length+1,s=new O_(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){const e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return G_.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new Vw((e,t)=>e-t);const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=wI(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const a=wI(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return G_.resolve(a)}re(e,t,n){var r=this.overlays.get(n.key);if(null!==r){const e=this.ts.get(r.largestBatchId).delete(n.key);this.ts.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new nT(t,n));let i=this.ts.get(t);void 0===i&&(i=TI(),this.ts.set(t,i)),this.ts.set(t,i.add(n.key))}}class p0{constructor(){this.es=new zw(f0.ns),this.ss=new zw(f0.rs)}isEmpty(){return this.es.isEmpty()}addReference(e,t){var n=new f0(e,t);this.es=this.es.add(n),this.ss=this.ss.add(n)}os(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.us(new f0(e,t))}cs(e,t){e.forEach(e=>this.removeReference(e,t))}hs(e){const t=new O_(new D_([])),n=new f0(t,e),r=new f0(t,e+1),i=[];return this.ss.forEachInRange([n,r],e=>{this.us(e),i.push(e.key)}),i}ls(){this.es.forEach(e=>this.us(e))}us(e){this.es=this.es.delete(e),this.ss=this.ss.delete(e)}fs(e){var t=new O_(new D_([])),n=new f0(t,e),t=new f0(t,e+1);let r=TI();return this.ss.forEachInRange([n,t],e=>{r=r.add(e.key)}),r}containsKey(e){var t=new f0(e,0),t=this.es.firstAfterOrEqual(t);return null!==t&&e.isEqual(t.key)}}class f0{constructor(e,t){this.key=e,this.ds=t}static ns(e,t){return O_.comparator(e.key,t.key)||k_(e.ds,t.ds)}static rs(e,t){return k_(e.ds,t.ds)||O_.comparator(e.key,t.key)}}class g0{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this._s=new zw(f0.ns)}checkEmpty(e){return G_.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){var i=this.ws;this.ws++,0<this.mutationQueue.length&&this.mutationQueue[this.mutationQueue.length-1];var s=new eT(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this._s=this._s.add(new f0(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return G_.resolve(s)}lookupMutationBatch(e,t){return G_.resolve(this.gs(t))}getNextMutationBatchAfterBatchId(e,t){var n=this.ys(t+1),n=n<0?0:n;return G_.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return G_.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return G_.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new f0(t,0),r=new f0(t,Number.POSITIVE_INFINITY),i=[];return this._s.forEachInRange([n,r],e=>{var t=this.gs(e.ds);i.push(t)}),G_.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new zw(k_);return t.forEach(e=>{var t=new f0(e,0),n=new f0(e,Number.POSITIVE_INFINITY);this._s.forEachInRange([t,n],e=>{r=r.add(e.ds)})}),G_.resolve(this.ps(r))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;O_.isDocumentKey(i)||(i=i.child(""));var s=new f0(new O_(i),0);let a=new zw(k_);return this._s.forEachWhile(e=>{var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.ds)),!0)},s),G_.resolve(this.ps(a))}ps(e){const n=[];return e.forEach(e=>{var t=this.gs(e);null!==t&&n.push(t)}),n}removeMutationBatch(n,r){d_(0===this.Is(r.batchId,"removed")),this.mutationQueue.shift();let i=this._s;return G_.forEach(r.mutations,e=>{var t=new f0(e.key,r.batchId);return i=i.delete(t),this.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(()=>{this._s=i})}En(e){}containsKey(e,t){var n=new f0(t,0),n=this._s.firstAfterOrEqual(n);return G_.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,G_.resolve()}Is(e,t){return this.ys(e)}ys(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}gs(e){var t=this.ys(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class m0{constructor(e){this.Ts=e,this.docs=new Vw(O_.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Ts(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return G_.resolve(n?n.document.mutableCopy():Ib.newInvalidDocument(t))}getEntries(e,t){let n=mI;return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Ib.newInvalidDocument(e))}),G_.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=mI;const s=t.path,a=new O_(s.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||z_(B_(a),n)<=0||(r.has(a.key)||dI(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return G_.resolve(i)}getAllFromCollectionGroup(e,t,n,r){h_()}Es(e,t){return G_.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new v0(this)}getSize(e){return G_.resolve(this.size)}}class v0 extends e0{constructor(e){super(),this.Jn=e}applyChanges(n){const r=[];return this.changes.forEach((e,t)=>{t.isValidDocument()?r.push(this.Jn.addEntry(n,t)):this.Jn.removeEntry(e)}),G_.waitFor(r)}getFromCache(e,t){return this.Jn.getEntry(e,t)}getAllFromCache(e,t){return this.Jn.getEntries(e,t)}}class y0{constructor(e){this.persistence=e,this.As=new gI(e=>Wb(e),Gb),this.lastRemoteSnapshotVersion=A_.min(),this.highestTargetId=0,this.Rs=0,this.vs=new p0,this.targetCount=0,this.bs=zE.vn()}forEachTarget(e,n){return this.As.forEach((e,t)=>n(t)),G_.resolve()}getLastRemoteSnapshotVersion(e){return G_.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return G_.resolve(this.Rs)}allocateTargetId(e){return this.highestTargetId=this.bs.next(),G_.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Rs&&(this.Rs=t),G_.resolve()}Sn(e){this.As.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.bs=new zE(t),this.highestTargetId=t),e.sequenceNumber>this.Rs&&(this.Rs=e.sequenceNumber)}addTargetData(e,t){return this.Sn(t),this.targetCount+=1,G_.resolve()}updateTargetData(e,t){return this.Sn(t),G_.resolve()}removeTargetData(e,t){return this.As.delete(t.target),this.vs.hs(t.targetId),--this.targetCount,G_.resolve()}removeTargets(n,r,i){let s=0;const a=[];return this.As.forEach((e,t)=>{t.sequenceNumber<=r&&null===i.get(t.targetId)&&(this.As.delete(e),a.push(this.removeMatchingKeysForTargetId(n,t.targetId)),s++)}),G_.waitFor(a).next(()=>s)}getTargetCount(e){return G_.resolve(this.targetCount)}getTargetData(e,t){var n=this.As.get(t)||null;return G_.resolve(n)}addMatchingKeys(e,t,n){return this.vs.os(t,n),G_.resolve()}removeMatchingKeys(t,e,n){this.vs.cs(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(e=>{i.push(r.markPotentiallyOrphaned(t,e))}),G_.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.vs.hs(t),G_.resolve()}getMatchingKeysForTargetId(e,t){var n=this.vs.fs(t);return G_.resolve(n)}containsKey(e,t){return G_.resolve(this.vs.containsKey(t))}}class _0{constructor(e,t){this.Ps={},this.overlays={},this.Vs=new sw(0),this.Ss=!1,this.Ss=!0,this.referenceDelegate=e(this),this.Ds=new y0(this),this.indexManager=new kE,this.remoteDocumentCache=(e=e=>this.referenceDelegate.Cs(e),new m0(e)),this.serializer=new KT(t),this.xs=new h0(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Ss=!1,Promise.resolve()}get started(){return this.Ss}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new d0,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Ps[e.toKey()];return n||(n=new g0(t,this.referenceDelegate),this.Ps[e.toKey()]=n),n}getTargetCache(){return this.Ds}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.xs}runTransaction(e,t,n){o_("MemoryPersistence","Starting transaction:",e);const r=new w0(this.Vs.next());return this.referenceDelegate.Ns(),n(r).next(e=>this.referenceDelegate.ks(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Os(t,n){return G_.or(Object.values(this.Ps).map(e=>()=>e.containsKey(t,n)))}}class w0 extends K_{constructor(e){super(),this.currentSequenceNumber=e}}class b0{constructor(e){this.persistence=e,this.$s=new p0,this.Ms=null}static Fs(e){return new b0(e)}get Bs(){if(this.Ms)return this.Ms;throw h_()}addReference(e,t,n){return this.$s.addReference(n,t),this.Bs.delete(n.toString()),G_.resolve()}removeReference(e,t,n){return this.$s.removeReference(n,t),this.Bs.add(n.toString()),G_.resolve()}markPotentiallyOrphaned(e,t){return this.Bs.add(t.toString()),G_.resolve()}removeTarget(e,t){this.$s.hs(t.targetId).forEach(e=>this.Bs.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Bs.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ns(){this.Ms=new Set}ks(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return G_.forEach(this.Bs,e=>{const t=O_.fromPath(e);return this.Ls(n,t).next(e=>{e||r.removeEntry(t,A_.min())})}).next(()=>(this.Ms=null,r.apply(n)))}updateLimboDocument(e,t){return this.Ls(e,t).next(e=>{e?this.Bs.delete(t.toString()):this.Bs.add(t.toString())})}Cs(e){return 0}Ls(e,t){return G_.or([()=>G_.resolve(this.$s.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Os(e,t)])}}class I0{constructor(e){this.serializer=e}M(t,e,n,r){const i=new H_("createOrUpgrade",e);var s;n<1&&1<=r&&(t.createObjectStore("owner"),(s=t).createObjectStore("mutationQueues",{keyPath:"userId"}),s.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",dw,{unique:!0}),s.createObjectStore("documentMutations"),T0(t),t.createObjectStore("remoteDocuments"));let a=G_.resolve();return n<3&&3<=r&&(0!==n&&((s=t).deleteObjectStore("targetDocuments"),s.deleteObjectStore("targets"),s.deleteObjectStore("targetGlobal"),T0(t)),a=a.next(()=>function(){const e=i.store("targetGlobal"),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:A_.min().toTimestamp(),targetCount:0};return e.put("targetGlobalKey",t)}())),n<4&&4<=r&&(0!==n&&(a=a.next(()=>function(r,i){return i.store("mutations").j().next(e=>{r.deleteObjectStore("mutations"),r.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",dw,{unique:!0});const t=i.store("mutations"),n=e.map(e=>t.put(e));return G_.waitFor(n)})}(t,i))),a=a.next(()=>{t.createObjectStore("clientMetadata",{keyPath:"clientId"})})),n<5&&5<=r&&(a=a.next(()=>this.qs(i))),n<6&&6<=r&&(a=a.next(()=>(t.createObjectStore("remoteDocumentGlobal"),this.Us(i)))),n<7&&7<=r&&(a=a.next(()=>this.Ks(i))),n<8&&8<=r&&(a=a.next(()=>this.Gs(t,i))),n<9&&9<=r&&(a=a.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&10<=r&&(a=a.next(()=>this.Qs(i))),n<11&&11<=r&&(a=a.next(()=>{t.createObjectStore("bundles",{keyPath:"bundleId"}),t.createObjectStore("namedQueries",{keyPath:"name"})})),n<12&&12<=r&&(a=a.next(()=>{!function(){const e=t.createObjectStore("documentOverlays",{keyPath:Cw});e.createIndex("collectionPathOverlayIndex",Nw,{unique:!1}),e.createIndex("collectionGroupOverlayIndex",Aw,{unique:!1})}()})),n<13&&13<=r&&(a=a.next(()=>function(){const e=t.createObjectStore("remoteDocumentsV14",{keyPath:mw});e.createIndex("documentKeyIndex",vw),e.createIndex("collectionGroupIndex",yw)}()).next(()=>this.zs(t,i)).next(()=>t.deleteObjectStore("remoteDocuments"))),n<14&&14<=r&&(a=a.next(()=>this.js(t,i))),n<15&&15<=r&&(a=a.next(()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Tw}).createIndex("sequenceNumberIndex",Ew,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:kw}).createIndex("documentKeyIndex",Sw,{unique:!1})}(t))),a}Us(t){let n=0;return t.store("remoteDocuments").Z((e,t)=>{n+=FE(t)}).next(()=>{var e={byteSize:n};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",e)})}qs(r){const e=r.store("mutationQueues"),t=r.store("mutations");return e.j().next(e=>G_.forEach(e,n=>{var e=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return t.j("userMutationsIndex",e).next(e=>G_.forEach(e,e=>{d_(e.userId===n.userId);var t=YT(this.serializer,e);return LE(r,n.userId,t).next(()=>{})}))}))}Ks(e){const a=e.store("targetDocuments"),t=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return t.Z((e,t)=>{const n=new D_(e),r=[0,lw(n)];s.push(a.get(r).next(e=>e?G_.resolve():(e=>a.put({targetId:0,path:lw(e),sequenceNumber:i.highestListenSequenceNumber}))(n)))}).next(()=>G_.waitFor(s))})}Gs(e,t){e.createObjectStore("collectionParents",{keyPath:Iw});const n=t.store("collectionParents"),r=new SE,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:lw(r)})}};return t.store("remoteDocuments").Z({Y:!0},(e,t)=>{const n=new D_(e);return i(n.popLast())}).next(()=>t.store("documentMutations").Z({Y:!0},([,e],t)=>{const n=hw(e);return i(n.popLast())}))}Qs(e){const r=e.store("targets");return r.Z((e,t)=>{var n=JT(t),n=XT(this.serializer,n);return r.put(n)})}zs(e,s){const t=s.store("remoteDocuments"),a=[];return t.Z((e,t)=>{const n=s.store("remoteDocumentsV14"),r=((i=t).document?new O_(D_.fromString(i.document.name).popFirst(5)):i.noDocument?O_.fromSegments(i.noDocument.path):i.unknownDocument?O_.fromSegments(i.unknownDocument.path):h_()).path.toArray();var i={prefixPath:r.slice(0,r.length-2),collectionGroup:r[r.length-2],documentId:r[r.length-1],readTime:t.readTime||[0,0],unknownDocument:t.unknownDocument,noDocument:t.noDocument,document:t.document,hasCommittedMutations:!!t.hasCommittedMutations};a.push(n.put(i))}).next(()=>G_.waitFor(a))}js(e,s){const t=s.store("mutations"),a=n0(this.serializer),o=new _0(b0.Fs,this.serializer.se);return t.j().next(e=>{const r=new Map;return e.forEach(e=>{var t;let n=null!==(t=r.get(e.userId))&&void 0!==t?t:TI();YT(this.serializer,e).keys().forEach(e=>n=n.add(e)),r.set(e.userId,n)}),G_.forEach(r,(e,t)=>{var n=new r_(t),r=aE.ie(this.serializer,n),i=o.getIndexManager(n),n=UE.ie(n,this.serializer,i,o.referenceDelegate);return new u0(a,n,r,i).recalculateAndSaveOverlaysForDocumentKeys(new Mw(s,sw.ct),e).next()})})}}function T0(e){e.createObjectStore("targetDocuments",{keyPath:ww}).createIndex("documentTargetsIndex",bw,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",_w,{unique:!0}),e.createObjectStore("targetGlobal")}const E0="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class k0{constructor(e,t,n,r,i,s,a,o,c,l,u=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Ws=i,this.window=s,this.document=a,this.Hs=c,this.Js=l,this.Ys=u,this.Vs=null,this.Ss=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.Xs=null,this.ti=null,this.ei=Number.NEGATIVE_INFINITY,this.ni=e=>Promise.resolve(),!k0.D())throw new f_(p_.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new XE(this,r),this.si=t+"main",this.serializer=new KT(o),this.ii=new Q_(this.si,this.Ys,new I0(this.serializer)),this.Ds=new $E(this.referenceDelegate,this.serializer),this.remoteDocumentCache=n0(this.serializer),this.xs=new rE,this.window&&this.window.localStorage?this.ri=this.window.localStorage:(this.ri=null,!1===l&&c_("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.oi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new f_(p_.FAILED_PRECONDITION,E0);return this.ui(),this.ci(),this.ai(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ds.getHighestSequenceNumber(e))}).then(e=>{this.Vs=new sw(e,this.Hs)}).then(()=>{this.Ss=!0}).catch(e=>(this.ii&&this.ii.close(),Promise.reject(e)))}hi(t){return this.ni=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.ii.B(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ws.enqueueAndForget(async()=>{this.started&&await this.oi()}))}oi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>C0(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.li(t).next(e=>{e||(this.isPrimary=!1,this.Ws.enqueueRetryable(()=>this.ni(!1)))})}).next(()=>this.fi(t)).next(e=>this.isPrimary&&!e?this.di(t).next(()=>!1):!!e&&this.wi(t).next(()=>!0))).catch(e=>{if(X_(e))return o_("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return o_("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Ws.enqueueRetryable(()=>this.ni(e)),this.isPrimary=e})}li(e){return S0(e).get("owner").next(e=>G_.resolve(this._i(e)))}mi(e){return C0(e).delete(this.clientId)}async gi(){if(this.isPrimary&&!this.yi(this.ei,18e5)){this.ei=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const r=Lw(e,"clientMetadata");return r.j().next(e=>{const t=this.pi(e,18e5),n=e.filter(e=>-1===t.indexOf(e));return G_.forEach(n,e=>r.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.ri)for(const t of e)this.ri.removeItem(this.Ii(t.clientId))}}ai(){this.ti=this.Ws.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.oi().then(()=>this.gi()).then(()=>this.ai()))}_i(e){return!!e&&e.ownerId===this.clientId}fi(t){return this.Js?G_.resolve(!0):S0(t).get("owner").next(e=>{if(null!==e&&this.yi(e.leaseTimestampMs,5e3)&&!this.Ti(e.ownerId)){if(this._i(e)&&this.networkEnabled)return!0;if(!this._i(e)){if(!e.allowTabSynchronization)throw new f_(p_.FAILED_PRECONDITION,E0);return!1}}return!(!this.networkEnabled||!this.inForeground)||C0(t).j().next(e=>void 0===this.pi(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&o_("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Ss=!1,this.Ei(),this.ti&&(this.ti.cancel(),this.ti=null),this.Ai(),this.Ri(),await this.ii.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new Mw(e,sw.ct);return this.di(t).next(()=>this.mi(t))}),this.ii.close(),this.vi()}pi(e,t){return e.filter(e=>this.yi(e.updateTimeMs,t)&&!this.Ti(e.clientId))}bi(){return this.runTransaction("getActiveClients","readonly",e=>C0(e).j().next(e=>this.pi(e,18e5).map(e=>e.clientId)))}get started(){return this.Ss}getMutationQueue(e,t){return UE.ie(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ds}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new NE(e,this.serializer.se.databaseId)}getDocumentOverlayCache(e){return aE.ie(this.serializer,e)}getBundleCache(){return this.xs}runTransaction(t,n,r){o_("IndexedDbPersistence","Starting transaction:",t);var e,i="readonly"===n?"readonly":"readwrite",e=15===(e=this.Ys)?Ow:14===e?Pw:13===e?xw:12===e?Dw:11===e?Rw:void h_();let s;return this.ii.runTransaction(t,i,e,e=>(s=new Mw(e,this.Vs?this.Vs.next():sw.ct),"readwrite-primary"===n?this.li(s).next(e=>!!e||this.fi(s)).next(e=>{if(!e)throw c_(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Ws.enqueueRetryable(()=>this.ni(!1)),new f_(p_.FAILED_PRECONDITION,$_);return r(s)}).next(e=>this.wi(s).next(()=>e)):this.Pi(s).next(()=>r(s)))).then(e=>(s.raiseOnCommittedEvent(),e))}Pi(e){return S0(e).get("owner").next(e=>{if(null!==e&&this.yi(e.leaseTimestampMs,5e3)&&!this.Ti(e.ownerId)&&!this._i(e)&&!(this.Js||this.allowTabSynchronization&&e.allowTabSynchronization))throw new f_(p_.FAILED_PRECONDITION,E0)})}wi(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return S0(e).put("owner",t)}static D(){return Q_.D()}di(e){const t=S0(e);return t.get("owner").next(e=>this._i(e)?(o_("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):G_.resolve())}yi(e,t){var n=Date.now();return!(e<n-t||n<e&&(c_(`Detected an update time that is in the future: ${e} > ${n}`),1))}ui(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Xs=()=>{this.Ws.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.oi()))},this.document.addEventListener("visibilitychange",this.Xs),this.inForeground="visible"===this.document.visibilityState)}Ai(){this.Xs&&(this.document.removeEventListener("visibilitychange",this.Xs),this.Xs=null)}ci(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ei();var e=/(?:Version|Mobile)\/1[456]/;I()||!navigator.userAgent.includes("Safari")||navigator.userAgent.includes("Chrome")||!navigator.appVersion.match(e)&&!navigator.userAgent.match(e)||this.Ws.enterRestrictedMode(!0),this.Ws.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}Ri(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ti(e){var t;try{var n=null!==(null===(t=this.ri)||void 0===t?void 0:t.getItem(this.Ii(e)));return o_("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return c_("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}Ei(){if(this.ri)try{this.ri.setItem(this.Ii(this.clientId),String(Date.now()))}catch(e){c_("Failed to set zombie client id.",e)}}vi(){if(this.ri)try{this.ri.removeItem(this.Ii(this.clientId))}catch(e){}}Ii(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function S0(e){return Lw(e,"owner")}function C0(e){return Lw(e,"clientMetadata")}function N0(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class A0{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Vi=n,this.Si=r}static Di(e,t){let n=TI(),r=TI();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new A0(e,t.fromCache,n,r)}}class R0{constructor(){this.Ci=!1}initialize(e,t){this.xi=e,this.indexManager=t,this.Ci=!0}getDocumentsMatchingQuery(t,n,r,i){return this.Ni(t,n).next(e=>e||this.ki(t,n,i,r)).next(e=>e||this.Oi(t,n))}Ni(i,s){if(tI(s))return G_.resolve(null);let t=aI(s);return this.indexManager.getIndexType(i,t).next(e=>0===e?null:(null!==s.limit&&1===e&&(s=cI(s,null,"F"),t=aI(s)),this.indexManager.getDocumentsMatchingTarget(i,t).next(e=>{const r=TI(...e);return this.xi.getDocuments(i,r).next(n=>this.indexManager.getMinOffset(i,t).next(e=>{var t=this.$i(s,n);return this.Mi(s,t,r,e.readTime)?this.Ni(i,cI(s,null,"F")):this.Fi(i,t,s,e)}))})))}ki(n,r,i,s){return tI(r)||s.isEqual(A_.min())?this.Oi(n,r):this.xi.getDocuments(n,i).next(e=>{var t=this.$i(r,e);return this.Mi(r,t,i,s)?this.Oi(n,r):(a_()<=m.DEBUG&&o_("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),hI(r)),this.Fi(n,t,r,V_(s,-1)))})}$i(n,e){let r=new zw(fI(n));return e.forEach((e,t)=>{dI(n,t)&&(r=r.add(t))}),r}Mi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||0<i.version.compareTo(r))}Oi(e,t){return a_()<=m.DEBUG&&o_("QueryEngine","Using full collection scan to execute query:",hI(t)),this.xi.getDocumentsMatchingQuery(e,t,j_.min())}Fi(e,n,t,r){return this.xi.getDocumentsMatchingQuery(e,t,r).next(t=>(n.forEach(e=>{t=t.insert(e.key,e)}),t))}}class D0{constructor(e,t,n,r){this.persistence=e,this.Bi=t,this.serializer=r,this.Li=new Vw(k_),this.qi=new gI(e=>Wb(e),Gb),this.Ui=new Map,this.Ki=e.getRemoteDocumentCache(),this.Ds=e.getTargetCache(),this.xs=e.getBundleCache(),this.Gi(n)}Gi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new u0(this.Ki,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ki.setIndexManager(this.indexManager),this.Bi.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Li))}}function x0(e,t,n,r){return new D0(e,t,n,r)}async function P0(e,t){const a=e;return a.persistence.runTransaction("Handle user change","readonly",i=>{let s;return a.mutationQueue.getAllMutationBatches(i).next(e=>(s=e,a.Gi(t),a.mutationQueue.getAllMutationBatches(i))).next(e=>{const t=[],n=[];let r=TI();for(const i of s){t.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}for(const i of e){n.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}return a.localDocuments.getDocuments(i,r).next(e=>({Qi:e,removedBatchIds:t,addedBatchIds:n}))})})}function O0(e){const t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Ds.getLastRemoteSnapshotVersion(e))}function M0(e,l){const u=e,h=l.snapshotVersion;let d=u.Li;return u.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const e=u.Ki.newChangeBuffer({trackRemovals:!0});d=u.Li;const c=[];l.targetChanges.forEach((t,n)=>{const r=d.get(n);if(r){c.push(u.Ds.removeMatchingKeys(o,t.removedDocuments,n).next(()=>u.Ds.addMatchingKeys(o,t.addedDocuments,n)));let e=r.withSequenceNumber(o.currentSequenceNumber);var i,s,a;l.targetMismatches.has(n)?e=e.withResumeToken(Hw.EMPTY_BYTE_STRING,A_.min()).withLastLimboFreeSnapshotVersion(A_.min()):0<t.resumeToken.approximateByteSize()&&(e=e.withResumeToken(t.resumeToken,h)),d=d.insert(n,e),i=r,s=e,a=t,0!==i.resumeToken.approximateByteSize()&&!(3e8<=s.snapshotVersion.toMicroseconds()-i.snapshotVersion.toMicroseconds()||0<a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size)||c.push(u.Ds.updateTargetData(o,e))}});let t=mI,n=TI();if(l.documentUpdates.forEach(e=>{l.resolvedLimboDocuments.has(e)&&c.push(u.persistence.referenceDelegate.updateLimboDocument(o,e))}),c.push(L0(o,e,l.documentUpdates).next(e=>{t=e.zi,n=e.ji})),!h.isEqual(A_.min())){const l=u.Ds.getLastRemoteSnapshotVersion(o).next(e=>u.Ds.setTargetsMetadata(o,o.currentSequenceNumber,h));c.push(l)}return G_.waitFor(c).next(()=>e.apply(o)).next(()=>u.localDocuments.getLocalViewOfDocuments(o,t,n)).next(()=>t)}).then(e=>(u.Li=d,e))}function L0(e,s,t){let n=TI(),a=TI();return t.forEach(e=>n=n.add(e)),s.getEntries(e,n).next(r=>{let i=mI;return t.forEach((e,t)=>{const n=r.get(e);t.isFoundDocument()!==n.isFoundDocument()&&(a=a.add(e)),t.isNoDocument()&&t.version.isEqual(A_.min())?(s.removeEntry(e,t.readTime),i=i.insert(e,t)):!n.isValidDocument()||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(s.addEntry(t),i=i.insert(e,t)):o_("LocalStore","Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),{zi:i,ji:a}})}function F0(e,r){const i=e;return i.persistence.runTransaction("Allocate target","readwrite",t=>{let n;return i.Ds.getTargetData(t,r).next(e=>e?(n=e,G_.resolve(n)):i.Ds.allocateTargetId(t).next(e=>(n=new $T(r,e,0,t.currentSequenceNumber),i.Ds.addTargetData(t,n).next(()=>n))))}).then(e=>{var t=i.Li.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(i.Li=i.Li.insert(e.targetId,e),i.qi.set(r,e.targetId)),e})}async function U0(e,t,n){const r=e,i=r.Li.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!X_(e))throw e;o_("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Li=r.Li.remove(t),r.qi.delete(i.target)}function q0(e,n,r){const i=e;let s=A_.min(),a=TI();return i.persistence.runTransaction("Execute query","readonly",t=>function(e,t,n){const r=e,i=r.qi.get(n);return void 0!==i?G_.resolve(r.Li.get(i)):r.Ds.getTargetData(t,n)}(i,t,aI(n)).next(e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,i.Ds.getMatchingKeysForTargetId(t,e.targetId).next(e=>{a=e})}).next(()=>i.Bi.getDocumentsMatchingQuery(t,n,r?s:A_.min(),r?a:TI())).next(e=>(j0(i,pI(n),e),{documents:e,Wi:a})))}function V0(e,t){const n=e,r=n.Ds,i=n.Li.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.ne(e,t).next(e=>e?e.target:null))}function B0(e,t){const n=e,r=n.Ui.get(t)||A_.min();return n.persistence.runTransaction("Get new document changes","readonly",e=>n.Ki.getAllFromCollectionGroup(e,t,V_(r,-1),Number.MAX_SAFE_INTEGER)).then(e=>(j0(n,t,e),e))}function j0(e,t,n){let r=e.Ui.get(t)||A_.min();n.forEach((e,t)=>{0<t.readTime.compareTo(r)&&(r=t.readTime)}),e.Ui.set(t,r)}function z0(e,t){return`firestore_clients_${e}_${t}`}function $0(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function K0(e,t){return`firestore_targets_${e}_${t}`}class W0{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Zi(e,t,n){var r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new f_(r.error.code,r.error.message))),s?new W0(e,t,r.state,i):(c_("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Xi(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class G0{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Zi(e,t){var n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new f_(n.error.code,n.error.message))),i?new G0(e,n.state,r):(c_("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Xi(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class H0{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){var n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=EI;for(let s=0;r&&s<n.activeTargetIds.length;++s)r=cw(n.activeTargetIds[s]),i=i.add(n.activeTargetIds[s]);return r?new H0(e,i):(c_("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Q0{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Q0(t.clientId,t.onlineState):(c_("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Y0{constructor(){this.activeTargetIds=EI}tr(e){this.activeTargetIds=this.activeTargetIds.add(e)}er(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Xi(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class J0{constructor(e,t,n,r,i){this.window=e,this.Ws=t,this.persistenceKey=n,this.nr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.sr=this.ir.bind(this),this.rr=new Vw(k_),this.started=!1,this.ur=[];var s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.cr=z0(this.persistenceKey,this.nr),this.ar=`firestore_sequence_number_${this.persistenceKey}`,this.rr=this.rr.insert(this.nr,new Y0),this.hr=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.lr=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.dr=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.wr=`firestore_online_state_${this.persistenceKey}`,this._r=`firestore_bundle_loaded_v2_${this.persistenceKey}`,this.window.addEventListener("storage",this.sr)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.bi();for(const n of e)if(n!==this.nr){const e=this.getItem(z0(this.persistenceKey,n));var t;!e||(t=H0.Zi(n,e))&&(this.rr=this.rr.insert(t.clientId,t))}this.mr();const n=this.storage.getItem(this.wr);if(n){const e=this.gr(n);e&&this.yr(e)}for(const e of this.ur)this.ir(e);this.ur=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.ar,JSON.stringify(e))}getAllActiveQueryTargets(){return this.pr(this.rr)}isActiveQueryTarget(n){let r=!1;return this.rr.forEach((e,t)=>{t.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(e){this.Ir(e,"pending")}updateMutationState(e,t,n){this.Ir(e,t,n),this.Tr(e)}addLocalQueryTarget(e){let t="not-current";var n;return this.isActiveQueryTarget(e)&&(!(n=this.storage.getItem(K0(this.persistenceKey,e)))||(n=G0.Zi(e,n))&&(t=n.state)),this.Er.tr(e),this.mr(),t}removeLocalQueryTarget(e){this.Er.er(e),this.mr()}isLocalQueryTarget(e){return this.Er.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(K0(this.persistenceKey,e))}updateQueryState(e,t,n){this.Ar(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Tr(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Rr(e)}notifyBundleLoaded(e){this.vr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.sr),this.removeItem(this.cr),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return o_("SharedClientState","READ",e,t),t}setItem(e,t){o_("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){o_("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ir(e){const i=e;i.storageArea===this.storage&&(o_("SharedClientState","EVENT",i.key,i.newValue),i.key!==this.cr?this.Ws.enqueueRetryable(async()=>{if(this.started){if(null!==i.key)if(this.hr.test(i.key)){if(null==i.newValue){var e=this.br(i.key);return this.Pr(e,null)}e=this.Vr(i.key,i.newValue);if(e)return this.Pr(e.clientId,e)}else if(this.lr.test(i.key)){if(null!==i.newValue){var t=this.Sr(i.key,i.newValue);if(t)return this.Dr(t)}}else if(this.dr.test(i.key)){if(null!==i.newValue){t=this.Cr(i.key,i.newValue);if(t)return this.Nr(t)}}else if(i.key===this.wr){if(null!==i.newValue){var n=this.gr(i.newValue);if(n)return this.yr(n)}}else if(i.key===this.ar){n=function(e){let t=sw.ct;if(null!=e)try{var n=JSON.parse(e);d_("number"==typeof n),t=n}catch(e){c_("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(i.newValue);n!==sw.ct&&this.sequenceNumberHandler(n)}else if(i.key===this._r){const r=this.kr(i.newValue);await Promise.all(r.map(e=>this.syncEngine.Or(e)))}}else this.ur.push(i)}):c_("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get Er(){return this.rr.get(this.nr)}mr(){this.setItem(this.cr,this.Er.Xi())}Ir(e,t,n){const r=new W0(this.currentUser,e,t,n),i=$0(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Xi())}Tr(e){var t=$0(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Rr(e){var t={clientId:this.nr,onlineState:e};this.storage.setItem(this.wr,JSON.stringify(t))}Ar(e,t,n){const r=K0(this.persistenceKey,e),i=new G0(e,t,n);this.setItem(r,i.Xi())}vr(e){var t=JSON.stringify(Array.from(e));this.setItem(this._r,t)}br(e){var t=this.hr.exec(e);return t?t[1]:null}Vr(e,t){var n=this.br(e);return H0.Zi(n,t)}Sr(e,t){var n=this.lr.exec(e),r=Number(n[1]),n=void 0!==n[2]?n[2]:null;return W0.Zi(new r_(n),r,t)}Cr(e,t){var n=this.dr.exec(e),n=Number(n[1]);return G0.Zi(n,t)}gr(e){return Q0.Zi(e)}kr(e){return JSON.parse(e)}async Dr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.$r(e.batchId,e.state,e.error);o_("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Nr(e){return this.syncEngine.Mr(e.targetId,e.state,e.error)}Pr(e,t){const n=t?this.rr.insert(e,t):this.rr.remove(e),r=this.pr(this.rr),i=this.pr(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Fr(s,a).then(()=>{this.rr=n})}yr(e){this.rr.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}pr(e){let n=EI;return e.forEach((e,t)=>{n=n.unionWith(t.activeTargetIds)}),n}}class X0{constructor(){this.Br=new Y0,this.Lr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Br.tr(e),this.Lr[e]||"not-current"}updateQueryState(e,t,n){this.Lr[e]=t}removeLocalQueryTarget(e){this.Br.er(e)}isLocalQueryTarget(e){return this.Br.activeTargetIds.has(e)}clearQueryState(e){delete this.Lr[e]}getAllActiveQueryTargets(){return this.Br.activeTargetIds}isActiveQueryTarget(e){return this.Br.activeTargetIds.has(e)}start(){return this.Br=new Y0,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Z0{qr(e){}shutdown(){}}class ek{constructor(){this.Ur=()=>this.Kr(),this.Gr=()=>this.Qr(),this.zr=[],this.jr()}qr(e){this.zr.push(e)}shutdown(){window.removeEventListener("online",this.Ur),window.removeEventListener("offline",this.Gr)}jr(){window.addEventListener("online",this.Ur),window.addEventListener("offline",this.Gr)}Kr(){o_("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.zr)e(0)}Qr(){o_("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.zr)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let tk=null;function nk(){return null===tk?tk=268435456+Math.round(2147483648*Math.random()):tk++,"0x"+tk.toString(16)}const rk={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ik{constructor(e){this.Wr=e.Wr,this.Hr=e.Hr}Jr(e){this.Yr=e}Zr(e){this.Xr=e}onMessage(e){this.eo=e}close(){this.Hr()}send(e){this.Wr(e)}no(){this.Yr()}so(e){this.Xr(e)}io(e){this.eo(e)}}const sk="WebChannelConnection";class ak extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.ro=t+"://"+e.host,this.oo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get uo(){return!1}co(t,e,n,r,i){const s=nk(),a=this.ao(t,e);o_("RestConnection",`Sending RPC '${t}' ${s}:`,a,n);var o={};return this.ho(o,r,i),this.lo(t,a,o,n).then(e=>(o_("RestConnection",`Received RPC '${t}' ${s}: `,e),e),e=>{throw l_("RestConnection",`RPC '${t}' ${s} failed with error: `,e,"url: ",a,"request:",n),e})}fo(e,t,n,r,i,s){return this.co(e,t,n,r,i)}ho(n,e,t){n["X-Goog-Api-Client"]="gl-js/ fire/"+i_,n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,t)=>n[t]=e),t&&t.headers.forEach((e,t)=>n[t]=e)}ao(e,t){var n=rk[e];return`${this.ro}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}lo(o,t,n,r){const c=nk();return new Promise((i,s)=>{const a=new t_;a.setWithCredentials(!0),a.listenOnce(Qy.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Hy.NO_ERROR:var e=a.getResponseJson();o_(sk,`XHR for RPC '${o}' ${c} received:`,JSON.stringify(e)),i(e);break;case Hy.TIMEOUT:o_(sk,`RPC '${o}' ${c} timed out`),s(new f_(p_.DEADLINE_EXCEEDED,"Request time out"));break;case Hy.HTTP_ERROR:var t=a.getStatus();if(o_(sk,`RPC '${o}' ${c} failed with status:`,t,"response text:",a.getResponseText()),0<t){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);var n=null==e?void 0:e.error;if(n&&n.status&&n.message){const o=(r=n.status.toLowerCase().replace(/_/g,"-"),0<=Object.values(p_).indexOf(r)?r:p_.UNKNOWN);s(new f_(o,n.message))}else s(new f_(p_.UNKNOWN,"Server responded with status "+a.getStatus()))}else s(new f_(p_.UNAVAILABLE,"Connection failed."));break;default:h_()}}finally{o_(sk,`RPC '${o}' ${c} completed.`)}var r});var e=JSON.stringify(r);o_(sk,`RPC '${o}' ${c} sending request:`,r),a.send(t,"POST",e,n,15)})}wo(i,e,t){const s=nk(),n=[this.ro,"/","google.firestore.v1.Firestore","/",i,"/channel"],r=new By,a=Gy(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Zy({})),this.ho(o.initMessageHeaders,e,t),o.encodeInitMessageHeaders=!0;var c=n.join("");o_(sk,`Creating RPC '${i}' stream ${s}: ${c}`,o);const l=r.createWebChannel(c,o);let u=!1,h=!1;const d=new ik({Wr:e=>{h?o_(sk,`Not sending because RPC '${i}' stream ${s} is closed:`,e):(u||(o_(sk,`Opening RPC '${i}' stream ${s} transport.`),l.open(),u=!0),o_(sk,`RPC '${i}' stream ${s} sending:`,e),l.send(e))},Hr:()=>l.close()}),p=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return p(l,e_.EventType.OPEN,()=>{h||o_(sk,`RPC '${i}' stream ${s} transport opened.`)}),p(l,e_.EventType.CLOSE,()=>{h||(h=!0,o_(sk,`RPC '${i}' stream ${s} transport closed`),d.so())}),p(l,e_.EventType.ERROR,e=>{h||(h=!0,l_(sk,`RPC '${i}' stream ${s} transport errored:`,e),d.so(new f_(p_.UNAVAILABLE,"The operation could not be completed")))}),p(l,e_.EventType.MESSAGE,n=>{if(!h){var e=n.data[0];d_(!!e);var r=e.error||(null===(r=e[0])||void 0===r?void 0:r.error);if(r){o_(sk,`RPC '${i}' stream ${s} received error:`,r);const n=r.status;let e=function(e){var t=Wy[e];if(void 0!==t)return sT(t)}(n),t=r.message;void 0===e&&(e=p_.INTERNAL,t="Unknown error status: "+n+" with message "+r.message),h=!0,d.so(new f_(e,t)),l.close()}else o_(sk,`RPC '${i}' stream ${s} received:`,e),d.io(e)}}),p(a,Yy.STAT_EVENT,e=>{e.stat===Jy?o_(sk,`RPC '${i}' stream ${s} detected buffering proxy`):e.stat===Xy&&o_(sk,`RPC '${i}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{d.no()},0),d}}function ok(){return"undefined"!=typeof window?window:null}function ck(){return"undefined"!=typeof document?document:null}function lk(e){return new wT(e,!0)}class uk{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Ws=e,this.timerId=t,this._o=n,this.mo=r,this.yo=i,this.po=0,this.Io=null,this.To=Date.now(),this.reset()}reset(){this.po=0}Eo(){this.po=this.yo}Ao(e){this.cancel();var t=Math.floor(this.po+this.Ro()),n=Math.max(0,Date.now()-this.To),r=Math.max(0,t-n);0<r&&o_("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.po} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Io=this.Ws.enqueueAfterDelay(this.timerId,r,()=>(this.To=Date.now(),e())),this.po*=this.mo,this.po<this._o&&(this.po=this._o),this.po>this.yo&&(this.po=this.yo)}vo(){null!==this.Io&&(this.Io.skipDelay(),this.Io=null)}cancel(){null!==this.Io&&(this.Io.cancel(),this.Io=null)}Ro(){return(Math.random()-.5)*this.po}}class hk{constructor(e,t,n,r,i,s,a,o){this.Ws=e,this.bo=n,this.Po=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.Vo=0,this.So=null,this.Do=null,this.stream=null,this.Co=new uk(e,t)}xo(){return 1===this.state||5===this.state||this.No()}No(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.ko()}async stop(){this.xo()&&await this.close(0)}Oo(){this.state=0,this.Co.reset()}$o(){this.No()&&null===this.So&&(this.So=this.Ws.enqueueAfterDelay(this.bo,6e4,()=>this.Mo()))}Fo(e){this.Bo(),this.stream.send(e)}async Mo(){if(this.No())return this.close(0)}Bo(){this.So&&(this.So.cancel(),this.So=null)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}async close(e,t){this.Bo(),this.Lo(),this.Co.cancel(),this.Vo++,4!==e?this.Co.reset():t&&t.code===p_.RESOURCE_EXHAUSTED?(c_(t.toString()),c_("Using maximum backoff delay to prevent overloading the backend."),this.Co.Eo()):t&&t.code===p_.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.qo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zr(t)}qo(){}auth(){this.state=1;const e=this.Uo(this.Vo),n=this.Vo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,t])=>{this.Vo===n&&this.Ko(e,t)},t=>{e(()=>{var e=new f_(p_.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Go(e)})})}Ko(e,t){const n=this.Uo(this.Vo);this.stream=this.Qo(e,t),this.stream.Jr(()=>{n(()=>(this.state=2,this.Do=this.Ws.enqueueAfterDelay(this.Po,1e4,()=>(this.No()&&(this.state=3),Promise.resolve())),this.listener.Jr()))}),this.stream.Zr(e=>{n(()=>this.Go(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}ko(){this.state=5,this.Co.Ao(async()=>{this.state=0,this.start()})}Go(e){return o_("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Uo(t){return e=>{this.Ws.enqueueAndForget(()=>this.Vo===t?e():(o_("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class dk extends hk{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}Qo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.Co.reset();var t=function(e,t){let n;if("targetChange"in t){t.targetChange;var r="NO_CHANGE"===(p=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===p?1:"REMOVE"===p?2:"CURRENT"===p?3:"RESET"===p?4:h_(),i=t.targetChange.targetIds||[],s=(p=t.targetChange.resumeToken,e.useProto3Json?(d_(void 0===p||"string"==typeof p),Hw.fromBase64String(p||"")):(d_(void 0===p||p instanceof Uint8Array),Hw.fromUint8Array(p||new Uint8Array))),a=t.targetChange.cause,o=a&&(o=void 0===(p=a).code?p_.UNKNOWN:sT(p.code),new f_(o,p.message||""));n=new dT(r,i,s,o||null)}else if("documentChange"in t){t.documentChange;var c=t.documentChange;c.document,c.document.name,c.document.updateTime;var s=CT(e,c.document.name),o=TT(c.document.updateTime),l=c.document.createTime?TT(c.document.createTime):A_.min(),u=new bb({mapValue:{fields:c.document.fields}}),l=Ib.newFoundDocument(s,o,l,u),u=c.targetIds||[],c=c.removedTargetIds||[];n=new uT(u,c,l.key,l)}else if("documentDelete"in t){t.documentDelete;u=t.documentDelete;u.document;c=CT(e,u.document),l=u.readTime?TT(u.readTime):A_.min(),l=Ib.newNoDocument(c,l),u=u.removedTargetIds||[];n=new uT([],u,l.key,l)}else if("documentRemove"in t){t.documentRemove;var h=t.documentRemove;h.document;var d=CT(e,h.document),h=h.removedTargetIds||[];n=new uT([],h,d,null)}else{if(!("filter"in t))return h_();{t.filter;const e=t.filter;e.targetId;h=e.count||0,d=new rT(h),h=e.targetId;n=new hT(h,d)}}var o,p;return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return A_.min();var t=e.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?TT(t.readTime):A_.min()}(e);return this.listener.zo(t,n)}jo(e){const t={};t.database=RT(this.serializer),t.addTarget=function(e,t){let n;var r=t.target;return n=Hb(r)?{documents:LT(e,r)}:{query:FT(e,r)},n.targetId=t.targetId,0<t.resumeToken.approximateByteSize()?n.resumeToken=IT(e,t.resumeToken):0<t.snapshotVersion.compareTo(A_.min())&&(n.readTime=bT(e,t.snapshotVersion.toTimestamp())),n}(this.serializer,e);var n,r,r=(this.serializer,n=e,null==(r=function(){switch(n.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return h_()}}())?null:{"goog-listen-tags":r});r&&(t.labels=r),this.Fo(t)}Wo(e){const t={};t.database=RT(this.serializer),t.removeTarget=e,this.Fo(t)}}class pk extends hk{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.Ho=!1}get Jo(){return this.Ho}start(){this.Ho=!1,this.lastStreamToken=void 0,super.start()}qo(){this.Ho&&this.Yo([])}Qo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(d_(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Ho){this.Co.reset();var t=(r=e.writeResults,i=e.commitTime,r&&0<r.length?(d_(void 0!==i),r.map(e=>function(e,t){let n=e.updateTime?TT(e.updateTime):TT(t);return n.isEqual(A_.min())&&(n=TT(t)),new qI(n,e.transformResults||[])}(e,i))):[]),n=TT(e.commitTime);return this.listener.Zo(n,t)}var r,i;return d_(!e.writeResults||0===e.writeResults.length),this.Ho=!0,this.listener.Xo()}tu(){const e={};e.database=RT(this.serializer),this.Fo(e)}Yo(e){var t={streamToken:this.lastStreamToken,writes:e.map(e=>OT(this.serializer,e))};this.Fo(t)}}class fk extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.eu=!1}nu(){if(this.eu)throw new f_(p_.FAILED_PRECONDITION,"The client has already been terminated.")}co(n,r,i){return this.nu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.co(n,r,i,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===p_.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new f_(p_.UNKNOWN,e.toString())})}fo(n,r,i,s){return this.nu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.fo(n,r,i,e,t,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===p_.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new f_(p_.UNKNOWN,e.toString())})}terminate(){this.eu=!0}}class gk{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.su=0,this.iu=null,this.ru=!0}ou(){0===this.su&&(this.uu("Unknown"),this.iu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.iu=null,this.cu("Backend didn't respond within 10 seconds."),this.uu("Offline"),Promise.resolve())))}au(e){"Online"===this.state?this.uu("Unknown"):(this.su++,1<=this.su&&(this.hu(),this.cu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.uu("Offline")))}set(e){this.hu(),this.su=0,"Online"===e&&(this.ru=!1),this.uu(e)}uu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}cu(e){var t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ru?(c_(t),this.ru=!1):o_("OnlineStateTracker",t)}hu(){null!==this.iu&&(this.iu.cancel(),this.iu=null)}}class mk{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.lu=[],this.fu=new Map,this.du=new Set,this.wu=[],this._u=i,this._u.qr(e=>{n.enqueueAndForget(async()=>{kk(this)&&(o_("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=e;t.du.add(4),await yk(t),t.mu.set("Unknown"),t.du.delete(4),await vk(t)}(this))})}),this.mu=new gk(n,r)}}async function vk(e){if(kk(e))for(const t of e.wu)await t(!0)}async function yk(e){for(const t of e.wu)await t(!1)}function _k(e,t){const n=e;n.fu.has(t.targetId)||(n.fu.set(t.targetId,t),Ek(n)?Tk(n):Ok(n).No()&&bk(n,t))}function wk(e,t){const n=e,r=Ok(n);n.fu.delete(t),r.No()&&Ik(n,t),0===n.fu.size&&(r.No()?r.$o():kk(n)&&n.mu.set("Unknown"))}function bk(e,t){e.gu.Ot(t.targetId),Ok(e).jo(t)}function Ik(e,t){e.gu.Ot(t),Ok(e).Wo(t)}function Tk(t){t.gu=new fT({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ne:e=>t.fu.get(e)||null}),Ok(t).start(),t.mu.ou()}function Ek(e){return kk(e)&&!Ok(e).xo()&&0<e.fu.size}function kk(e){return 0===e.du.size}function Sk(e){e.gu=void 0}async function Ck(e,t,n){if(!X_(t))throw t;e.du.add(1),await yk(e),e.mu.set("Offline"),n=n||(()=>O0(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{o_("RemoteStore","Retrying IndexedDB access"),await n(),e.du.delete(1),await vk(e)})}function Nk(t,n){return n().catch(e=>Ck(t,e,n))}async function Ak(e){const t=e,n=Mk(t);let r=0<t.lu.length?t.lu[t.lu.length-1].batchId:-1;for(;kk(i=t)&&i.lu.length<10;)try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}(t.localStore,r);if(null===e){0===t.lu.length&&n.$o();break}r=e.batchId,function(e,t){e.lu.push(t);const n=Mk(e);n.No()&&n.Jo&&n.Yo(t.mutations)}(t,e)}catch(e){await Ck(t,e)}var i;Rk(t)&&Dk(t)}function Rk(e){return kk(e)&&!Mk(e).xo()&&0<e.lu.length}function Dk(e){Mk(e).start()}async function xk(e,t){const n=e;n.asyncQueue.verifyOperationInProgress(),o_("RemoteStore","RemoteStore received new credentials");var r=kk(n);n.du.add(3),await yk(n),r&&n.mu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.du.delete(3),await vk(n)}async function Pk(e,t){const n=e;t?(n.du.delete(2),await vk(n)):(n.du.add(2),await yk(n),n.mu.set("Unknown"))}function Ok(t){return t.yu||(t.yu=function(e,t,n){const r=e;return r.nu(),new dk(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Jr:(async function(n){n.fu.forEach((e,t)=>{bk(n,e)})}).bind(null,t),Zr:(async function(e,t){Sk(e),Ek(e)?(e.mu.au(t),Tk(e)):e.mu.set("Unknown")}).bind(null,t),zo:(async function(e,r,t){if(e.mu.set("Online"),r instanceof dT&&2===r.state&&r.cause)try{await async function(e){var t=r.cause;for(const n of r.targetIds)e.fu.has(n)&&(await e.remoteSyncer.rejectListen(n,t),e.fu.delete(n),e.gu.removeTarget(n))}(e)}catch(t){o_("RemoteStore","Failed to remove targets %s: %s ",r.targetIds.join(","),t),await Ck(e,t)}else if(r instanceof uT?e.gu.Kt(r):r instanceof hT?e.gu.Jt(r):e.gu.zt(r),!t.isEqual(A_.min()))try{const r=await O0(e.localStore);0<=t.compareTo(r)&&await function(r,i){const e=r.gu.Xt(i);return e.targetChanges.forEach((e,t)=>{if(0<e.resumeToken.approximateByteSize()){const n=r.fu.get(t);n&&r.fu.set(t,n.withResumeToken(e.resumeToken,i))}}),e.targetMismatches.forEach(e=>{const t=r.fu.get(e);var n;t&&(r.fu.set(e,t.withResumeToken(Hw.EMPTY_BYTE_STRING,t.snapshotVersion)),Ik(r,e),n=new $T(t.target,e,1,t.sequenceNumber),bk(r,n))}),r.remoteSyncer.applyRemoteEvent(e)}(e,t)}catch(r){o_("RemoteStore","Failed to raise snapshot:",r),await Ck(e,r)}}).bind(null,t)}),t.wu.push(async e=>{e?(t.yu.Oo(),Ek(t)?Tk(t):t.mu.set("Unknown")):(await t.yu.stop(),Sk(t))})),t.yu}function Mk(t){return t.pu||(t.pu=function(e,t,n){const r=e;return r.nu(),new pk(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Jr:(async function(e){Mk(e).tu()}).bind(null,t),Zr:(async function(e,t){t&&Mk(e).Jo&&await async function(e,t){if(iT(n=t.code)&&n!==p_.ABORTED){const n=e.lu.shift();Mk(e).Oo(),await Nk(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await Ak(e)}var n}(e,t),Rk(e)&&Dk(e)}).bind(null,t),Xo:(async function(e){const t=Mk(e);for(const n of e.lu)t.Yo(n.mutations)}).bind(null,t),Zo:(async function(e,t,n){const r=e.lu.shift(),i=tT.from(r,t,n);await Nk(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await Ak(e)}).bind(null,t)}),t.wu.push(async e=>{e?(t.pu.Oo(),await Ak(t)):(await t.pu.stop(),0<t.lu.length&&(o_("RemoteStore",`Stopping write stream with ${t.lu.length} pending writes`),t.lu=[]))})),t.pu}class Lk{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new g_,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,a=new Lk(e,t,s,r,i);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new f_(p_.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Fk(e,t){if(c_("AsyncQueue",`${t}: ${e}`),X_(e))return new f_(p_.UNAVAILABLE,`${t}: ${e}`);throw e}class Uk{constructor(n){this.comparator=n?(e,t)=>n(e,t)||O_.comparator(e.key,t.key):(e,t)=>O_.comparator(e.key,t.key),this.keyedMap=yI(),this.sortedSet=new Vw(this.comparator)}static emptySet(e){return new Uk(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((e,t)=>(n(e),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Uk))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){const n=new Uk;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class qk{constructor(){this.Iu=new Vw(O_.comparator)}track(e){var t=e.doc.key,n=this.Iu.get(t);!n||0!==e.type&&3===n.type?this.Iu=this.Iu.insert(t,e):3===e.type&&1!==n.type?this.Iu=this.Iu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Iu=this.Iu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Iu=this.Iu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Iu=this.Iu.remove(t):1===e.type&&2===n.type?this.Iu=this.Iu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Iu=this.Iu.insert(t,{type:2,doc:e.doc}):h_()}Tu(){const n=[];return this.Iu.inorderTraversal((e,t)=>{n.push(t)}),n}}class Vk{constructor(e,t,n,r,i,s,a,o,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new Vk(e,t,Uk.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&lI(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class Bk{constructor(){this.Eu=void 0,this.listeners=[]}}class jk{constructor(){this.queries=new gI(e=>uI(e),lI),this.onlineState="Unknown",this.Au=new Set}}async function zk(e,t){const n=e,r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Bk),i)try{s.Eu=await n.onListen(r)}catch(e){const n=Fk(e,`Initialization of query '${hI(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.Ru(n.onlineState),!s.Eu||t.vu(s.Eu)&&Kk(n)}async function $k(e,t){const n=e,r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);0<=e&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function Kk(e){e.Au.forEach(e=>{e.next()})}class Wk{constructor(e,t,n){this.query=e,this.bu=t,this.Pu=!1,this.Vu=null,this.onlineState="Unknown",this.options=n||{}}vu(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Vk(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Pu?this.Su(e)&&(this.bu.next(e),t=!0):this.Du(e,this.onlineState)&&(this.Cu(e),t=!0),this.Vu=e,t}onError(e){this.bu.error(e)}Ru(e){this.onlineState=e;let t=!1;return this.Vu&&!this.Pu&&this.Du(this.Vu,e)&&(this.Cu(this.Vu),t=!0),t}Du(e,t){return!e.fromCache||(!this.options.xu||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Su(e){if(0<e.docChanges.length)return!0;var t=this.Vu&&this.Vu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Cu(e){e=Vk.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Pu=!0,this.bu.next(e)}}class Gk{constructor(e,t){this.Nu=e,this.byteLength=t}ku(){return"metadata"in this.Nu}}class Hk{constructor(e){this.serializer=e}Hi(e){return CT(this.serializer,e)}Ji(e){return e.metadata.exists?PT(this.serializer,e.document,!1):Ib.newNoDocument(this.Hi(e.metadata.name),this.Yi(e.metadata.readTime))}Yi(e){return TT(e)}}class Qk{constructor(e,t,n){this.Ou=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Yk(e)}$u(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Nu.namedQuery)this.queries.push(e.Nu.namedQuery);else if(e.Nu.documentMetadata){this.documents.push({metadata:e.Nu.documentMetadata}),e.Nu.documentMetadata.exists||++t;const n=D_.fromString(e.Nu.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.Nu.document&&(this.documents[this.documents.length-1].document=e.Nu.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Mu(e){const t=new Map,n=new Hk(this.serializer);for(const i of e)if(i.metadata.queries){const e=n.Hi(i.metadata.name);for(const n of i.metadata.queries){var r=(t.get(n)||TI()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=e;let s=TI(),a=mI;for(const e of n){const n=t.Hi(e.metadata.name);e.document&&(s=s.add(n));const l=t.Ji(e);l.setReadTime(t.Yi(e.metadata.readTime)),a=a.insert(n,l)}const o=i.Ki.newChangeBuffer({trackRemovals:!0}),c=await F0(i,(r=r,aI(eI(D_.fromString(`__bundle__/docs/${r}`)))));return i.persistence.runTransaction("Apply bundle documents","readwrite",t=>L0(t,o,a).next(e=>(o.apply(t),e)).next(e=>i.Ds.removeMatchingKeysForTargetId(t,c.targetId).next(()=>i.Ds.addMatchingKeys(t,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(t,e.zi,e.ji)).next(()=>e.zi)))}(this.localStore,new Hk(this.serializer),this.documents,this.Ou.id),t=this.Mu(this.documents);for(const e of this.queries)await async function(e,n,r=TI()){const i=await F0(e,aI(ZT(n.bundledQuery))),s=e;return s.persistence.runTransaction("Save named query","readwrite",e=>{var t=TT(n.readTime);if(0<=i.snapshotVersion.compareTo(t))return s.xs.saveNamedQuery(e,n);t=i.withResumeToken(Hw.EMPTY_BYTE_STRING,t);return s.Li=s.Li.insert(t.targetId,t),s.Ds.updateTargetData(e,t).next(()=>s.Ds.removeMatchingKeysForTargetId(e,i.targetId)).next(()=>s.Ds.addMatchingKeys(e,r,i.targetId)).next(()=>s.xs.saveNamedQuery(e,n))})}(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Fu:this.collectionGroups,Bu:e}}}function Yk(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class Jk{constructor(e){this.key=e}}class Xk{constructor(e){this.key=e}}class Zk{constructor(e,t){this.query=e,this.Lu=t,this.qu=null,this.hasCachedResults=!1,this.current=!1,this.Uu=TI(),this.mutatedKeys=TI(),this.Ku=fI(e),this.Gu=new Uk(this.Ku)}get Qu(){return this.Lu}zu(e,t){const o=t?t.ju:new qk,c=(t||this).Gu;let l=(t||this).mutatedKeys,u=c,h=!1;const d="F"===this.query.limitType&&c.size===this.query.limit?c.last():null,p="L"===this.query.limitType&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal((e,t)=>{const n=c.get(e),r=dI(this.query,t)?t:null,i=!!n&&this.mutatedKeys.has(n.key),s=!!r&&(r.hasLocalMutations||this.mutatedKeys.has(r.key)&&r.hasCommittedMutations);let a=!1;n&&r?n.data.isEqual(r.data)?i!==s&&(o.track({type:3,doc:r}),a=!0):this.Wu(n,r)||(o.track({type:2,doc:r}),a=!0,(d&&0<this.Ku(r,d)||p&&this.Ku(r,p)<0)&&(h=!0)):!n&&r?(o.track({type:0,doc:r}),a=!0):n&&!r&&(o.track({type:1,doc:n}),a=!0,(d||p)&&(h=!0)),a&&(l=r?(u=u.add(r),s?l.add(e):l.delete(e)):(u=u.delete(e),l.delete(e)))}),null!==this.query.limit)for(;u.size>this.query.limit;){const e="F"===this.query.limitType?u.last():u.first();u=u.delete(e.key),l=l.delete(e.key),o.track({type:1,doc:e})}return{Gu:u,ju:o,Mi:h,mutatedKeys:l}}Wu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){var r=this.Gu;this.Gu=e.Gu,this.mutatedKeys=e.mutatedKeys;const i=e.ju.Tu();i.sort((e,t)=>function(e,t){var n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return h_()}};return n(e)-n(t)}(e.type,t.type)||this.Ku(e.doc,t.doc)),this.Hu(n);var s=t?this.Ju():[],a=0===this.Uu.size&&this.current?1:0,o=a!==this.qu;return this.qu=a,0!==i.length||o?{snapshot:new Vk(this.query,e.Gu,r,i,e.mutatedKeys,0==a,o,!1,!!n&&0<n.resumeToken.approximateByteSize()),Yu:s}:{Yu:s}}Ru(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Gu:this.Gu,ju:new qk,mutatedKeys:this.mutatedKeys,Mi:!1},!1)):{Yu:[]}}Zu(e){return!this.Lu.has(e)&&!!this.Gu.has(e)&&!this.Gu.get(e).hasLocalMutations}Hu(e){e&&(e.addedDocuments.forEach(e=>this.Lu=this.Lu.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Lu=this.Lu.delete(e)),this.current=e.current)}Ju(){if(!this.current)return[];const t=this.Uu;this.Uu=TI(),this.Gu.forEach(e=>{this.Zu(e.key)&&(this.Uu=this.Uu.add(e.key))});const n=[];return t.forEach(e=>{this.Uu.has(e)||n.push(new Xk(e))}),this.Uu.forEach(e=>{t.has(e)||n.push(new Jk(e))}),n}Xu(e){this.Lu=e.Wi,this.Uu=TI();var t=this.zu(e.documents);return this.applyChanges(t,!0)}tc(){return Vk.fromInitialDocuments(this.query,this.Gu,this.mutatedKeys,0===this.qu,this.hasCachedResults)}}class eS{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class tS{constructor(e){this.key=e,this.ec=!1}}class nS{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.nc={},this.sc=new gI(e=>uI(e),lI),this.ic=new Map,this.rc=new Set,this.oc=new Vw(O_.comparator),this.uc=new Map,this.cc=new p0,this.ac={},this.hc=new Map,this.lc=zE.bn(),this.onlineState="Unknown",this.fc=void 0}get isPrimaryClient(){return!0===this.fc}}async function rS(n,e,t,r,i){n.dc=(e,s,t)=>async function(e,t,n){let r=t.view.zu(s);r.Mi&&(r=await q0(e.localStore,t.query,!1).then(({documents:e})=>t.view.zu(e,r)));var i=n&&n.targetChanges.get(t.targetId),i=t.view.applyChanges(r,e.isPrimaryClient,i);return dS(e,t.targetId,i.Yu),i.snapshot}(n,e,t);const s=await q0(n.localStore,e,!0),a=new Zk(e,s.Wi),o=a.zu(s.documents),c=lT.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),l=a.applyChanges(o,n.isPrimaryClient,c);dS(n,t,l.Yu);var u=new eS(e,t,a);return n.sc.set(e,u),n.ic.has(t)?n.ic.get(t).push(e):n.ic.set(t,[e]),l.snapshot}async function iS(e,t,n){const r=_S(e);try{const e=await function(e,i){const s=e,a=N_.now(),o=i.reduce((e,t)=>e.add(t.key),TI());let c,l;return s.persistence.runTransaction("Locally write mutations","readwrite",n=>{let t=mI,r=TI();return s.Ki.getEntries(n,o).next(e=>{t=e,t.forEach((e,t)=>{t.isValidDocument()||(r=r.add(e))})}).next(()=>s.localDocuments.getOverlayedDocuments(n,t)).next(e=>{c=e;const t=[];for(const n of i){const i=function(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=AI(r.transform,e||null);null!=i&&(null===n&&(n=bb.empty()),n.set(r.field,i))}return n||null}(n,c.get(n.key).overlayedDocument);null!=i&&t.push(new HI(n.key,i,function r(e){const i=[];return Uw(e.fields,(e,t)=>{const n=new P_([e]);if(mb(t)){const e=r(t.mapValue).fields;if(0===e.length)i.push(n);else for(const t of e)i.push(n.child(t))}else i.push(n)}),new Ww(i)}(i.value.mapValue),VI.exists(!0)))}return s.mutationQueue.addMutationBatch(n,a,t,i)}).next(e=>{var t=(l=e).applyToLocalDocumentSet(c,r);return s.documentOverlayCache.saveOverlays(n,e.batchId,t)})}).then(()=>({batchId:l.batchId,changes:_I(c)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.ac[e.currentUser.toKey()];r=r||new Vw(k_),r=r.insert(t,n),e.ac[e.currentUser.toKey()]=r}(r,e.batchId,n),await fS(r,e.changes),await Ak(r.remoteStore)}catch(e){const t=Fk(e,"Failed to persist write");n.reject(t)}}async function sS(e,t){const r=e;try{const e=await M0(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.uc.get(t);n&&(d_(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?n.ec=!0:0<e.modifiedDocuments.size?d_(n.ec):0<e.removedDocuments.size&&(d_(n.ec),n.ec=!1))}),await fS(r,e,t)}catch(e){await W_(e)}}function aS(r,i,e){const t=r;if(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e){const r=[];t.sc.forEach((e,t)=>{var n=t.view.Ru(i);n.snapshot&&r.push(n.snapshot)}),function(e,n){const t=e;t.onlineState=n;let r=!1;t.queries.forEach((e,t)=>{for(const e of t.listeners)e.Ru(n)&&(r=!0)}),r&&Kk(t)}(t.eventManager,i),r.length&&t.nc.zo(r),t.onlineState=i,t.isPrimaryClient&&t.sharedClientState.setOnlineState(i)}}async function oS(e,t){const n=e,r=t.batch.batchId;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const t=r.batch.keys(),n=i.Ki.newChangeBuffer({trackRemovals:!0});return function(e,t,r,i){const s=r.batch,n=s.keys();let a=G_.resolve();return n.forEach(n=>{a=a.next(()=>i.getEntry(t,n)).next(e=>{var t=r.docVersions.get(n);d_(null!==t),e.version.compareTo(t)<0&&(s.applyToRemoteDocument(e,r),e.isValidDocument()&&(e.setReadTime(r.commitVersion),i.addEntry(e)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,s))}(i,e,r,n).next(()=>n.apply(e)).next(()=>i.mutationQueue.performConsistencyCheck(e)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(e,t,r.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=TI();for(let n=0;n<e.mutationResults.length;++n)0<e.mutationResults[n].transformResults.length&&(t=t.add(e.batch.mutations[n].key));return t}(r))).next(()=>i.localDocuments.getDocuments(e,t))})}(n.localStore,t);lS(n,r,null),cS(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await fS(n,e)}catch(e){await W_(e)}}function cS(e,t){(e.hc.get(t)||[]).forEach(e=>{e.resolve()}),e.hc.delete(t)}function lS(e,t,n){const r=e;let i=r.ac[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.ac[r.currentUser.toKey()]=i}}function uS(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.ic.get(e))t.sc.delete(r),n&&t.nc.wc(r,n);t.ic.delete(e),t.isPrimaryClient&&t.cc.hs(e).forEach(e=>{t.cc.containsKey(e)||hS(t,e)})}function hS(e,t){e.rc.delete(t.path.canonicalString());var n=e.oc.get(t);null!==n&&(wk(e.remoteStore,n),e.oc=e.oc.remove(t),e.uc.delete(n),pS(e))}function dS(e,t,n){for(const r of n)r instanceof Jk?(e.cc.addReference(r.key,t),function(e,t){const n=t.key,r=n.path.canonicalString();e.oc.get(n)||e.rc.has(r)||(o_("SyncEngine","New document in limbo: "+n),e.rc.add(r),pS(e))}(e,r)):r instanceof Xk?(o_("SyncEngine","Document no longer in limbo: "+r.key),e.cc.removeReference(r.key,t),e.cc.containsKey(r.key)||hS(e,r.key)):h_()}function pS(e){for(;0<e.rc.size&&e.oc.size<e.maxConcurrentLimboResolutions;){var t=e.rc.values().next().value;e.rc.delete(t);var n=new O_(D_.fromString(t)),t=e.lc.next();e.uc.set(t,new tS(n)),e.oc=e.oc.insert(n,t),_k(e.remoteStore,new $T(aI(eI(n.path)),t,2,sw.ct))}}async function fS(e,t,r){const i=e,s=[],a=[],o=[];i.sc.isEmpty()||(i.sc.forEach((e,n)=>{o.push(i.dc(n,t,r).then(e=>{var t;(e||r)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(n.targetId,null!=e&&e.fromCache?"not-current":"current"),e&&(s.push(e),t=A0.Di(n.targetId,e),a.push(t))}))}),await Promise.all(o),i.nc.zo(s),await async function(e,t){const r=e;try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>G_.forEach(t,t=>G_.forEach(t.Vi,e=>r.persistence.referenceDelegate.addReference(n,t.targetId,e)).next(()=>G_.forEach(t.Si,e=>r.persistence.referenceDelegate.removeReference(n,t.targetId,e)))))}catch(e){if(!X_(e))throw e;o_("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=r.Li.get(t),n=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(n);r.Li=r.Li.insert(t,i)}}}(i.localStore,a))}async function gS(r,e){const i=r;if(yS(i),_S(i),!0===e&&!0!==i.fc){const r=i.sharedClientState.getAllActiveQueryTargets(),e=await mS(i,r.toArray());i.fc=!0,await Pk(i.remoteStore,!0);for(const r of e)_k(i.remoteStore,r)}else if(!1===e&&!1!==i.fc){const r=[];let n=Promise.resolve();i.ic.forEach((e,t)=>{i.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(uS(i,t),U0(i.localStore,t,!0))),wk(i.remoteStore,t)}),await n,await mS(i,r),function(){const n=i;n.uc.forEach((e,t)=>{wk(n.remoteStore,t)}),n.cc.ls(),n.uc=new Map,n.oc=new Vw(O_.comparator)}(),i.fc=!1,await Pk(i.remoteStore,!1)}}async function mS(t,n){const r=t,i=[],s=[];for(const t of n){let e;const u=r.ic.get(t);if(u&&0!==u.length){e=await F0(r.localStore,aI(u[0]));for(const t of u){const n=r.sc.get(t),u=(a=r,o=n,l=c=void 0,l=await q0((c=a).localStore,o.query,!0),l=o.view.Xu(l),c.isPrimaryClient&&dS(c,o.targetId,l.Yu),await l);u.snapshot&&s.push(u.snapshot)}}else{const u=await V0(r.localStore,t);e=await F0(r.localStore,u),await rS(r,vS(u),t,!1,e.resumeToken)}i.push(e)}var a,o,c,l;return r.nc.zo(s),i}function vS(e){return Zb(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function yS(e){const t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=sS.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=(function(e,t){const n=e,r=n.uc.get(t);if(r&&r.ec)return TI().add(r.key);{let e=TI();const r=n.ic.get(t);if(!r)return e;for(const t of r){const r=n.sc.get(t);e=e.unionWith(r.view.Qu)}return e}}).bind(null,t),t.remoteStore.remoteSyncer.rejectListen=(async function(e,t,n){const r=e;r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.uc.get(t),s=i&&i.key;if(s){let e=new Vw(O_.comparator);e=e.insert(s,Ib.newNoDocument(s,A_.min()));const n=TI().add(s),i=new cT(A_.min(),new Map,new zw(k_),e,n);await sS(r,i),r.oc=r.oc.remove(s),r.uc.delete(t),pS(r)}else await U0(r.localStore,t,!1).then(()=>uS(r,t,n)).catch(W_)}).bind(null,t),t.nc.zo=(function(e,t){const n=e;let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.vu(e)&&(r=!0);i.Eu=e}}r&&Kk(n)}).bind(null,t.eventManager),t.nc.wc=(function(e,t,n){const r=e,i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}).bind(null,t.eventManager),t}function _S(e){const t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=oS.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=(async function(e,t,n){const r=e;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let n;return i.mutationQueue.lookupMutationBatch(t,r).next(e=>(d_(null!==e),n=e.keys(),i.mutationQueue.removeMutationBatch(t,e))).next(()=>i.mutationQueue.performConsistencyCheck(t)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(t,n,r)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,n)).next(()=>i.localDocuments.getDocuments(t,n))})}(r.localStore,t);lS(r,t,n),cS(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await fS(r,e)}catch(n){await W_(n)}}).bind(null,t),t}class wS{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=lk(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return x0(this.persistence,new R0,e.initialUser,this.serializer)}createPersistence(e){return new _0(b0.Fs,this.serializer)}createSharedClientState(e){return new X0}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class bS extends wS{constructor(e,t,n){super(),this.mc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.mc.initialize(this,e),await _S(this.mc.syncEngine),await Ak(this.mc.remoteStore),await this.persistence.hi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){return x0(this.persistence,new R0,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){var n=this.persistence.referenceDelegate.garbageCollector;return new YE(n,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){var n=new iw(t,this.persistence);return new rw(e.asyncQueue,n)}createPersistence(e){var t=N0(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?ME.withCacheSize(this.cacheSizeBytes):ME.DEFAULT;return new k0(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,ok(),ck(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new X0}}class IS extends bS{constructor(e,t){super(e,t,!1),this.mc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);var t=this.mc.syncEngine;this.sharedClientState instanceof J0&&(this.sharedClientState.syncEngine={$r:(async function(e,t,n,r){var i=e,s=await function(e,n){const r=e,i=r.mutationQueue;return r.persistence.runTransaction("Lookup mutation documents","readonly",t=>i.In(t,n).next(e=>e?r.localDocuments.getDocuments(t,e):G_.resolve(null)))}(i.localStore,t);null!==s?("pending"===n?await Ak(i.remoteStore):"acknowledged"===n||"rejected"===n?(lS(i,t,r||null),cS(i,t),i.localStore.mutationQueue.En(t)):h_(),await fS(i,s)):o_("SyncEngine","Cannot apply mutation batch with id: "+t)}).bind(null,t),Mr:(async function(e,t,n,r){const i=e;if(i.fc)o_("SyncEngine","Ignoring unexpected query state notification.");else{var s=i.ic.get(t);if(s&&0<s.length)switch(n){case"current":case"not-current":{const e=await B0(i.localStore,pI(s[0])),r=cT.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,Hw.EMPTY_BYTE_STRING);await fS(i,e,r);break}case"rejected":await U0(i.localStore,t,!0),uS(i,t,r);break;default:h_()}}}).bind(null,t),Fr:(async function(e,t,n){const r=yS(e);if(r.fc){for(const e of t)if(r.ic.has(e))o_("SyncEngine","Adding an already active target "+e);else{const t=await V0(r.localStore,e),n=await F0(r.localStore,t);await rS(r,vS(t),n.targetId,!1,n.resumeToken),_k(r.remoteStore,n)}for(const e of n)r.ic.has(e)&&await U0(r.localStore,e,!1).then(()=>{wk(r.remoteStore,e),uS(r,e)}).catch(W_)}}).bind(null,t),bi:(function(e){return e.localStore.persistence.bi()}).bind(null,t),Or:(async function(e,t){const n=e;return B0(n.localStore,t).then(e=>fS(n,e))}).bind(null,t)},await this.sharedClientState.start()),await this.persistence.hi(async e=>{await gS(this.mc.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}createSharedClientState(e){var t=ok();if(!J0.D(t))throw new f_(p_.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=N0(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new J0(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class TS{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>aS(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=(async function(e,t){const n=e;if(!n.currentUser.isEqual(t)){o_("SyncEngine","User change. New user:",t.toKey());const r=await P0(n.localStore,t);n.currentUser=t,(e=n).hc.forEach(e=>{e.forEach(e=>{e.reject(new f_(p_.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.hc.clear(),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await fS(n,r.Qi)}}).bind(null,this.syncEngine),await Pk(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new jk}createDatastore(e){var t,n,r,i,s=lk(e.databaseInfo.databaseId),t=(t=e.databaseInfo,new ak(t));return n=e.authCredentials,r=e.appCheckCredentials,i=t,e=s,new fk(n,r,i,e)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>aS(this.syncEngine,e,0),s=new(ek.D()?ek:Z0),new mk(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,a){const o=new nS(e,t,n,r,i,s);return a&&(o.fc=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=e;o_("RemoteStore","RemoteStore shutting down."),t.du.add(5),await yk(t),t._u.shutdown(),t.mu.set("Unknown")}(this.remoteStore)}}function ES(t,n=10240){let r=0;return{async read(){if(r<t.byteLength){var e={value:t.slice(r,r+n),done:!1};return r+=n,e}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class kS{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.gc(this.observer.next,e)}error(e){this.observer.error?this.gc(this.observer.error,e):c_("Uncaught Error in snapshot listener:",e.toString())}yc(){this.muted=!0}gc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class SS{constructor(e,t){this.Ic=e,this.serializer=t,this.metadata=new g_,this.buffer=new Uint8Array,this.Tc=new TextDecoder("utf-8"),this.Ec().then(e=>{e&&e.ku()?this.metadata.resolve(e.Nu.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.Nu)}`))},e=>this.metadata.reject(e))}close(){return this.Ic.cancel()}async getMetadata(){return this.metadata.promise}async _c(){return await this.getMetadata(),this.Ec()}async Ec(){var e=await this.Ac();if(null===e)return null;var t=this.Tc.decode(e),n=Number(t);isNaN(n)&&this.Rc(`length string (${t}) is not valid number`);t=await this.vc(n);return new Gk(JSON.parse(t),e.length+n)}bc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async Ac(){for(;this.bc()<0&&!await this.Pc(););if(0===this.buffer.length)return null;var e=this.bc();e<0&&this.Rc("Reached the end of bundle when a length string is expected.");var t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async vc(e){for(;this.buffer.length<e;)await this.Pc()&&this.Rc("Reached the end of bundle when more is expected.");var t=this.Tc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Rc(e){throw this.Ic.cancel(),new Error(`Invalid bundle format: ${e}`)}async Pc(){var e=await this.Ic.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class CS{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new f_(p_.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const r=e,n=RT(r.serializer)+"/documents",i={documents:t.map(e=>ST(r.serializer,e))},s=await r.fo("BatchGetDocuments",n,i,t.length),a=new Map;s.forEach(e=>{const t=(n=r.serializer,"found"in(e=e)?function(e,t){d_(!!t.found),t.found.name,t.found.updateTime;var n=CT(e,t.found.name),r=TT(t.found.updateTime),i=t.found.createTime?TT(t.found.createTime):A_.min(),s=new bb({mapValue:{fields:t.found.fields}});return Ib.newFoundDocument(n,r,i,s)}(n,e):"missing"in e?function(e,t){d_(!!t.missing),d_(!!t.readTime);var n=CT(e,t.missing),r=TT(t.readTime);return Ib.newNoDocument(n,r)}(n,e):h_());var n;a.set(t.key.toString(),t)});const o=[];return t.forEach(e=>{var t=a.get(e.toString());d_(!!t),o.push(t)}),o}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new XI(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{var n=O_.fromPath(t);this.mutations.push(new ZI(n,this.precondition(n)))}),await async function(e,t){const n=e,r=RT(n.serializer)+"/documents",i={writes:t.map(e=>OT(n.serializer,e))};await n.co("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw h_();t=A_.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new f_(p_.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(A_.min())?VI.exists(!1):VI.updateTime(t):VI.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return VI.exists(!0);if(t.isEqual(A_.min()))throw new f_(p_.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return VI.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class NS{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Vc=n.maxAttempts,this.Co=new uk(this.asyncQueue,"transaction_retry")}run(){--this.Vc,this.Sc()}Sc(){this.Co.Ao(async()=>{const t=new CS(this.datastore),e=this.Dc(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.Cc(e)}))}).catch(e=>{this.Cc(e)})})}Dc(e){try{var t=this.updateFunction(e);return!aw(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Cc(e){0<this.Vc&&this.xc(e)?(--this.Vc,this.asyncQueue.enqueueAndForget(()=>(this.Sc(),Promise.resolve()))):this.deferred.reject(e)}xc(e){if("FirebaseError"!==e.name)return!1;var t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!iT(t)}}class AS{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=r_.UNAUTHENTICATED,this.clientId=E_.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{o_("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(o_("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new f_(p_.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const n=new g_;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(e){var t=Fk(e,"Failed to shutdown persistence");n.reject(t)}}),n.promise}}async function RS(e,t){e.asyncQueue.verifyOperationInProgress(),o_("FirestoreClient","Initializing OfflineComponentProvider");var n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await P0(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function DS(e,n){e.asyncQueue.verifyOperationInProgress();var t=await PS(e);o_("FirestoreClient","Initializing OnlineComponentProvider");var r=await e.getConfiguration();await n.initialize(t,r),e.setCredentialChangeListener(e=>xk(n.remoteStore,e)),e.setAppCheckTokenChangeListener((e,t)=>xk(n.remoteStore,t)),e._onlineComponents=n}function xS(e){return"FirebaseError"===e.name?e.code===p_.FAILED_PRECONDITION||e.code===p_.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function PS(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){o_("FirestoreClient","Using user provided OfflineComponentProvider");try{await RS(t,t._uninitializedComponentsProvider._offline)}catch(e){var n=e;if(!xS(n))throw n;l_("Error using user provided cache. Falling back to memory cache: "+n),await RS(t,new wS)}}else o_("FirestoreClient","Using default OfflineComponentProvider"),await RS(t,new wS);return t._offlineComponents}async function OS(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(o_("FirestoreClient","Using user provided OnlineComponentProvider"),await DS(e,e._uninitializedComponentsProvider._online)):(o_("FirestoreClient","Using default OnlineComponentProvider"),await DS(e,new TS))),e._onlineComponents}function MS(e){return PS(e).then(e=>e.persistence)}function LS(e){return PS(e).then(e=>e.localStore)}function FS(e){return OS(e).then(e=>e.remoteStore)}function US(e){return OS(e).then(e=>e.syncEngine)}async function qS(e){const t=await OS(e),n=t.eventManager;return n.onListen=(async function(e,t){const n=yS(e);let r,i;const s=n.sc.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.tc();else{const e=await F0(n.localStore,aI(t));n.isPrimaryClient&&_k(n.remoteStore,e);const s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await rS(n,t,r,"current"===s,e.resumeToken)}return i}).bind(null,t.syncEngine),n.onUnlisten=(async function(e,t){const n=e,r=n.sc.get(t),i=n.ic.get(r.targetId);if(1<i.length)return n.ic.set(r.targetId,i.filter(e=>!lI(e,t))),void n.sc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await U0(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),wk(n.remoteStore,r.targetId),uS(n,r.targetId)}).catch(W_)):(uS(n,r.targetId),await U0(n.localStore,r.targetId,!0))}).bind(null,t.syncEngine),n}function VS(e,t,n={}){const r=new g_;return e.asyncQueue.enqueueAndForget(async()=>function(n,r,i,s,a){const e=new kS({next:e=>{r.enqueueAndForget(()=>$k(n,o));var t=e.docs.has(i);!t&&e.fromCache?a.reject(new f_(p_.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&s&&"server"===s.source?a.reject(new f_(p_.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):a.resolve(e)},error:e=>a.reject(e)}),o=new Wk(eI(i.path),e,{includeMetadataChanges:!0,xu:!0});return zk(n,o)}(await qS(e),e.asyncQueue,t,n,r)),r.promise}function BS(e,t,n={}){const r=new g_;return e.asyncQueue.enqueueAndForget(async()=>function(t,n,e,r,i){const s=new kS({next:e=>{n.enqueueAndForget(()=>$k(t,a)),e.fromCache&&"server"===r.source?i.reject(new f_(p_.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(e)},error:e=>i.reject(e)}),a=new Wk(e,s,{includeMetadataChanges:!0,xu:!0});return zk(t,a)}(await qS(e),e.asyncQueue,t,n,r)),r.promise}function jS(e,t,n,r){const i=(n=n,t=lk(t),s="string"==typeof n?(new TextEncoder).encode(n):n,n=function(e){if(e instanceof Uint8Array)return ES(e,void 0);if(e instanceof ArrayBuffer)return ES(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(s),t=t,new SS(n,t));var s;e.asyncQueue.enqueueAndForget(async()=>{!function(e,t,n){const r=e;!async function(t,n,r){try{var i=await n.getMetadata();if(await function(e,t){const n=e,r=TT(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.xs.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(r))}(t.localStore,i))return await n.close(),r._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}),Promise.resolve(new Set);r._updateProgress(Yk(i));const a=new Qk(i,t.localStore,n.serializer);let e=await n._c();for(;e;){const t=await a.$u(e);t&&r._updateProgress(t),e=await n._c()}var s=await a.complete();return await fS(t,s.Bu,void 0),await function(e,t){const n=e;return n.persistence.runTransaction("Save bundle","readwrite",e=>n.xs.saveBundleMetadata(e,t))}(t.localStore,i),r._completeWith(s.progress),Promise.resolve(s.Fu)}catch(t){return l_("SyncEngine",`Loading bundle failed with ${t}`),r._failWith(t),Promise.resolve(new Set)}}(r,t,n).then(e=>{r.sharedClientState.notifyBundleLoaded(e)})}(await US(e),i,r)})}const zS=new Map;function $S(e,t,n){if(!n)throw new f_(p_.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function KS(e,t,n,r){if(!0===t&&!0===r)throw new f_(p_.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function WS(e){if(!O_.isDocumentKey(e))throw new f_(p_.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function GS(e){if(O_.isDocumentKey(e))throw new f_(p_.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function HS(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":h_();if(e instanceof Array)return"an array";var t=(e=e).constructor?e.constructor.name:null;return t?`a custom ${t} object`:"an object"}function QS(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new f_(p_.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=HS(e);throw new f_(p_.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}function YS(e,t){if(t<=0)throw new f_(p_.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class JS{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new f_(p_.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new f_(p_.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,KS("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class XS{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new JS({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new f_(p_.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new f_(p_.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new JS(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new v_;switch(e.type){case"firstParty":return new b_(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new f_(p_.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=zS.get(e);t&&(o_("ComponentProvider","Removing Datastore"),zS.delete(e),t.terminate())}(this),Promise.resolve()}}class ZS{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new tC(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ZS(this.firestore,e,this._key)}}class eC{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new eC(this.firestore,e,this._query)}}class tC extends eC{constructor(e,t,n){super(e,t,eI(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ZS(this.firestore,null,new O_(e))}withConverter(e){return new tC(this.firestore,e,this._path)}}function nC(e,t,...n){if(e=ae(e),$S("collection","path",t),e instanceof XS){var r=D_.fromString(t,...n);return GS(r),new tC(e,null,r)}if(!(e instanceof ZS||e instanceof tC))throw new f_(p_.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(D_.fromString(t,...n));return GS(r),new tC(e.firestore,null,r)}function rC(e,t,...n){if(e=ae(e),$S("doc","path",t=1===arguments.length?E_.A():t),e instanceof XS){var r=D_.fromString(t,...n);return WS(r),new ZS(e,null,new O_(r))}if(!(e instanceof ZS||e instanceof tC))throw new f_(p_.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(D_.fromString(t,...n));return WS(r),new ZS(e.firestore,e instanceof tC?e.converter:null,new O_(r))}function iC(e,t){return e=ae(e),t=ae(t),(e instanceof ZS||e instanceof tC)&&(t instanceof ZS||t instanceof tC)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function sC(e,t){return e=ae(e),t=ae(t),e instanceof eC&&t instanceof eC&&e.firestore===t.firestore&&lI(e._query,t._query)&&e.converter===t.converter}class aC{constructor(){this.Nc=Promise.resolve(),this.kc=[],this.Oc=!1,this.$c=[],this.Mc=null,this.Fc=!1,this.Bc=!1,this.Lc=[],this.Co=new uk(this,"async_queue_retry"),this.qc=()=>{var e=ck();e&&o_("AsyncQueue","Visibility state changed to "+e.visibilityState),this.Co.vo()};const e=ck();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.qc)}get isShuttingDown(){return this.Oc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Uc(),this.Kc(e)}enterRestrictedMode(e){if(!this.Oc){this.Oc=!0,this.Bc=e||!1;const t=ck();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.qc)}}enqueue(e){if(this.Uc(),this.Oc)return new Promise(()=>{});const t=new g_;return this.Kc(()=>this.Oc&&this.Bc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.kc.push(e),this.Gc()))}async Gc(){if(0!==this.kc.length){try{await this.kc[0](),this.kc.shift(),this.Co.reset()}catch(e){if(!X_(e))throw e;o_("AsyncQueue","Operation failed with retryable error: "+e)}0<this.kc.length&&this.Co.Ao(()=>this.Gc())}}Kc(e){var t=this.Nc.then(()=>(this.Fc=!0,e().catch(e=>{throw this.Mc=e,this.Fc=!1,c_("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.Fc=!1,e))));return this.Nc=t}enqueueAfterDelay(e,t,n){this.Uc(),-1<this.Lc.indexOf(e)&&(t=0);var r=Lk.createAndSchedule(this,e,t,n,e=>this.Qc(e));return this.$c.push(r),r}Uc(){this.Mc&&h_()}verifyOperationInProgress(){}async zc(){for(var e;await(e=this.Nc),e!==this.Nc;);}jc(e){for(const t of this.$c)if(t.timerId===e)return!0;return!1}Wc(t){return this.zc().then(()=>{this.$c.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const e of this.$c)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.zc()})}Hc(e){this.Lc.push(e)}Qc(e){var t=this.$c.indexOf(e);this.$c.splice(t,1)}}function oC(e){return function(e){if("object"==typeof e&&null!==e){var t=e;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return 1}}(e)}class cC{constructor(){this._progressObserver={},this._taskCompletionResolver=new g_,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}var lC,uC,hC,dC;class pC extends XS{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new aC,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||gC(this),this._firestoreClient.terminate()}}function fC(e){return e._firestoreClient||gC(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function gC(e){var t,n,r,i,s,a=e._freezeSettings(),o=(n=e._databaseId,r=(null===(o=e._app)||void 0===o?void 0:o.options.appId)||"",i=e._persistenceKey,s=a,new tb(n,r,i,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams));e._firestoreClient=new AS(e._authCredentials,e._appCheckCredentials,e._queue,o),null!==(o=a.cache)&&void 0!==o&&o._offlineComponentProvider&&null!==(t=a.cache)&&void 0!==t&&t._onlineComponentProvider&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:a.cache.kind,_offline:a.cache._offlineComponentProvider,_online:a.cache._onlineComponentProvider})}function mC(e,t,n){const r=new g_;return e.asyncQueue.enqueue(async()=>{try{await RS(e,n),await DS(e,t),r.resolve()}catch(e){const t=e;if(!xS(t))throw t;l_("Error enabling indexeddb cache. Falling back to memory cache: "+t),r.reject(t)}}).then(()=>r.promise)}function vC(e){return function(e){const t=new g_;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=e;kk(n.remoteStore)||o_("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(){const t=n.localStore;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}();if(-1===e)return void t.resolve();const r=n.hc.get(e)||[];r.push(t),n.hc.set(e,r)}catch(e){const n=Fk(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await US(e),t)),t.promise}(fC(e=QS(e,pC)))}function yC(e){return(n=fC(e=QS(e,pC))).asyncQueue.enqueue(async()=>{const e=await MS(n),t=await FS(n);return e.setNetworkEnabled(!0),function(){const e=t;return e.du.delete(0),vk(e)}()});var n}function _C(e){return(n=fC(e=QS(e,pC))).asyncQueue.enqueue(async()=>{const e=await MS(n),t=await FS(n);return e.setNetworkEnabled(!1),async function(){const e=t;e.du.add(0),await yk(e),e.mu.set("Offline")}()});var n}function wC(t,e){return n=fC(t=QS(t,pC)),r=e,n.asyncQueue.enqueue(async()=>function(e,t){const n=e;return n.persistence.runTransaction("Get named query","readonly",e=>n.xs.getNamedQuery(e,t))}(await LS(n),r)).then(e=>e?new eC(t,null,e.query):null);var n,r}function bC(e){if(e._initialized||e._terminated)throw new f_(p_.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class IC{constructor(e){this._byteString=e}static fromBase64String(e){try{return new IC(Hw.fromBase64String(e))}catch(e){throw new f_(p_.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new IC(Hw.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class TC{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new f_(p_.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new P_(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class EC{constructor(e){this._methodName=e}}class kC{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new f_(p_.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new f_(p_.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return k_(this._lat,e._lat)||k_(this._long,e._long)}}const SC=/^__.*__$/;class CC{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new HI(e,this.data,this.fieldMask,t,this.fieldTransforms):new GI(e,this.data,t,this.fieldTransforms)}}class NC{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new HI(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function AC(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw h_()}}class RC{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Jc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Yc(){return this.settings.Yc}Zc(e){return new RC(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Xc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Zc({path:n,ta:!1});return r.ea(e),r}na(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Zc({path:n,ta:!1});return r.Jc(),r}sa(e){return this.Zc({path:void 0,ta:!0})}ia(e){return YC(e,this.settings.methodName,this.settings.ra||!1,this.path,this.settings.oa)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}Jc(){if(this.path)for(let e=0;e<this.path.length;e++)this.ea(this.path.get(e))}ea(e){if(0===e.length)throw this.ia("Document fields must not be empty");if(AC(this.Yc)&&SC.test(e))throw this.ia('Document fields cannot begin and end with "__"')}}class DC{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||lk(e)}ua(e,t,n,r=!1){return new RC({Yc:e,methodName:t,oa:n,path:P_.emptyPath(),ta:!1,ra:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function xC(e){var t=e._freezeSettings(),n=lk(e._databaseId);return new DC(e._databaseId,!!t.ignoreUndefinedProperties,n)}function PC(e,t,n,r,i,s={}){const a=e.ua(s.merge||s.mergeFields?2:0,t,n,i);WC("Data must be an object, but it was:",a,r);var o=$C(r,a);let c,l;if(s.merge)c=new Ww(a.fieldMask),l=a.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=GC(t,r,n);if(!a.contains(i))throw new f_(p_.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);JC(e,i)||e.push(i)}c=new Ww(e),l=a.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,l=a.fieldTransforms;return new CC(new bb(o),c,l)}class OC extends EC{_toFieldTransform(e){if(2!==e.Yc)throw 1===e.Yc?e.ia(`${this._methodName}() can only appear at the top level of your update data`):e.ia(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof OC}}function MC(e,t,n){return new RC({Yc:3,oa:t.settings.oa,methodName:e._methodName,ta:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class LC extends EC{_toFieldTransform(e){return new UI(e.path,new RI)}isEqual(e){return e instanceof LC}}class FC extends EC{constructor(e,t){super(e),this.ca=t}_toFieldTransform(e){const t=MC(this,e,!0),n=this.ca.map(e=>zC(e,t)),r=new DI(n);return new UI(e.path,r)}isEqual(e){return this===e}}class UC extends EC{constructor(e,t){super(e),this.ca=t}_toFieldTransform(e){const t=MC(this,e,!0),n=this.ca.map(e=>zC(e,t)),r=new PI(n);return new UI(e.path,r)}isEqual(e){return this===e}}class qC extends EC{constructor(e,t){super(e),this.aa=t}_toFieldTransform(e){var t=new MI(e.serializer,CI(e.serializer,this.aa));return new UI(e.path,t)}isEqual(e){return this===e}}function VC(e,i,s,t){const a=e.ua(1,i,s);WC("Data must be an object, but it was:",a,t);const o=[],c=bb.empty();Uw(t,(e,t)=>{var n=QC(i,e,s);t=ae(t);var r=a.na(n);if(t instanceof OC)o.push(n);else{const e=zC(t,r);null!=e&&(o.push(n),c.set(n,e))}});var n=new Ww(o);return new NC(c,n,a.fieldTransforms)}function BC(e,t,n,r,i,s){const a=e.ua(1,t,n),o=[GC(t,r,n)],c=[i];if(s.length%2!=0)throw new f_(p_.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<s.length;p+=2)o.push(GC(t,s[p])),c.push(s[p+1]);const l=[],u=bb.empty();for(let f=o.length-1;0<=f;--f)if(!JC(l,o[f])){const t=o[f];var h=ae(h=c[f]);const r=a.na(t);if(h instanceof OC)l.push(t);else{const e=zC(h,r);null!=e&&(l.push(t),u.set(t,e))}}var d=new Ww(l);return new NC(u,d,a.fieldTransforms)}function jC(e,t,n,r=!1){return zC(n,e.ua(r?4:3,t))}function zC(s,e){if(KC(s=ae(s)))return WC("Unsupported field value:",e,s),$C(s,e);if(s instanceof EC)return function(e,t){if(!AC(t.Yc))throw t.ia(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.ia(`${e._methodName}() is not currently supported inside arrays`);var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(s,e),null;if(void 0===s&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.ta&&4!==e.Yc)throw e.ia("Nested arrays are not supported");return function(t){const n=[];let r=0;for(const i of s){let e=zC(i,t.sa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e)}return function(e,t){if(null===(e=ae(s)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return CI(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=N_.fromDate(e);return{timestampValue:bT(t.serializer,n)}}if(e instanceof N_){n=new N_(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:bT(t.serializer,n)}}if(e instanceof kC)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof IC)return{bytesValue:IT(t.serializer,e._byteString)};if(e instanceof ZS){const r=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(r))throw t.ia(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:ET(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.ia(`Unsupported field value: ${HS(e)}`)}(0,e)}function $C(e,r){const i={};return qw(e)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):Uw(e,(e,t)=>{var n=zC(t,r.Xc(e));null!=n&&(i[e]=n)}),{mapValue:{fields:i}}}function KC(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof N_||e instanceof kC||e instanceof IC||e instanceof ZS||e instanceof EC)}function WC(e,t,n){if(!KC(n)||("object"!=typeof(i=n)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i))){var r=HS(n);throw"an object"===r?t.ia(e+" a custom object"):t.ia(e+" "+r)}var i}function GC(e,t,n){if((t=ae(t))instanceof TC)return t._internalPath;if("string"==typeof t)return QC(e,t);throw YC("Field path arguments must be of type string or ",e,!1,void 0,n)}const HC=new RegExp("[~\\*/\\[\\]]");function QC(t,n,r){if(0<=n.search(HC))throw YC(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new TC(...n.split("."))._internalPath}catch(e){throw YC(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function YC(e,t,n,r,i){var s=r&&!r.isEmpty(),a=void 0!==i;let o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=` in field ${r}`),a&&(c+=` in document ${i}`),c+=")"),new f_(p_.INVALID_ARGUMENT,o+e+c)}function JC(e,t){return e.some(e=>e.isEqual(t))}class XC{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ZS(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){var e=new ZC(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){var t=this._document.data.field(eN("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class ZC extends XC{data(){return super.data()}}function eN(e,t){return"string"==typeof t?QC(e,t):(t instanceof TC?t:t._delegate)._internalPath}function tN(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new f_(p_.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class nN{}class rN extends nN{}function iN(e,t,...n){let r=[];t instanceof nN&&r.push(t),r=r.concat(n),function(e){var t=e.filter(e=>e instanceof aN).length,n=e.filter(e=>e instanceof sN).length;if(1<t||0<t&&0<n)throw new f_(p_.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class sN extends rN{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new sN(e,t,n)}_apply(e){var t=this._parse(e);return fN(e._query,t),new eC(e.firestore,e.converter,oI(e._query,t))}_parse(e){var t=xC(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new f_(p_.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){pN(a,s);const t=[];for(const n of a)t.push(dN(r,e,n));o={arrayValue:{values:t}}}else o=dN(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||pN(a,s),o=jC(n,t,a,"in"===s||"not-in"===s);return Nb.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class aN extends nN{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new aN(e,t)}_parse(t){var e=this._queryConstraints.map(e=>e._parse(t)).filter(e=>0<e.getFilters().length);return 1===e.length?e[0]:Ab.create(e,this._getOperator())}_apply(e){const n=this._parse(e);return 0===n.getFilters().length?e:(function(e){let t=e;for(const e of n.getFlattenedFilters())fN(t,e),t=oI(t,e)}(e._query),new eC(e.firestore,e.converter,oI(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class oN extends rN{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new oN(e,t)}_apply(e){var t=function(e,t,n){if(null!==e.startAt)throw new f_(p_.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new f_(p_.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r,i=new Sb(t,n);return n=i,null!==nI(e=e)||null!==(r=rI(e))&&gN(0,r,n.field),i}(e._query,this._field,this._direction);return new eC(e.firestore,e.converter,(e=e._query,t=e.explicitOrderBy.concat([t]),new Xb(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class cN extends rN{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new cN(e,t,n)}_apply(e){return new eC(e.firestore,e.converter,cI(e._query,this._limit,this._limitType))}}class lN extends rN{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new lN(e,t,n)}_apply(e){var t,n=hN(e,this.type,this._docOrFields,this._inclusive);return new eC(e.firestore,e.converter,(t=e._query,e=n,new Xb(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))}}class uN extends rN{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new uN(e,t,n)}_apply(e){var t,n=hN(e,this.type,this._docOrFields,this._inclusive);return new eC(e.firestore,e.converter,(t=e._query,e=n,new Xb(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))}}function hN(e,t,n,r){if(n[0]=ae(n[0]),n[0]instanceof XC)return function(e,t,n,r,i){if(!r)throw new f_(p_.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of sI(e))if(n.field.isKeyField())s.push(hb(t,r.key));else{const e=r.data.field(n.field);if(Zw(e))throw new f_(p_.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new f_(p_.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new Tb(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=xC(e.firestore);return function(e,t,n,r,i,s){const a=e.explicitOrderBy;if(i.length>a.length)throw new f_(p_.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const o=[];for(let c=0;c<i.length;c++){const l=i[c];if(a[c].field.isKeyField()){if("string"!=typeof l)throw new f_(p_.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!iI(e)&&-1!==l.indexOf("/"))throw new f_(p_.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);const n=e.path.child(D_.fromString(l));if(!O_.isDocumentKey(n))throw new f_(p_.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new O_(n);o.push(hb(t,i))}else{const e=jC(n,r,l);o.push(e)}}return new Tb(o,s)}(e._query,e.firestore._databaseId,i,t,n,r)}function dN(e,t,n){if("string"==typeof(n=ae(n))){if(""===n)throw new f_(p_.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!iI(t)&&-1!==n.indexOf("/"))throw new f_(p_.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);var r=t.path.child(D_.fromString(n));if(!O_.isDocumentKey(r))throw new f_(p_.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return hb(e,new O_(r))}if(n instanceof ZS)return hb(e,n._key);throw new f_(p_.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${HS(n)}.`)}function pN(e,t){if(!Array.isArray(e)||0===e.length)throw new f_(p_.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function fN(e,t){if(t.isInequality()){const r=rI(e),i=t.field;if(null!==r&&!r.isEqual(i))throw new f_(p_.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${i.toString()}'`);var n=nI(e);null!==n&&gN(0,i,n)}const r=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(0<=t.indexOf(e.op))return e.op;return null}(e.filters,function(){switch(t.op){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}());if(null!==r)throw r===t.op?new f_(p_.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new f_(p_.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function gN(e,t,n){if(!n.isEqual(t))throw new f_(p_.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class mN{convertValue(e,t="none"){switch(sb(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Jw(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Xw(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw h_()}}convertObject(e,n){const r={};return Uw(e.fields,(e,t)=>{r[e]=this.convertValue(t,n)}),r}convertGeoPoint(e){return new kC(Jw(e.latitude),Jw(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var n=function e(t){var n=t.mapValue.fields.__previous_value__;return Zw(n)?e(n):n}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(eb(e));default:return null}}convertTimestamp(e){var t=Yw(e);return new N_(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=D_.fromString(e);d_(zT(n));const r=new nb(n.get(1),n.get(3)),i=new O_(n.popFirst(5));return r.isEqual(t)||c_(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function vN(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class yN extends mN{constructor(e){super(),this.firestore=e}convertBytes(e){return new IC(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new ZS(this.firestore,null,t)}}class _N{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class wN extends XC{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){var t=new bN(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){var n=this._document.data.field(eN("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class bN extends wN{data(e={}){return super.data(e)}}class IN{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new _N(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,n){this._snapshot.docs.forEach(e=>{t.call(n,new bN(this._firestore,this._userDataWriter,e.key,e,new _N(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){var t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new f_(p_.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,t){if(s._snapshot.oldDocs.isEmpty()){let n=0;return s._snapshot.docChanges.map(e=>{var t=new bN(s._firestore,s._userDataWriter,e.doc.key,e.doc,new _N(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);return e.doc,{type:"added",doc:t,oldIndex:-1,newIndex:n++}})}{let i=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new bN(s._firestore,s._userDataWriter,e.doc.key,e.doc,new _N(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);let n=-1,r=-1;return 0!==e.type&&(n=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(i=i.add(e.doc),r=i.indexOf(e.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return h_()}}(e.type),doc:t,oldIndex:n,newIndex:r}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function TN(e,t){return e instanceof wN&&t instanceof wN?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof IN&&t instanceof IN&&e._firestore===t._firestore&&sC(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class EN extends mN{constructor(e){super(),this.firestore=e}convertBytes(e){return new IC(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new ZS(this.firestore,null,t)}}function kN(t){t=QS(t,ZS);const n=QS(t.firestore,pC),e=fC(n),r=new EN(n);return function(e,t){const n=new g_;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const i=await function(t){const n=e;return n.persistence.runTransaction("read document","readonly",e=>n.localDocuments.getDocument(e,t))}(t);i.isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new f_(p_.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){var r=Fk(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await LS(e),t,n)),n.promise}(e,t._key).then(e=>new wN(n,r,t._key,e,new _N(null!==e&&e.hasLocalMutations,!0),t.converter))}function SN(t){t=QS(t,eC);const n=QS(t.firestore,pC),e=fC(n),r=new EN(n);return function(e,t){const n=new g_;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const i=await q0(e,t,!0),s=new Zk(t,i.Wi),a=s.zu(i.documents),o=s.applyChanges(a,!1);n.resolve(o.snapshot)}catch(e){var r=Fk(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await LS(e),t,n)),n.promise}(e,t._query).then(e=>new IN(n,r,t,e))}function CN(e,t,n){e=QS(e,ZS);var r=QS(e.firestore,pC),i=vN(e.converter,t,n);return DN(r,[PC(xC(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,VI.none())])}function NN(e,t,n,...r){e=QS(e,ZS);var i=QS(e.firestore,pC),s=xC(i);let a;return a="string"==typeof(t=ae(t))||t instanceof TC?BC(s,"updateDoc",e._key,t,n,r):VC(s,"updateDoc",e._key,t),DN(i,[a.toMutation(e._key,VI.exists(!0))])}function AN(t,...n){var e;t=ae(t);let r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||oC(n[i])||(r=n[i],i++);var s={includeMetadataChanges:r.includeMetadataChanges};if(oC(n[i])){const t=n[i];n[i]=null===(e=t.next)||void 0===e?void 0:e.bind(t),n[i+1]=null===(e=t.error)||void 0===e?void 0:e.bind(t),n[i+2]=null===(e=t.complete)||void 0===e?void 0:e.bind(t)}let a,o,c;if(t instanceof ZS)o=QS(t.firestore,pC),c=eI(t._key.path),a={next:e=>{n[i]&&n[i](xN(o,t,e))},error:n[i+1],complete:n[i+2]};else{const l=QS(t,eC);o=QS(l.firestore,pC),c=l._query;const u=new EN(o);a={next:e=>{n[i]&&n[i](new IN(o,u,l,e))},error:n[i+1],complete:n[i+2]},tN(t._query)}return function(e,t,n,r){const i=new kS(r),s=new Wk(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>zk(await qS(e),s)),()=>{i.yc(),e.asyncQueue.enqueueAndForget(async()=>$k(await qS(e),s))}}(fC(o),c,s,a)}function RN(e,t){return function(e,t){const n=new kS(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Au.add(t),t.next()}(await qS(e),n)),()=>{n.yc(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Au.delete(t)}(await qS(e),n))}}(fC(e=QS(e,pC)),oC(t)?t:{next:t})}function DN(e,t){return function(e,t){const n=new g_;return e.asyncQueue.enqueueAndForget(async()=>iS(await US(e),t,n)),n.promise}(fC(e),t)}function xN(e,t,n){var r=n.docs.get(t._key),i=new EN(e);return new wN(e,i,t._key,r,new _N(n.hasPendingWrites,n.fromCache),t.converter)}const PN={maxAttempts:5};class ON{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=xC(e)}set(e,t,n){this._verifyNotCommitted();const r=MN(e,this._firestore),i=vN(r.converter,t,n),s=PC(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,VI.none())),this}update(e,t,n,...r){this._verifyNotCommitted();var i=MN(e,this._firestore);let s;return s="string"==typeof(t=ae(t))||t instanceof TC?BC(this._dataReader,"WriteBatch.update",i._key,t,n,r):VC(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,VI.exists(!0))),this}delete(e){this._verifyNotCommitted();var t=MN(e,this._firestore);return this._mutations=this._mutations.concat(new XI(t._key,VI.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new f_(p_.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function MN(e,t){if((e=ae(e)).firestore!==t)throw new f_(p_.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class LN extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=xC(e)}get(e){const n=MN(e,this._firestore),r=new yN(this._firestore);return this._transaction.lookup([n._key]).then(e=>{if(!e||1!==e.length)return h_();const t=e[0];if(t.isFoundDocument())return new XC(this._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new XC(this._firestore,r,n._key,null,n.converter);throw h_()})}set(e,t,n){var r=MN(e,this._firestore),i=vN(r.converter,t,n),i=PC(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,i),this}update(e,t,n,...r){var i=MN(e,this._firestore),s="string"==typeof(t=ae(t))||t instanceof TC?BC(this._dataReader,"Transaction.update",i._key,t,n,r):VC(this._dataReader,"Transaction.update",i._key,t);return this._transaction.update(i._key,s),this}delete(e){var t=MN(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=MN(e,this._firestore),n=new EN(this._firestore);return super.get(e).then(e=>new wN(this._firestore,n,t._key,e._document,new _N(!1,!1),t.converter))}}function FN(t,n,e){t=QS(t,pC);var r=Object.assign(Object.assign({},PN),e);return function(){if(r.maxAttempts<1)throw new f_(p_.INVALID_ARGUMENT,"Max attempts must be at least 1")}(),function(t,n,r){const i=new g_;return t.asyncQueue.enqueueAndForget(async()=>{var e=await OS(t).then(e=>e.datastore);new NS(t.asyncQueue,e,r,n,i).run()}),i.promise}(fC(t),e=>n(new LN(t,e)),r)}EA=Ye,i_=EA,We(new oe("firestore",(e,{instanceIdentifier:t,options:n})=>{const r=e.getProvider("app").getImmediate(),i=new pC(new __(e.getProvider("auth-internal")),new T_(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new f_(p_.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new nb(e.options.projectId,t)}(r,t),r);return n=Object.assign({useFetchStreams:!0},n),i._setSettings(n),i},"PUBLIC").setMultipleInstances(!0)),et(n_,"3.10.0",void 0),et(n_,"3.10.0","esm2017");function UN(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new f_("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function qN(){if("undefined"==typeof Uint8Array)throw new f_("unimplemented","Uint8Arrays are not available in this environment.")}function VN(){if("undefined"==typeof atob)throw new f_("unimplemented","Blobs are unavailable in Firestore in this environment.")}class BN{constructor(e){this._delegate=e}static fromBase64String(e){return VN(),new BN(IC.fromBase64String(e))}static fromUint8Array(e){return qN(),new BN(IC.fromUint8Array(e))}toBase64(){return VN(),this._delegate.toBase64()}toUint8Array(){return qN(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function jN(e){return function(e,t){if("object"!=typeof e||null===e)return;var n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return 1;return}(e,["next","error","complete"])}class zN{enableIndexedDbPersistence(e,t){return function(e,t){bC(e=QS(e,pC));var n=fC(e);if(n._uninitializedComponentsProvider)throw new f_(p_.FAILED_PRECONDITION,"SDK cache is already specified.");l_("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");var r=e._freezeSettings(),i=new TS;return mC(n,i,new bS(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){bC(e=QS(e,pC));var t=fC(e);if(t._uninitializedComponentsProvider)throw new f_(p_.FAILED_PRECONDITION,"SDK cache is already specified.");l_("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");var n=e._freezeSettings(),r=new TS;return mC(t,r,new IS(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new f_(p_.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new g_;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!Q_.D())return Promise.resolve();var t=e+"main";await Q_.delete(t)}(N0(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}(e._delegate)}}class $N{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof nb||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||l_("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(n,e,t,r={}){var i;const s=(n=QS(n,XS))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&l_("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let e,t;if("string"==typeof r.mockUserToken)e=r.mockUserToken,t=r_.MOCK_USER;else{e=_(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new f_(p_.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t=new r_(s)}n._authCredentials=new y_(new m_(e,t))}}(this._delegate,e,t,n)}enableNetwork(){return yC(this._delegate)}disableNetwork(){return _C(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,KS("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return vC(this._delegate)}onSnapshotsInSync(e){return RN(this._delegate,e)}get app(){if(!this._appCompat)throw new f_("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new iA(this,nC(this._delegate,e))}catch(e){throw YN(e,"collection()","Firestore.collection()")}}doc(e){try{return new QN(this,rC(this._delegate,e))}catch(e){throw YN(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new tA(this,function(e,t){if(e=QS(e,XS),$S("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new f_(p_.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new eC(e,null,(t=t,new Xb(D_.emptyPath(),t)))}(this._delegate,e))}catch(e){throw YN(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return FN(this._delegate,e=>t(new WN(this,e)))}batch(){return fC(this._delegate),new GN(new ON(this._delegate,e=>DN(this._delegate,e)))}loadBundle(e){return t=this._delegate,e=e,n=fC(t=QS(t,pC)),r=new cC,jS(n,t._databaseId,e,r),r;var t,n,r}namedQuery(e){return wC(this._delegate,e).then(e=>e?new tA(this,e):null)}}class KN extends mN{constructor(e){super(),this.firestore=e}convertBytes(e){return new BN(new IC(e))}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return QN.forKey(t,this.firestore,null)}}class WN{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new KN(e)}get(e){const t=sA(e);return this._delegate.get(t).then(e=>new ZN(this._firestore,new wN(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){var r=sA(e);return n?(UN("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var i=sA(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){var t=sA(e);return this._delegate.delete(t),this}}class GN{constructor(e){this._delegate=e}set(e,t,n){var r=sA(e);return n?(UN("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var i=sA(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){var t=sA(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class HN{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){var n=new bN(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new eA(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=HN.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new HN(e,new KN(e),t),r.set(t,i)),i}}HN.INSTANCES=new WeakMap;class QN{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new KN(e)}static forPath(e,t,n){if(e.length%2!=0)throw new f_("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+`${e.canonicalString()} has ${e.length}`);return new QN(t,new ZS(t._delegate,n,new O_(e)))}static forKey(e,t,n){return new QN(t,new ZS(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new iA(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new iA(this.firestore,nC(this._delegate,e))}catch(e){throw YN(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=ae(e))instanceof ZS&&iC(this._delegate,e)}set(e,t){t=UN("DocumentReference.set",t);try{return t?CN(this._delegate,e,t):CN(this._delegate,e)}catch(e){throw YN(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?NN(this._delegate,e):NN(this._delegate,e,t,...n)}catch(e){throw YN(e,"updateDoc()","DocumentReference.update()")}}delete(){return DN(QS((e=this._delegate).firestore,pC),[new XI(e._key,VI.none())]);var e}onSnapshot(...e){var t=JN(e),n=XN(e,e=>new ZN(this.firestore,new wN(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return AN(this._delegate,t,n)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?kN:"server"===(null==e?void 0:e.source)?function(t){t=QS(t,ZS);const n=QS(t.firestore,pC);return VS(fC(n),t._key,{source:"server"}).then(e=>xN(n,t,e))}:function(t){t=QS(t,ZS);const n=QS(t.firestore,pC);return VS(fC(n),t._key).then(e=>xN(n,t,e))})(this._delegate),t.then(e=>new ZN(this.firestore,new wN(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new QN(this.firestore,e?this._delegate.withConverter(HN.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function YN(e,t,n){return e.message=e.message.replace(t,n),e}function JN(e){for(const t of e)if("object"==typeof t&&!jN(t))return t;return{}}function XN(e,t){var n;let r;return r=jN(e[0])?e[0]:jN(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{r.next&&r.next(t(e))},error:null===(n=r.error)||void 0===n?void 0:n.bind(r),complete:null===(n=r.complete)||void 0===n?void 0:n.bind(r)}}class ZN{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new QN(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return TN(this._delegate,e._delegate)}}class eA extends ZN{data(e){var t=this._delegate.data(e);return void 0!==t||h_(),t}}class tA{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new KN(e)}where(e,t,n){try{return new tA(this.firestore,iN(this._delegate,(r=n,i=t,s=eN("where",e),sN._create(s,i,r))))}catch(e){throw YN(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,s}orderBy(e,t){try{return new tA(this.firestore,iN(this._delegate,([n,r="asc"]=[e,t],i=r,s=eN("orderBy",n),oN._create(s,i))))}catch(e){throw YN(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r,i,s}limit(e){try{return new tA(this.firestore,iN(this._delegate,(YS("limit",t=e),cN._create("limit",t,"F"))))}catch(e){throw YN(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new tA(this.firestore,iN(this._delegate,(YS("limitToLast",t=e),cN._create("limitToLast",t,"L"))))}catch(e){throw YN(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new tA(this.firestore,iN(this._delegate,function(...e){return lN._create("startAt",e,!0)}(...e)))}catch(e){throw YN(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new tA(this.firestore,iN(this._delegate,function(...e){return lN._create("startAfter",e,!1)}(...e)))}catch(e){throw YN(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new tA(this.firestore,iN(this._delegate,function(...e){return uN._create("endBefore",e,!1)}(...e)))}catch(e){throw YN(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new tA(this.firestore,iN(this._delegate,function(...e){return uN._create("endAt",e,!0)}(...e)))}catch(e){throw YN(e,"endAt()","Query.endAt()")}}isEqual(e){return sC(this._delegate,e._delegate)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?SN:"server"===(null==e?void 0:e.source)?function(t){t=QS(t,eC);const n=QS(t.firestore,pC),e=fC(n),r=new EN(n);return BS(e,t._query,{source:"server"}).then(e=>new IN(n,r,t,e))}:function(t){t=QS(t,eC);const n=QS(t.firestore,pC),e=fC(n),r=new EN(n);return tN(t._query),BS(e,t._query).then(e=>new IN(n,r,t,e))})(this._delegate),t.then(e=>new rA(this.firestore,new IN(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=JN(e),n=XN(e,e=>new rA(this.firestore,new IN(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return AN(this._delegate,t,n)}withConverter(e){return new tA(this.firestore,e?this._delegate.withConverter(HN.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class nA{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new eA(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class rA{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new tA(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new eA(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new nA(this._firestore,e))}forEach(t,n){this._delegate.forEach(e=>{t.call(n,new eA(this._firestore,e))})}isEqual(e){return TN(this._delegate,e._delegate)}}class iA extends tA{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new QN(this.firestore,e):null}doc(e){try{return void 0===e?new QN(this.firestore,rC(this._delegate)):new QN(this.firestore,rC(this._delegate,e))}catch(e){throw YN(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=QS(e.firestore,pC),r=rC(e),i=vN(e.converter,t);return DN(n,[PC(xC(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,VI.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new QN(this.firestore,e))}isEqual(e){return iC(this._delegate,e._delegate)}withConverter(e){return new iA(this.firestore,e?this._delegate.withConverter(HN.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function sA(e){return QS(e,ZS)}const aA={Firestore:$N,GeoPoint:kC,Timestamp:N_,Blob:BN,Transaction:WN,WriteBatch:GN,DocumentReference:QN,DocumentSnapshot:ZN,Query:tA,QueryDocumentSnapshot:eA,QuerySnapshot:rA,CollectionReference:iA,FieldPath:class gO{constructor(...e){this._delegate=new TC(...e)}static documentId(){return new gO(P_.keyField().canonicalString())}isEqual(e){return(e=ae(e))instanceof TC&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class mO{constructor(e){this._delegate=e}static serverTimestamp(){const e=new LC("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new mO(e)}static delete(){const e=new OC("deleteField");return e._methodName="FieldValue.delete",new mO(e)}static arrayUnion(...e){const t=function(...e){return new FC("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new mO(t)}static arrayRemove(...e){const t=function(...e){return new UC("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new mO(t)}static increment(e){const t=new qC("increment",e);return t._methodName="FieldValue.increment",new mO(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){e=e,s_.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};lC=wt,uC=(e,t)=>new $N(e,t,new zN),lC.INTERNAL.registerComponent(new oe("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate();return uC(t,n)},"PUBLIC").setServiceProps(Object.assign({},aA))),lC.registerVersion("@firebase/firestore-compat","0.3.6");const oA="type.googleapis.com/google.protobuf.Int64Value",cA="type.googleapis.com/google.protobuf.UInt64Value";function lA(e,t){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function uA(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case oA:case cA:var t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t;default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(e=>uA(e)):"function"==typeof e||"object"==typeof e?lA(e,e=>uA(e)):e}const hA="functions",dA={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class pA extends R{constructor(e,t,n){super(`${hA}/${e}`,t||""),this.details=n}}function fA(e,t){let n=function(e){if(200<=e&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),r=n,i=void 0;try{var s=t&&t.error;if(s){const e=s.status;if("string"==typeof e){if(!dA[e])return new pA("internal","internal");n=dA[e],r=e}var a=s.message;"string"==typeof a&&(r=a),i=s.details,void 0!==i&&(i=uA(i))}}catch(e){}return"ok"===n?null:new pA(n,r,i)}class gA{constructor(e,t,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(e=>this.auth=e,()=>{}),this.messaging||t.get().then(e=>this.messaging=e,()=>{}),this.appCheck||n.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{var e=await this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return this.messaging.getToken()}catch(e){return}}async getAppCheckToken(){if(this.appCheck){var e=await this.appCheck.getToken();return e.error?null:e.token}return null}async getContext(){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken()}}}const mA="us-central1";class vA{constructor(e,t,n,r,i=mA,s){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new gA(t,n,r),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{var a=new URL(i);this.customDomain=a.origin,this.region=mA}catch(e){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){var t=this.app.options.projectId;return null===this.emulatorOrigin?null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`:`${this.emulatorOrigin}/${t}/${this.region}/${e}`}}function yA(i,s,a){return e=>{return t=e,n=a||{},r=(e=i)._url(s),_A(e,r,t,n);var t,n,r}}async function _A(e,t,n,r){var i={data:n=function t(e){if(null==e)return null;if("number"==typeof(e=e instanceof Number?e.valueOf():e)&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(e=>t(e));if("function"==typeof e||"object"==typeof e)return lA(e,e=>t(e));throw new Error("Data cannot be encoded in JSON: "+e)}(n)};const s={};var a=await e.contextProvider.getContext();a.authToken&&(s.Authorization="Bearer "+a.authToken),a.messagingToken&&(s["Firebase-Instance-ID-Token"]=a.messagingToken),null!==a.appCheckToken&&(s["X-Firebase-AppCheck"]=a.appCheckToken);const o=function(n){let r=null;return{promise:new Promise((e,t)=>{r=setTimeout(()=>{t(new pA("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{r&&clearTimeout(r)}}}(r.timeout||7e4);a=await Promise.race([async function(e,t,n,r){n["Content-Type"]="application/json";let i;try{i=await r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch(e){return{status:0,json:null}}let s=null;try{s=await i.json()}catch(e){}return{status:i.status,json:s}}(t,i,s,e.fetchImpl),o.promise,e.cancelAllRequests]);if(o.cancel(),!a)throw new pA("cancelled","Firebase Functions instance was deleted.");i=fA(a.status,a.json);if(i)throw i;if(!a.json)throw new pA("internal","Response is not valid JSON object.");let c=a.json.data;if(void 0===c&&(c=a.json.result),void 0===c)throw new pA("internal","Response is missing data field.");return{data:uA(c)}}const wA="@firebase/functions";function bA(e,t,n){ae(e).emulatorOrigin=`http://${t}:${n}`}function IA(e,t,n){return r=ae(e),i=t,s=n,e=>_A(r,i,e,s||{});var r,i,s}hC=fetch.bind(self),We(new oe(hA,(e,{instanceIdentifier:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("messaging-internal"),s=e.getProvider("app-check-internal");return new vA(n,r,i,s,t,hC)},"PUBLIC").setMultipleInstances(!0)),et(wA,"0.9.4",dC),et(wA,"0.9.4","esm2017");var TA,EA,kA,SA,CA;class NA{constructor(e,t){this.app=e,this._delegate=t,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(e,t){return yA(ae(this._delegate),e,t)}httpsCallableFromURL(e,t){return IA(this._delegate,e,t)}useFunctionsEmulator(e){var t=e.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(null==t)throw new R("functions","No origin provided to useFunctionsEmulator()");if(null==t[2])throw new R("functions","Port missing in origin provided to useFunctionsEmulator()");return bA(this._delegate,t[1],Number(t[2]))}useEmulator(e,t){return bA(this._delegate,e,t)}}const AA="us-central1",RA=(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("functions").getImmediate({identifier:null!=t?t:AA});return new NA(n,r)};TA={Functions:NA},wt.INTERNAL.registerComponent(new oe("functions-compat",RA,"PUBLIC").setServiceProps(TA).setMultipleInstances(!0)),wt.registerVersion("@firebase/functions-compat","0.3.4");const DA="/firebase-messaging-sw.js",xA="/firebase-cloud-messaging-push-scope",PA="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",OA="https://fcmregistrations.googleapis.com/v1",MA="google.c.a.c_id",LA="google.c.a.e";function FA(e){var t=new Uint8Array(e);const n=btoa(String.fromCharCode(...t));return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(EA=Jx=Jx||{})[EA.DATA_MESSAGE=1]="DATA_MESSAGE",EA[EA.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(Hc=kA=kA||{}).PUSH_RECEIVED="push-received",Hc.NOTIFICATION_CLICKED="notification-clicked";const UA="fcm_token_details_db",qA="fcm_token_object_Store";async function VA(c){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(UA))return null}let l=null;const e=await Re(UA,5,{upgrade:async(e,t,n,r)=>{var i;if(!(t<2)&&e.objectStoreNames.contains(qA)){const o=r.objectStore(qA);var s,a=await o.index("fcmSenderId").get(c);await o.clear(),a&&(2===t?(s=a).auth&&s.p256dh&&s.endpoint&&(l={token:s.fcmToken,createTime:null!==(i=s.createTime)&&void 0!==i?i:Date.now(),subscriptionOptions:{auth:s.auth,p256dh:s.p256dh,endpoint:s.endpoint,swScope:s.swScope,vapidKey:"string"==typeof s.vapidKey?s.vapidKey:FA(s.vapidKey)}}):3===t?(s=a,l={token:s.fcmToken,createTime:s.createTime,subscriptionOptions:{auth:FA(s.auth),p256dh:FA(s.p256dh),endpoint:s.endpoint,swScope:s.swScope,vapidKey:FA(s.vapidKey)}}):4===t&&(a=a,l={token:a.fcmToken,createTime:a.createTime,subscriptionOptions:{auth:FA(a.auth),p256dh:FA(a.p256dh),endpoint:a.endpoint,swScope:a.swScope,vapidKey:FA(a.vapidKey)}}))}}});return e.close(),await De(UA),await De("fcm_vapid_details_db"),await De("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;var t=e["subscriptionOptions"];return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(l)?l:null}const BA="firebase-messaging-database",jA=1,zA="firebase-messaging-store";let $A=null;function KA(){return $A=$A||Re(BA,jA,{upgrade:(e,t)=>{0===t&&e.createObjectStore(zA)}}),$A}async function WA(e){var t=HA(e);const n=await KA();t=await n.transaction(zA).objectStore(zA).get(t);if(t)return t;t=await VA(e.appConfig.senderId);return t?(await GA(e,t),t):void 0}async function GA(e,t){var n=HA(e);const r=await KA(),i=r.transaction(zA,"readwrite");return await i.objectStore(zA).put(t,n),await i.done,t}function HA({appConfig:e}){return e.appId}const QA=new D("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function YA(e,t){var n={method:"DELETE",headers:await XA(e)};try{const s=await fetch(`${JA(e.appConfig)}/${t}`,n);var r=await s.json();if(r.error){var i=r.error.message;throw QA.create("token-unsubscribe-failed",{errorInfo:i})}}catch(e){throw QA.create("token-unsubscribe-failed",{errorInfo:null==e?void 0:e.toString()})}}function JA({projectId:e}){return`${OA}/projects/${e}/registrations`}async function XA({appConfig:e,installations:t}){var n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function ZA({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==PA&&(i.web.applicationPubKey=r),i}const eR=6048e5;async function tR(e){const t=await async function(e,t){var n=await e.pushManager.getSubscription();if(n)return n;return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const n=atob(t),r=new Uint8Array(n.length);for(let i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}(t)})}(e.swRegistration,e.vapidKey);var n,r,i,s,a,o={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:FA(t.getKey("auth")),p256dh:FA(t.getKey("p256dh"))},c=await WA(e.firebaseDependencies);if(c){if(n=c.subscriptionOptions,r=o.vapidKey===n.vapidKey,i=o.endpoint===n.endpoint,s=o.auth===n.auth,a=o.p256dh===n.p256dh,r&&i&&s&&a)return Date.now()>=c.createTime+eR?async function(t,e){try{var n=await async function(e,t){var n=await XA(e),r=ZA(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(`${JA(e.appConfig)}/${t.token}`,r);i=await s.json()}catch(e){throw QA.create("token-update-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error){r=i.error.message;throw QA.create("token-update-failed",{errorInfo:r})}if(!i.token)throw QA.create("token-update-no-token");return i.token}(t.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return await GA(t.firebaseDependencies,r),n}catch(e){throw await nR(t),e}}(e,{token:c.token,createTime:Date.now(),subscriptionOptions:o}):c.token;try{await YA(e.firebaseDependencies,c.token)}catch(e){console.warn(e)}return rR(e.firebaseDependencies,o)}return rR(e.firebaseDependencies,o)}async function nR(e){var t=await WA(e.firebaseDependencies);t&&(await YA(e.firebaseDependencies,t.token),await async function(e){var t=HA(e);const n=await KA(),r=n.transaction(zA,"readwrite");await r.objectStore(zA).delete(t),await r.done}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function rR(e,t){var n={token:await async function(e,t){var n=await XA(e),r=ZA(t),r={method:"POST",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(JA(e.appConfig),r);i=await s.json()}catch(e){throw QA.create("token-subscribe-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error){r=i.error.message;throw QA.create("token-subscribe-failed",{errorInfo:r})}if(!i.token)throw QA.create("token-subscribe-no-token");return i.token}(e,t),createTime:Date.now(),subscriptionOptions:t};return await GA(e,n),n.token}function iR(e){var t,n,r,i,s,a={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return r=a,(n=e).notification&&(r.notification={},(t=n.notification.title)&&(r.notification.title=t),(t=n.notification.body)&&(r.notification.body=t),(t=n.notification.image)&&(r.notification.image=t),(t=n.notification.icon)&&(r.notification.icon=t)),n=a,(r=e).data&&(n.data=r.data),r=a,((e=e).fcmOptions||null!==(i=e.notification)&&void 0!==i&&i.click_action)&&(r.fcmOptions={},(s=null!==(i=null===(i=e.fcmOptions)||void 0===i?void 0:i.link)&&void 0!==i?i:null===(s=e.notification)||void 0===s?void 0:s.click_action)&&(r.fcmOptions.link=s),(s=null===(s=e.fcmOptions)||void 0===s?void 0:s.analytics_label)&&(r.fcmOptions.analyticsLabel=s)),a}function sR(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}function aR(e){return QA.create("missing-app-config-values",{valueName:e})}sR("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),sR("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class oR{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw aR("App Configuration Object");if(!e.name)throw aR("App Name");var t=e["options"];for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw aR(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}async function cR(e){try{e.swRegistration=await navigator.serviceWorker.register(DA,{scope:xA}),e.swRegistration.update().catch(()=>{})}catch(e){throw QA.create("failed-service-worker-registration",{browserErrorMessage:null==e?void 0:e.message})}}async function lR(e,t){if(!navigator)throw QA.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw QA.create("permission-blocked");var n,r;return n=e,await((r=null==t?void 0:t.vapidKey)?n.vapidKey=r:n.vapidKey||(n.vapidKey=PA)),await async function(e,t){if(t||e.swRegistration||await cR(e),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw QA.create("invalid-sw-registration");e.swRegistration=t}}(e,null==t?void 0:t.serviceWorkerRegistration),tR(e)}async function uR(e,t,n){var r=function(e){switch(e){case kA.NOTIFICATION_CLICKED:return"notification_open";case kA.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(t);const i=await e.firebaseDependencies.analyticsProvider.get();i.logEvent(r,{message_id:n[MA],message_name:n["google.c.a.c_l"],message_time:n["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}async function hR(e,t){var n,r=t.data;r.isFirebaseMessaging&&(e.onMessageHandler&&r.messageType===kA.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(iR(r)):e.onMessageHandler.next(iR(r))),n=r.data,"object"==typeof(t=n)&&t&&MA in t&&"1"===n[LA]&&await uR(e,r.messageType,n))}const dR="@firebase/messaging",pR=e=>{const t=new oR(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>hR(t,e)),t},fR=e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>lR(t,e)}};function gR(e){return async function(e){if(!navigator)throw QA.create("only-available-in-window");return e.swRegistration||await cR(e),nR(e)}(e=ae(e))}function mR(e,t){return function(e,t){if(!navigator)throw QA.create("only-available-in-window");return e.onMessageHandler=t,()=>{e.onMessageHandler=null}}(e=ae(e),t)}We(new oe("messaging",pR,"PUBLIC")),We(new oe("messaging-internal",fR,"PRIVATE")),et(dR,"0.12.4"),et(dR,"0.12.4","esm2017");const vR="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",yR="https://fcmregistrations.googleapis.com/v1",_R="FCM_MSG",wR="google.c.a.c_id",bR=3,IR=1;function TR(e){var t=new Uint8Array(e);const n=btoa(String.fromCharCode(...t));return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(Hc=SA=SA||{})[Hc.DATA_MESSAGE=1]="DATA_MESSAGE",Hc[Hc.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(Hc=CA=CA||{}).PUSH_RECEIVED="push-received",Hc.NOTIFICATION_CLICKED="notification-clicked";const ER="fcm_token_details_db",kR="fcm_token_object_Store";async function SR(c){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(ER))return null}let l=null;const e=await Re(ER,5,{upgrade:async(e,t,n,r)=>{var i;if(!(t<2)&&e.objectStoreNames.contains(kR)){const o=r.objectStore(kR);var s,a=await o.index("fcmSenderId").get(c);await o.clear(),a&&(2===t?(s=a).auth&&s.p256dh&&s.endpoint&&(l={token:s.fcmToken,createTime:null!==(i=s.createTime)&&void 0!==i?i:Date.now(),subscriptionOptions:{auth:s.auth,p256dh:s.p256dh,endpoint:s.endpoint,swScope:s.swScope,vapidKey:"string"==typeof s.vapidKey?s.vapidKey:TR(s.vapidKey)}}):3===t?(s=a,l={token:s.fcmToken,createTime:s.createTime,subscriptionOptions:{auth:TR(s.auth),p256dh:TR(s.p256dh),endpoint:s.endpoint,swScope:s.swScope,vapidKey:TR(s.vapidKey)}}):4===t&&(a=a,l={token:a.fcmToken,createTime:a.createTime,subscriptionOptions:{auth:TR(a.auth),p256dh:TR(a.p256dh),endpoint:a.endpoint,swScope:a.swScope,vapidKey:TR(a.vapidKey)}}))}}});return e.close(),await De(ER),await De("fcm_vapid_details_db"),await De("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;var t=e["subscriptionOptions"];return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(l)?l:null}const CR="firebase-messaging-database",NR=1,AR="firebase-messaging-store";let RR=null;function DR(){return RR=RR||Re(CR,NR,{upgrade:(e,t)=>{0===t&&e.createObjectStore(AR)}}),RR}async function xR(e){var t=OR(e);const n=await DR();t=await n.transaction(AR).objectStore(AR).get(t);if(t)return t;t=await SR(e.appConfig.senderId);return t?(await PR(e,t),t):void 0}async function PR(e,t){var n=OR(e);const r=await DR(),i=r.transaction(AR,"readwrite");return await i.objectStore(AR).put(t,n),await i.done,t}function OR({appConfig:e}){return e.appId}const MR=new D("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function LR(e,t){var n={method:"DELETE",headers:await UR(e)};try{const s=await fetch(`${FR(e.appConfig)}/${t}`,n);var r=await s.json();if(r.error){var i=r.error.message;throw MR.create("token-unsubscribe-failed",{errorInfo:i})}}catch(e){throw MR.create("token-unsubscribe-failed",{errorInfo:null==e?void 0:e.toString()})}}function FR({projectId:e}){return`${yR}/projects/${e}/registrations`}async function UR({appConfig:e,installations:t}){var n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function qR({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==vR&&(i.web.applicationPubKey=r),i}async function VR(e){const t=await async function(e,t){var n=await e.pushManager.getSubscription();if(n)return n;return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const n=atob(t),r=new Uint8Array(n.length);for(let i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}(t)})}(e.swRegistration,e.vapidKey);var n,r,i,s,a,o={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:TR(t.getKey("auth")),p256dh:TR(t.getKey("p256dh"))},c=await xR(e.firebaseDependencies);if(c){if(n=c.subscriptionOptions,r=o.vapidKey===n.vapidKey,i=o.endpoint===n.endpoint,s=o.auth===n.auth,a=o.p256dh===n.p256dh,r&&i&&s&&a)return Date.now()>=c.createTime+6048e5?async function(t,e){try{var n=await async function(e,t){var n=await UR(e),r=qR(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(`${FR(e.appConfig)}/${t.token}`,r);i=await s.json()}catch(e){throw MR.create("token-update-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error){r=i.error.message;throw MR.create("token-update-failed",{errorInfo:r})}if(!i.token)throw MR.create("token-update-no-token");return i.token}(t.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return await PR(t.firebaseDependencies,r),n}catch(e){throw await BR(t),e}}(e,{token:c.token,createTime:Date.now(),subscriptionOptions:o}):c.token;try{await LR(e.firebaseDependencies,c.token)}catch(e){console.warn(e)}return jR(e.firebaseDependencies,o)}return jR(e.firebaseDependencies,o)}async function BR(e){var t=await xR(e.firebaseDependencies);t&&(await LR(e.firebaseDependencies,t.token),await async function(e){var t=OR(e);const n=await DR(),r=n.transaction(AR,"readwrite");await r.objectStore(AR).delete(t),await r.done}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function jR(e,t){var n={token:await async function(e,t){var n=await UR(e),r=qR(t),r={method:"POST",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(FR(e.appConfig),r);i=await s.json()}catch(e){throw MR.create("token-subscribe-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error){r=i.error.message;throw MR.create("token-subscribe-failed",{errorInfo:r})}if(!i.token)throw MR.create("token-subscribe-no-token");return i.token}(e,t),createTime:Date.now(),subscriptionOptions:t};return await PR(e,n),n.token}async function zR(e,t){var n=function(e,t){var n;const r={};e.from&&(r.project_number=e.from);e.fcmMessageId&&(r.message_id=e.fcmMessageId);r.instance_id=t,e.notification?r.message_type=SA.DISPLAY_NOTIFICATION.toString():r.message_type=SA.DATA_MESSAGE.toString();r.sdk_platform=bR.toString(),r.package_name=self.origin.replace(/(^\w+:|^)\/\//,""),e.collapse_key&&(r.collapse_key=e.collapse_key);r.event=IR.toString(),null!==(n=e.fcmOptions)&&void 0!==n&&n.analytics_label&&(r.analytics_label=null===(n=e.fcmOptions)||void 0===n?void 0:n.analytics_label);return r}(t,await e.firebaseDependencies.installations.getId());!function(e,t){const n={};n.event_time_ms=Math.floor(Date.now()).toString(),n.source_extension_json_proto3=JSON.stringify(t),e.logEvents.push(n)}(e,n)}function $R(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}async function KR(e,t){var n=function({data:e}){if(!e)return null;try{return e.json()}catch(e){return null}}(e);if(n){t.deliveryMetricsExportedToBigQueryEnabled&&await zR(t,n);var r,i,s,a,o=await GR();if(o.some(e=>"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://")))return function(e,t){t.isFirebaseMessaging=!0,t.messageType=CA.PUSH_RECEIVED;for(const n of e)n.postMessage(t)}(o,n);n.notification&&await function(e){var t=e["actions"],n=Notification["maxActions"];t&&n&&t.length>n&&console.warn(`This browser only supports ${n} actions. The remaining actions will not be displayed.`);return self.registration.showNotification(null!==(n=e.title)&&void 0!==n?n:"",e)}(function(e){const t=Object.assign({},e.notification);return t.data={[_R]:e},t}(n)),t&&t.onBackgroundMessageHandler&&(a={from:(r=n).from,collapseKey:r.collapse_key,messageId:r.fcmMessageId},o=a,(e=r).notification&&(o.notification={},(n=e.notification.title)&&(o.notification.title=n),(n=e.notification.body)&&(o.notification.body=n),(n=e.notification.image)&&(o.notification.image=n),(n=e.notification.icon)&&(o.notification.icon=n)),e=a,(o=r).data&&(e.data=o.data),o=a,((r=r).fcmOptions||null!==(i=r.notification)&&void 0!==i&&i.click_action)&&(o.fcmOptions={},(s=null!==(i=null===(i=r.fcmOptions)||void 0===i?void 0:i.link)&&void 0!==i?i:null===(s=r.notification)||void 0===s?void 0:s.click_action)&&(o.fcmOptions.link=s),(s=null===(s=r.fcmOptions)||void 0===s?void 0:s.analytics_label)&&(o.fcmOptions.analyticsLabel=s)),a=a,"function"==typeof t.onBackgroundMessageHandler?await t.onBackgroundMessageHandler(a):t.onBackgroundMessageHandler.next(a))}}async function WR(e){const t=null===(s=null===(i=e.notification)||void 0===i?void 0:i.data)||void 0===s?void 0:s[_R];if(t&&!e.action){e.stopImmediatePropagation(),e.notification.close();var n=function(e){var t;var n=null!==(t=null===(t=e.fcmOptions)||void 0===t?void 0:t.link)&&void 0!==t?t:null===(n=e.notification)||void 0===n?void 0:n.click_action;if(n)return n;return function(e){return"object"==typeof e&&e&&wR in e}(e.data)?self.location.origin:null}(t);if(n){var r,i=new URL(n,self.location.href),s=new URL(self.location.origin);if(i.host===s.host){let e=await async function(e){var t=await GR();for(const r of t){var n=new URL(r.url,self.location.href);if(e.host===n.host)return r}return null}(i);if(e?e=await e.focus():(e=await self.clients.openWindow(n),r=3e3,await new Promise(e=>{setTimeout(e,r)})),e)return t.messageType=CA.NOTIFICATION_CLICKED,t.isFirebaseMessaging=!0,e.postMessage(t)}}}}function GR(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function HR(e){return MR.create("missing-app-config-values",{valueName:e})}$R("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),$R("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class QR{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw HR("App Configuration Object");if(!e.name)throw HR("App Name");var t=e["options"];for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw HR(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}const YR=e=>{const t=new QR(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return self.addEventListener("push",e=>{e.waitUntil(KR(e,t))}),self.addEventListener("pushsubscriptionchange",e=>{e.waitUntil(async function(e,t){var n;(n=e["newSubscription"])?(n=await xR(t.firebaseDependencies),await BR(t),t.vapidKey=null!==(n=null===(n=null==n?void 0:n.subscriptionOptions)||void 0===n?void 0:n.vapidKey)&&void 0!==n?n:vR,await VR(t)):await BR(t)}(e,t))}),self.addEventListener("notificationclick",e=>{e.waitUntil(WR(e))}),t};function JR(e,t){return function(e,t){if(void 0!==self.document)throw MR.create("only-available-in-sw");return e.onBackgroundMessageHandler=t,()=>{e.onBackgroundMessageHandler=null}}(e=ae(e),t)}We(new oe("messaging-sw",YR,"PUBLIC"));var XR,ZR,eD,tD;class nD{constructor(e,t){this.app=e,this._delegate=t,this.app=e,this._delegate=t}async getToken(e){return async function(e,t){return lR(e=ae(e),t)}(this._delegate,e)}async deleteToken(){return gR(this._delegate)}onMessage(e){return mR(this._delegate,e)}onBackgroundMessage(e){return JR(this._delegate,e)}}const rD=e=>self&&"ServiceWorkerGlobalScope"in self?new nD(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging-sw").getImmediate()):new nD(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging").getImmediate()),iD={isSupported:function(){return self&&"ServiceWorkerGlobalScope"in self?C()&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):"undefined"!=typeof window&&C()&&A()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}};wt.INTERNAL.registerComponent(new oe("messaging-compat",rD,"PUBLIC").setServiceProps(iD)),wt.registerVersion("@firebase/messaging-compat","0.2.4");const sD="firebasestorage.googleapis.com",aD="storageBucket";class oD extends R{constructor(e,t,n=0){super(cD(e),`Firebase Storage: ${t} (${cD(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,oD.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return cD(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}function cD(e){return"storage/"+e}function lD(){return new oD(XR.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function uD(){return new oD(XR.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function hD(){return new oD(XR.CANCELED,"User canceled the upload/download.")}function dD(){return new oD(XR.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function pD(e){return new oD(XR.INVALID_ARGUMENT,e)}function fD(){return new oD(XR.APP_DELETED,"The Firebase app was deleted.")}function gD(e){return new oD(XR.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function mD(e,t){return new oD(XR.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function vD(e){throw new oD(XR.INTERNAL_ERROR,"Internal error: "+e)}(It=XR=XR||{}).UNKNOWN="unknown",It.OBJECT_NOT_FOUND="object-not-found",It.BUCKET_NOT_FOUND="bucket-not-found",It.PROJECT_NOT_FOUND="project-not-found",It.QUOTA_EXCEEDED="quota-exceeded",It.UNAUTHENTICATED="unauthenticated",It.UNAUTHORIZED="unauthorized",It.UNAUTHORIZED_APP="unauthorized-app",It.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",It.INVALID_CHECKSUM="invalid-checksum",It.CANCELED="canceled",It.INVALID_EVENT_NAME="invalid-event-name",It.INVALID_URL="invalid-url",It.INVALID_DEFAULT_BUCKET="invalid-default-bucket",It.NO_DEFAULT_BUCKET="no-default-bucket",It.CANNOT_SLICE_BLOB="cannot-slice-blob",It.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",It.NO_DOWNLOAD_URL="no-download-url",It.INVALID_ARGUMENT="invalid-argument",It.INVALID_ARGUMENT_COUNT="invalid-argument-count",It.APP_DELETED="app-deleted",It.INVALID_ROOT_OPERATION="invalid-root-operation",It.INVALID_FORMAT="invalid-format",It.INTERNAL_ERROR="internal-error",It.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class yD{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let n;try{n=yD.makeFromUrl(t,e)}catch(e){return new yD(t,"")}if(""===n.path)return n;throw t=t,new oD(XR.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}static makeFromUrl(e,t){let n=null;var r="([A-Za-z0-9.\\-_]+)";var i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}var a=t.replace(/[.]/g,"\\."),o=new RegExp(`^https?://${a}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),a=t===sD?"(?:storage.googleapis.com|storage.cloud.google.com)":t,c=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:o,indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${a}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let h=0;h<c.length;h++){const d=c[h];var l=d.regex.exec(e);if(l){var u=l[d.indices.bucket];let e=l[d.indices.path];e=e||"",n=new yD(u,e),d.postModify(n);break}}if(null==n)throw t=e,new oD(XR.INVALID_URL,"Invalid URL '"+t+"'.");return n}}class _D{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=0){}}function wD(e){return"string"==typeof e||e instanceof String}function bD(e){return ID()&&e instanceof Blob}function ID(){return"undefined"!=typeof Blob&&!I()}function TD(e,t,n,r){if(r<t)throw pD(`Invalid value for '${e}'. Expected ${t} or greater.`);if(n<r)throw pD(`Invalid value for '${e}'. Expected ${n} or less.`)}function ED(e,t,n){let r=null==n?`https://${t}`:t;return`${n}://${r}/v0${e}`}function kD(e){const t=encodeURIComponent;let n="?";for(const i in e){var r;e.hasOwnProperty(i)&&(r=t(i)+"="+t(e[i]),n=n+r+"&")}return n=n.slice(0,-1),n}function SD(e,t){var n=500<=e&&e<600,r=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return n||r||i}(It=ZR=ZR||{})[It.NO_ERROR=0]="NO_ERROR",It[It.NETWORK_ERROR=1]="NETWORK_ERROR",It[It.ABORT=2]="ABORT";class CD{constructor(e,t,n,r,i,s,a,o,c,l,u,h=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=a,this.errorCallback_=o,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=u,this.retry=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){var e=(n,e)=>{if(e)n(!1,new ND(!1,null,!0));else{const r=this.connectionFactory_();this.pendingConnection_=r;const i=e=>{var t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&r.addUploadProgressListener(i),r.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&r.removeUploadProgressListener(i),this.pendingConnection_=null;var e=r.getErrorCode()===ZR.NO_ERROR,t=r.getStatus();!e||SD(t,this.additionalRetryCodes_)&&this.retry?(e=r.getErrorCode()===ZR.ABORT,n(!1,new ND(!1,null,e))):(t=-1!==this.successCodes_.indexOf(t),n(!0,new ND(t,r)))})}},t=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{var s=this.callback_(i,i.getResponse());void 0!==s?n(s):n()}catch(e){r(e)}else if(null!==i){const o=lD();o.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,o)):r(o)}else{var a;t.canceled?(a=(this.appDelete_?fD:hD)(),r(a)):(a=uD(),r(a))}};this.canceled_?t(0,new ND(!1,null,!0)):this.backoffId_=function(t,n,e){let r=1,i=null,s=null,a=!1,o=0;function c(){return 2===o}let l=!1;function u(...e){l||(l=!0,n.apply(null,e))}function h(e){i=setTimeout(()=>{i=null,t(p,c())},e)}function d(){s&&clearTimeout(s)}function p(t,...n){if(l)d();else{if(t)return d(),void u.call(null,t,...n);if(c()||a)return d(),void u.call(null,t,...n);r<64&&(r*=2);let e;e=1===o?(o=2,0):1e3*(r+Math.random()),h(e)}}let f=!1;function g(e){f||(f=!0,d(),l||(null!==i?(e||(o=2),clearTimeout(i),h(0)):e||(o=1)))}return h(0),s=setTimeout(()=>{g(a=!0)},e),g}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class ND{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function AD(...t){const n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){const r=new n;for(let e=0;e<t.length;e++)r.append(t[e]);return r.getBlob()}if(ID())return new Blob(t);throw new oD(XR.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function RD(e){if("undefined"==typeof atob)throw new oD(XR.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}const DD={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class xD{constructor(e,t){this.data=e,this.contentType=t||null}}function PD(e,t){switch(e){case DD.RAW:return new xD(OD(t));case DD.BASE64:case DD.BASE64URL:return new xD(MD(e,t));case DD.DATA_URL:return new xD((n=t,(r=new LD(n)).base64?MD(DD.BASE64,r.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw mD(DD.DATA_URL,"Malformed data URL.")}return OD(t)}(r.rest)),(n=t,new LD(n).contentType))}var n,r;throw lD()}function OD(t){const n=[];for(let s=0;s<t.length;s++){let e=t.charCodeAt(s);var r,i;e<=127?n.push(e):e<=2047?n.push(192|e>>6,128|63&e):55296==(64512&e)?s<t.length-1&&56320==(64512&t.charCodeAt(s+1))?(r=e,i=t.charCodeAt(++s),e=65536|(1023&r)<<10|1023&i,n.push(240|e>>18,128|e>>12&63,128|e>>6&63,128|63&e)):n.push(239,191,189):56320==(64512&e)?n.push(239,191,189):n.push(224|e>>12,128|e>>6&63,128|63&e)}return new Uint8Array(n)}function MD(t,e){switch(t){case DD.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw mD(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case DD.BASE64URL:r=-1!==e.indexOf("+"),n=-1!==e.indexOf("/");if(r||n)throw mD(t,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}let i;try{i=RD(e)}catch(e){if(e.message.includes("polyfill"))throw e;throw mD(t,"Invalid character found")}const s=new Uint8Array(i.length);for(let a=0;a<i.length;a++)s[a]=i.charCodeAt(a);return s}class LD{constructor(e){this.base64=!1,this.contentType=null;var t,n,r=e.match(/^data:([^,]+)?,/);if(null===r)throw mD(DD.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const i=r[1]||null;null!=i&&(this.base64=(t=i,n=";base64",t.length>=n.length&&t.substring(t.length-n.length)===n),this.contentType=this.base64?i.substring(0,i.length-";base64".length):i),this.rest=e.substring(e.indexOf(",")+1)}}class FD{constructor(e,t){let n=0,r="";bD(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(bD(this.data_)){var n=this.data_,n=(i=e,s=t,(r=n).webkitSlice?r.webkitSlice(i,s):r.mozSlice?r.mozSlice(i,s):r.slice?r.slice(i,s):null);return null===n?null:new FD(n)}var r,i,s,n=new Uint8Array(this.data_.buffer,e,t-e);return new FD(n,!0)}static getBlob(...e){if(ID()){var t=e.map(e=>e instanceof FD?e.data_:e);return new FD(AD.apply(null,t))}{const r=e.map(e=>wD(e)?PD(DD.RAW,e).data:e.data_);let t=0;r.forEach(e=>{t+=e.byteLength});const i=new Uint8Array(t);let n=0;return r.forEach(e=>{for(let t=0;t<e.length;t++)i[n++]=e[t]}),new FD(i,!0)}}uploadData(){return this.data_}}function UD(e){let t;try{t=JSON.parse(e)}catch(e){return null}return"object"!=typeof(e=t)||Array.isArray(e)?null:t}function qD(e){var t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function VD(e,t){return t}class BD{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||VD}}let jD=null;function zD(){if(jD)return jD;const e=[];e.push(new BD("bucket")),e.push(new BD("generation")),e.push(new BD("metageneration")),e.push(new BD("name","fullPath",!0));const t=new BD("name");t.xform=function(e,t){return!wD(t=t)||t.length<2?t:qD(t)},e.push(t);const n=new BD("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new BD("timeCreated")),e.push(new BD("updated")),e.push(new BD("md5Hash",null,!0)),e.push(new BD("cacheControl",null,!0)),e.push(new BD("contentDisposition",null,!0)),e.push(new BD("contentEncoding",null,!0)),e.push(new BD("contentLanguage",null,!0)),e.push(new BD("contentType",null,!0)),e.push(new BD("metadata","customMetadata",!0)),jD=e,jD}function $D(n,r){Object.defineProperty(n,"ref",{get:function(){var e=n.bucket,t=n.fullPath,t=new yD(e,t);return r._makeStorageReference(t)}})}function KD(e,t,n){var r=UD(t);return null===r?null:function(e,t,n){const r={type:"file"};var i=n.length;for(let s=0;s<i;s++){const a=n[s];r[a.local]=a.xform(r,t[a.server])}return $D(r,e),r}(e,r,n)}function WD(e,t){const n={};var r=t.length;for(let s=0;s<r;s++){var i=t[s];i.writable&&(n[i.server]=e[i.local])}return JSON.stringify(n)}const GD="prefixes";function HD(e,t,n){var r=UD(n);return null===r?null:function(e,t,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[GD])for(const a of n[GD]){var i=a.replace(/\/$/,""),i=e._makeStorageReference(new yD(t,i));r.prefixes.push(i)}if(n.items)for(const o of n.items){var s=e._makeStorageReference(new yD(t,o.name));r.items.push(s)}return r}(e,t,r)}class QD{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function YD(e){if(!e)throw lD()}function JD(r,i){return function(e,t){var n=KD(r,t,i);return YD(null!==n),n}}function XD(r,i){return function(e,t){var n=HD(r,i,t);return YD(null!==n),n}}function ZD(r,i){return function(e,t){var n=KD(r,t,i);return YD(null!==n),function(r,e,i,s){var t=UD(e);if(null===t)return null;if(!wD(t.downloadTokens))return null;const n=t.downloadTokens;if(0===n.length)return null;const a=encodeURIComponent,o=n.split(",");return o.map(e=>{var t=r.bucket,n=r.fullPath;return ED("/b/"+a(t)+"/o/"+a(n),i,s)+kD({alt:"media",token:e})})[0]}(n,t,r.host,r._protocol)}}function ex(i){return function(e,t){let n;var r;return n=401===e.getStatus()?e.getErrorText().includes("Firebase App Check token is invalid")?new oD(XR.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new oD(XR.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(r=i.bucket,new oD(XR.QUOTA_EXCEEDED,"Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(r=i.path,new oD(XR.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")):t,n.status=e.getStatus(),n.serverResponse=t.serverResponse,n}}function tx(r){const i=ex(r);return function(e,t){let n=i(e,t);return 404===e.getStatus()&&(n=(e=r.path,new oD(XR.OBJECT_NOT_FOUND,"Object '"+e+"' does not exist."))),n.serverResponse=t.serverResponse,n}}function nx(e,t,n){var r=ED(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime;const s=new QD(r,"GET",JD(e,n),i);return s.errorHandler=tx(t),s}function rx(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=(e=t,(t=null)&&t.contentType||e&&e.type()||"application/octet-stream")),r}function ix(e,t,n,r,i){var s=t.bucketOnlyServerUrl();const a={"X-Goog-Upload-Protocol":"multipart"};var o=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();a["Content-Type"]="multipart/related; boundary="+o;var c=rx(t,r,i),l="--"+o+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+WD(c,n)+"\r\n--"+o+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",o="\r\n--"+o+"--";const u=FD.getBlob(l,r,o);if(null===u)throw dD();o={name:c.fullPath},c=ED(s,e.host,e._protocol),s=e.maxUploadRetryTime;const h=new QD(c,"POST",JD(e,n),s);return h.urlParams=o,h.headers=a,h.body=u.uploadData(),h.errorHandler=ex(t),h}class sx{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function ax(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){YD(!1)}const r=t||["active"];return YD(!!n&&-1!==r.indexOf(n)),n}function ox(e,t,n,r,i){var s=t.bucketOnlyServerUrl(),a=rx(t,r,i),o={name:a.fullPath},c=ED(s,e.host,e._protocol),l={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},s=WD(a,n),a=e.maxUploadRetryTime;const u=new QD(c,"POST",function(e){ax(e);let t;try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){YD(!1)}return YD(wD(t)),t},a);return u.urlParams=o,u.headers=l,u.body=s,u.errorHandler=ex(t),u}function cx(e,t,n,i){var r=e.maxUploadRetryTime;const s=new QD(n,"POST",function(e){var t=ax(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){YD(!1)}n||YD(!1);var r=Number(n);return YD(!isNaN(r)),new sx(r,i.size(),"final"===t)},r);return s.headers={"X-Goog-Upload-Command":"query"},s.errorHandler=ex(t),s}function lx(e,a,t,o,n,c,r,i){const l=new sx(0,0);if(r?(l.current=r.current,l.total=r.total):(l.current=0,l.total=o.size()),o.size()!==l.total)throw new oD(XR.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var s=l.total-l.current;let u=s;0<n&&(u=Math.min(u,n));var h=l.current,d=h+u;let p="";p=0===u?"finalize":s===u?"upload, finalize":"upload";s={"X-Goog-Upload-Command":p,"X-Goog-Upload-Offset":`${l.current}`};const f=o.slice(h,d);if(null===f)throw dD();d=a.maxUploadRetryTime;const g=new QD(t,"POST",function(e,t){var n=ax(e,["active","final"]),r=l.current+u,i=o.size();let s;return s="final"===n?JD(a,c)(e,t):null,new sx(r,i,"final"===n,s)},d);return g.headers=s,g.body=f.uploadData(),g.progressCallback=i||null,g.errorHandler=ex(e),g}const ux={STATE_CHANGED:"state_changed"},hx={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function dx(e){switch(e){case"running":case"pausing":case"canceling":return hx.RUNNING;case"paused":return hx.PAUSED;case"success":return hx.SUCCESS;case"canceled":return hx.CANCELED;default:return hx.ERROR}}class px{constructor(e,t,n){var r;"function"==typeof e||null!=t||null!=n?(this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0):(this.next=(r=e).next,this.error=r.error,this.complete=r.complete)}}function fx(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class gx extends class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=ZR.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=ZR.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=ZR.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r){if(this.sent_)throw vD("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw vD("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw vD("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw vD("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw vD("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}{initXhr(){this.xhr_.responseType="text"}}function mx(){return new gx}class vx{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=zD(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{if(this._request=void 0,this._chunkMultiplier=1,e._codeEquals(XR.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{var t=this.isExponentialBackoffExpired();if(SD(e.status,[])){if(!t)return this.sleepTime=Math.max(2*this.sleepTime,1e3),this._needToFetchStatus=!0,void this.completeTransitions_();e=uD()}this._error=e,this._transition("error")}},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals(XR.CANCELED)?this.completeTransitions_():(this._error=e,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const t=this._transferred;return e=>this._updateProgress(t+e)}_shouldDoResumable(e){return 262144<e.size()}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(n){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([e,t])=>{switch(this._state){case"running":n(e,t);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((e,t)=>{var n=ox(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,mx,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const i=this._uploadUrl;this._resolveToken((e,t)=>{var n=cx(this._ref.storage,this._ref._location,i,this._blob);const r=this._ref.storage._makeRequest(n,mx,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const i=262144*this._chunkMultiplier,s=new sx(this._transferred,this._blob.size()),a=this._uploadUrl;this._resolveToken((e,t)=>{let n;try{n=lx(this._ref._location,this._ref.storage,a,this._blob,i,this._mappings,s,this._makeProgressCallback())}catch(e){return this._error=e,void this._transition("error")}const r=this._ref.storage._makeRequest(n,mx,e,t,!1);this._request=r,r.getPromise().then(e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){2*(262144*this._chunkMultiplier)<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{var n=nx(this._ref.storage,this._ref._location,this._mappings);const r=this._ref.storage._makeRequest(n,mx,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{var n=ix(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,mx,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){var t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":var t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=hD(),this._state=e,this._notifyObservers();break;case"error":case"success":this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){var e=dx(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const i=new px(t||void 0,n||void 0,r||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){var t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise();const e=this._observers.slice();e.forEach(e=>{this._notifyObserver(e)})}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(dx(this._state)){case hx.SUCCESS:fx(this._resolve.bind(null,this.snapshot))();break;case hx.CANCELED:case hx.ERROR:const t=this._reject;fx(t.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(dx(this._state)){case hx.RUNNING:case hx.PAUSED:e.next&&fx(e.next.bind(e,this.snapshot))();break;case hx.SUCCESS:e.complete&&fx(e.complete.bind(e))();break;case hx.CANCELED:case hx.ERROR:default:e.error&&fx(e.error.bind(e,this._error))()}}resume(){var e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){var e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){var e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class yx{constructor(e,t){this._service=e,t instanceof yD?this._location=t:this._location=yD.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new yx(e,t)}get root(){var e=new yD(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return qD(this._location.path)}get storage(){return this._service}get parent(){var e=function(e){if(0===e.length)return null;var t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;e=new yD(this._location.bucket,e);return new yx(this._service,e)}_throwIfRoot(e){if(""===this._location.path)throw gD(e)}}function _x(e){const t={prefixes:[],items:[]};return async function e(t,n,r){const i={pageToken:r};const s=await wx(t,i);n.prefixes.push(...s.prefixes);n.items.push(...s.items);null!=s.nextPageToken&&await e(t,n,s.nextPageToken)}(e,t).then(()=>t)}function wx(e,t){null!=t&&"number"==typeof t.maxResults&&TD("options.maxResults",1,1e3,t.maxResults);var n=t||{},n=function(e,t,n,r,i){const s={};t.isRoot?s.prefix="":s.prefix=t.path+"/",n&&0<n.length&&(s.delimiter=n),r&&(s.pageToken=r),i&&(s.maxResults=i);var a=ED(t.bucketOnlyServerUrl(),e.host,e._protocol),o=e.maxOperationRetryTime;const c=new QD(a,"GET",XD(e,t.bucket),o);return c.urlParams=s,c.errorHandler=ex(t),c}(e.storage,e._location,"/",n.pageToken,n.maxResults);return e.storage.makeRequestWithTokens(n,mx)}function bx(e,t){e._throwIfRoot("updateMetadata");var n=function(e,t,n,r){var i=ED(t.fullServerUrl(),e.host,e._protocol),s=WD(n,r),a=e.maxOperationRetryTime;const o=new QD(i,"PATCH",JD(e,r),a);return o.headers={"Content-Type":"application/json; charset=utf-8"},o.body=s,o.errorHandler=tx(t),o}(e.storage,e._location,t,zD());return e.storage.makeRequestWithTokens(n,mx)}function Ix(e){e._throwIfRoot("getDownloadURL");var t=function(e,t,n){var r=ED(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime;const s=new QD(r,"GET",ZD(e,n),i);return s.errorHandler=tx(t),s}(e.storage,e._location,zD());return e.storage.makeRequestWithTokens(t,mx).then(e=>{if(null===e)throw new oD(XR.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})}function Tx(e){e._throwIfRoot("deleteObject");var t=function(e,t){var n=ED(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime;const i=new QD(n,"DELETE",function(e,t){},r);return i.successCodes=[200,204],i.errorHandler=tx(t),i}(e.storage,e._location);return e.storage.makeRequestWithTokens(t,mx)}function Ex(e,t){var n,r=(n=e._location.path,r=t.split("/").filter(e=>0<e.length).join("/"),0===n.length?r:n+"/"+r),r=new yD(e._location.bucket,r);return new yx(e.storage,r)}function kx(e,t){if(e instanceof Nx){var n=e;if(null==n._bucket)throw new oD(XR.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+aD+"' property when initializing the app?");n=new yx(n,n._bucket);return null!=t?kx(n,t):n}return void 0!==t?Ex(e,t):e}function Sx(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof Nx)return n=e,r=t,new yx(n,r);throw pD("To use ref(service, url), the first argument must be a Storage instance.")}return kx(e,t);var n,r}function Cx(e,t){var n=null==t?void 0:t[aD];return null==n?null:yD.makeFromBucketSpec(n,e)}class Nx{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=sD,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?yD.makeFromBucketSpec(r,this._host):Cx(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=yD.makeFromBucketSpec(this._url,e):this._bucket=Cx(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){TD("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){TD("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){var t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new yx(this,e)}_makeRequest(e,t,n,r,i=!0){if(this._deleted)return new _D(fD());{const u=([s,a,o,e,n,r,t=!0]=[e,this._appId,n,r,t,this._firebaseVersion,i],c=kD(s.urlParams),l=s.url+c,c=Object.assign({},s.headers),i=c,(a=a)&&(i["X-Firebase-GMPID"]=a),a=c,null!==(o=o)&&0<o.length&&(a.Authorization="Firebase "+o),r=r,c["X-Firebase-Storage-Version"]="webjs/"+(null!=r?r:"AppManager"),r=c,null!==(e=e)&&(r["X-Firebase-AppCheck"]=e),new CD(l,s.method,c,s.body,s.successCodes,s.additionalRetryCodes,s.handler,s.errorHandler,s.timeout,s.progressCallback,n,t));return this._requests.add(u),u.getPromise().then(()=>this._requests.delete(u),()=>this._requests.delete(u)),u}var s,a,o,c,l}async makeRequestWithTokens(e,t){var[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const Ax="@firebase/storage";function Rx(e,t,n){return e=ae(e),t=t,n=n,(e=e)._throwIfRoot("uploadBytesResumable"),new vx(e,new FD(t),n)}function Dx(e){return function(e){e._throwIfRoot("getMetadata");var t=nx(e.storage,e._location,zD());return e.storage.makeRequestWithTokens(t,mx)}(e=ae(e))}function xx(e,t){return Sx(e=ae(e),t)}function Px(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`,e._protocol="http";var i=r["mockUserToken"];i&&(e._overrideAuthToken="string"==typeof i?i:_(i,e.app.options.projectId))}(e,t,n,r)}function Ox(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new Nx(n,r,i,t,Ye)}We(new oe("storage",Ox,"PUBLIC").setMultipleInstances(!0)),et(Ax,"0.11.2",""),et(Ax,"0.11.2","esm2017");class Mx{constructor(e,t,n){this._delegate=e,this.task=t,this.ref=n}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class Lx{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new Mx(this._delegate.snapshot,this,this._ref)}then(t,e){return this._delegate.then(e=>{if(t)return t(new Mx(e,this,this._ref))},e)}on(e,t,n,r){let i=void 0;return t&&(i="function"==typeof t?e=>t(new Mx(e,this,this._ref)):{next:t.next?e=>t.next(new Mx(e,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,n||void 0,r||void 0)}}class Fx{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new Ux(e,this._service))}get items(){return this._delegate.items.map(e=>new Ux(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class Ux{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){var t=Ex(this._delegate,e);return new Ux(t,this.storage)}get root(){return new Ux(this._delegate.root,this.storage)}get parent(){var e=this._delegate.parent;return null==e?null:new Ux(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new Lx(Rx(this._delegate,e,t),this)}putString(e,t=DD.RAW,n){this._throwIfRoot("putString");var r=PD(t,e);const i=Object.assign({},n);return null==i.contentType&&null!=r.contentType&&(i.contentType=r.contentType),new Lx(new vx(this._delegate,new FD(r.data,!0),i),this)}listAll(){return _x(ae(this._delegate)).then(e=>new Fx(e,this.storage))}list(e){return t=this._delegate,e=e||void 0,wx(t=ae(t),e).then(e=>new Fx(e,this.storage));var t}getMetadata(){return Dx(this._delegate)}updateMetadata(e){return bx(ae(this._delegate),e)}getDownloadURL(){return Ix(ae(this._delegate))}delete(){return this._throwIfRoot("delete"),Tx(ae(this._delegate))}_throwIfRoot(e){if(""===this._delegate._location.path)throw gD(e)}}class qx{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(Vx(e))throw pD("ref() expected a child path but got a URL, use refFromURL instead.");return new Ux(xx(this._delegate,e),this)}refFromURL(e){if(!Vx(e))throw pD("refFromURL() expected a full URL but got a child path, use ref() instead.");try{yD.makeFromUrl(e,this._delegate.host)}catch(e){throw pD("refFromUrl() expected a valid full URL but got an invalid one.")}return new Ux(xx(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,n={}){Px(this._delegate,e,t,n)}}function Vx(e){return/^[A-Za-z]+:\/\//.test(e)}function Bx(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("storage").getImmediate({identifier:t});return new qx(n,r)}eD=wt,tD={TaskState:hx,TaskEvent:ux,StringFormat:DD,Storage:qx,Reference:Ux},eD.INTERNAL.registerComponent(new oe("storage-compat",Bx,"PUBLIC").setServiceProps(tD).setMultipleInstances(!0)),eD.registerVersion("@firebase/storage-compat","0.3.2");const jx="@firebase/performance",zx="0.6.4",$x=zx,Kx="FB-PERF-TRACE-MEASURE",Wx="@firebase/performance/config",Gx="@firebase/performance/configexpire";var Hx,Qx,Yx,Jx="Performance";const Xx=new D("performance",Jx,{"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."}),Zx=new me(Jx);Zx.logLevel=m.INFO;let eP,tP;class nP{constructor(e){if(!(this.window=e))throw Xx.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,n){this.performance&&this.performance.measure&&this.performance.measure(e,t,n)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&A()?!!C()||(Zx.info("IndexedDB is not supported by current browswer"),!1):(Zx.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,n){if(this.PerformanceObserver){const t=new this.PerformanceObserver(e=>{for(const t of e.getEntries())n(t)});t.observe({entryTypes:[e]})}}static getInstance(){return void 0===eP&&(eP=new nP(tP)),eP}}let rP;function iP(e,t){var n=e.length-t.length;if(n<0||1<n)throw Xx.create("invalid String merger input");const r=[];for(let i=0;i<e.length;i++)r.push(e.charAt(i)),t.length>i&&r.push(t.charAt(i));return r.join("")}let sP;class aP{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=iP("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=iP("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return void 0===sP&&(sP=new aP),sP}}(It=Hx=Hx||{})[It.UNKNOWN=0]="UNKNOWN",It[It.VISIBLE=1]="VISIBLE",It[It.HIDDEN=2]="HIDDEN";const oP=["firebase_","google_","ga_"],cP=new RegExp("^[a-zA-Z]\\w*$");function lP(){switch(nP.getInstance().document.visibilityState){case"visible":return Hx.VISIBLE;case"hidden":return Hx.HIDDEN;default:return Hx.UNKNOWN}}function uP(e){var t=null===(t=e.options)||void 0===t?void 0:t.appId;if(!t)throw Xx.create("no app id");return t}const hP="0.0.1",dP={loggingEnabled:!0},pP="FIREBASE_INSTALLATIONS_AUTH";function fP(e,t){var r,i,n=function(){const e=nP.getInstance().localStorage;if(e){var t=e.getItem(Gx);if(t&&function(e){return Number(e)>Date.now()}(t)){t=e.getItem(Wx);if(t)try{return JSON.parse(t)}catch(e){return}}}}();return n?(mP(n),Promise.resolve()):(i=t,function(e){const t=e.getToken();return t.then(e=>{}),t}((r=e).installations).then(e=>{var t=function(e){var t=null===(t=e.options)||void 0===t?void 0:t.projectId;if(!t)throw Xx.create("no project id");return t}(r.app),n=function(e){var t=null===(t=e.options)||void 0===t?void 0:t.apiKey;if(!t)throw Xx.create("no api key");return t}(r.app),n=new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${t}/namespaces/fireperf:fetch?key=${n}`,{method:"POST",headers:{Authorization:`${pP} ${e}`},body:JSON.stringify({app_instance_id:i,app_instance_id_token:e,app_id:uP(r.app),app_version:$x,sdk_version:hP})});return fetch(n).then(e=>{if(e.ok)return e.json();throw Xx.create("RC response not ok")})}).catch(()=>{Zx.info(gP)}).then(mP).then(e=>function(e){const t=nP.getInstance().localStorage;e&&t&&(t.setItem(Wx,JSON.stringify(e)),t.setItem(Gx,String(Date.now()+60*aP.getInstance().configTimeToLive*60*1e3)))}(e),()=>{}))}const gP="Could not fetch config, will use default configs";function mP(e){if(!e)return e;const t=aP.getInstance();var n=e.entries||{};return void 0!==n.fpr_enabled?t.loggingEnabled="true"===String(n.fpr_enabled):t.loggingEnabled=dP.loggingEnabled,n.fpr_log_source?t.logSource=Number(n.fpr_log_source):dP.logSource&&(t.logSource=dP.logSource),n.fpr_log_endpoint_url?t.logEndPointUrl=n.fpr_log_endpoint_url:dP.logEndPointUrl&&(t.logEndPointUrl=dP.logEndPointUrl),n.fpr_log_transport_key?t.transportKey=n.fpr_log_transport_key:dP.transportKey&&(t.transportKey=dP.transportKey),void 0!==n.fpr_vc_network_request_sampling_rate?t.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate):void 0!==dP.networkRequestsSamplingRate&&(t.networkRequestsSamplingRate=dP.networkRequestsSamplingRate),void 0!==n.fpr_vc_trace_sampling_rate?t.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate):void 0!==dP.tracesSamplingRate&&(t.tracesSamplingRate=dP.tracesSamplingRate),t.logTraceAfterSampling=vP(t.tracesSamplingRate),t.logNetworkAfterSampling=vP(t.networkRequestsSamplingRate),e}function vP(e){return Math.random()<=e}let yP=1,_P;function wP(e){var t;return yP=2,_P=_P||(t=e,function(){const n=nP.getInstance().document;return new Promise(e=>{if(n&&"complete"!==n.readyState){const t=()=>{"complete"===n.readyState&&(n.removeEventListener("readystatechange",t),e())};n.addEventListener("readystatechange",t)}else e()})}().then(()=>function(e){const t=e.getId();return t.then(e=>{rP=e}),t}(t.installations)).then(e=>fP(t,e)).then(()=>bP(),()=>bP())),_P}function bP(){yP=3}const IP=1e4,TP=3,EP=1e3;let kP=TP,SP=[],CP=!1;function NP(e){setTimeout(()=>{if(0!==kP)return SP.length?void function(){const e=SP.splice(0,EP),t=e.map(e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)})),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:aP.getInstance().logSource,log_event:t};!function(e,r){return function(e){var t=aP.getInstance().getFlTransportFullUrl();return fetch(t,{method:"POST",body:JSON.stringify(e)})}(e).then(e=>(e.ok||Zx.info("Call to Firebase backend failed."),e.json())).then(e=>{var t=Number(e.nextRequestWaitMillis);let n=IP;isNaN(t)||(n=Math.max(t,n));t=e.logResponseDetails;Array.isArray(t)&&0<t.length&&"RETRY_REQUEST_LATER"===t[0].responseAction&&(SP=[...r,...SP],Zx.info("Retry transport request later.")),kP=TP,NP(n)})}(n,e).catch(()=>{SP=[...e,...SP],kP--,Zx.info(`Tries left: ${kP}.`),NP(IP)})}():NP(IP)},e)}function AP(t){return(...e)=>{!function(e){if(!e.eventTime||!e.message)throw Xx.create("invalid cc log");SP=[...SP,e]}({message:t(...e),eventTime:Date.now()})}}let RP;function DP(e,t){RP=RP||AP(OP),RP(e,t)}function xP(e){var t=aP.getInstance();!t.instrumentationEnabled&&e.isAuto||(t.dataCollectionEnabled||e.isAuto)&&nP.getInstance().requiredApisAvailable()&&(e.isAuto&&lP()!==Hx.VISIBLE||(3===yP?PP(e):wP(e.performanceController).then(()=>PP(e),()=>PP(e))))}function PP(e){var t;!rP||(t=aP.getInstance()).loggingEnabled&&t.logTraceAfterSampling&&setTimeout(()=>DP(e,1),0)}function OP(e,t){return 0===t?(n={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},n={application_info:MP(e.performanceController.app),network_request_metric:n},JSON.stringify(n)):function(e){const t={name:e.name,is_auto:e.isAuto,client_start_time_us:e.startTimeUs,duration_us:e.durationUs};0!==Object.keys(e.counters).length&&(t.counters=e.counters);var n=e.getAttributes();0!==Object.keys(n).length&&(t.custom_attributes=n);n={application_info:MP(e.performanceController.app),trace_metric:t};return JSON.stringify(n)}(e);var n}function MP(e){return{google_app_id:uP(e),app_instance_id:rP,web_app_info:{sdk_version:$x,page_url:nP.getInstance().getUrl(),service_worker_status:null!=(t=nP.getInstance().navigator)&&t.serviceWorker?t.serviceWorker.controller?2:3:1,visibility_state:lP(),effective_connection_type:function(){var e=nP.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0};var t}const LP=["_fp","_fcp","_fid"];class FP{constructor(e,t,n=!1,r){this.performanceController=e,this.name=t,this.isAuto=n,this.state=1,this.customAttributes={},this.counters={},this.api=nP.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`FB-PERF-TRACE-START-${this.randomId}-${this.name}`,this.traceStopMark=`FB-PERF-TRACE-STOP-${this.randomId}-${this.name}`,this.traceMeasure=r||`${Kx}-${this.randomId}-${this.name}`,r&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw Xx.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw Xx.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),xP(this)}record(e,t,n){if(e<=0)throw Xx.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw Xx.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),n&&n.attributes&&(this.customAttributes=Object.assign({},n.attributes)),n&&n.metrics)for(const r of Object.keys(n.metrics))isNaN(Number(n.metrics[r]))||(this.counters[r]=Math.floor(Number(n.metrics[r])));xP(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(r=e,i=this.name,0===r.length||100<r.length||!(i&&i.startsWith("_wt_")&&-1<LP.indexOf(r))&&r.startsWith("_"))throw Xx.create("invalid custom metric name",{customMetricName:e});var n,r,i;this.counters[e]=(t=null!=t?t:0,(n=Math.floor(t))<t&&Zx.info(`Metric value should be an Integer, setting the value as : ${n}.`),n)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){var n,r,i=!(0===(n=e).length||40<n.length)&&(!oP.some(e=>n.startsWith(e))&&!!n.match(cP)),s=0!==(r=t).length&&r.length<=100;if(i&&s)this.customAttributes[e]=t;else{if(!i)throw Xx.create("invalid attribute name",{attributeName:e});if(!s)throw Xx.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){var e=this.api.getEntriesByName(this.traceMeasure),e=e&&e[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,n,r){var i=nP.getInstance().getUrl();if(i){const s=new FP(e,"_wt_"+i,!0);i=Math.floor(1e3*nP.getInstance().getTimeOrigin());s.setStartTime(i),t&&t[0]&&(s.setDuration(Math.floor(1e3*t[0].duration)),s.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),s.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),s.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd)));n&&((i=n.find(e=>"first-paint"===e.name))&&i.startTime&&s.putMetric("_fp",Math.floor(1e3*i.startTime)),(i=n.find(e=>"first-contentful-paint"===e.name))&&i.startTime&&s.putMetric("_fcp",Math.floor(1e3*i.startTime)),r&&s.putMetric("_fid",Math.floor(1e3*r))),xP(s)}}static createUserTimingTrace(e,t){xP(new FP(e,t,!1,t))}}function UP(e,t){const n=t;var r,i,s;n&&void 0!==n.responseStart&&(s=nP.getInstance().getTimeOrigin(),r=Math.floor(1e3*(n.startTime+s)),i=n.responseStart?Math.floor(1e3*(n.responseStart-n.startTime)):void 0,s=Math.floor(1e3*(n.responseEnd-n.startTime)),function(e){const t=aP.getInstance();var n,r,i;t.instrumentationEnabled&&(n=e.url,r=t.logEndPointUrl.split("?")[0],i=t.flTransportEndpointUrl.split("?")[0],n!==r&&n!==i&&t.loggingEnabled&&t.logNetworkAfterSampling&&setTimeout(()=>DP(e,0),0))}({performanceController:e,url:n.name&&n.name.split("?")[0],responsePayloadBytes:n.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:s}))}const qP=5e3;function VP(e){rP&&(setTimeout(()=>function(n){const e=nP.getInstance(),r=e.getEntriesByType("navigation"),i=e.getEntriesByType("paint");if(e.onFirstInputDelay){let t=setTimeout(()=>{FP.createOobTrace(n,r,i),t=void 0},qP);e.onFirstInputDelay(e=>{t&&(clearTimeout(t),FP.createOobTrace(n,r,i,e))})}else FP.createOobTrace(n,r,i)}(e),0),setTimeout(()=>function(t){const e=nP.getInstance(),n=e.getEntriesByType("resource");for(const r of n)UP(t,r);e.setupObserver("resource",e=>UP(t,e))}(e),0),setTimeout(()=>function(t){const e=nP.getInstance(),n=e.getEntriesByType("measure");for(const r of n)BP(t,r);e.setupObserver("measure",e=>BP(t,e))}(e),0))}function BP(e,t){const n=t.name;n.substring(0,Kx.length)!==Kx&&FP.createUserTimingTrace(e,n)}class jP{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null==e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null==e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),nP.getInstance().requiredApisAvailable()?N().then(e=>{e&&(CP||(NP(5500),CP=!0),wP(this).then(()=>VP(this),()=>VP(this)),this.initialized=!0)}).catch(e=>{Zx.info(`Environment doesn't support IndexedDB: ${e}`)}):Zx.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){aP.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return aP.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){aP.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return aP.getInstance().dataCollectionEnabled}}const zP="[DEFAULT]";const $P=(e,{options:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if(n.name!==zP)throw Xx.create("FB not default");if("undefined"==typeof window)throw Xx.create("no window");e=window,tP=e;const i=new jP(n,r);return i._init(t),i};We(new oe("performance",$P,"PUBLIC")),et(jx,zx),et(jx,zx,"esm2017");class KP{constructor(e,t){this.app=e,this._delegate=t}get instrumentationEnabled(){return this._delegate.instrumentationEnabled}set instrumentationEnabled(e){this._delegate.instrumentationEnabled=e}get dataCollectionEnabled(){return this._delegate.dataCollectionEnabled}set dataCollectionEnabled(e){this._delegate.dataCollectionEnabled=e}trace(e){return t=this._delegate,e=e,t=ae(t),new FP(t,e);var t}}function WP(e){var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("performance").getImmediate();return new KP(t,n)}(Qx=wt).INTERNAL.registerComponent(new oe("performance-compat",WP,"PUBLIC")),Qx.registerVersion("@firebase/performance-compat","0.2.4");const GP="@firebase/remote-config";class HP{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}const QP=new D("remoteconfig","Remote Config",{"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"});const YP=["1","true","t","yes","y","on"];class JP{constructor(e,t=""){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return"static"!==this._source&&0<=YP.indexOf(this._value.toLowerCase())}asNumber(){if("static"===this._source)return 0;let e=Number(this._value);return isNaN(e)&&(e=0),e}getSource(){return this._source}}async function XP(e){const t=ae(e);var[n,r]=await Promise.all([t._storage.getLastSuccessfulFetchResponse(),t._storage.getActiveConfigEtag()]);return!!(n&&n.config&&n.eTag&&n.eTag!==r)&&(await Promise.all([t._storageCache.setActiveConfig(n.config),t._storage.setActiveConfigEtag(n.eTag)]),!0)}function ZP(e){const t=ae(e);return t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0})),t._initializePromise}async function eO(t){const n=ae(t),e=new HP;setTimeout(async()=>{e.abort()},n.settings.fetchTimeoutMillis);try{await n._client.fetch({cacheMaxAgeMillis:n.settings.minimumFetchIntervalMillis,signal:e}),await n._storageCache.setLastFetchStatus("success")}catch(e){var r=(i="fetch-throttle",(t=e)instanceof R&&-1!==t.code.indexOf(i)?"throttle":"failure");throw await n._storageCache.setLastFetchStatus(r),e}var i}function tO(n){const e=ae(n);return[t={},r={}]=[e._storageCache.getActiveConfig(),e.defaultConfig],Object.keys(Object.assign(Object.assign({},t),r)).reduce((e,t)=>(e[t]=nO(n,t),e),{});var t,r}function nO(e,t){const n=ae(e);n._isInitializationComplete||n._logger.debug(`A value was requested for key "${t}" before SDK initialization completed.`+" Await on ensureInitialized if the intent was to get a previously activated value.");var r=n._storageCache.getActiveConfig();return r&&void 0!==r[t]?new JP("remote",r[t]):n.defaultConfig&&void 0!==n.defaultConfig[t]?new JP("default",String(n.defaultConfig[t])):(n._logger.debug(`Returning static value for key "${t}".`+" Define a default or remote value if this is unintentional."),new JP("static"))}class rO{constructor(e,t,n,r){this.client=e,this.storage=t,this.storageCache=n,this.logger=r}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-t,r=n<=e;return this.logger.debug("Config fetch cache check."+` Cache age millis: ${n}.`+` Cache max age millis (minimumFetchIntervalMillis setting): ${e}.`+` Is cache hit: ${r}.`),r}async fetch(e){var[t,n]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(n&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return n;e.eTag=n&&n.eTag;n=await this.client.fetch(e);const r=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===n.status&&r.push(this.storage.setLastSuccessfulFetchResponse(n)),await Promise.all(r),n}}class iO{constructor(e,t,n,r,i,s){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=s}async fetch(n){var e,[t,r]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),i=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,s={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":n.eTag||"*"},r={sdk_version:this.sdkVersion,app_instance_id:t,app_instance_id_token:r,app_id:this.appId,language_code:(e=navigator).languages&&e.languages[0]||e.language},r={method:"POST",headers:s,body:JSON.stringify(r)},i=fetch(i,r),r=new Promise((e,t)=>{n.signal.addEventListener(()=>{const e=new Error("The operation was aborted.");e.name="AbortError",t(e)})});let a;try{await Promise.race([i,r]),a=await i}catch(e){let t="fetch-client-network";throw"AbortError"===(null==e?void 0:e.name)&&(t="fetch-timeout"),QP.create(t,{originalErrorMessage:null==e?void 0:e.message})}let o=a.status;i=a.headers.get("ETag")||void 0;let c,l;if(200===a.status){let e;try{e=await a.json()}catch(e){throw QP.create("fetch-client-parse",{originalErrorMessage:null==e?void 0:e.message})}c=e.entries,l=e.state}if("INSTANCE_STATE_UNSPECIFIED"===l?o=500:"NO_CHANGE"===l?o=304:"NO_TEMPLATE"!==l&&"EMPTY_CONFIG"!==l||(c={}),304!==o&&200!==o)throw QP.create("fetch-status",{httpStatus:o});return{status:o,eTag:i,config:c}}}class sO{constructor(e,t){this.client=e,this.storage=t}async fetch(e){var t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(t,{throttleEndTimeMillis:e,backoffCount:n}){var i,s;i=t.signal,s=e,await new Promise((e,t)=>{var n=Math.max(s-Date.now(),0);const r=setTimeout(e,n);i.addEventListener(()=>{clearTimeout(r),t(QP.create("fetch-throttle",{throttleEndTimeMillis:s}))})});try{var r=await this.client.fetch(t);return await this.storage.deleteThrottleMetadata(),r}catch(e){if(!function(e){if(e instanceof R&&e.customData){var t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}}(e))throw e;r={throttleEndTimeMillis:Date.now()+se(n),backoffCount:n+1};return await this.storage.setThrottleMetadata(r),this.attemptFetch(t,r)}}}class aO{constructor(e,t,n,r,i){this.app=e,this._client=t,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}function oO(e,t){var n=e.target.error||void 0;return QP.create(t,{originalErrorMessage:n&&(null==n?void 0:n.message)})}const cO="app_namespace_store";class lO{constructor(e,t,n,r=function(){return new Promise((t,n)=>{try{const e=indexedDB.open("firebase_remote_config",1);e.onerror=e=>{n(oO(e,"storage-open"))},e.onsuccess=e=>{t(e.target.result)},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(cO,{keyPath:"compositeKey"})}}catch(e){n(QP.create("storage-open",{originalErrorMessage:null==e?void 0:e.message}))}})}()){this.appId=e,this.appName=t,this.namespace=n,this.openDbPromise=r}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(a){const o=await this.openDbPromise;return new Promise((n,t)=>{const e=o.transaction([cO],"readonly"),r=e.objectStore(cO);var i=this.createCompositeKey(a);try{const s=r.get(i);s.onerror=e=>{t(oO(e,"storage-get"))},s.onsuccess=e=>{var t=e.target.result;n(t?t.value:void 0)}}catch(e){t(QP.create("storage-get",{originalErrorMessage:null==e?void 0:e.message}))}})}async set(a,o){const c=await this.openDbPromise;return new Promise((e,t)=>{const n=c.transaction([cO],"readwrite"),r=n.objectStore(cO);var i=this.createCompositeKey(a);try{const s=r.put({compositeKey:i,value:o});s.onerror=e=>{t(oO(e,"storage-set"))},s.onsuccess=()=>{e()}}catch(e){t(QP.create("storage-set",{originalErrorMessage:null==e?void 0:e.message}))}})}async delete(a){const o=await this.openDbPromise;return new Promise((e,t)=>{const n=o.transaction([cO],"readwrite"),r=n.objectStore(cO);var i=this.createCompositeKey(a);try{const s=r.delete(i);s.onerror=e=>{t(oO(e,"storage-delete"))},s.onsuccess=()=>{e()}}catch(e){t(QP.create("storage-delete",{originalErrorMessage:null==e?void 0:e.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class uO{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){var e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),n=this.storage.getActiveConfig(),e=await e;e&&(this.lastFetchStatus=e);t=await t;t&&(this.lastSuccessfulFetchTimestampMillis=t);n=await n;n&&(this.activeConfig=n)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}async function hO(){if(!C())return!1;try{return await N()}catch(e){return!1}}We(new oe("remote-config",function(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("undefined"==typeof window)throw QP.create("registration-window");if(!C())throw QP.create("indexed-db-unavailable");var{projectId:i,apiKey:s,appId:a}=n.options;if(!i)throw QP.create("registration-project-id");if(!s)throw QP.create("registration-api-key");if(!a)throw QP.create("registration-app-id");t=t||"firebase";const o=new lO(a,n.name,t),c=new uO(o),l=new me(GP);l.logLevel=m.ERROR;a=new iO(r,Ye,t,i,s,a),a=new sO(a,o),a=new rO(a,o,c,l),a=new aO(n,a,c,o,l);return ZP(a),a},"PUBLIC").setMultipleInstances(!0)),et(GP,"0.4.4"),et(GP,"0.4.4","esm2017");class dO{constructor(e,t){this.app=e,this._delegate=t}get defaultConfig(){return this._delegate.defaultConfig}set defaultConfig(e){this._delegate.defaultConfig=e}get fetchTimeMillis(){return this._delegate.fetchTimeMillis}get lastFetchStatus(){return this._delegate.lastFetchStatus}get settings(){return this._delegate.settings}set settings(e){this._delegate.settings=e}activate(){return XP(this._delegate)}ensureInitialized(){return ZP(this._delegate)}fetch(){return eO(this._delegate)}fetchAndActivate(){return async function(e){return await eO(e=ae(e)),XP(e)}(this._delegate)}getAll(){return tO(this._delegate)}getBoolean(e){return nO(ae(this._delegate),e).asBoolean()}getNumber(e){return nO(ae(this._delegate),e).asNumber()}getString(e){return nO(ae(this._delegate),e).asString()}getValue(e){return nO(this._delegate,e)}setLogLevel(e){!function(e,t){const n=ae(e);switch(t){case"debug":n._logger.logLevel=m.DEBUG;break;case"silent":n._logger.logLevel=m.SILENT;break;default:n._logger.logLevel=m.ERROR}}(this._delegate,e)}}function pO(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("remote-config").getImmediate({identifier:t});return new dO(n,r)}return(Yx=wt).INTERNAL.registerComponent(new oe("remoteConfig-compat",pO,"PUBLIC").setMultipleInstances(!0).setServiceProps({isSupported:hO})),Yx.registerVersion("@firebase/remote-config-compat","0.2.4"),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),wt.registerVersion("firebase","9.19.1","compat-cdn"),wt});
//# sourceMappingURL=firebase-compat.js.map
