{"ast":null,"code":"import _objectSpread from\"C:/Users/TRETEC/Desktop/Software Engineering/Tp/code/Expense Tracker Website/light-bootstrap-dashboard-react/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"C:/Users/TRETEC/Desktop/Software Engineering/Tp/code/Expense Tracker Website/light-bootstrap-dashboard-react/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _createForOfIteratorHelper from\"C:/Users/TRETEC/Desktop/Software Engineering/Tp/code/Expense Tracker Website/light-bootstrap-dashboard-react/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _asyncToGenerator from\"C:/Users/TRETEC/Desktop/Software Engineering/Tp/code/Expense Tracker Website/light-bootstrap-dashboard-react/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/TRETEC/Desktop/Software Engineering/Tp/code/Expense Tracker Website/light-bootstrap-dashboard-react/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState}from\"react\";import{MDBContainer,MDBInput,MDBBtn,MDBFile}from\"mdb-react-ui-kit\";// import Form from 'react-bootstrap/Form';\nimport{Link,Navigate,useNavigate}from\"react-router-dom\";import{createUserWithEmailAndPassword,updateProfile}from\"firebase/auth\";import{auth,db,storage}from\"../database/firebase\";import{ref,uploadBytesResumable,getDownloadURL}from\"firebase/storage\";import{collection,query,where,getDocs,doc,setDoc,updateDoc,addDoc}from\"firebase/firestore\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LIST_OF_CATEGORIES=[\"Fruits\",\"Vegetables\",\"Fun\",\"Luxury\",\"Other\"];function App(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),err=_useState2[0],setErr=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),successfulCreation=_useState4[0],setSuccessfullCreation=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isSubUser=_useState8[0],setIsSubUser=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),subUserCode=_useState10[0],setSubUserCode=_useState10[1];var navigate=useNavigate();var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(e){var fullName,userName,email,password,country,city,imageFile,res,date,storageRef,_res,_date,_storageRef;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:setLoading(true);e.preventDefault();fullName=e.target[0].value;userName=e.target[1].value;email=e.target[2].value;password=e.target[3].value;country=e.target[4].value;city=e.target[5].value;imageFile=e.target[6].files[0];if(isSubUser){_context4.next=28;break;}_context4.prev=10;_context4.next=13;return createUserWithEmailAndPassword(auth,email,password);case 13:res=_context4.sent;date=new Date().getTime();storageRef=ref(storage,\"\".concat(userName+date));uploadBytesResumable(storageRef,imageFile).then(function(){getDownloadURL(storageRef).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(downloadUrl){var _iterator,_step,category;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return updateProfile(res.user,{userName:userName,photoURL:downloadUrl});case 3:_context.next=5;return setDoc(doc(db,\"users\",res.user.uid),{uid:res.user.uid,userName:userName,fullName:fullName,email:email,income:0,photoURL:downloadUrl,city:city,country:country});case 5:// setting the document in the categories db\n_iterator=_createForOfIteratorHelper(LIST_OF_CATEGORIES);_context.prev=6;_iterator.s();case 8:if((_step=_iterator.n()).done){_context.next=14;break;}category=_step.value;_context.next=12;return addDoc(collection(db,\"Expenses Categories\"),{user_id:res.user.uid,expenseCategory:category,numberOfExpenses:0});case 12:_context.next=8;break;case 14:_context.next=19;break;case 16:_context.prev=16;_context.t0=_context[\"catch\"](6);_iterator.e(_context.t0);case 19:_context.prev=19;_iterator.f();return _context.finish(19);case 22:_context.next=29;break;case 24:_context.prev=24;_context.t1=_context[\"catch\"](0);console.log(_context.t1);setErr(true);setLoading(false);case 29:case\"end\":return _context.stop();}},_callee,null,[[0,24],[6,16,19,22]]);}));return function(_x2){return _ref2.apply(this,arguments);};}());});_context4.next=24;break;case 19:_context4.prev=19;_context4.t0=_context4[\"catch\"](10);console.log(_context4.t0);setErr(true);setLoading(false);case 24:setSuccessfullCreation(true);setTimeout(function(){setSuccessfullCreation(false);navigate(\"/\");// return <Navigate to='/' />\n},4000);_context4.next=44;break;case 28:_context4.prev=28;_context4.next=31;return createUserWithEmailAndPassword(auth,email,password);case 31:_res=_context4.sent;_date=new Date().getTime();_storageRef=ref(storage,\"\".concat(userName+_date));uploadBytesResumable(_storageRef,imageFile).then(function(){getDownloadURL(_storageRef).then(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(downloadUrl){var q,querySnapshot,_iterator2,_step2,category;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return updateProfile(_res.user,{userName:userName,photoURL:downloadUrl});case 3:q=query(collection(db,\"users\"),where(\"sub_user_code\",\"==\",subUserCode));_context3.next=6;return getDocs(q);case 6:querySnapshot=_context3.sent;querySnapshot.forEach(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(docSnapshot){var userRef;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:userRef=doc(db,\"users\",docSnapshot.id);_context2.next=3;return updateDoc(userRef,_objectSpread(_objectSpread({},doc),{},{uid:_res.user.uid,userName:userName,fullName:fullName,email:email,photoURL:downloadUrl,city:city,country:country,activated:true}));case 3:case\"end\":return _context2.stop();}},_callee2);}));return function(_x4){return _ref4.apply(this,arguments);};}());// setting the document in the categories db\n_iterator2=_createForOfIteratorHelper(LIST_OF_CATEGORIES);_context3.prev=9;_iterator2.s();case 11:if((_step2=_iterator2.n()).done){_context3.next=17;break;}category=_step2.value;_context3.next=15;return addDoc(collection(db,\"Expenses Categories\"),{user_id:subUserCode,expenseCategory:category,numberOfExpenses:0});case 15:_context3.next=11;break;case 17:_context3.next=22;break;case 19:_context3.prev=19;_context3.t0=_context3[\"catch\"](9);_iterator2.e(_context3.t0);case 22:_context3.prev=22;_iterator2.f();return _context3.finish(22);case 25:_context3.next=32;break;case 27:_context3.prev=27;_context3.t1=_context3[\"catch\"](0);console.log(_context3.t1);setErr(true);setLoading(false);case 32:case\"end\":return _context3.stop();}},_callee3,null,[[0,27],[9,19,22,25]]);}));return function(_x3){return _ref3.apply(this,arguments);};}());});_context4.next=42;break;case 37:_context4.prev=37;_context4.t1=_context4[\"catch\"](28);console.log(_context4.t1);setErr(true);setLoading(false);case 42:setSuccessfullCreation(true);setTimeout(function(){setSuccessfullCreation(false);navigate(\"/\");},4000);case 44:case\"end\":return _context4.stop();}},_callee4,null,[[10,19],[28,37]]);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(MDBContainer,{className:\"p-3 my-2 d-flex flex-column w-50\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"mb-5 text-center\",children:\"Join Us !\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"w-100\",children:[/*#__PURE__*/_jsx(MDBInput,{wrapperClass:\"mb-4\",label:\"Full Name\",id:\"form-full-name\",type:\"text\",required:true}),/*#__PURE__*/_jsx(MDBInput,{wrapperClass:\"mb-4\",label:\"User Name\",id:\"form-user-name\",type:\"text\",required:true}),/*#__PURE__*/_jsx(MDBInput,{wrapperClass:\"mb-4\",label:\"Email address\",id:\"form-email\",type:\"email\",required:true}),/*#__PURE__*/_jsx(MDBInput,{wrapperClass:\"mb-4\",label:\"Password\",id:\"form-pass\",type:\"password\",required:true}),/*#__PURE__*/_jsx(MDBInput,{wrapperClass:\"mb-4\",label:\"Country\",id:\"form-country\",type:\"text\",required:true}),/*#__PURE__*/_jsx(MDBInput,{wrapperClass:\"mb-4\",label:\"City\",id:\"form-city\",type:\"text\",required:true}),/*#__PURE__*/_jsx(MDBFile,{className:\"mb-4 border-0\",label:\"Image\",id:\"form-file\",required:true}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"issubuser\",className:\"mr-2\",style:{fontSize:\"1.1rem\"},children:\"Are you registering as a sub user ?\"}),/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",id:\"issubuser\",checked:isSubUser,style:{marginTop:\"2px\",height:\"20px\",width:\"20px\"},onChange:function onChange(e){return setIsSubUser(e.target.checked);}})]}),isSubUser&&/*#__PURE__*/_jsx(MDBInput,{wrapperClass:\"mb-4 mt-2\",label:\"Enter the provided code\",id:\"form-city\",type:\"text\",value:subUserCode,onChange:function onChange(e){return setSubUserCode(e.target.value);}}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-primary\",children:\"Sign up\"}),/*#__PURE__*/_jsx(\"br\",{}),err&&/*#__PURE__*/_jsx(\"span\",{className:\"title mt-1 text-danger\",children:\" An error has happened, Retry ... \"}),successfulCreation&&/*#__PURE__*/_jsxs(\"span\",{className:\"title mt-1 text-success\",style:{fontSize:\"1rem\"},children:[\" \",\"Account created successfully, Wait ...\",\" \"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-center mt-3\",children:/*#__PURE__*/_jsxs(\"p\",{children:[\"Already have an account ? \",/*#__PURE__*/_jsx(Link,{to:\"/user/login\",children:\" Login\"})]})})]});}export default App;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}