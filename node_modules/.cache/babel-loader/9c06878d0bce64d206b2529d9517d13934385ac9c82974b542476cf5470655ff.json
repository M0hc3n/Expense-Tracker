{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/TRETEC/Desktop/Software Engineering/Tp/code/Expense Tracker Website/light-bootstrap-dashboard-react/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/TRETEC/Desktop/Software Engineering/Tp/code/Expense Tracker Website/light-bootstrap-dashboard-react/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/TRETEC/Desktop/Software Engineering/Tp/code/Expense Tracker Website/light-bootstrap-dashboard-react/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useContext,useState}from\"react\";// react-bootstrap components\nimport{Button,Card,Form,Container,Row,Dropdown,Col}from\"react-bootstrap\";import{collection,updateDoc,addDoc,doc,FieldValue,query,where,getDocs}from\"firebase/firestore\";import{AuthContext}from\"context/AuthContext\";import{db}from\"database/firebase\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function AddExpense(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),successfulCreation=_useState2[0],setSuccessfullCreation=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],setError=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),errorMessage=_useState6[0],setErrorMessage=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),expenseName=_useState8[0],setExpenseName=_useState8[1];var _useState9=useState(\"Fruits\"),_useState10=_slicedToArray(_useState9,2),expenseCategory=_useState10[0],setExpenseCategory=_useState10[1];var _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),expenseUnitPrice=_useState12[0],setExpenseUnitPrice=_useState12[1];var _useState13=useState(0),_useState14=_slicedToArray(_useState13,2),expenseTotalPrice=_useState14[0],setExpenseTotalPrice=_useState14[1];var _useContext=useContext(AuthContext),currentUser=_useContext.currentUser,userInfo=_useContext.userInfo;var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(e){var userRef,today,date,time,dateTime,q,querySnapshot,userExpensesCategories;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:e.preventDefault();setError(false);setErrorMessage(\"\");_context2.prev=3;userRef=doc(db,\"users\",userInfo.is_sub_user?userInfo.document_id:currentUser.uid);if(!(parseInt(userInfo.income)>expenseTotalPrice)){_context2.next=23;break;}today=new Date();date=today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();time=today.getHours()+\":\"+today.getMinutes()+\":\"+today.getSeconds();dateTime=date+' '+time;// adding the expense\n_context2.next=12;return addDoc(collection(db,\"Expenses\"),{user_id:currentUser.uid,expenseName:expenseName,expenseCategory:expenseCategory,expenseUnitPrice:expenseUnitPrice,expenseTotalPrice:expenseTotalPrice,created_at:dateTime});case 12:_context2.next=14;return updateDoc(userRef,{income:parseInt(userInfo.income)-expenseTotalPrice});case 14:// incrementing the number of expenses in that category\nq=query(collection(db,\"Expenses Categories\"),where(\"user_id\",\"==\",userInfo.is_sub_user?userInfo.sub_user_code:currentUser.uid),where(\"expenseCategory\",\"==\",expenseCategory));_context2.next=17;return getDocs(q);case 17:querySnapshot=_context2.sent;userExpensesCategories=querySnapshot.docs[0].ref;querySnapshot.forEach(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(document){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return updateDoc(userExpensesCategories,{numberOfExpenses:document.data()[\"numberOfExpenses\"]+1});case 2:case\"end\":return _context.stop();}},_callee);}));return function(_x2){return _ref2.apply(this,arguments);};}());setSuccessfullCreation(true);_context2.next=26;break;case 23:setSuccessfullCreation(false);setError(true);setErrorMessage(\"The expense given exceeds your current balance of $ \".concat(userInfo.income,\".\"));case 26:_context2.next=35;break;case 28:_context2.prev=28;_context2.t0=_context2[\"catch\"](3);console.log(_context2.t0);errorMessage(\"\");setError(true);setSuccessfullCreation(false);return _context2.abrupt(\"return\");case 35:setTimeout(function(){setSuccessfullCreation(false);},4000);case 36:case\"end\":return _context2.stop();}},_callee2,null,[[3,28]]);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();var handleChange=function handleChange(e){setExpenseCategory(e.target.value);};return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Container,{fluid:true,children:/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{md:\"12\",children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(Card.Header,{children:/*#__PURE__*/_jsx(Card.Title,{as:\"h4\",children:\"Add Expense\"})}),/*#__PURE__*/_jsx(Card.Body,{children:/*#__PURE__*/_jsxs(Form,{onSubmit:function onSubmit(e){return handleSubmit(e);},children:[/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{className:\" px-1 ml-2\",md:\"5\",children:/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Expense Name\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",value:expenseName,onChange:function onChange(e){return setExpenseName(e.target.value);},required:true})]})}),/*#__PURE__*/_jsx(Col,{className:\"pl-1\",md:\"5\",children:/*#__PURE__*/_jsxs(Dropdown,{className:\"d-flex form-select flex-column ml-2 my-2 h-25\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"dropdown\",children:\"Category\"}),/*#__PURE__*/_jsxs(\"select\",{id:\"dropdown\",className:\"form-control\",onChange:handleChange,children:[/*#__PURE__*/_jsx(\"option\",{value:\"Fruits\",children:\"Fruits\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Vegetables\",children:\"Vegetables\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Fun\",children:\"Fun\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Luxury\",children:\"Luxury\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Other\",children:\"Other\"})]})]})})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{className:\"pr-1\",md:\"4\",children:/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Expense Unit Price\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"number\",value:expenseUnitPrice,onChange:function onChange(e){return setExpenseUnitPrice(e.target.value);},min:\"0\",required:true})]})}),/*#__PURE__*/_jsx(Col,{className:\"pr-1\",md:\"6\",children:/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Expense Total Price\"}),/*#__PURE__*/_jsx(Form.Control,{value:expenseTotalPrice,onChange:function onChange(e){return setExpenseTotalPrice(e.target.value);},type:\"number\",min:\"0\",required:true})]})})]}),/*#__PURE__*/_jsx(Button,{className:\"btn-fill pull-right mt-1\",type:\"submit\",variant:\"info\",children:\"Add Expense\"}),successfulCreation&&/*#__PURE__*/_jsx(\"div\",{className:\"clearfix mt-2\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-success\",children:\"Expense Added Successfully\"})}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"clearfix mt-2\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-danger\",children:errorMessage.length>0?errorMessage:\"Encountered an issue while adding expense... Retry Again\"})})]})})]})})})})});}export default AddExpense;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}